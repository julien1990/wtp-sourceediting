<project xmlns:au="antlib:org.apache.ant.antunit" xmlns="antlib:org.apache.tools.ant" default="run">

	<property name="relengCommonBuilderDir" location="../../" />
	<taskdef uri="antlib:org.apache.ant.antunit" resource="org/apache/ant/antunit/antlib.xml">
		<classpath>
			<pathelement location="${relengCommonBuilderDir}/lib/ant-antunit.jar" />
			<pathelement location="../lib/ant-antunit.jar" />
			<pathelement location="./lib/ant-antunit.jar" />
		</classpath>
	</taskdef>
	
	<import file="pmd.xml"/>

	<!-- is called prior to the test -->
	<target name="setUp">
	    <property name="writableBuildRoot" location="build"/>
		<property name="workspace" location=".."/>
		<property name="sdkzipUrl" value="https://build.eclipse.org/hudson/job/cbi-wtp-wst.xsl.psychopath/128/artifact/build/athena/"/>
		<property name="zipPrefix" value="wst-xpath2-psychopath"/>
		<property name="buildType" value="N"/>
	    <property name="buildTimestamp" value="200912041353"/>
	</target>

	<!-- is called after the test, even if that caused an error -->
	<target name="tearDown">
		<delete file="${writableBuildRoot}/downloads/pmd.zip"/>
		<delete dir="${writableBuildRoot}/3rdPartyJars/pmd"/>
	</target>

	<target name="testGetPMD">
		<getPMD downloadDir="${writableBuildRoot}/downloads" destDir="${writableBuildRoot}/3rdPartyJars/pmd"/>
		<au:assertFileExists file="${writableBuildRoot}/downloads/pmd.zip" message="Did not find pmd.zip"/>
		<au:assertFileExists file="${writableBuildRoot}/3rdPartyJars/pmd/pmd-4.2.5/lib/pmd-4.2.5.jar"/>
	</target>
		
	<!-- test the MacroDef for downloading Files -->
	<target name="testCPD">
		<patternset id="xpathjars">
			<include name="eclipse/plugins/org.eclipse.wst.xml.xpath2.processor*.jar"/>
		</patternset>
		<getPMD downloadDir="${writableBuildRoot}/downloads" destDir="${writableBuildRoot}/3rdPartyJars/pmd"/>
		<cpd srcdir="${workspace}/org.eclipse.wst.xml.xpath2.processor" outputfile="${writableBuildRoot}/athena/cpd-xpath20processor.xml"/>
		<au:assertFileExists file="${writableBuildRoot}/athena/cpd-xpath20processor.xml"/>
	</target>
	
	<target name="run">
		<au:antunit>
			<fileset dir="${basedir}" includes="pmd.test.xml" excludes="*AllTaskTests.test.xml" />
			<au:plainlistener />
		</au:antunit>
	</target>

</project>