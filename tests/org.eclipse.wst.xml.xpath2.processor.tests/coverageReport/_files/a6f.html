<HTML><HEAD><META CONTENT="text/html; charset=UTF-8" HTTP-EQUIV="Content-Type"/><TITLE>EMMA Coverage Report</TITLE><STYLE TYPE="text/css"> TABLE,TD,TH {border-style:solid; border-color:black;} TD,TH {background:white;margin:0;line-height:100%;padding-left:0.5em;padding-right:0.5em;} TD {border-width:0 1px 0 0;} TH {border-width:1px 1px 1px 0;} TR TD.h {color:red;} TABLE {border-spacing:0; border-collapse:collapse;border-width:0 0 1px 1px;} P,H1,H2,H3,TH {font-family:verdana,arial,sans-serif;font-size:10pt;} TD {font-family:courier,monospace;font-size:10pt;} TABLE.hdft {border-spacing:0;border-collapse:collapse;border-style:none;} TABLE.hdft TH,TABLE.hdft TD {border-style:none;line-height:normal;} TABLE.hdft TH.tl,TABLE.hdft TD.tl {background:#6699CC;color:white;} TABLE.hdft TD.nv {background:#6633DD;color:white;} .nv A:link {color:white;} .nv A:visited {color:white;} .nv A:active {color:yellow;} TABLE.hdft A:link {color:white;} TABLE.hdft A:visited {color:white;} TABLE.hdft A:active {color:yellow;} .in {color:#356085;} TABLE.s TD {padding-left:0.25em;padding-right:0.25em;} TABLE.s TD.l {padding-left:0.25em;padding-right:0.25em;text-align:right;background:#F0F0F0;} TABLE.s TR.z TD {background:#FF9999;} TABLE.s TR.p TD {background:#FFFF88;} TABLE.s TR.c TD {background:#CCFFCC;} A:link {color:#0000EE;text-decoration:none;} A:visited {color:#0000EE;text-decoration:none;} A:hover {color:#0000EE;text-decoration:underline;} TABLE.cn {border-width:0 0 1px 0;} TABLE.s {border-width:1px 0 1px 1px;} TD.h {color:red;border-width:0 1px 0 0;} TD.f {border-width:0 1px 0 1px;} TD.hf {color:red;border-width:0 1px 0 1px;} TH.f {border-width:1px 1px 1px 1px;} TR.cis TD {background:#F0F0F0;} TR.cis TD {border-width:1px 1px 1px 0;} TR.cis TD.h {color:red;border-width:1px 1px 1px 0;} TR.cis TD.f {border-width:1px 1px 1px 1px;} TR.cis TD.hf {color:red;border-width:1px 1px 1px 1px;} TD.b {border-style:none;background:transparent;line-height:50%;}  TD.bt {border-width:1px 0 0 0;background:transparent;line-height:50%;} TR.o TD {background:#F0F0F0;}TABLE.it {border-style:none;}TABLE.it TD,TABLE.it TH {border-style:none;}</STYLE></HEAD><BODY><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="tl"><A HREF="http://www.eclemma.org/">EMMA</A> Coverage Report (generated Tue Jun 09 19:59:05 GMT 2009)</TH></TR><TR><TD CLASS="nv">[<A HREF="../xslUnitTestCoverage.html">all classes</A>][<A HREF="10f.html">org.eclipse.wst.jsdt.core.tests.model</A>]</TD></TR></TABLE><H2>COVERAGE SUMMARY FOR SOURCE FILE [<SPAN CLASS="in">WorkingCopyTests.java</SPAN>]</H2><TABLE CELLSPACING="0" WIDTH="100%"><TR><TH>name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD>WorkingCopyTests.java</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/30)</TD><TD CLASS="h">0%   (0/1197)</TD><TD CLASS="h">0%   (0/294)</TD></TR></TABLE><H3>COVERAGE BREAKDOWN BY CLASS AND METHOD</H3><TABLE CLASS="cn" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="f">name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#0">WorkingCopyTests</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/24)</TD><TD CLASS="h">0%   (0/1147)</TD><TD CLASS="h">0%   (0/286)</TD></TR><TR><TD CLASS="f"><A HREF="#0">WorkingCopyTests (String): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/10)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2">setUp (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/50)</TD><TD CLASS="h">0%   (0/13)</TD></TR><TR><TD CLASS="f"><A HREF="#3">suite (): Test</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/17)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#4">tearDown (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/12)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR><TD CLASS="f"><A HREF="#5">testCancelMakeConsistent (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/26)</TD><TD CLASS="h">0%   (0/9)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#6">testChangeContent (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/37)</TD><TD CLASS="h">0%   (0/14)</TD></TR><TR><TD CLASS="f"><A HREF="#7">testChangeContentOfReadOnlyCU1 (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/58)</TD><TD CLASS="h">0%   (0/16)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#8">testChangeContentOfReadOnlyCU2 (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/60)</TD><TD CLASS="h">0%   (0/22)</TD></TR><TR><TD CLASS="f"><A HREF="#9">testContents (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/20)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#a">testCreation (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/25)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR><TD CLASS="f"><A HREF="#b">testCustomizedBuffer (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/26)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#c">testCustomizedBuffer2 (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/31)</TD><TD CLASS="h">0%   (0/9)</TD></TR><TR><TD CLASS="f"><A HREF="#d">testDelete2Fields (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/21)</TD><TD CLASS="h">0%   (0/11)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#e">testGeneral (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/178)</TD><TD CLASS="h">0%   (0/41)</TD></TR><TR><TD CLASS="f"><A HREF="#f">testGetPrimaryCU (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/21)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#10">testGetPrimaryField (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/24)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR><TD CLASS="f"><A HREF="#11">testGetPrimaryMethod (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/16)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#12">testMoveTypeToAnotherWorkingCopy (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/80)</TD><TD CLASS="h">0%   (0/21)</TD></TR><TR><TD CLASS="f"><A HREF="#13">testMultipleCommit (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/65)</TD><TD CLASS="h">0%   (0/17)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#14">testNonExistingCU (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/142)</TD><TD CLASS="h">0%   (0/35)</TD></TR><TR><TD CLASS="f"><A HREF="#15">testOperations (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/73)</TD><TD CLASS="h">0%   (0/16)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#16">testRenameMethod (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/29)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR><TD CLASS="f"><A HREF="#17">testShared1 (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/42)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#18">testShared2 (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/84)</TD><TD CLASS="h">0%   (0/13)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#19">WorkingCopyTests$1</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/2)</TD><TD CLASS="h">0%   (0/27)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR><TD CLASS="f"><A HREF="#19">WorkingCopyTests$1 (WorkingCopyTests): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1b">run (IProgressMonitor): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/21)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#17">WorkingCopyTests$2</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#17">WorkingCopyTests$2 (WorkingCopyTests): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#18">WorkingCopyTests$3</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#18">WorkingCopyTests$3 (WorkingCopyTests): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#20">WorkingCopyTests$TestWorkingCopyOwner</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/2)</TD><TD CLASS="h">0%   (0/11)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#20">WorkingCopyTests$TestWorkingCopyOwner (WorkingCopyTests): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#22">createBuffer (IJavaScriptUnit): IBuffer</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/1)</TD></TR></TABLE><P></P><TABLE CLASS="s" CELLSPACING="0" WIDTH="100%"><TR CLASS="z"><TD CLASS="l">1</TD><TD>/*******************************************************************************</TD></TR><TR><TD CLASS="l">2</TD><TD> * Copyright (c) 2000, 2008 IBM Corporation and others.</TD></TR><TR><TD CLASS="l">3</TD><TD> * All rights reserved. This program and the accompanying materials</TD></TR><TR><TD CLASS="l">4</TD><TD> * are made available under the terms of the Eclipse Public License v1.0</TD></TR><TR><TD CLASS="l">5</TD><TD> * which accompanies this distribution, and is available at</TD></TR><TR><TD CLASS="l">6</TD><TD> * http://www.eclipse.org/legal/epl-v10.html</TD></TR><TR><TD CLASS="l">7</TD><TD> *</TD></TR><TR><TD CLASS="l">8</TD><TD> * Contributors:</TD></TR><TR><TD CLASS="l">9</TD><TD> *     IBM Corporation - initial API and implementation</TD></TR><TR><TD CLASS="l">10</TD><TD> *******************************************************************************/</TD></TR><TR><TD CLASS="l">11</TD><TD>package org.eclipse.wst.jsdt.core.tests.model;</TD></TR><TR><TD CLASS="l">12</TD><TD> </TD></TR><TR><TD CLASS="l">13</TD><TD>import java.io.IOException;</TD></TR><TR><TD CLASS="l">14</TD><TD>import java.util.Vector;</TD></TR><TR><TD CLASS="l">15</TD><TD> </TD></TR><TR><TD CLASS="l">16</TD><TD>import junit.framework.Test;</TD></TR><TR><TD CLASS="l">17</TD><TD> </TD></TR><TR><TD CLASS="l">18</TD><TD>import org.eclipse.core.resources.IProject;</TD></TR><TR><TD CLASS="l">19</TD><TD>import org.eclipse.core.resources.IResource;</TD></TR><TR><TD CLASS="l">20</TD><TD>import org.eclipse.core.resources.IWorkspaceRunnable;</TD></TR><TR><TD CLASS="l">21</TD><TD>import org.eclipse.core.runtime.*;</TD></TR><TR><TD CLASS="l">22</TD><TD>import org.eclipse.wst.jsdt.core.*;</TD></TR><TR><TD CLASS="l">23</TD><TD>import org.eclipse.wst.jsdt.internal.core.util.Util;</TD></TR><TR><TD CLASS="l">24</TD><TD>import org.eclipse.team.core.RepositoryProvider;</TD></TR><TR><TD CLASS="l">25</TD><TD> </TD></TR><TR><TD CLASS="l">26</TD><TD> </TD></TR><TR><TD CLASS="l">27</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="20">28</A></TD><TD>public class WorkingCopyTests extends ModifyingResourceTests {</TD></TR><TR CLASS="z"><TD CLASS="l">29</TD><TD>        IJavaScriptUnit cu = null;</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="22">30</A></TD><TD>        IJavaScriptUnit copy = null;</TD></TR><TR><TD CLASS="l">31</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">32</TD><TD>        public class TestWorkingCopyOwner extends WorkingCopyOwner {</TD></TR><TR><TD CLASS="l">33</TD><TD>                public IBuffer createBuffer(IJavaScriptUnit workingCopy) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="0">34</A></TD><TD>                        return new TestBuffer(workingCopy);</TD></TR><TR><TD CLASS="l">35</TD><TD>                }</TD></TR><TR><TD CLASS="l">36</TD><TD>        }</TD></TR><TR><TD CLASS="l">37</TD><TD>        public WorkingCopyTests(String name) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="3">38</A></TD><TD>        super(name);</TD></TR><TR><TD CLASS="l">39</TD><TD>}</TD></TR><TR><TD CLASS="l">40</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="2">41</A></TD><TD>public static Test suite() {</TD></TR><TR CLASS="z"><TD CLASS="l">42</TD><TD>        return buildModelTestSuite(WorkingCopyTests.class);</TD></TR><TR><TD CLASS="l">43</TD><TD>}</TD></TR><TR><TD CLASS="l">44</TD><TD>protected void setUp() throws Exception {</TD></TR><TR CLASS="z"><TD CLASS="l">45</TD><TD>        super.setUp();</TD></TR><TR><TD CLASS="l">46</TD><TD>        </TD></TR><TR><TD CLASS="l">47</TD><TD>        try {</TD></TR><TR CLASS="z"><TD CLASS="l">48</TD><TD>                this.createJavaProject(</TD></TR><TR CLASS="z"><TD CLASS="l">49</TD><TD>                        &#34;P&#34;, </TD></TR><TR CLASS="z"><TD CLASS="l">50</TD><TD>                        new String[] {&#34;src&#34;}, </TD></TR><TR CLASS="z"><TD CLASS="l">51</TD><TD>                        new String[] {this.getSystemJsPathString(), &#34;lib&#34;});</TD></TR><TR><TD CLASS="l">52</TD><TD>//                this.createFolder(&#34;P/src&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">53</TD><TD>                this.createFile(&#34;P/src/A.js&#34;, </TD></TR><TR CLASS="z"><TD CLASS="l">54</TD><TD>                        &#34;  var FIELD;\n&#34; +</TD></TR><TR><TD CLASS="l">55</TD><TD>                        &#34;  var field1;\n&#34; +</TD></TR><TR><TD CLASS="l">56</TD><TD>                        &#34;  var field2;\n&#34; +</TD></TR><TR><TD CLASS="l">57</TD><TD>                        &#34;  function foo() {\n&#34; +</TD></TR><TR><TD CLASS="l">58</TD><TD>                        &#34;  }\n&#34; +</TD></TR><TR><TD CLASS="l">59</TD><TD>                        &#34;&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">60</TD><TD>                this.cu = this.getCompilationUnit(&#34;P/src/A.js&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">61</TD><TD>                this.copy = cu.getWorkingCopy(null);</TD></TR><TR CLASS="z"><TD CLASS="l">62</TD><TD>        } catch (CoreException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">63</TD><TD>                e.printStackTrace();</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="4">64</A></TD><TD>                throw new RuntimeException(e.getMessage());</TD></TR><TR><TD CLASS="l">65</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">66</TD><TD>}</TD></TR><TR><TD CLASS="l">67</TD><TD>protected void tearDown() throws Exception {</TD></TR><TR CLASS="z"><TD CLASS="l">68</TD><TD>        if (this.copy != null) this.copy.discardWorkingCopy();</TD></TR><TR CLASS="z"><TD CLASS="l">69</TD><TD>        this.deleteProject(&#34;P&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">70</TD><TD>        super.tearDown();</TD></TR><TR CLASS="z"><TD CLASS="l">71</TD><TD>}</TD></TR><TR><TD CLASS="l">72</TD><TD>/*</TD></TR><TR><TD CLASS="l">73</TD><TD> * Ensures that cancelling a make consistent operation doesn't leave the working copy closed</TD></TR><TR><TD CLASS="l"><A NAME="5">74</A></TD><TD> * (regression test for bug 61719 Incorrect fine grain delta after method copy-rename)</TD></TR><TR><TD CLASS="l">75</TD><TD> */</TD></TR><TR><TD CLASS="l">76</TD><TD>public void testCancelMakeConsistent() throws JavaScriptModelException {</TD></TR><TR CLASS="z"><TD CLASS="l">77</TD><TD>        String newContents =</TD></TR><TR CLASS="z"><TD CLASS="l">78</TD><TD>                &#34; function bar() {\n&#34; +</TD></TR><TR><TD CLASS="l">79</TD><TD>                &#34;  }\n&#34; +</TD></TR><TR><TD CLASS="l">80</TD><TD>                &#34;&#34;;</TD></TR><TR CLASS="z"><TD CLASS="l">81</TD><TD>        this.copy.getBuffer().setContents(newContents);</TD></TR><TR CLASS="z"><TD CLASS="l">82</TD><TD>        NullProgressMonitor monitor = new NullProgressMonitor();</TD></TR><TR CLASS="z"><TD CLASS="l">83</TD><TD>        monitor.setCanceled(true);</TD></TR><TR><TD CLASS="l">84</TD><TD>        try {</TD></TR><TR CLASS="z"><TD CLASS="l">85</TD><TD>                this.copy.makeConsistent(monitor);</TD></TR><TR CLASS="z"><TD CLASS="l">86</TD><TD>        } catch (OperationCanceledException e) {</TD></TR><TR><TD CLASS="l">87</TD><TD>                // got exception</TD></TR><TR><TD CLASS="l">88</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">89</TD><TD>        assertTrue(&#34;Working copy should be opened&#34;, this.copy.isOpen());</TD></TR><TR CLASS="z"><TD CLASS="l">90</TD><TD>}</TD></TR><TR><TD CLASS="l">91</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="6">92</A></TD><TD>/**</TD></TR><TR><TD CLASS="l">93</TD><TD> */</TD></TR><TR><TD CLASS="l">94</TD><TD>public void testChangeContent() throws CoreException {</TD></TR><TR CLASS="z"><TD CLASS="l">95</TD><TD>        String newContents =</TD></TR><TR CLASS="z"><TD CLASS="l">96</TD><TD>                &#34;  function bar() {\n&#34; +</TD></TR><TR><TD CLASS="l">97</TD><TD>                &#34;}&#34;;</TD></TR><TR CLASS="z"><TD CLASS="l">98</TD><TD>        this.copy.getBuffer().setContents(newContents);</TD></TR><TR CLASS="z"><TD CLASS="l">99</TD><TD>        this.copy.reconcile(IJavaScriptUnit.NO_AST, false, null, null);</TD></TR><TR CLASS="z"><TD CLASS="l">100</TD><TD>        assertSourceEquals(</TD></TR><TR CLASS="z"><TD CLASS="l">101</TD><TD>                &#34;Unexpected working copy contents&#34;,</TD></TR><TR CLASS="z"><TD CLASS="l">102</TD><TD>                newContents,</TD></TR><TR CLASS="z"><TD CLASS="l">103</TD><TD>                this.copy.getBuffer().getContents());</TD></TR><TR><TD CLASS="l">104</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">105</TD><TD>        this.copy.commitWorkingCopy(true, null);</TD></TR><TR CLASS="z"><TD CLASS="l">106</TD><TD>        assertSourceEquals(</TD></TR><TR CLASS="z"><TD CLASS="l">107</TD><TD>                &#34;Unexpected original cu contents&#34;,</TD></TR><TR CLASS="z"><TD CLASS="l">108</TD><TD>                newContents,</TD></TR><TR CLASS="z"><TD CLASS="l">109</TD><TD>                this.cu.getBuffer().getContents());</TD></TR><TR CLASS="z"><TD CLASS="l">110</TD><TD>}</TD></TR><TR><TD CLASS="l">111</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="7">112</A></TD><TD>/*</TD></TR><TR><TD CLASS="l">113</TD><TD> * Ensures that one cannot commit the contents of a working copy on a read only cu. </TD></TR><TR><TD CLASS="l">114</TD><TD> */</TD></TR><TR><TD CLASS="l">115</TD><TD>public void testChangeContentOfReadOnlyCU1() throws CoreException {</TD></TR><TR CLASS="z"><TD CLASS="l">116</TD><TD>        if (!Util.isReadOnlySupported()) {</TD></TR><TR><TD CLASS="l">117</TD><TD>                // Do not test if file system does not support read-only attribute</TD></TR><TR CLASS="z"><TD CLASS="l">118</TD><TD>                return;</TD></TR><TR><TD CLASS="l">119</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">120</TD><TD>        IResource resource = this.cu.getUnderlyingResource();</TD></TR><TR CLASS="z"><TD CLASS="l">121</TD><TD>        boolean readOnlyFlag = Util.isReadOnly(resource);</TD></TR><TR CLASS="z"><TD CLASS="l">122</TD><TD>        boolean didComplain = false;</TD></TR><TR><TD CLASS="l">123</TD><TD>        try {</TD></TR><TR CLASS="z"><TD CLASS="l">124</TD><TD>                Util.setReadOnly(resource, true);</TD></TR><TR CLASS="z"><TD CLASS="l">125</TD><TD>                this.copy.getBuffer().setContents(&#34;invalid&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">126</TD><TD>                this.copy.commitWorkingCopy(true, null);</TD></TR><TR CLASS="z"><TD CLASS="l">127</TD><TD>        } catch(JavaScriptModelException e){</TD></TR><TR CLASS="z"><TD CLASS="l">128</TD><TD>                didComplain = true;</TD></TR><TR CLASS="z"><TD CLASS="l">129</TD><TD>        } finally {</TD></TR><TR CLASS="z"><TD CLASS="l">130</TD><TD>                Util.setReadOnly(resource, readOnlyFlag);</TD></TR><TR CLASS="z"><TD CLASS="l">131</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">132</TD><TD>        assertTrue(&#34;Should have complained about modifying a read-only unit:&#34;, didComplain);</TD></TR><TR CLASS="z"><TD CLASS="l">133</TD><TD>        assertTrue(&#34;ReadOnly buffer got modified:&#34;, !this.cu.getBuffer().getContents().equals(&#34;invalid&#34;));</TD></TR><TR CLASS="z"><TD CLASS="l">134</TD><TD>}</TD></TR><TR><TD CLASS="l">135</TD><TD> </TD></TR><TR><TD CLASS="l">136</TD><TD>/*</TD></TR><TR><TD CLASS="l"><A NAME="8">137</A></TD><TD> * Ensures that one can commit the contents of a working copy on a read only cu if a pessimistic repository</TD></TR><TR><TD CLASS="l">138</TD><TD> * provider allows it. </TD></TR><TR><TD CLASS="l">139</TD><TD> */</TD></TR><TR><TD CLASS="l">140</TD><TD>public void testChangeContentOfReadOnlyCU2() throws CoreException {</TD></TR><TR CLASS="z"><TD CLASS="l">141</TD><TD>        if (!Util.isReadOnlySupported()) {</TD></TR><TR><TD CLASS="l">142</TD><TD>                // Do not test if file system does not support read-only attribute</TD></TR><TR CLASS="z"><TD CLASS="l">143</TD><TD>                return;</TD></TR><TR><TD CLASS="l">144</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">145</TD><TD>        String newContents =</TD></TR><TR CLASS="z"><TD CLASS="l">146</TD><TD>                &#34;  function bar() {\n&#34; +</TD></TR><TR><TD CLASS="l">147</TD><TD>                &#34;}&#34;;</TD></TR><TR CLASS="z"><TD CLASS="l">148</TD><TD>        IResource resource = this.cu.getUnderlyingResource();</TD></TR><TR CLASS="z"><TD CLASS="l">149</TD><TD>        IProject project = resource.getProject();</TD></TR><TR CLASS="z"><TD CLASS="l">150</TD><TD>        boolean readOnlyFlag = Util.isReadOnly(resource);</TD></TR><TR><TD CLASS="l">151</TD><TD>        try {</TD></TR><TR CLASS="z"><TD CLASS="l">152</TD><TD>                RepositoryProvider.map(project, TestPessimisticProvider.NATURE_ID);</TD></TR><TR CLASS="z"><TD CLASS="l">153</TD><TD>                TestPessimisticProvider.markWritableOnSave = true;</TD></TR><TR CLASS="z"><TD CLASS="l">154</TD><TD>                Util.setReadOnly(resource, true);</TD></TR><TR><TD CLASS="l">155</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">156</TD><TD>                this.copy.getBuffer().setContents(newContents);</TD></TR><TR CLASS="z"><TD CLASS="l">157</TD><TD>                this.copy.commitWorkingCopy(true, null);</TD></TR><TR CLASS="z"><TD CLASS="l">158</TD><TD>                assertSourceEquals(</TD></TR><TR CLASS="z"><TD CLASS="l">159</TD><TD>                        &#34;Unexpected original cu contents&#34;,</TD></TR><TR CLASS="z"><TD CLASS="l">160</TD><TD>                        newContents,</TD></TR><TR CLASS="z"><TD CLASS="l">161</TD><TD>                        this.cu.getBuffer().getContents());</TD></TR><TR CLASS="z"><TD CLASS="l">162</TD><TD>        } finally {</TD></TR><TR CLASS="z"><TD CLASS="l">163</TD><TD>                TestPessimisticProvider.markWritableOnSave = false;</TD></TR><TR CLASS="z"><TD CLASS="l">164</TD><TD>                RepositoryProvider.unmap(project);</TD></TR><TR CLASS="z"><TD CLASS="l">165</TD><TD>                Util.setReadOnly(resource, readOnlyFlag);</TD></TR><TR CLASS="z"><TD CLASS="l">166</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">167</TD><TD>}</TD></TR><TR><TD CLASS="l">168</TD><TD> </TD></TR><TR><TD CLASS="l">169</TD><TD>/**</TD></TR><TR><TD CLASS="l">170</TD><TD> * Ensures that the source contents of a working copy are</TD></TR><TR><TD CLASS="l"><A NAME="9">171</A></TD><TD> * not altered by changes to the source of the original compilation</TD></TR><TR><TD CLASS="l">172</TD><TD> * unit.</TD></TR><TR><TD CLASS="l">173</TD><TD> */</TD></TR><TR><TD CLASS="l">174</TD><TD>public void testContents() throws CoreException {</TD></TR><TR CLASS="z"><TD CLASS="l">175</TD><TD>        String originalSource = this.cu.getSource();</TD></TR><TR CLASS="z"><TD CLASS="l">176</TD><TD>        IField type = this.cu.getField(&#34;field1&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">177</TD><TD>        assertDeletion(type);</TD></TR><TR CLASS="z"><TD CLASS="l">178</TD><TD>        assertSourceEquals(&#34;source code of copy should still be original&#34;, originalSource, this.copy.getSource());</TD></TR><TR CLASS="z"><TD CLASS="l">179</TD><TD>}</TD></TR><TR><TD CLASS="l">180</TD><TD> </TD></TR><TR><TD CLASS="l">181</TD><TD>///**</TD></TR><TR><TD CLASS="l">182</TD><TD>// * Test creating a working copy on a class file with a customized buffer.</TD></TR><TR><TD CLASS="l">183</TD><TD>// */</TD></TR><TR><TD CLASS="l">184</TD><TD>//public void testOnClassFile() throws JavaScriptModelException, IOException {</TD></TR><TR><TD CLASS="l">185</TD><TD>//        // ensure the external JCL is copied</TD></TR><TR><TD CLASS="l">186</TD><TD>//        setupExternalJCL(&#34;jclMin&#34;);</TD></TR><TR><TD CLASS="l">187</TD><TD>//                        </TD></TR><TR><TD CLASS="l">188</TD><TD>//        this.attachSource(this.getPackageFragmentRoot(&#34;P&#34;, this.getExternalJCLPathString()), this.getExternalJCLSourcePath().toOSString(), &#34;src&#34;);</TD></TR><TR><TD CLASS="l">189</TD><TD>//        IClassFile classFile = this.getClassFile(&#34;P&#34;, this.getExternalJCLPathString(), &#34;java.lang&#34;, &#34;Object.class&#34;);</TD></TR><TR><TD CLASS="l">190</TD><TD>//        WorkingCopyOwner owner = new TestWorkingCopyOwner();</TD></TR><TR><TD CLASS="l">191</TD><TD>//        IJavaScriptUnit customizedCopy = classFile.getWorkingCopy(owner, null);</TD></TR><TR><TD CLASS="l">192</TD><TD>//        try {</TD></TR><TR><TD CLASS="l">193</TD><TD>//                IBuffer buffer = customizedCopy.getBuffer();</TD></TR><TR><TD CLASS="l">194</TD><TD>//                assertTrue(&#34;Unexpected buffer&#34;, buffer instanceof TestBuffer);        </TD></TR><TR><TD CLASS="l">195</TD><TD>//                assertTrue(&#34;Buffer should be initialized with source&#34;, buffer.getCharacters().length &gt; 0);</TD></TR><TR><TD CLASS="l">196</TD><TD>//        } finally {</TD></TR><TR><TD CLASS="l">197</TD><TD>//                customizedCopy.discardWorkingCopy();</TD></TR><TR><TD CLASS="l">198</TD><TD>//        }</TD></TR><TR><TD CLASS="l">199</TD><TD>//}</TD></TR><TR><TD CLASS="l"><A NAME="a">200</A></TD><TD>/**</TD></TR><TR><TD CLASS="l">201</TD><TD> * Create the compilation unit place holder for the working copy tests.</TD></TR><TR><TD CLASS="l">202</TD><TD> */</TD></TR><TR><TD CLASS="l">203</TD><TD>public void testCreation() {</TD></TR><TR CLASS="z"><TD CLASS="l">204</TD><TD>        assertTrue(&#34;Failed to create X.js compilation unit&#34;, this.cu != null &amp;&amp; this.cu.exists());</TD></TR><TR CLASS="z"><TD CLASS="l">205</TD><TD>        assertTrue(&#34;Failed to create working copy on X.js&#34;, this.copy != null &amp;&amp; this.copy.exists());</TD></TR><TR CLASS="z"><TD CLASS="l">206</TD><TD>}</TD></TR><TR><TD CLASS="l">207</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="b">208</A></TD><TD>/**</TD></TR><TR><TD CLASS="l">209</TD><TD> * Test creating a working copy with a customized buffer.</TD></TR><TR><TD CLASS="l">210</TD><TD> */</TD></TR><TR><TD CLASS="l">211</TD><TD>public void testCustomizedBuffer() throws JavaScriptModelException {</TD></TR><TR CLASS="z"><TD CLASS="l">212</TD><TD>        WorkingCopyOwner owner = new TestWorkingCopyOwner();</TD></TR><TR CLASS="z"><TD CLASS="l">213</TD><TD>        IJavaScriptUnit customizedCopy = this.cu.getWorkingCopy(owner, null, null);</TD></TR><TR><TD CLASS="l">214</TD><TD>        try {</TD></TR><TR CLASS="z"><TD CLASS="l">215</TD><TD>                assertTrue(&#34;Unexpected buffer&#34;, customizedCopy.getBuffer() instanceof TestBuffer);</TD></TR><TR CLASS="z"><TD CLASS="l">216</TD><TD>        } finally {</TD></TR><TR CLASS="z"><TD CLASS="l">217</TD><TD>                customizedCopy.discardWorkingCopy();</TD></TR><TR CLASS="z"><TD CLASS="l">218</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">219</TD><TD>}</TD></TR><TR><TD CLASS="l"><A NAME="c">220</A></TD><TD>/**</TD></TR><TR><TD CLASS="l">221</TD><TD> * Test closing then reopening a working copy with a customized buffer.</TD></TR><TR><TD CLASS="l">222</TD><TD> */</TD></TR><TR><TD CLASS="l">223</TD><TD>public void testCustomizedBuffer2() throws JavaScriptModelException {</TD></TR><TR CLASS="z"><TD CLASS="l">224</TD><TD>        WorkingCopyOwner owner = new TestWorkingCopyOwner();</TD></TR><TR CLASS="z"><TD CLASS="l">225</TD><TD>        IJavaScriptUnit customizedCopy = this.cu.getWorkingCopy(owner, null, null);</TD></TR><TR><TD CLASS="l">226</TD><TD>        try {</TD></TR><TR CLASS="z"><TD CLASS="l">227</TD><TD>                customizedCopy.close();</TD></TR><TR CLASS="z"><TD CLASS="l">228</TD><TD>                customizedCopy.open(null);</TD></TR><TR CLASS="z"><TD CLASS="l">229</TD><TD>                assertTrue(&#34;Unexpected buffer&#34;, customizedCopy.getBuffer() instanceof TestBuffer);                </TD></TR><TR CLASS="z"><TD CLASS="l">230</TD><TD>        } finally {</TD></TR><TR CLASS="z"><TD CLASS="l">231</TD><TD>                customizedCopy.discardWorkingCopy();</TD></TR><TR CLASS="z"><TD CLASS="l">232</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">233</TD><TD>}</TD></TR><TR><TD CLASS="l">234</TD><TD>/*</TD></TR><TR><TD CLASS="l">235</TD><TD> * Test that deleting 2 fields in a JavaScriptCore.run() operation reports the correct delta.</TD></TR><TR><TD CLASS="l"><A NAME="d">236</A></TD><TD> * (regression test for bug 32225 incorrect delta after deleting 2 fields)</TD></TR><TR><TD CLASS="l">237</TD><TD> */</TD></TR><TR><TD CLASS="l"><A NAME="19">238</A></TD><TD>public void testDelete2Fields() throws CoreException {</TD></TR><TR><TD CLASS="l">239</TD><TD>        try {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1b">240</A></TD><TD>                startDeltas();</TD></TR><TR CLASS="z"><TD CLASS="l">241</TD><TD>                JavaScriptCore.run(</TD></TR><TR CLASS="z"><TD CLASS="l">242</TD><TD>                        new IWorkspaceRunnable() {</TD></TR><TR><TD CLASS="l">243</TD><TD>                                public void run(IProgressMonitor monitor) throws CoreException {</TD></TR><TR CLASS="z"><TD CLASS="l">244</TD><TD>                                        IField field1 = copy.getField(&#34;field1&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">245</TD><TD>                                        IField field2 = copy.getField(&#34;field2&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">246</TD><TD>                                        field1.delete(false, monitor);</TD></TR><TR CLASS="z"><TD CLASS="l">247</TD><TD>                                        field2.delete(false, monitor);</TD></TR><TR CLASS="z"><TD CLASS="l">248</TD><TD>                                }</TD></TR><TR><TD CLASS="l">249</TD><TD>                        },</TD></TR><TR CLASS="z"><TD CLASS="l">250</TD><TD>                        null);</TD></TR><TR CLASS="z"><TD CLASS="l">251</TD><TD>                assertDeltas(</TD></TR><TR CLASS="z"><TD CLASS="l">252</TD><TD>                        &#34;Unexpected delta&#34;,</TD></TR><TR CLASS="z"><TD CLASS="l">253</TD><TD>                        &#34;field1[-]: {}\n&#34; + </TD></TR><TR><TD CLASS="l">254</TD><TD>                        &#34;field2[-]: {}&#34;</TD></TR><TR><TD CLASS="l">255</TD><TD>                );</TD></TR><TR CLASS="z"><TD CLASS="l">256</TD><TD>        } finally {</TD></TR><TR CLASS="z"><TD CLASS="l">257</TD><TD>                stopDeltas();</TD></TR><TR CLASS="z"><TD CLASS="l">258</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">259</TD><TD>}</TD></TR><TR><TD CLASS="l">260</TD><TD>/**</TD></TR><TR><TD CLASS="l">261</TD><TD> * Tests the general functionality of a working copy:&lt;ul&gt;</TD></TR><TR><TD CLASS="l">262</TD><TD> * &lt;li&gt;ensures that the copy and original compilation unit are not equal&lt;/li&gt;</TD></TR><TR><TD CLASS="l">263</TD><TD> * &lt;li&gt;ensures the correct retrieval of the original element&lt;/li&gt;</TD></TR><TR><TD CLASS="l">264</TD><TD> * &lt;li&gt;closing the package of the compilation unit does not close the copy&lt;/li&gt;</TD></TR><TR><TD CLASS="l">265</TD><TD> * &lt;li&gt;ensures that working copies are unique</TD></TR><TR><TD CLASS="l"><A NAME="e">266</A></TD><TD> * &lt;li&gt;ensures committing changes from working copies </TD></TR><TR><TD CLASS="l">267</TD><TD> */</TD></TR><TR><TD CLASS="l">268</TD><TD>public void testGeneral() throws JavaScriptModelException, CoreException {</TD></TR><TR><TD CLASS="l">269</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">270</TD><TD>        assertTrue(&#34;copy and actual should not be equal&#34;, !this.copy.equals(this.cu));</TD></TR><TR><TD CLASS="l">271</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">272</TD><TD>        IField copyfield= this.copy.getField(&#34;field1&#34;);</TD></TR><TR><TD CLASS="l">273</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">274</TD><TD>        assertEquals(&#34;primary should be the samel&#34;, this.cu, this.cu.getPrimary());</TD></TR><TR><TD CLASS="l">275</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">276</TD><TD>        assertEquals(&#34;getting working copy from a copy should yield original copy&#34;, this.copy, this.copy.getWorkingCopy(null));</TD></TR><TR><TD CLASS="l">277</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">278</TD><TD>        boolean ex= false;</TD></TR><TR CLASS="z"><TD CLASS="l">279</TD><TD>        assertDeletion(copyfield);</TD></TR><TR><TD CLASS="l">280</TD><TD> </TD></TR><TR><TD CLASS="l">281</TD><TD>        // closing the package should not close the copy</TD></TR><TR CLASS="z"><TD CLASS="l">282</TD><TD>        ((IOpenable)this.cu.getParent()).close();</TD></TR><TR CLASS="z"><TD CLASS="l">283</TD><TD>        assertTrue(&#34;copy should still be open&#34;, this.copy.isOpen());</TD></TR><TR><TD CLASS="l">284</TD><TD>        </TD></TR><TR><TD CLASS="l">285</TD><TD>        // verify original still present</TD></TR><TR CLASS="z"><TD CLASS="l">286</TD><TD>        assertTrue(&#34;actual type should still be present&#34;, this.cu.getField(&#34;field1&#34;).exists());</TD></TR><TR><TD CLASS="l">287</TD><TD> </TD></TR><TR><TD CLASS="l">288</TD><TD>        // getAnother working copy</TD></TR><TR CLASS="z"><TD CLASS="l">289</TD><TD>        IJavaScriptUnit copy2= this.cu.getWorkingCopy(null);</TD></TR><TR><TD CLASS="l">290</TD><TD>        try {</TD></TR><TR CLASS="z"><TD CLASS="l">291</TD><TD>                assertTrue(&#34;working copies should be unique &#34;, !(this.copy.equals(copy2)));</TD></TR><TR><TD CLASS="l">292</TD><TD>        </TD></TR><TR><TD CLASS="l">293</TD><TD>                // delete a method from the 2nd working copy.</TD></TR><TR CLASS="z"><TD CLASS="l">294</TD><TD>                IFunction method= copy2.getFunction(&#34;foo&#34;, null);</TD></TR><TR><TD CLASS="l">295</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">296</TD><TD>                assertDeletion(method);</TD></TR><TR CLASS="z"><TD CLASS="l">297</TD><TD>                IFunction originalMethod= this.cu.getFunction(&#34;foo&#34;, null);</TD></TR><TR CLASS="z"><TD CLASS="l">298</TD><TD>                assertTrue(&#34;method should still be present in original&#34;, originalMethod.exists());</TD></TR><TR><TD CLASS="l">299</TD><TD>        </TD></TR><TR><TD CLASS="l">300</TD><TD>                // commit the changes from the 2nd copy.</TD></TR><TR CLASS="z"><TD CLASS="l">301</TD><TD>                copy2.commitWorkingCopy(false, null);</TD></TR><TR><TD CLASS="l">302</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">303</TD><TD>                assertTrue(&#34;copy always has unsaved changes&#34;, copy2.hasUnsavedChanges());</TD></TR><TR><TD CLASS="l">304</TD><TD>                </TD></TR><TR><TD CLASS="l">305</TD><TD>                // original method should now be gone</TD></TR><TR CLASS="z"><TD CLASS="l">306</TD><TD>                assertTrue(&#34;method should no longer be present in original after commit&#34;, !originalMethod.exists());</TD></TR><TR><TD CLASS="l">307</TD><TD>        </TD></TR><TR><TD CLASS="l">308</TD><TD>                // commit the changes from the 1st copy - should fail</TD></TR><TR><TD CLASS="l">309</TD><TD>                try {</TD></TR><TR CLASS="z"><TD CLASS="l">310</TD><TD>                        this.copy.commitWorkingCopy(false, null);</TD></TR><TR CLASS="z"><TD CLASS="l">311</TD><TD>                        assertTrue(&#34;commit should have failed&#34;, ex);</TD></TR><TR CLASS="z"><TD CLASS="l">312</TD><TD>                } catch (JavaScriptModelException jme) {</TD></TR><TR><TD CLASS="l">313</TD><TD>                }</TD></TR><TR><TD CLASS="l">314</TD><TD>                </TD></TR><TR><TD CLASS="l">315</TD><TD>        </TD></TR><TR><TD CLASS="l">316</TD><TD>                // now force the update</TD></TR><TR><TD CLASS="l">317</TD><TD>                try {</TD></TR><TR CLASS="z"><TD CLASS="l">318</TD><TD>                        this.copy.commitWorkingCopy(true, null);</TD></TR><TR CLASS="z"><TD CLASS="l">319</TD><TD>                } catch (JavaScriptModelException jme) {</TD></TR><TR CLASS="z"><TD CLASS="l">320</TD><TD>                        assertTrue(&#34;commit should work&#34;, false);</TD></TR><TR><TD CLASS="l">321</TD><TD>                }</TD></TR><TR><TD CLASS="l">322</TD><TD>        </TD></TR><TR><TD CLASS="l">323</TD><TD>                // now the type should be gone.</TD></TR><TR CLASS="z"><TD CLASS="l">324</TD><TD>                assertTrue(&#34;original type should no longer be present&#34;, !this.cu.getField(&#34;field1&#34;).exists());</TD></TR><TR><TD CLASS="l">325</TD><TD>        </TD></TR><TR><TD CLASS="l">326</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">327</TD><TD>                this.copy.close();</TD></TR><TR CLASS="z"><TD CLASS="l">328</TD><TD>                ex= false;</TD></TR><TR><TD CLASS="l">329</TD><TD>                try {</TD></TR><TR CLASS="z"><TD CLASS="l">330</TD><TD>                        this.copy.open(null);</TD></TR><TR CLASS="z"><TD CLASS="l">331</TD><TD>                } catch (JavaScriptModelException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">332</TD><TD>                        ex= true;</TD></TR><TR><TD CLASS="l">333</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">334</TD><TD>                assertTrue(&#34;should be able to open working copy a 2nd time&#34;, !ex);</TD></TR><TR><TD CLASS="l">335</TD><TD>        </TD></TR><TR><TD CLASS="l">336</TD><TD>                // now discard the working copy</TD></TR><TR CLASS="z"><TD CLASS="l">337</TD><TD>                this.copy.discardWorkingCopy();</TD></TR><TR CLASS="z"><TD CLASS="l">338</TD><TD>                ex= false;</TD></TR><TR><TD CLASS="l">339</TD><TD>                try {</TD></TR><TR CLASS="z"><TD CLASS="l">340</TD><TD>                        this.copy.open(null);</TD></TR><TR CLASS="z"><TD CLASS="l">341</TD><TD>                } catch (JavaScriptModelException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">342</TD><TD>                        ex= true;</TD></TR><TR><TD CLASS="l">343</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">344</TD><TD>                assertTrue(&#34;should not be able to open working copy again&#34;, ex);</TD></TR><TR CLASS="z"><TD CLASS="l">345</TD><TD>        } finally {</TD></TR><TR CLASS="z"><TD CLASS="l">346</TD><TD>                copy2.discardWorkingCopy();</TD></TR><TR CLASS="z"><TD CLASS="l">347</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">348</TD><TD>}</TD></TR><TR><TD CLASS="l">349</TD><TD>///**</TD></TR><TR><TD CLASS="l">350</TD><TD>// * Ensures that the primary element of a binary element is itself.</TD></TR><TR><TD CLASS="l">351</TD><TD>// */</TD></TR><TR><TD CLASS="l">352</TD><TD>//public void testGetPrimaryBinaryElement() throws CoreException {</TD></TR><TR><TD CLASS="l">353</TD><TD>//        /* Evaluate the following in a scrapbook:</TD></TR><TR><TD CLASS="l">354</TD><TD>//         org.eclipse.wst.jsdt.core.tests.model.ModifyingResourceTests.generateClassFile(</TD></TR><TR><TD CLASS="l">355</TD><TD>//                &#34;A&#34;,</TD></TR><TR><TD CLASS="l">356</TD><TD>//                &#34;public class A {\n&#34; +</TD></TR><TR><TD CLASS="l">357</TD><TD>//                &#34;}&#34;)</TD></TR><TR><TD CLASS="l">358</TD><TD>//        */</TD></TR><TR><TD CLASS="l">359</TD><TD>//        byte[] bytes = new byte[] {</TD></TR><TR><TD CLASS="l">360</TD><TD>//                -54, -2, -70, -66, 0, 3, 0, 45, 0, 10, 1, 0, 1, 65, 7, 0, 1, 1, 0, 16, 106, 97, 118, 97, 47, 108, 97, 110, 103, 47, 79, 98, 106, 101, 99, 116, 7, 0, 3, 1, 0, 6, 60, 105, 110, 105, 116, 62, 1, 0, 3, 40, 41, 86, 1, 0, 4, 67, 111, 100, 101, 12, 0, 5, 0, 6, 10, 0, 4, 0, 8, 0, 33, 0, 2, 0, 4, 0, 0, 0, </TD></TR><TR><TD CLASS="l">361</TD><TD>//                0, 0, 1, 0, 1, 0, 5, 0, 6, 0, 1, 0, 7, 0, 0, 0, 17, 0, 1, 0, 1, 0, 0, 0, 5, 42, -73, 0, 9, -79, 0, 0, 0, 0, 0, 0, </TD></TR><TR><TD CLASS="l">362</TD><TD>//        };</TD></TR><TR><TD CLASS="l">363</TD><TD>//        this.createFile(&#34;P/lib/A.class&#34;, bytes);</TD></TR><TR><TD CLASS="l">364</TD><TD>//        IClassFile cf = this.getClassFile(&#34;P/lib/A.class&#34;);</TD></TR><TR><TD CLASS="l">365</TD><TD>//        IJavaScriptElement primary = cf.getPrimaryElement();</TD></TR><TR><TD CLASS="l">366</TD><TD>//        assertEquals(&#34;Primary element should be the same&#34;, cf, primary);</TD></TR><TR><TD CLASS="l">367</TD><TD>//}</TD></TR><TR><TD CLASS="l"><A NAME="f">368</A></TD><TD>/**</TD></TR><TR><TD CLASS="l">369</TD><TD> * Ensures that the primary cu can be retrieved.</TD></TR><TR><TD CLASS="l">370</TD><TD> */</TD></TR><TR><TD CLASS="l">371</TD><TD>public void testGetPrimaryCU() {</TD></TR><TR CLASS="z"><TD CLASS="l">372</TD><TD>        IJavaScriptElement primary= this.copy.getPrimaryElement();</TD></TR><TR CLASS="z"><TD CLASS="l">373</TD><TD>        assertTrue(&#34;Element is not a cu&#34;, primary instanceof IJavaScriptUnit &amp;&amp; !((IJavaScriptUnit)primary).isWorkingCopy());</TD></TR><TR CLASS="z"><TD CLASS="l">374</TD><TD>        assertTrue(&#34;Element should exist&#34;, primary.exists());</TD></TR><TR CLASS="z"><TD CLASS="l">375</TD><TD>}</TD></TR><TR><TD CLASS="l"><A NAME="10">376</A></TD><TD>/**</TD></TR><TR><TD CLASS="l">377</TD><TD> * Ensures that the primary field can be retrieved.</TD></TR><TR><TD CLASS="l">378</TD><TD> */</TD></TR><TR><TD CLASS="l">379</TD><TD>public void testGetPrimaryField() {</TD></TR><TR CLASS="z"><TD CLASS="l">380</TD><TD>        IJavaScriptElement primary = this.copy.getField(&#34;FIELD&#34;).getPrimaryElement();</TD></TR><TR CLASS="z"><TD CLASS="l">381</TD><TD>        assertTrue(&#34;Element is not a field&#34;, primary instanceof IField &amp;&amp; !((IJavaScriptUnit)primary.getParent()).isWorkingCopy());</TD></TR><TR CLASS="z"><TD CLASS="l">382</TD><TD>        assertTrue(&#34;Element should exist&#34;, primary.exists());</TD></TR><TR CLASS="z"><TD CLASS="l">383</TD><TD>}</TD></TR><TR><TD CLASS="l">384</TD><TD>///**</TD></TR><TR><TD CLASS="l">385</TD><TD>// * Ensures that the primary import declaration can be retrieved.</TD></TR><TR><TD CLASS="l">386</TD><TD>// */</TD></TR><TR><TD CLASS="l">387</TD><TD>//public void testGetPrimaryImportDeclaration()  {</TD></TR><TR><TD CLASS="l">388</TD><TD>//        IImportDeclaration imprt = copy.getImport(&#34;java.io.File&#34;);</TD></TR><TR><TD CLASS="l">389</TD><TD>//        IJavaScriptElement primary = imprt.getPrimaryElement();</TD></TR><TR><TD CLASS="l">390</TD><TD>//        assertTrue(&#34;Element should exist&#34;, primary.exists());</TD></TR><TR><TD CLASS="l">391</TD><TD>//}</TD></TR><TR><TD CLASS="l">392</TD><TD>///**</TD></TR><TR><TD CLASS="l">393</TD><TD>// * Ensures that the primary import container can be retrieved.</TD></TR><TR><TD CLASS="l">394</TD><TD>// */</TD></TR><TR><TD CLASS="l">395</TD><TD>//public void testGetPrimaryImportContainer() {</TD></TR><TR><TD CLASS="l">396</TD><TD>//        IImportContainer container = this.copy.getImportContainer();</TD></TR><TR><TD CLASS="l">397</TD><TD>//        IJavaScriptElement primary = container.getPrimaryElement();</TD></TR><TR><TD CLASS="l">398</TD><TD>//        assertTrue(&#34;Element should not be null&#34;, primary != null);</TD></TR><TR><TD CLASS="l">399</TD><TD>//        assertTrue(&#34;Element should exist&#34;, primary.exists());</TD></TR><TR><TD CLASS="l">400</TD><TD>//}</TD></TR><TR><TD CLASS="l">401</TD><TD>/////**</TD></TR><TR><TD CLASS="l">402</TD><TD>//// * Ensures that the primary initializer can be retrieved.</TD></TR><TR><TD CLASS="l">403</TD><TD>//// */</TD></TR><TR><TD CLASS="l">404</TD><TD>////public void testGetPrimaryInitializer() {</TD></TR><TR><TD CLASS="l">405</TD><TD>////        IType type= copy.getType(&#34;A&#34;);</TD></TR><TR><TD CLASS="l">406</TD><TD>////        IJavaScriptElement primary= type.getInitializer(1).getPrimaryElement();</TD></TR><TR><TD CLASS="l">407</TD><TD>////        assertTrue(&#34;Element should exist&#34;, primary.exists());</TD></TR><TR><TD CLASS="l">408</TD><TD>////}</TD></TR><TR><TD CLASS="l">409</TD><TD>///**</TD></TR><TR><TD CLASS="l">410</TD><TD>// */</TD></TR><TR><TD CLASS="l">411</TD><TD>//public void testGetPrimaryInnerField() {</TD></TR><TR><TD CLASS="l">412</TD><TD>//        IType innerType = this.copy.getType(&#34;A&#34;).getType(&#34;Inner&#34;);</TD></TR><TR><TD CLASS="l">413</TD><TD>//        IJavaScriptElement primary = innerType.getField(&#34;innerField&#34;).getPrimaryElement();</TD></TR><TR><TD CLASS="l">414</TD><TD>//        assertTrue(&#34;Element is not a field&#34;, primary instanceof IField);</TD></TR><TR><TD CLASS="l">415</TD><TD>//        assertTrue(&#34;Element should exist&#34;, primary.exists());</TD></TR><TR><TD CLASS="l">416</TD><TD>//}</TD></TR><TR><TD CLASS="l">417</TD><TD>///**</TD></TR><TR><TD CLASS="l">418</TD><TD>// */</TD></TR><TR><TD CLASS="l">419</TD><TD>//public void testGetPrimaryInnerMethod() throws JavaScriptModelException {</TD></TR><TR><TD CLASS="l">420</TD><TD>//        IType innerType = this.copy.getType(&#34;A&#34;).getType(&#34;Inner&#34;);</TD></TR><TR><TD CLASS="l">421</TD><TD>//        IJavaScriptElement primary = innerType.getMethods()[0].getPrimaryElement();</TD></TR><TR><TD CLASS="l">422</TD><TD>//        assertTrue(&#34;Element is not a method&#34;, primary instanceof IFunction);</TD></TR><TR><TD CLASS="l">423</TD><TD>//        assertTrue(&#34;Element should exist&#34;, primary.exists());</TD></TR><TR><TD CLASS="l">424</TD><TD>//}</TD></TR><TR><TD CLASS="l">425</TD><TD>///**</TD></TR><TR><TD CLASS="l">426</TD><TD>// */</TD></TR><TR><TD CLASS="l">427</TD><TD>//public void testGetPrimaryInnerType() {</TD></TR><TR><TD CLASS="l">428</TD><TD>//        IType innerInnerType = this.copy.getType(&#34;A&#34;).getType(&#34;Inner&#34;).getType(&#34;InnerInner&#34;);</TD></TR><TR><TD CLASS="l">429</TD><TD>//        IJavaScriptElement primary = innerInnerType.getPrimaryElement();</TD></TR><TR><TD CLASS="l">430</TD><TD>//        assertTrue(&#34;Element is not a method&#34;, primary instanceof IType);</TD></TR><TR><TD CLASS="l">431</TD><TD>//        assertTrue(&#34;Element should exist&#34;, primary.exists());</TD></TR><TR><TD CLASS="l">432</TD><TD>//</TD></TR><TR><TD CLASS="l">433</TD><TD>//        Vector hierarchy = new Vector(5);</TD></TR><TR><TD CLASS="l">434</TD><TD>//        IJavaScriptElement parent= primary.getParent();</TD></TR><TR><TD CLASS="l">435</TD><TD>//        while (parent.getElementType() &gt; IJavaScriptElement.JAVASCRIPT_UNIT) {</TD></TR><TR><TD CLASS="l">436</TD><TD>//                hierarchy.addElement(parent);</TD></TR><TR><TD CLASS="l">437</TD><TD>//                parent = parent.getParent();</TD></TR><TR><TD CLASS="l">438</TD><TD>//        }</TD></TR><TR><TD CLASS="l">439</TD><TD>//        hierarchy.addElement(parent);</TD></TR><TR><TD CLASS="l">440</TD><TD>//        assertTrue(&#34;Compilation Unit should not be a working copy&#34;, !((IJavaScriptUnit)hierarchy.lastElement()).isWorkingCopy());</TD></TR><TR><TD CLASS="l">441</TD><TD>//}</TD></TR><TR><TD CLASS="l"><A NAME="11">442</A></TD><TD>/**</TD></TR><TR><TD CLASS="l">443</TD><TD> * Ensures that the primary method can be retrieved.</TD></TR><TR><TD CLASS="l">444</TD><TD> */</TD></TR><TR><TD CLASS="l">445</TD><TD>public void testGetPrimaryMethod() throws JavaScriptModelException {</TD></TR><TR CLASS="z"><TD CLASS="l">446</TD><TD>        IJavaScriptElement primary= this.copy.getFunctions()[0].getPrimaryElement();</TD></TR><TR CLASS="z"><TD CLASS="l">447</TD><TD>        assertTrue(&#34;Element is not a method&#34;, primary instanceof IFunction);</TD></TR><TR CLASS="z"><TD CLASS="l">448</TD><TD>        assertTrue(&#34;Element should exist&#34;, primary.exists());</TD></TR><TR CLASS="z"><TD CLASS="l">449</TD><TD>}</TD></TR><TR><TD CLASS="l">450</TD><TD>/**</TD></TR><TR><TD CLASS="l">451</TD><TD> * Ensures that renaming a method of a working copy does</TD></TR><TR><TD CLASS="l"><A NAME="16">452</A></TD><TD> * not alter the source of the primary compilation</TD></TR><TR><TD CLASS="l">453</TD><TD> * unit.</TD></TR><TR><TD CLASS="l">454</TD><TD> */</TD></TR><TR><TD CLASS="l">455</TD><TD>public void testRenameMethod() throws JavaScriptModelException {</TD></TR><TR CLASS="z"><TD CLASS="l">456</TD><TD>        IFunction method = this.copy.getFunctions()[0];</TD></TR><TR CLASS="z"><TD CLASS="l">457</TD><TD>        IJavaScriptElement primary= method.getPrimaryElement();</TD></TR><TR CLASS="z"><TD CLASS="l">458</TD><TD>        method.rename(&#34;bar&#34;, false, null);</TD></TR><TR CLASS="z"><TD CLASS="l">459</TD><TD>        assertEquals(&#34;Invalid name of working copy method&#34;, &#34;bar&#34;, this.copy.getFunctions()[0].getElementName());</TD></TR><TR CLASS="z"><TD CLASS="l">460</TD><TD>        assertEquals(&#34;Invalid name of primary method&#34;, &#34;foo&#34;, primary.getElementName());</TD></TR><TR CLASS="z"><TD CLASS="l">461</TD><TD>}</TD></TR><TR><TD CLASS="l">462</TD><TD>///**</TD></TR><TR><TD CLASS="l">463</TD><TD>// * Ensures that the primary package declaration can be retrieved.</TD></TR><TR><TD CLASS="l">464</TD><TD>// */</TD></TR><TR><TD CLASS="l">465</TD><TD>//public void testGetPrimaryPackageDeclaration() {</TD></TR><TR><TD CLASS="l">466</TD><TD>//        IPackageDeclaration pkg = this.copy.getPackageDeclaration(&#34;x.y&#34;);</TD></TR><TR><TD CLASS="l">467</TD><TD>//        IJavaScriptElement primary = pkg.getPrimaryElement();</TD></TR><TR><TD CLASS="l">468</TD><TD>//        assertTrue(&#34;Element should exist&#34;, primary.exists());</TD></TR><TR><TD CLASS="l">469</TD><TD>//}</TD></TR><TR><TD CLASS="l">470</TD><TD>///**</TD></TR><TR><TD CLASS="l">471</TD><TD>// * Ensures that the primary type can be retrieved.</TD></TR><TR><TD CLASS="l">472</TD><TD>// */</TD></TR><TR><TD CLASS="l">473</TD><TD>//public void testGetPrimaryType() {</TD></TR><TR><TD CLASS="l">474</TD><TD>//        IType type = this.copy.getType(&#34;A&#34;);</TD></TR><TR><TD CLASS="l">475</TD><TD>//        IJavaScriptElement primary= type.getPrimaryElement();</TD></TR><TR><TD CLASS="l">476</TD><TD>//        assertTrue(&#34;Element should exist&#34;, primary.exists());</TD></TR><TR><TD CLASS="l">477</TD><TD>//}</TD></TR><TR><TD CLASS="l">478</TD><TD>/**</TD></TR><TR><TD CLASS="l"><A NAME="12">479</A></TD><TD> * Ensures that a type can be moved to another working copy.</TD></TR><TR><TD CLASS="l">480</TD><TD> * (regression test for bug 7881 IType.move() clobbers editing buffer of destination element)</TD></TR><TR><TD CLASS="l">481</TD><TD> */</TD></TR><TR><TD CLASS="l">482</TD><TD>public void testMoveTypeToAnotherWorkingCopy() throws CoreException {</TD></TR><TR CLASS="z"><TD CLASS="l">483</TD><TD>        this.createFile(</TD></TR><TR CLASS="z"><TD CLASS="l">484</TD><TD>                &#34;P/src/B.js&#34;,</TD></TR><TR CLASS="z"><TD CLASS="l">485</TD><TD>                &#34;function B() {\n&#34; +</TD></TR><TR><TD CLASS="l">486</TD><TD>                &#34;}&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">487</TD><TD>        IJavaScriptUnit cu2 = this.getCompilationUnit(&#34;P/src/B.js&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">488</TD><TD>        IJavaScriptUnit copy2 = cu2.getWorkingCopy(null);</TD></TR><TR><TD CLASS="l">489</TD><TD>        try {</TD></TR><TR CLASS="z"><TD CLASS="l">490</TD><TD>                IField fld1 = this.copy.getField(&#34;field1&#34;);</TD></TR><TR><TD CLASS="l">491</TD><TD>//                IType classB = copy2.getType(&#34;B&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">492</TD><TD>                fld1.move(copy2, null, null, false, null);</TD></TR><TR CLASS="z"><TD CLASS="l">493</TD><TD>                assertTrue(&#34;A should not exist&#34;, !fld1.exists());</TD></TR><TR CLASS="z"><TD CLASS="l">494</TD><TD>                assertTrue(&#34;B.A should exist&#34;, copy2.getField(&#34;field1&#34;).exists());</TD></TR><TR CLASS="z"><TD CLASS="l">495</TD><TD>                assertTrue(&#34;Buffer for A should not be null&#34;, this.copy.getBuffer() != null);</TD></TR><TR CLASS="z"><TD CLASS="l">496</TD><TD>                assertSourceEquals(&#34;Invalid content for A&#34;, </TD></TR><TR CLASS="z"><TD CLASS="l">497</TD><TD>                                &#34;  var FIELD;\n&#34; +</TD></TR><TR><TD CLASS="l">498</TD><TD>                                &#34;  var field2;\n&#34; +</TD></TR><TR><TD CLASS="l">499</TD><TD>                                &#34;  function foo() {\n&#34; +</TD></TR><TR><TD CLASS="l">500</TD><TD>                                &#34;  }\n&#34; ,</TD></TR><TR CLASS="z"><TD CLASS="l">501</TD><TD>                        this.copy.getBuffer().getContents());</TD></TR><TR CLASS="z"><TD CLASS="l">502</TD><TD>                assertTrue(&#34;Buffer for B should not be null&#34;, copy2.getBuffer() != null);</TD></TR><TR CLASS="z"><TD CLASS="l">503</TD><TD>                assertSourceEquals(&#34;Invalid content for B&#34;, </TD></TR><TR CLASS="z"><TD CLASS="l">504</TD><TD>                                &#34;var field1;\n&#34; +</TD></TR><TR><TD CLASS="l">505</TD><TD>                                &#34;\n&#34; +</TD></TR><TR><TD CLASS="l">506</TD><TD>                                &#34;function B() {\n&#34; +</TD></TR><TR><TD CLASS="l">507</TD><TD>                                &#34;}&#34;,</TD></TR><TR CLASS="z"><TD CLASS="l">508</TD><TD>                        copy2.getBuffer().getContents());</TD></TR><TR CLASS="z"><TD CLASS="l">509</TD><TD>        } finally {</TD></TR><TR CLASS="z"><TD CLASS="l">510</TD><TD>                copy2.discardWorkingCopy();</TD></TR><TR CLASS="z"><TD CLASS="l">511</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">512</TD><TD>}</TD></TR><TR><TD CLASS="l"><A NAME="17">513</A></TD><TD>/**</TD></TR><TR><TD CLASS="l">514</TD><TD> * Test creating a shared working copy.</TD></TR><TR><TD CLASS="l">515</TD><TD> */</TD></TR><TR><TD CLASS="l">516</TD><TD>public void testShared1() throws JavaScriptModelException {</TD></TR><TR CLASS="z"><TD CLASS="l">517</TD><TD>        WorkingCopyOwner owner = new WorkingCopyOwner() {};</TD></TR><TR CLASS="z"><TD CLASS="l">518</TD><TD>        IJavaScriptUnit shared = this.cu.getWorkingCopy(owner, null, null);</TD></TR><TR><TD CLASS="l">519</TD><TD>        try {</TD></TR><TR CLASS="z"><TD CLASS="l">520</TD><TD>                assertTrue(&#34;Should find shared working copy&#34;, this.cu.findWorkingCopy(owner) == shared);</TD></TR><TR CLASS="z"><TD CLASS="l">521</TD><TD>        } finally {</TD></TR><TR CLASS="z"><TD CLASS="l">522</TD><TD>                shared.discardWorkingCopy();</TD></TR><TR CLASS="z"><TD CLASS="l">523</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">524</TD><TD>        assertTrue(&#34;Should not find cu with same owner&#34;, this.cu.findWorkingCopy(owner) == null);</TD></TR><TR CLASS="z"><TD CLASS="l">525</TD><TD>}</TD></TR><TR><TD CLASS="l"><A NAME="18">526</A></TD><TD>/**</TD></TR><TR><TD CLASS="l">527</TD><TD> * Test several call to creating shared working copy.</TD></TR><TR><TD CLASS="l">528</TD><TD> */</TD></TR><TR><TD CLASS="l">529</TD><TD>public void testShared2() throws JavaScriptModelException {</TD></TR><TR CLASS="z"><TD CLASS="l">530</TD><TD>        WorkingCopyOwner owner = new WorkingCopyOwner() {};</TD></TR><TR CLASS="z"><TD CLASS="l">531</TD><TD>        IJavaScriptUnit shared = this.cu.getWorkingCopy(owner, null, null);</TD></TR><TR><TD CLASS="l">532</TD><TD>        try {</TD></TR><TR CLASS="z"><TD CLASS="l">533</TD><TD>                IJavaScriptUnit shared2 = this.cu.getWorkingCopy(owner, null, null);</TD></TR><TR CLASS="z"><TD CLASS="l">534</TD><TD>                assertTrue(&#34;Second working copy should be identical to first one&#34;, shared2 == shared);</TD></TR><TR CLASS="z"><TD CLASS="l">535</TD><TD>        } finally {</TD></TR><TR CLASS="z"><TD CLASS="l">536</TD><TD>                shared.discardWorkingCopy();</TD></TR><TR><TD CLASS="l">537</TD><TD>                try {</TD></TR><TR CLASS="z"><TD CLASS="l">538</TD><TD>                        assertTrue(&#34;Should find shared working copy&#34;, this.cu.findWorkingCopy(owner) == shared);</TD></TR><TR CLASS="z"><TD CLASS="l">539</TD><TD>                } finally {</TD></TR><TR CLASS="z"><TD CLASS="l">540</TD><TD>                        shared.discardWorkingCopy();</TD></TR><TR CLASS="z"><TD CLASS="l">541</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">542</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">543</TD><TD>        assertTrue(&#34;Should not find cu with same owner&#34;, this.cu.findWorkingCopy(owner) == null);</TD></TR><TR CLASS="z"><TD CLASS="l">544</TD><TD>}</TD></TR><TR><TD CLASS="l">545</TD><TD>/**</TD></TR><TR><TD CLASS="l">546</TD><TD> * Tests that multiple commits are possible with the same working copy.</TD></TR><TR><TD CLASS="l">547</TD><TD> */</TD></TR><TR><TD CLASS="l">548</TD><TD>public void testMultipleCommit() {</TD></TR><TR><TD CLASS="l"><A NAME="13">549</A></TD><TD> </TD></TR><TR><TD CLASS="l">550</TD><TD>        // Add a method to the working copy</TD></TR><TR><TD CLASS="l">551</TD><TD>//        IType gp = this.copy.getType(&#34;A&#34;);</TD></TR><TR><TD CLASS="l">552</TD><TD>        try {</TD></TR><TR CLASS="z"><TD CLASS="l">553</TD><TD>                this.copy.createMethod(&#34;function anotherMethod() {}\n&#34;,null, false, null);</TD></TR><TR CLASS="z"><TD CLASS="l">554</TD><TD>        } catch (JavaScriptModelException jme) {</TD></TR><TR CLASS="z"><TD CLASS="l">555</TD><TD>                assertTrue(&#34;creation failed&#34;, false);</TD></TR><TR><TD CLASS="l">556</TD><TD>        }</TD></TR><TR><TD CLASS="l">557</TD><TD>        </TD></TR><TR><TD CLASS="l">558</TD><TD>        // commit the changes from the copy.</TD></TR><TR><TD CLASS="l">559</TD><TD>        try {</TD></TR><TR CLASS="z"><TD CLASS="l">560</TD><TD>                this.copy.commitWorkingCopy(false, null);</TD></TR><TR CLASS="z"><TD CLASS="l">561</TD><TD>        } catch (JavaScriptModelException t) {</TD></TR><TR CLASS="z"><TD CLASS="l">562</TD><TD>                assertTrue(&#34;commit failed&#34;, false);</TD></TR><TR><TD CLASS="l">563</TD><TD>        }</TD></TR><TR><TD CLASS="l">564</TD><TD>        </TD></TR><TR><TD CLASS="l">565</TD><TD>        // new method added</TD></TR><TR CLASS="z"><TD CLASS="l">566</TD><TD>        assertTrue(&#34;method should exist after commit&#34;, </TD></TR><TR CLASS="z"><TD CLASS="l">567</TD><TD>                this.cu.getFunction(&#34;anotherMethod&#34;, new String[]{}).exists());</TD></TR><TR><TD CLASS="l">568</TD><TD> </TD></TR><TR><TD CLASS="l">569</TD><TD>        //add another method</TD></TR><TR><TD CLASS="l">570</TD><TD>        try {</TD></TR><TR CLASS="z"><TD CLASS="l">571</TD><TD>                this.copy.createMethod(&#34;function anotherAnotherMethod() {}\n&#34;, null, false, null);</TD></TR><TR CLASS="z"><TD CLASS="l">572</TD><TD>        } catch (JavaScriptModelException x) {</TD></TR><TR CLASS="z"><TD CLASS="l">573</TD><TD>                assertTrue(&#34;Creation failed 2&#34;, false);</TD></TR><TR><TD CLASS="l">574</TD><TD>        }</TD></TR><TR><TD CLASS="l">575</TD><TD> </TD></TR><TR><TD CLASS="l">576</TD><TD>        //commit the new method</TD></TR><TR><TD CLASS="l">577</TD><TD>        try {</TD></TR><TR CLASS="z"><TD CLASS="l">578</TD><TD>                this.copy.commitWorkingCopy(false, null);</TD></TR><TR CLASS="z"><TD CLASS="l">579</TD><TD>        } catch (JavaScriptModelException t) {</TD></TR><TR CLASS="z"><TD CLASS="l">580</TD><TD>                assertTrue(&#34;commit2 failed&#34;, false);</TD></TR><TR><TD CLASS="l">581</TD><TD>        }</TD></TR><TR><TD CLASS="l">582</TD><TD> </TD></TR><TR><TD CLASS="l">583</TD><TD>        // new method added</TD></TR><TR CLASS="z"><TD CLASS="l">584</TD><TD>        assertTrue(&#34;second method added should exist after commit&#34;, </TD></TR><TR CLASS="z"><TD CLASS="l">585</TD><TD>                this.cu.getFunction(&#34;anotherAnotherMethod&#34;, new String[]{}).exists());</TD></TR><TR CLASS="z"><TD CLASS="l">586</TD><TD>}</TD></TR><TR><TD CLASS="l">587</TD><TD>/**</TD></TR><TR><TD CLASS="l"><A NAME="14">588</A></TD><TD> * Creates a working copy on a non-existing compilation unit.</TD></TR><TR><TD CLASS="l">589</TD><TD> * (regression test for bug 8921  DCR - Need a way to create a working copy ignoring existing files)</TD></TR><TR><TD CLASS="l">590</TD><TD> */</TD></TR><TR><TD CLASS="l">591</TD><TD>public void testNonExistingCU() throws JavaScriptModelException {</TD></TR><TR CLASS="z"><TD CLASS="l">592</TD><TD>        IJavaScriptUnit nonExistingCU = this.getCompilationUnit(&#34;P/src/NonExisting.js&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">593</TD><TD>        IJavaScriptUnit workingCopy = null;</TD></TR><TR><TD CLASS="l">594</TD><TD>        try {</TD></TR><TR><TD CLASS="l">595</TD><TD>                // getBuffer()</TD></TR><TR CLASS="z"><TD CLASS="l">596</TD><TD>                workingCopy = nonExistingCU.getWorkingCopy(null);</TD></TR><TR CLASS="z"><TD CLASS="l">597</TD><TD>                assertSourceEquals(&#34;Buffer should be empty&#34;, &#34;&#34;, ((IOpenable)workingCopy).getBuffer().getContents());</TD></TR><TR><TD CLASS="l">598</TD><TD>                </TD></TR><TR><TD CLASS="l">599</TD><TD>                // exists()</TD></TR><TR CLASS="z"><TD CLASS="l">600</TD><TD>                assertTrue(&#34;Working copy should exists&#34;, ((IJavaScriptElement)workingCopy).exists());</TD></TR><TR><TD CLASS="l">601</TD><TD>                </TD></TR><TR><TD CLASS="l">602</TD><TD>                // getCorrespondingResource()</TD></TR><TR CLASS="z"><TD CLASS="l">603</TD><TD>                assertEquals(&#34;Corresponding resource should be null&#34;, null, ((IJavaScriptElement)workingCopy).getCorrespondingResource());</TD></TR><TR><TD CLASS="l">604</TD><TD>                </TD></TR><TR><TD CLASS="l">605</TD><TD>                // getPrimaryElement()</TD></TR><TR CLASS="z"><TD CLASS="l">606</TD><TD>                assertEquals(&#34;Unexpected orginal element&#34;, nonExistingCU, workingCopy.getPrimaryElement());</TD></TR><TR><TD CLASS="l">607</TD><TD>                </TD></TR><TR><TD CLASS="l">608</TD><TD>                // getPath()</TD></TR><TR CLASS="z"><TD CLASS="l">609</TD><TD>                assertEquals(&#34;Unexpected path&#34;, new Path(&#34;/P/src/NonExisting.js&#34;), ((IJavaScriptElement)workingCopy).getPath());</TD></TR><TR><TD CLASS="l">610</TD><TD>                </TD></TR><TR><TD CLASS="l">611</TD><TD>                // getResource()</TD></TR><TR CLASS="z"><TD CLASS="l">612</TD><TD>                assertEquals(&#34;Unexpected resource&#34;, nonExistingCU.getResource(), ((IJavaScriptElement)workingCopy).getResource());</TD></TR><TR><TD CLASS="l">613</TD><TD>                </TD></TR><TR><TD CLASS="l">614</TD><TD>                // isConsistent()</TD></TR><TR CLASS="z"><TD CLASS="l">615</TD><TD>                assertTrue(&#34;Working copy should be consistent&#34;, ((IOpenable)workingCopy).isConsistent());</TD></TR><TR><TD CLASS="l">616</TD><TD>                </TD></TR><TR><TD CLASS="l">617</TD><TD>                // restore()</TD></TR><TR CLASS="z"><TD CLASS="l">618</TD><TD>                boolean exception = false;</TD></TR><TR><TD CLASS="l">619</TD><TD>                try {</TD></TR><TR CLASS="z"><TD CLASS="l">620</TD><TD>                        workingCopy.restore();</TD></TR><TR CLASS="z"><TD CLASS="l">621</TD><TD>                } catch (JavaScriptModelException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">622</TD><TD>                        exception = true;</TD></TR><TR><TD CLASS="l">623</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">624</TD><TD>                assertTrue(&#34;Should not be able to restore from primary element&#34;, exception);</TD></TR><TR><TD CLASS="l">625</TD><TD>                </TD></TR><TR><TD CLASS="l">626</TD><TD>                // makeConsistent()</TD></TR><TR CLASS="z"><TD CLASS="l">627</TD><TD>                ((IOpenable)workingCopy).getBuffer().setContents(</TD></TR><TR CLASS="z"><TD CLASS="l">628</TD><TD>                        &#34;function X() {\n&#34; +</TD></TR><TR><TD CLASS="l">629</TD><TD>                        &#34;}&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">630</TD><TD>                assertTrue(&#34;Working copy should not be consistent&#34;, !((IOpenable)workingCopy).isConsistent());</TD></TR><TR CLASS="z"><TD CLASS="l">631</TD><TD>                ((IOpenable)workingCopy).makeConsistent(null);</TD></TR><TR CLASS="z"><TD CLASS="l">632</TD><TD>                assertTrue(&#34;Working copy should be consistent&#34;, ((IOpenable)workingCopy).isConsistent());</TD></TR><TR><TD CLASS="l">633</TD><TD>                </TD></TR><TR><TD CLASS="l">634</TD><TD>                // save()</TD></TR><TR CLASS="z"><TD CLASS="l">635</TD><TD>                ((IOpenable)workingCopy).getBuffer().setContents(</TD></TR><TR CLASS="z"><TD CLASS="l">636</TD><TD>                        &#34;function Y() {\n&#34; +</TD></TR><TR><TD CLASS="l">637</TD><TD>                        &#34;}&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">638</TD><TD>                ((IOpenable)workingCopy).save(null, false);</TD></TR><TR CLASS="z"><TD CLASS="l">639</TD><TD>                assertTrue(&#34;Working copy should be consistent after save&#34;, ((IOpenable)workingCopy).isConsistent());</TD></TR><TR CLASS="z"><TD CLASS="l">640</TD><TD>                assertTrue(&#34;Primary cu should not exist&#34;, !nonExistingCU.exists());</TD></TR><TR><TD CLASS="l">641</TD><TD>                </TD></TR><TR><TD CLASS="l">642</TD><TD>                // commitWorkingCopy()</TD></TR><TR CLASS="z"><TD CLASS="l">643</TD><TD>                workingCopy.commitWorkingCopy(false, null);</TD></TR><TR CLASS="z"><TD CLASS="l">644</TD><TD>                assertTrue(&#34;Primary cu should exist&#34;, nonExistingCU.exists());</TD></TR><TR><TD CLASS="l">645</TD><TD> </TD></TR><TR><TD CLASS="l">646</TD><TD>                // hasResourceChanged()</TD></TR><TR CLASS="z"><TD CLASS="l">647</TD><TD>                assertTrue(&#34;Working copy's resource should now not mark as changed&#34;, !workingCopy.hasResourceChanged());</TD></TR><TR><TD CLASS="l">648</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">649</TD><TD>        } finally {</TD></TR><TR CLASS="z"><TD CLASS="l">650</TD><TD>                if (workingCopy != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">651</TD><TD>                        workingCopy.discardWorkingCopy();</TD></TR><TR><TD CLASS="l">652</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">653</TD><TD>                if (nonExistingCU.exists()) {</TD></TR><TR CLASS="z"><TD CLASS="l">654</TD><TD>                        nonExistingCU.delete(true, null);</TD></TR><TR><TD CLASS="l">655</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">656</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">657</TD><TD>}</TD></TR><TR><TD CLASS="l">658</TD><TD>/**</TD></TR><TR><TD CLASS="l">659</TD><TD> * Tests the general functionality of a operations working with working copies:&lt;ul&gt;</TD></TR><TR><TD CLASS="l">660</TD><TD> * &lt;li&gt;ensures that the copy cannot be renamed&lt;/li&gt;</TD></TR><TR><TD CLASS="l">661</TD><TD> * &lt;li&gt;ensures that the copy cannot be moved to the same location as the primary cu&lt;/li&gt;</TD></TR><TR><TD CLASS="l"><A NAME="15">662</A></TD><TD> * &lt;li&gt;ensures that the copy can be copied to a different location as the primary cu&lt;/li&gt;</TD></TR><TR><TD CLASS="l">663</TD><TD> */</TD></TR><TR><TD CLASS="l">664</TD><TD>public void testOperations() throws JavaScriptModelException {</TD></TR><TR><TD CLASS="l">665</TD><TD>        // rename working copy</TD></TR><TR CLASS="z"><TD CLASS="l">666</TD><TD>        boolean ex= false;</TD></TR><TR><TD CLASS="l">667</TD><TD>        try {</TD></TR><TR CLASS="z"><TD CLASS="l">668</TD><TD>                this.copy.rename(&#34;someName.js&#34;, false, null);</TD></TR><TR CLASS="z"><TD CLASS="l">669</TD><TD>        } catch (JavaScriptModelException jme) {</TD></TR><TR CLASS="z"><TD CLASS="l">670</TD><TD>                assertTrue(&#34;Incorrect status code for attempting to rename working copy&#34;, jme.getStatus().getCode() == IJavaScriptModelStatusConstants.INVALID_ELEMENT_TYPES);</TD></TR><TR CLASS="z"><TD CLASS="l">671</TD><TD>                ex= true;</TD></TR><TR><TD CLASS="l">672</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">673</TD><TD>        assertTrue(&#34;renaming a working copy should fail&#34;, ex);</TD></TR><TR><TD CLASS="l">674</TD><TD>        </TD></TR><TR><TD CLASS="l">675</TD><TD>        // move to same location as primary cu</TD></TR><TR CLASS="z"><TD CLASS="l">676</TD><TD>        ex= false;</TD></TR><TR><TD CLASS="l">677</TD><TD>        try {</TD></TR><TR CLASS="z"><TD CLASS="l">678</TD><TD>                this.copy.move(this.cu.getParent(), null, &#34;someName.js&#34;, false, null);</TD></TR><TR CLASS="z"><TD CLASS="l">679</TD><TD>        } catch (JavaScriptModelException jme) {</TD></TR><TR CLASS="z"><TD CLASS="l">680</TD><TD>                assertTrue(&#34;Incorrect status code for attempting to move working copy&#34;, jme.getStatus().getCode() == IJavaScriptModelStatusConstants.INVALID_ELEMENT_TYPES);</TD></TR><TR CLASS="z"><TD CLASS="l">681</TD><TD>                ex= true;</TD></TR><TR><TD CLASS="l">682</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">683</TD><TD>        assertTrue(&#34;moving a working copy should fail&#34;, ex);</TD></TR><TR><TD CLASS="l">684</TD><TD> </TD></TR><TR><TD CLASS="l">685</TD><TD>        // copy working copy to default package</TD></TR><TR CLASS="z"><TD CLASS="l">686</TD><TD>        IPackageFragment pkg= getPackageFragment(&#34;P&#34;, &#34;src&#34;, &#34;&#34;);</TD></TR><TR CLASS="z"><TD CLASS="l">687</TD><TD>        this.copy.copy(pkg, null, &#34;someName.js&#34;, false, null);</TD></TR><TR CLASS="z"><TD CLASS="l">688</TD><TD>        assertCreation(this.copy);        </TD></TR><TR CLASS="z"><TD CLASS="l">689</TD><TD>}</TD></TR><TR><TD CLASS="l">690</TD><TD>}</TD></TR></TABLE><P></P><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TD CLASS="nv">[<A HREF="../xslUnitTestCoverage.html">all classes</A>][<A HREF="10f.html">org.eclipse.wst.jsdt.core.tests.model</A>]</TD></TR><TR><TD CLASS="tl"><A HREF="http://www.eclemma.org/support.html">EMMA 2.0.5312 EclEmma Fix 1</A> (C) Vladimir Roubtsov</TD></TR></TABLE></BODY></HTML>