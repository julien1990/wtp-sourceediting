<HTML><HEAD><META CONTENT="text/html; charset=UTF-8" HTTP-EQUIV="Content-Type"/><TITLE>EMMA Coverage Report</TITLE><STYLE TYPE="text/css"> TABLE,TD,TH {border-style:solid; border-color:black;} TD,TH {background:white;margin:0;line-height:100%;padding-left:0.5em;padding-right:0.5em;} TD {border-width:0 1px 0 0;} TH {border-width:1px 1px 1px 0;} TR TD.h {color:red;} TABLE {border-spacing:0; border-collapse:collapse;border-width:0 0 1px 1px;} P,H1,H2,H3,TH {font-family:verdana,arial,sans-serif;font-size:10pt;} TD {font-family:courier,monospace;font-size:10pt;} TABLE.hdft {border-spacing:0;border-collapse:collapse;border-style:none;} TABLE.hdft TH,TABLE.hdft TD {border-style:none;line-height:normal;} TABLE.hdft TH.tl,TABLE.hdft TD.tl {background:#6699CC;color:white;} TABLE.hdft TD.nv {background:#6633DD;color:white;} .nv A:link {color:white;} .nv A:visited {color:white;} .nv A:active {color:yellow;} TABLE.hdft A:link {color:white;} TABLE.hdft A:visited {color:white;} TABLE.hdft A:active {color:yellow;} .in {color:#356085;} TABLE.s TD {padding-left:0.25em;padding-right:0.25em;} TABLE.s TD.l {padding-left:0.25em;padding-right:0.25em;text-align:right;background:#F0F0F0;} TABLE.s TR.z TD {background:#FF9999;} TABLE.s TR.p TD {background:#FFFF88;} TABLE.s TR.c TD {background:#CCFFCC;} A:link {color:#0000EE;text-decoration:none;} A:visited {color:#0000EE;text-decoration:none;} A:hover {color:#0000EE;text-decoration:underline;} TABLE.cn {border-width:0 0 1px 0;} TABLE.s {border-width:1px 0 1px 1px;} TD.h {color:red;border-width:0 1px 0 0;} TD.f {border-width:0 1px 0 1px;} TD.hf {color:red;border-width:0 1px 0 1px;} TH.f {border-width:1px 1px 1px 1px;} TR.cis TD {background:#F0F0F0;} TR.cis TD {border-width:1px 1px 1px 0;} TR.cis TD.h {color:red;border-width:1px 1px 1px 0;} TR.cis TD.f {border-width:1px 1px 1px 1px;} TR.cis TD.hf {color:red;border-width:1px 1px 1px 1px;} TD.b {border-style:none;background:transparent;line-height:50%;}  TD.bt {border-width:1px 0 0 0;background:transparent;line-height:50%;} TR.o TD {background:#F0F0F0;}TABLE.it {border-style:none;}TABLE.it TD,TABLE.it TH {border-style:none;}</STYLE></HEAD><BODY><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="tl"><A HREF="http://www.eclemma.org/">EMMA</A> Coverage Report (generated Tue Jun 09 19:59:05 GMT 2009)</TH></TR><TR><TD CLASS="nv">[<A HREF="../xslUnitTestCoverage.html">all classes</A>][<A HREF="177.html">org.eclipse.wst.jsdt.internal.ui.text.correction</A>]</TD></TR></TABLE><H2>COVERAGE SUMMARY FOR SOURCE FILE [<SPAN CLASS="in">AdvancedQuickAssistProcessor.java</SPAN>]</H2><TABLE CELLSPACING="0" WIDTH="100%"><TR><TH>name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD>AdvancedQuickAssistProcessor.java</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/59)</TD><TD CLASS="h">0%   (0/5484)</TD><TD CLASS="h">0%   (0/1425)</TD></TR></TABLE><H3>COVERAGE BREAKDOWN BY CLASS AND METHOD</H3><TABLE CLASS="cn" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="f">name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#0">AdvancedQuickAssistProcessor</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/54)</TD><TD CLASS="h">0%   (0/5379)</TD><TD CLASS="h">0%   (0/1407)</TD></TR><TR><TD CLASS="f"><A HREF="#0">AdvancedQuickAssistProcessor (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2">breakInfixOperationAtOperation (ASTRewrite, Expression, InfixExpression$Opera...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/93)</TD><TD CLASS="h">0%   (0/17)</TD></TR><TR><TD CLASS="f"><A HREF="#3">combineOperands (ASTRewrite, Expression, Expression, boolean, InfixExpression...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/38)</TD><TD CLASS="h">0%   (0/12)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#4">copyStatementExceptBreak (AST, ASTRewrite, Statement): Statement</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/40)</TD><TD CLASS="h">0%   (0/10)</TD></TR><TR><TD CLASS="f"><A HREF="#5">createAssignmentStatement (ASTRewrite, Assignment$Operator, Expression, Expre...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/27)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#6">createReturnExpression (ASTRewrite, Expression): ReturnStatement</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/14)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR><TD CLASS="f"><A HREF="#7">createSwitchCaseCondition (AST, ASTRewrite, ImportRewrite, SwitchStatement, S...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/67)</TD><TD CLASS="h">0%   (0/15)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#8">getAddParanoidalParenthesisProposals (IInvocationContext, ASTNode, ArrayList,...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/53)</TD><TD CLASS="h">0%   (0/12)</TD></TR><TR><TD CLASS="f"><A HREF="#9">getAssists (IInvocationContext, IProblemLocation []): IJavaCompletionProposal []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/146)</TD><TD CLASS="h">0%   (0/30)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#a">getBooleanExpression (ASTNode): Expression</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/84)</TD><TD CLASS="h">0%   (0/29)</TD></TR><TR><TD CLASS="f"><A HREF="#b">getCastAndAssignIfStatementProposals (IInvocationContext, ASTNode, Collection...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/256)</TD><TD CLASS="h">0%   (0/64)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#c">getConvertSwitchToIfProposals (IInvocationContext, ASTNode, Collection): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/246)</TD><TD CLASS="h">0%   (0/81)</TD></TR><TR><TD CLASS="f"><A HREF="#d">getExchangeInnerAndOuterIfConditionsProposals (IInvocationContext, ASTNode, C...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/208)</TD><TD CLASS="h">0%   (0/52)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#e">getExchangeOperandsProposals (IInvocationContext, ASTNode, Collection): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/166)</TD><TD CLASS="h">0%   (0/38)</TD></TR><TR><TD CLASS="f"><A HREF="#f">getExpressionPrecedence (Expression): int</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/52)</TD><TD CLASS="h">0%   (0/19)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#10">getFullyCoveredNodes (IInvocationContext, ASTNode): ArrayList</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/22)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR><TD CLASS="f"><A HREF="#11">getIfReturnIntoIfElseAtEndOfVoidMethodProposals (IInvocationContext, ASTNode,...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/178)</TD><TD CLASS="h">0%   (0/48)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#12">getInfixOperatorPrecedence (InfixExpression$Operator): int</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/88)</TD><TD CLASS="h">0%   (0/27)</TD></TR><TR><TD CLASS="f"><A HREF="#13">getInverseConditionProposals (IInvocationContext, ASTNode, ArrayList, Collect...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/69)</TD><TD CLASS="h">0%   (0/22)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#14">getInverseConditionalExpressionProposals (IInvocationContext, ASTNode, Collec...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/78)</TD><TD CLASS="h">0%   (0/22)</TD></TR><TR><TD CLASS="f"><A HREF="#15">getInverseIfContinueIntoIfThenInLoopsProposals (IInvocationContext, ASTNode, ...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/136)</TD><TD CLASS="h">0%   (0/35)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#16">getInverseIfIntoContinueInLoopsProposals (IInvocationContext, ASTNode, Collec...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/184)</TD><TD CLASS="h">0%   (0/46)</TD></TR><TR><TD CLASS="f"><A HREF="#17">getInverseIfProposals (IInvocationContext, ASTNode, Collection): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/99)</TD><TD CLASS="h">0%   (0/28)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#18">getInverseLocalVariableProposals (IInvocationContext, ASTNode, Collection): b...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/378)</TD><TD CLASS="h">0%   (0/96)</TD></TR><TR><TD CLASS="f"><A HREF="#19">getInversedAndOrExpression (ASTRewrite, InfixExpression, InfixExpression$Oper...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/62)</TD><TD CLASS="h">0%   (0/13)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1a">getInversedBooleanExpression (ASTRewrite, Expression): Expression</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#1b">getInversedBooleanExpression (ASTRewrite, Expression, AdvancedQuickAssistProc...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/212)</TD><TD CLASS="h">0%   (0/53)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1c">getInversedInfixBooleanExpression (ASTRewrite, InfixExpression, InfixExpressi...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/23)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR><TD CLASS="f"><A HREF="#1d">getJoinAndIfStatementsProposals (IInvocationContext, ASTNode, Collection): bo...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/250)</TD><TD CLASS="h">0%   (0/67)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1e">getJoinIfListInIfElseIfProposals (IInvocationContext, ASTNode, ArrayList, Col...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/145)</TD><TD CLASS="h">0%   (0/41)</TD></TR><TR><TD CLASS="f"><A HREF="#1f">getJoinOrIfStatementsProposals (IInvocationContext, ASTNode, ArrayList, Colle...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/205)</TD><TD CLASS="h">0%   (0/64)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#20">getParenthesizedExpression (AST, Expression): Expression</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/8)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR><TD CLASS="f"><A HREF="#21">getParenthesizedForAndIfNeeded (AST, ASTRewrite, Expression): Expression</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/46)</TD><TD CLASS="h">0%   (0/11)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#22">getParenthesizedForOrIfNeeded (AST, ASTRewrite, Expression): Expression</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/31)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR><TD CLASS="f"><A HREF="#23">getPickOutStringProposals (IInvocationContext, ASTNode, Collection): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/202)</TD><TD CLASS="h">0%   (0/44)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#24">getPullNegationUpProposals (IInvocationContext, ASTNode, ArrayList, Collectio...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/73)</TD><TD CLASS="h">0%   (0/22)</TD></TR><TR><TD CLASS="f"><A HREF="#25">getPushNegationDownProposals (IInvocationContext, ASTNode, Collection): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/124)</TD><TD CLASS="h">0%   (0/35)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#26">getRemoveExtraParenthesisProposals (IInvocationContext, ASTNode, ArrayList, C...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/75)</TD><TD CLASS="h">0%   (0/18)</TD></TR><TR><TD CLASS="f"><A HREF="#27">getRenamedNameCopy (AdvancedQuickAssistProcessor$SimpleNameRenameProvider, AS...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/21)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#28">getReplaceConditionalWithIfElseProposals (IInvocationContext, ASTNode, Collec...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/208)</TD><TD CLASS="h">0%   (0/49)</TD></TR><TR><TD CLASS="f"><A HREF="#29">getReplaceIfElseWithConditionalProposals (IInvocationContext, ASTNode, Collec...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/275)</TD><TD CLASS="h">0%   (0/71)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2a">getSingleStatement (Statement): Statement</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/20)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR><TD CLASS="f"><A HREF="#2b">getSplitAndConditionProposals (IInvocationContext, ASTNode, Collection): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/148)</TD><TD CLASS="h">0%   (0/43)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2c">getSplitOrConditionProposals (IInvocationContext, ASTNode, Collection): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/170)</TD><TD CLASS="h">0%   (0/47)</TD></TR><TR><TD CLASS="f"><A HREF="#2d">getUnwrappedStatements (Statement): ArrayList</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/31)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2e">hasAssists (IInvocationContext): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/136)</TD><TD CLASS="h">0%   (0/27)</TD></TR><TR><TD CLASS="f"><A HREF="#2f">hasStopAsLastExecutableStatement (Statement): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/29)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#30">isBoolean (Expression): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/11)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#31">isNegated (Expression): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/28)</TD><TD CLASS="h">0%   (0/9)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#32">isOperatorSelected (InfixExpression, int, int): int</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/44)</TD><TD CLASS="h">0%   (0/11)</TD></TR><TR><TD CLASS="f"><A HREF="#33">isSelectingOperator (ASTNode, ASTNode, int, int): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/34)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#34">noErrorsAtLocation (IProblemLocation []): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/19)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR><TD CLASS="f"><A HREF="#35">parenthesizeIfRequired (Expression, int): Expression</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/11)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#36">suggestLocalVariableNames (IJavaScriptUnit, ITypeBinding): String []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/8)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#37">AdvancedQuickAssistProcessor$1</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/72)</TD><TD CLASS="h">0%   (0/15)</TD></TR><TR><TD CLASS="f"><A HREF="#37">AdvancedQuickAssistProcessor$1 (int, int, ArrayList): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/12)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#39">isCovered (ASTNode): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/20)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR><TD CLASS="f"><A HREF="#3a">visitNode (ASTNode): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/40)</TD><TD CLASS="h">0%   (0/10)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#3b">AdvancedQuickAssistProcessor$2</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/2)</TD><TD CLASS="h">0%   (0/33)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR><TD CLASS="f"><A HREF="#3b">AdvancedQuickAssistProcessor$2 (IBinding, HashSet, AST, String): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/15)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#3d">getRenamed (SimpleName): SimpleName</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/18)</TD><TD CLASS="h">0%   (0/4)</TD></TR></TABLE><P></P><TABLE CLASS="s" CELLSPACING="0" WIDTH="100%"><TR CLASS="z"><TD CLASS="l">1</TD><TD>/*******************************************************************************</TD></TR><TR><TD CLASS="l">2</TD><TD> * Copyright (c) 2000, 2008 IBM Corporation and others.</TD></TR><TR><TD CLASS="l">3</TD><TD> * All rights reserved. This program and the accompanying materials</TD></TR><TR><TD CLASS="l">4</TD><TD> * are made available under the terms of the Eclipse Public License v1.0</TD></TR><TR><TD CLASS="l">5</TD><TD> * which accompanies this distribution, and is available at</TD></TR><TR><TD CLASS="l">6</TD><TD> * http://www.eclipse.org/legal/epl-v10.html</TD></TR><TR><TD CLASS="l">7</TD><TD> *</TD></TR><TR><TD CLASS="l">8</TD><TD> * Contributors:</TD></TR><TR><TD CLASS="l">9</TD><TD> *   Konstantin Scheglov (scheglov_ke@nlmk.ru) - initial API and implementation</TD></TR><TR><TD CLASS="l">10</TD><TD> *          (reports 71244 &amp; 74746: New Quick Assist's [quick assist])</TD></TR><TR><TD CLASS="l">11</TD><TD> *******************************************************************************/</TD></TR><TR><TD CLASS="l">12</TD><TD>package org.eclipse.wst.jsdt.internal.ui.text.correction;</TD></TR><TR><TD CLASS="l">13</TD><TD> </TD></TR><TR><TD CLASS="l">14</TD><TD>import java.util.ArrayList;</TD></TR><TR><TD CLASS="l">15</TD><TD>import java.util.Collection;</TD></TR><TR><TD CLASS="l">16</TD><TD>import java.util.HashSet;</TD></TR><TR><TD CLASS="l">17</TD><TD>import java.util.Hashtable;</TD></TR><TR><TD CLASS="l">18</TD><TD>import java.util.Iterator;</TD></TR><TR><TD CLASS="l">19</TD><TD>import java.util.List;</TD></TR><TR><TD CLASS="l">20</TD><TD>import java.util.Map;</TD></TR><TR><TD CLASS="l">21</TD><TD> </TD></TR><TR><TD CLASS="l">22</TD><TD>import org.eclipse.core.runtime.CoreException;</TD></TR><TR><TD CLASS="l">23</TD><TD>import org.eclipse.swt.graphics.Image;</TD></TR><TR><TD CLASS="l">24</TD><TD>import org.eclipse.wst.jsdt.core.IJavaScriptUnit;</TD></TR><TR><TD CLASS="l">25</TD><TD>import org.eclipse.wst.jsdt.core.dom.AST;</TD></TR><TR><TD CLASS="l">26</TD><TD>import org.eclipse.wst.jsdt.core.dom.ASTNode;</TD></TR><TR><TD CLASS="l">27</TD><TD>import org.eclipse.wst.jsdt.core.dom.Assignment;</TD></TR><TR><TD CLASS="l">28</TD><TD>import org.eclipse.wst.jsdt.core.dom.Block;</TD></TR><TR><TD CLASS="l">29</TD><TD>import org.eclipse.wst.jsdt.core.dom.BooleanLiteral;</TD></TR><TR><TD CLASS="l">30</TD><TD>import org.eclipse.wst.jsdt.core.dom.BreakStatement;</TD></TR><TR><TD CLASS="l">31</TD><TD>import org.eclipse.wst.jsdt.core.dom.CastExpression;</TD></TR><TR><TD CLASS="l">32</TD><TD>import org.eclipse.wst.jsdt.core.dom.ChildListPropertyDescriptor;</TD></TR><TR><TD CLASS="l">33</TD><TD>import org.eclipse.wst.jsdt.core.dom.ClassInstanceCreation;</TD></TR><TR><TD CLASS="l">34</TD><TD>import org.eclipse.wst.jsdt.core.dom.ConditionalExpression;</TD></TR><TR><TD CLASS="l">35</TD><TD>import org.eclipse.wst.jsdt.core.dom.ConstructorInvocation;</TD></TR><TR><TD CLASS="l">36</TD><TD>import org.eclipse.wst.jsdt.core.dom.ContinueStatement;</TD></TR><TR><TD CLASS="l">37</TD><TD>import org.eclipse.wst.jsdt.core.dom.DoStatement;</TD></TR><TR><TD CLASS="l">38</TD><TD>import org.eclipse.wst.jsdt.core.dom.Expression;</TD></TR><TR><TD CLASS="l">39</TD><TD>import org.eclipse.wst.jsdt.core.dom.ExpressionStatement;</TD></TR><TR><TD CLASS="l">40</TD><TD>import org.eclipse.wst.jsdt.core.dom.ForInStatement;</TD></TR><TR><TD CLASS="l">41</TD><TD>import org.eclipse.wst.jsdt.core.dom.ForStatement;</TD></TR><TR><TD CLASS="l">42</TD><TD>import org.eclipse.wst.jsdt.core.dom.FunctionDeclaration;</TD></TR><TR><TD CLASS="l">43</TD><TD>import org.eclipse.wst.jsdt.core.dom.FunctionInvocation;</TD></TR><TR><TD CLASS="l">44</TD><TD>import org.eclipse.wst.jsdt.core.dom.IBinding;</TD></TR><TR><TD CLASS="l">45</TD><TD>import org.eclipse.wst.jsdt.core.dom.ITypeBinding;</TD></TR><TR><TD CLASS="l">46</TD><TD>import org.eclipse.wst.jsdt.core.dom.IVariableBinding;</TD></TR><TR><TD CLASS="l">47</TD><TD>import org.eclipse.wst.jsdt.core.dom.IfStatement;</TD></TR><TR><TD CLASS="l">48</TD><TD>import org.eclipse.wst.jsdt.core.dom.InfixExpression;</TD></TR><TR><TD CLASS="l">49</TD><TD>import org.eclipse.wst.jsdt.core.dom.InstanceofExpression;</TD></TR><TR><TD CLASS="l">50</TD><TD>import org.eclipse.wst.jsdt.core.dom.Name;</TD></TR><TR><TD CLASS="l">51</TD><TD>import org.eclipse.wst.jsdt.core.dom.ParenthesizedExpression;</TD></TR><TR><TD CLASS="l">52</TD><TD>import org.eclipse.wst.jsdt.core.dom.PostfixExpression;</TD></TR><TR><TD CLASS="l">53</TD><TD>import org.eclipse.wst.jsdt.core.dom.PrefixExpression;</TD></TR><TR><TD CLASS="l">54</TD><TD>import org.eclipse.wst.jsdt.core.dom.PrimitiveType;</TD></TR><TR><TD CLASS="l">55</TD><TD>import org.eclipse.wst.jsdt.core.dom.QualifiedName;</TD></TR><TR><TD CLASS="l">56</TD><TD>import org.eclipse.wst.jsdt.core.dom.ReturnStatement;</TD></TR><TR><TD CLASS="l">57</TD><TD>import org.eclipse.wst.jsdt.core.dom.SimpleName;</TD></TR><TR><TD CLASS="l">58</TD><TD>import org.eclipse.wst.jsdt.core.dom.SingleVariableDeclaration;</TD></TR><TR><TD CLASS="l">59</TD><TD>import org.eclipse.wst.jsdt.core.dom.Statement;</TD></TR><TR><TD CLASS="l">60</TD><TD>import org.eclipse.wst.jsdt.core.dom.StringLiteral;</TD></TR><TR><TD CLASS="l">61</TD><TD>import org.eclipse.wst.jsdt.core.dom.StructuralPropertyDescriptor;</TD></TR><TR><TD CLASS="l">62</TD><TD>import org.eclipse.wst.jsdt.core.dom.SuperConstructorInvocation;</TD></TR><TR><TD CLASS="l">63</TD><TD>import org.eclipse.wst.jsdt.core.dom.SuperMethodInvocation;</TD></TR><TR><TD CLASS="l">64</TD><TD>import org.eclipse.wst.jsdt.core.dom.SwitchCase;</TD></TR><TR><TD CLASS="l">65</TD><TD>import org.eclipse.wst.jsdt.core.dom.SwitchStatement;</TD></TR><TR><TD CLASS="l">66</TD><TD>import org.eclipse.wst.jsdt.core.dom.Type;</TD></TR><TR><TD CLASS="l">67</TD><TD>import org.eclipse.wst.jsdt.core.dom.VariableDeclarationFragment;</TD></TR><TR><TD CLASS="l">68</TD><TD>import org.eclipse.wst.jsdt.core.dom.VariableDeclarationStatement;</TD></TR><TR><TD CLASS="l">69</TD><TD>import org.eclipse.wst.jsdt.core.dom.WhileStatement;</TD></TR><TR><TD CLASS="l">70</TD><TD>import org.eclipse.wst.jsdt.core.dom.InfixExpression.Operator;</TD></TR><TR><TD CLASS="l">71</TD><TD>import org.eclipse.wst.jsdt.core.dom.rewrite.ASTRewrite;</TD></TR><TR><TD CLASS="l">72</TD><TD>import org.eclipse.wst.jsdt.core.dom.rewrite.ImportRewrite;</TD></TR><TR><TD CLASS="l">73</TD><TD>import org.eclipse.wst.jsdt.core.dom.rewrite.ListRewrite;</TD></TR><TR><TD CLASS="l">74</TD><TD>import org.eclipse.wst.jsdt.internal.corext.codemanipulation.StubUtility;</TD></TR><TR><TD CLASS="l">75</TD><TD>import org.eclipse.wst.jsdt.internal.corext.dom.ASTNodes;</TD></TR><TR><TD CLASS="l">76</TD><TD>import org.eclipse.wst.jsdt.internal.corext.dom.GenericVisitor;</TD></TR><TR><TD CLASS="l">77</TD><TD>import org.eclipse.wst.jsdt.internal.corext.dom.LinkedNodeFinder;</TD></TR><TR><TD CLASS="l">78</TD><TD>import org.eclipse.wst.jsdt.internal.corext.fix.CleanUpConstants;</TD></TR><TR><TD CLASS="l">79</TD><TD>import org.eclipse.wst.jsdt.internal.corext.fix.ExpressionsFix;</TD></TR><TR><TD CLASS="l">80</TD><TD>import org.eclipse.wst.jsdt.internal.corext.fix.IFix;</TD></TR><TR><TD CLASS="l">81</TD><TD>import org.eclipse.wst.jsdt.internal.corext.util.JavaModelUtil;</TD></TR><TR><TD CLASS="l">82</TD><TD>import org.eclipse.wst.jsdt.internal.corext.util.Messages;</TD></TR><TR><TD CLASS="l">83</TD><TD>import org.eclipse.wst.jsdt.internal.ui.JavaPluginImages;</TD></TR><TR><TD CLASS="l">84</TD><TD>import org.eclipse.wst.jsdt.internal.ui.fix.ExpressionsCleanUp;</TD></TR><TR><TD CLASS="l">85</TD><TD>import org.eclipse.wst.jsdt.ui.CodeStyleConfiguration;</TD></TR><TR><TD CLASS="l">86</TD><TD>import org.eclipse.wst.jsdt.ui.text.java.IInvocationContext;</TD></TR><TR><TD CLASS="l">87</TD><TD>import org.eclipse.wst.jsdt.ui.text.java.IJavaCompletionProposal;</TD></TR><TR><TD CLASS="l">88</TD><TD>import org.eclipse.wst.jsdt.ui.text.java.IProblemLocation;</TD></TR><TR><TD CLASS="l">89</TD><TD>import org.eclipse.wst.jsdt.ui.text.java.IQuickAssistProcessor;</TD></TR><TR><TD CLASS="l">90</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="0">91</A></TD><TD>/**</TD></TR><TR><TD CLASS="l">92</TD><TD> */</TD></TR><TR><TD CLASS="l">93</TD><TD>public class AdvancedQuickAssistProcessor implements IQuickAssistProcessor {</TD></TR><TR><TD CLASS="l">94</TD><TD>        public AdvancedQuickAssistProcessor() {</TD></TR><TR CLASS="z"><TD CLASS="l">95</TD><TD>                super();</TD></TR><TR CLASS="z"><TD CLASS="l">96</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="2e">97</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">98</TD><TD>         * @see org.eclipse.wst.jsdt.internal.ui.text.correction.IAssistProcessor#hasAssists(org.eclipse.wst.jsdt.internal.ui.text.correction.IAssistContext)</TD></TR><TR><TD CLASS="l">99</TD><TD>         */</TD></TR><TR><TD CLASS="l">100</TD><TD>        public boolean hasAssists(IInvocationContext context) throws CoreException {</TD></TR><TR CLASS="z"><TD CLASS="l">101</TD><TD>                ASTNode coveringNode = context.getCoveringNode();</TD></TR><TR CLASS="z"><TD CLASS="l">102</TD><TD>                if (coveringNode != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">103</TD><TD>                        ArrayList coveredNodes= getFullyCoveredNodes(context, coveringNode);</TD></TR><TR CLASS="z"><TD CLASS="l">104</TD><TD>                        return getInverseIfProposals(context, coveringNode, null)</TD></TR><TR CLASS="z"><TD CLASS="l">105</TD><TD>                                        || getIfReturnIntoIfElseAtEndOfVoidMethodProposals(context, coveringNode, null)</TD></TR><TR CLASS="z"><TD CLASS="l">106</TD><TD>                                        || getInverseIfContinueIntoIfThenInLoopsProposals(context, coveringNode, null)</TD></TR><TR CLASS="z"><TD CLASS="l">107</TD><TD>                                        || getInverseIfIntoContinueInLoopsProposals(context, coveringNode, null)</TD></TR><TR CLASS="z"><TD CLASS="l">108</TD><TD>                                        || getInverseConditionProposals(context, coveringNode, coveredNodes, null)</TD></TR><TR CLASS="z"><TD CLASS="l">109</TD><TD>                                        || getRemoveExtraParenthesisProposals(context, coveringNode, coveredNodes, null)</TD></TR><TR CLASS="z"><TD CLASS="l">110</TD><TD>                                        || getAddParanoidalParenthesisProposals(context, coveringNode, coveredNodes, null)</TD></TR><TR CLASS="z"><TD CLASS="l">111</TD><TD>                                        || getJoinAndIfStatementsProposals(context, coveringNode, null)</TD></TR><TR CLASS="z"><TD CLASS="l">112</TD><TD>                                        || getSplitAndConditionProposals(context, coveringNode, null)</TD></TR><TR CLASS="z"><TD CLASS="l">113</TD><TD>                                        || getJoinOrIfStatementsProposals(context, coveringNode, coveredNodes, null)</TD></TR><TR CLASS="z"><TD CLASS="l">114</TD><TD>                                        || getSplitOrConditionProposals(context, coveringNode, null)</TD></TR><TR CLASS="z"><TD CLASS="l">115</TD><TD>                                        || getInverseConditionalExpressionProposals(context, coveringNode, null)</TD></TR><TR CLASS="z"><TD CLASS="l">116</TD><TD>                                        || getExchangeInnerAndOuterIfConditionsProposals(context, coveringNode, null)</TD></TR><TR CLASS="z"><TD CLASS="l">117</TD><TD>                                        || getExchangeOperandsProposals(context, coveringNode, null)</TD></TR><TR CLASS="z"><TD CLASS="l">118</TD><TD>                                        || getCastAndAssignIfStatementProposals(context, coveringNode, null)</TD></TR><TR CLASS="z"><TD CLASS="l">119</TD><TD>                                        || getPickOutStringProposals(context, coveringNode, null)</TD></TR><TR CLASS="z"><TD CLASS="l">120</TD><TD>                                        || getReplaceIfElseWithConditionalProposals(context, coveringNode, null)</TD></TR><TR CLASS="z"><TD CLASS="l">121</TD><TD>                                        || getReplaceConditionalWithIfElseProposals(context, coveringNode, null)</TD></TR><TR CLASS="z"><TD CLASS="l">122</TD><TD>                                        || getInverseLocalVariableProposals(context, coveringNode, null)</TD></TR><TR CLASS="z"><TD CLASS="l">123</TD><TD>                                        || getPushNegationDownProposals(context, coveringNode, null)</TD></TR><TR CLASS="z"><TD CLASS="l">124</TD><TD>                                        || getPullNegationUpProposals(context, coveringNode, coveredNodes, null)</TD></TR><TR CLASS="z"><TD CLASS="l">125</TD><TD>                                        || getJoinIfListInIfElseIfProposals(context, coveringNode, coveredNodes, null)</TD></TR><TR CLASS="z"><TD CLASS="l">126</TD><TD>                                        || getConvertSwitchToIfProposals(context, coveringNode, null);</TD></TR><TR><TD CLASS="l">127</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">128</TD><TD>                return false;</TD></TR><TR><TD CLASS="l">129</TD><TD>        }</TD></TR><TR><TD CLASS="l">130</TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l"><A NAME="9">131</A></TD><TD>         * @see org.eclipse.wst.jsdt.internal.ui.text.correction.IAssistProcessor#getAssists(org.eclipse.wst.jsdt.internal.ui.text.correction.IAssistContext, org.eclipse.wst.jsdt.internal.ui.text.correction.IProblemLocation[])</TD></TR><TR><TD CLASS="l">132</TD><TD>         */</TD></TR><TR><TD CLASS="l">133</TD><TD>        public IJavaCompletionProposal[] getAssists(IInvocationContext context, IProblemLocation[] locations)</TD></TR><TR><TD CLASS="l">134</TD><TD>                        throws CoreException {</TD></TR><TR CLASS="z"><TD CLASS="l">135</TD><TD>                ASTNode coveringNode = context.getCoveringNode();</TD></TR><TR CLASS="z"><TD CLASS="l">136</TD><TD>                if (coveringNode != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">137</TD><TD>                        ArrayList coveredNodes = getFullyCoveredNodes(context, coveringNode);</TD></TR><TR CLASS="z"><TD CLASS="l">138</TD><TD>                        ArrayList resultingCollections = new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">139</TD><TD>                        if (noErrorsAtLocation(locations)) {</TD></TR><TR CLASS="z"><TD CLASS="l">140</TD><TD>                                getInverseIfProposals(context, coveringNode, resultingCollections);</TD></TR><TR CLASS="z"><TD CLASS="l">141</TD><TD>                                getIfReturnIntoIfElseAtEndOfVoidMethodProposals(context, coveringNode, resultingCollections);</TD></TR><TR CLASS="z"><TD CLASS="l">142</TD><TD>                                getInverseIfContinueIntoIfThenInLoopsProposals(context, coveringNode, resultingCollections);</TD></TR><TR CLASS="z"><TD CLASS="l">143</TD><TD>                                getInverseIfIntoContinueInLoopsProposals(context, coveringNode, resultingCollections);</TD></TR><TR CLASS="z"><TD CLASS="l">144</TD><TD>                                getInverseConditionProposals(context, coveringNode, coveredNodes, resultingCollections);</TD></TR><TR CLASS="z"><TD CLASS="l">145</TD><TD>                                getRemoveExtraParenthesisProposals(context, coveringNode, coveredNodes, resultingCollections);</TD></TR><TR CLASS="z"><TD CLASS="l">146</TD><TD>                                getAddParanoidalParenthesisProposals(context, coveringNode, coveredNodes, resultingCollections);</TD></TR><TR CLASS="z"><TD CLASS="l">147</TD><TD>                                getJoinAndIfStatementsProposals(context, coveringNode, resultingCollections);</TD></TR><TR CLASS="z"><TD CLASS="l">148</TD><TD>                                getSplitAndConditionProposals(context, coveringNode, resultingCollections);</TD></TR><TR CLASS="z"><TD CLASS="l">149</TD><TD>                                getJoinOrIfStatementsProposals(context, coveringNode, coveredNodes, resultingCollections);</TD></TR><TR CLASS="z"><TD CLASS="l">150</TD><TD>                                getSplitOrConditionProposals(context, coveringNode, resultingCollections);</TD></TR><TR CLASS="z"><TD CLASS="l">151</TD><TD>                                getInverseConditionalExpressionProposals(context, coveringNode, resultingCollections);</TD></TR><TR CLASS="z"><TD CLASS="l">152</TD><TD>                                getExchangeInnerAndOuterIfConditionsProposals(context, coveringNode, resultingCollections);</TD></TR><TR CLASS="z"><TD CLASS="l">153</TD><TD>                                getExchangeOperandsProposals(context, coveringNode, resultingCollections);</TD></TR><TR CLASS="z"><TD CLASS="l">154</TD><TD>                                getCastAndAssignIfStatementProposals(context, coveringNode, resultingCollections);</TD></TR><TR CLASS="z"><TD CLASS="l">155</TD><TD>                                getPickOutStringProposals(context, coveringNode, resultingCollections);</TD></TR><TR CLASS="z"><TD CLASS="l">156</TD><TD>                                getReplaceIfElseWithConditionalProposals(context, coveringNode, resultingCollections);</TD></TR><TR CLASS="z"><TD CLASS="l">157</TD><TD>                                getReplaceConditionalWithIfElseProposals(context, coveringNode, resultingCollections);</TD></TR><TR CLASS="z"><TD CLASS="l">158</TD><TD>                                getInverseLocalVariableProposals(context, coveringNode, resultingCollections);</TD></TR><TR CLASS="z"><TD CLASS="l">159</TD><TD>                                getPushNegationDownProposals(context, coveringNode, resultingCollections);</TD></TR><TR CLASS="z"><TD CLASS="l">160</TD><TD>                                getPullNegationUpProposals(context, coveringNode, coveredNodes, resultingCollections);</TD></TR><TR CLASS="z"><TD CLASS="l">161</TD><TD>                                getJoinIfListInIfElseIfProposals(context, coveringNode, coveredNodes, resultingCollections);</TD></TR><TR CLASS="z"><TD CLASS="l">162</TD><TD>                                getConvertSwitchToIfProposals(context, coveringNode, resultingCollections);</TD></TR><TR><TD CLASS="l">163</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">164</TD><TD>                        return (IJavaCompletionProposal[]) resultingCollections.toArray(new IJavaCompletionProposal[resultingCollections.size()]);</TD></TR><TR><TD CLASS="l"><A NAME="34">165</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">166</TD><TD>                return null;</TD></TR><TR><TD CLASS="l">167</TD><TD>        }</TD></TR><TR><TD CLASS="l">168</TD><TD>        private static boolean noErrorsAtLocation(IProblemLocation[] locations) {</TD></TR><TR CLASS="z"><TD CLASS="l">169</TD><TD>                if (locations != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">170</TD><TD>                        for (int i = 0; i &lt; locations.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">171</TD><TD>                                if (locations[i].isError()) {</TD></TR><TR CLASS="z"><TD CLASS="l">172</TD><TD>                                        return false;</TD></TR><TR><TD CLASS="l">173</TD><TD>                                }</TD></TR><TR><TD CLASS="l">174</TD><TD>                        }</TD></TR><TR><TD CLASS="l">175</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="11">176</A></TD><TD>                return true;</TD></TR><TR><TD CLASS="l">177</TD><TD>        }</TD></TR><TR><TD CLASS="l">178</TD><TD>        private static boolean getIfReturnIntoIfElseAtEndOfVoidMethodProposals(IInvocationContext context, ASTNode covering,</TD></TR><TR><TD CLASS="l">179</TD><TD>                        Collection resultingCollections) {</TD></TR><TR CLASS="z"><TD CLASS="l">180</TD><TD>                Statement coveringStatement = ASTResolving.findParentStatement(covering);</TD></TR><TR CLASS="z"><TD CLASS="l">181</TD><TD>                if (!(coveringStatement instanceof IfStatement)) {</TD></TR><TR CLASS="z"><TD CLASS="l">182</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">183</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">184</TD><TD>                IfStatement ifStatement = (IfStatement) coveringStatement;</TD></TR><TR CLASS="z"><TD CLASS="l">185</TD><TD>                if (ifStatement.getElseStatement() != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">186</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">187</TD><TD>                }</TD></TR><TR><TD CLASS="l">188</TD><TD>                // 'then' block should have 'return' as last statement</TD></TR><TR CLASS="z"><TD CLASS="l">189</TD><TD>                Statement thenStatement = ifStatement.getThenStatement();</TD></TR><TR CLASS="z"><TD CLASS="l">190</TD><TD>                if (!(thenStatement instanceof Block)) {</TD></TR><TR CLASS="z"><TD CLASS="l">191</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">192</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">193</TD><TD>                Block thenBlock = (Block) thenStatement;</TD></TR><TR CLASS="z"><TD CLASS="l">194</TD><TD>                List thenStatements = thenBlock.statements();</TD></TR><TR CLASS="z"><TD CLASS="l">195</TD><TD>                if (thenStatements.isEmpty() || !(thenStatements.get(thenStatements.size() - 1) instanceof ReturnStatement)) {</TD></TR><TR CLASS="z"><TD CLASS="l">196</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">197</TD><TD>                }</TD></TR><TR><TD CLASS="l">198</TD><TD>                // method should return 'void'</TD></TR><TR CLASS="z"><TD CLASS="l">199</TD><TD>                FunctionDeclaration coveringMetod = ASTResolving.findParentMethodDeclaration(covering);</TD></TR><TR CLASS="z"><TD CLASS="l">200</TD><TD>                if (coveringMetod == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">201</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">202</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">203</TD><TD>                Type returnType = coveringMetod.getReturnType2();</TD></TR><TR CLASS="z"><TD CLASS="l">204</TD><TD>                if (!(returnType instanceof PrimitiveType)</TD></TR><TR CLASS="z"><TD CLASS="l">205</TD><TD>                                || ((PrimitiveType) returnType).getPrimitiveTypeCode() != PrimitiveType.VOID)</TD></TR><TR CLASS="z"><TD CLASS="l">206</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">207</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">208</TD><TD>                List statements = coveringMetod.getBody().statements();</TD></TR><TR CLASS="z"><TD CLASS="l">209</TD><TD>                int ifIndex = statements.indexOf(ifStatement);</TD></TR><TR CLASS="z"><TD CLASS="l">210</TD><TD>                if (ifIndex == -1) {</TD></TR><TR CLASS="z"><TD CLASS="l">211</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">212</TD><TD>                }</TD></TR><TR><TD CLASS="l">213</TD><TD>                //  we could produce quick assist</TD></TR><TR CLASS="z"><TD CLASS="l">214</TD><TD>                if (resultingCollections == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">215</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">216</TD><TD>                }</TD></TR><TR><TD CLASS="l">217</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">218</TD><TD>                AST ast = coveringStatement.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">219</TD><TD>                ASTRewrite rewrite = ASTRewrite.create(ast);</TD></TR><TR><TD CLASS="l">220</TD><TD>                // remove last 'return' in 'then' block</TD></TR><TR CLASS="z"><TD CLASS="l">221</TD><TD>                ListRewrite listRewriter = rewrite.getListRewrite(thenBlock,</TD></TR><TR CLASS="z"><TD CLASS="l">222</TD><TD>                        (ChildListPropertyDescriptor) ifStatement.getLocationInParent());</TD></TR><TR CLASS="z"><TD CLASS="l">223</TD><TD>                listRewriter.remove((ASTNode) thenStatements.get(thenStatements.size() - 1), null);</TD></TR><TR><TD CLASS="l">224</TD><TD>                // prepare original nodes</TD></TR><TR CLASS="z"><TD CLASS="l">225</TD><TD>                Expression conditionPlaceholder = (Expression) rewrite.createMoveTarget(ifStatement.getExpression());</TD></TR><TR CLASS="z"><TD CLASS="l">226</TD><TD>                Statement thenPlaceholder = (Statement) rewrite.createMoveTarget(ifStatement.getThenStatement());</TD></TR><TR><TD CLASS="l">227</TD><TD>                // prepare 'else' block</TD></TR><TR CLASS="z"><TD CLASS="l">228</TD><TD>                Block elseBlock = ast.newBlock();</TD></TR><TR CLASS="z"><TD CLASS="l">229</TD><TD>                for (int i = ifIndex + 1; i &lt; statements.size(); i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">230</TD><TD>                        Statement statement = (Statement) statements.get(i);</TD></TR><TR CLASS="z"><TD CLASS="l">231</TD><TD>                        elseBlock.statements().add(rewrite.createMoveTarget(statement));</TD></TR><TR><TD CLASS="l">232</TD><TD>                }</TD></TR><TR><TD CLASS="l">233</TD><TD>                // prepare new 'if' statement</TD></TR><TR CLASS="z"><TD CLASS="l">234</TD><TD>                IfStatement newIf = ast.newIfStatement();</TD></TR><TR CLASS="z"><TD CLASS="l">235</TD><TD>                newIf.setExpression(conditionPlaceholder);</TD></TR><TR CLASS="z"><TD CLASS="l">236</TD><TD>                newIf.setThenStatement(thenPlaceholder);</TD></TR><TR CLASS="z"><TD CLASS="l">237</TD><TD>                newIf.setElseStatement(elseBlock);</TD></TR><TR CLASS="z"><TD CLASS="l">238</TD><TD>                rewrite.replace(ifStatement, newIf, null);</TD></TR><TR><TD CLASS="l">239</TD><TD>                // add correction proposal</TD></TR><TR CLASS="z"><TD CLASS="l">240</TD><TD>                String label = CorrectionMessages.AdvancedQuickAssistProcessor_convertToIfElse_description;</TD></TR><TR CLASS="z"><TD CLASS="l">241</TD><TD>                Image image = JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">242</TD><TD>                ASTRewriteCorrectionProposal proposal = new ASTRewriteCorrectionProposal(label, context.getCompilationUnit(),</TD></TR><TR CLASS="z"><TD CLASS="l">243</TD><TD>                                rewrite, 1, image);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="17">244</A></TD><TD>                resultingCollections.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l">245</TD><TD>                return true;</TD></TR><TR><TD CLASS="l">246</TD><TD>        }</TD></TR><TR><TD CLASS="l">247</TD><TD>        private static boolean getInverseIfProposals(IInvocationContext context, ASTNode covering, Collection resultingCollections) {</TD></TR><TR CLASS="z"><TD CLASS="l">248</TD><TD>                Statement coveringStatement = ASTResolving.findParentStatement(covering);</TD></TR><TR CLASS="z"><TD CLASS="l">249</TD><TD>                if (!(coveringStatement instanceof IfStatement)) {</TD></TR><TR CLASS="z"><TD CLASS="l">250</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">251</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">252</TD><TD>                IfStatement ifStatement = (IfStatement) coveringStatement;</TD></TR><TR CLASS="z"><TD CLASS="l">253</TD><TD>                if (ifStatement.getElseStatement() == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">254</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">255</TD><TD>                }</TD></TR><TR><TD CLASS="l">256</TD><TD>                //  we could produce quick assist</TD></TR><TR CLASS="z"><TD CLASS="l">257</TD><TD>                if (resultingCollections == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">258</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">259</TD><TD>                }</TD></TR><TR><TD CLASS="l">260</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">261</TD><TD>                AST ast = coveringStatement.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">262</TD><TD>                ASTRewrite rewrite = ASTRewrite.create(ast);</TD></TR><TR CLASS="z"><TD CLASS="l">263</TD><TD>                Statement thenStatement= ifStatement.getThenStatement();</TD></TR><TR CLASS="z"><TD CLASS="l">264</TD><TD>                Statement elseStatement= ifStatement.getElseStatement();</TD></TR><TR><TD CLASS="l">265</TD><TD>                </TD></TR><TR><TD CLASS="l">266</TD><TD>                // prepare original nodes</TD></TR><TR CLASS="z"><TD CLASS="l">267</TD><TD>                Expression inversedExpression = getInversedBooleanExpression(rewrite, ifStatement.getExpression());</TD></TR><TR><TD CLASS="l">268</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">269</TD><TD>                Statement newElseStatement = (Statement) rewrite.createMoveTarget(thenStatement);</TD></TR><TR CLASS="z"><TD CLASS="l">270</TD><TD>                Statement newThenStatement = (Statement) rewrite.createMoveTarget(elseStatement);</TD></TR><TR><TD CLASS="l">271</TD><TD>                // set new nodes</TD></TR><TR CLASS="z"><TD CLASS="l">272</TD><TD>                rewrite.set(ifStatement, IfStatement.EXPRESSION_PROPERTY, inversedExpression, null);</TD></TR><TR><TD CLASS="l">273</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">274</TD><TD>                if (elseStatement instanceof IfStatement) {// bug 79507 &amp;&amp; bug 74580</TD></TR><TR CLASS="z"><TD CLASS="l">275</TD><TD>                        Block elseBlock = ast.newBlock();</TD></TR><TR CLASS="z"><TD CLASS="l">276</TD><TD>                        elseBlock.statements().add(newThenStatement);</TD></TR><TR CLASS="z"><TD CLASS="l">277</TD><TD>                        newThenStatement= elseBlock;</TD></TR><TR><TD CLASS="l">278</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">279</TD><TD>                rewrite.set(ifStatement, IfStatement.THEN_STATEMENT_PROPERTY, newThenStatement, null);</TD></TR><TR CLASS="z"><TD CLASS="l">280</TD><TD>                rewrite.set(ifStatement, IfStatement.ELSE_STATEMENT_PROPERTY, newElseStatement, null);</TD></TR><TR><TD CLASS="l">281</TD><TD>                // add correction proposal</TD></TR><TR CLASS="z"><TD CLASS="l">282</TD><TD>                String label = CorrectionMessages.AdvancedQuickAssistProcessor_inverseIf_description;</TD></TR><TR CLASS="z"><TD CLASS="l">283</TD><TD>                Image image = JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">284</TD><TD>                ASTRewriteCorrectionProposal proposal = new ASTRewriteCorrectionProposal(label, context.getCompilationUnit(),</TD></TR><TR CLASS="z"><TD CLASS="l">285</TD><TD>                                rewrite, 1, image);</TD></TR><TR CLASS="z"><TD CLASS="l">286</TD><TD>                resultingCollections.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="15">287</A></TD><TD>                return true;</TD></TR><TR><TD CLASS="l">288</TD><TD>        }</TD></TR><TR><TD CLASS="l">289</TD><TD>        private static boolean getInverseIfContinueIntoIfThenInLoopsProposals(IInvocationContext context, ASTNode covering,</TD></TR><TR><TD CLASS="l">290</TD><TD>                        Collection resultingCollections) {</TD></TR><TR CLASS="z"><TD CLASS="l">291</TD><TD>                Statement coveringStatement = ASTResolving.findParentStatement(covering);</TD></TR><TR CLASS="z"><TD CLASS="l">292</TD><TD>                if (!(coveringStatement instanceof IfStatement)) {</TD></TR><TR CLASS="z"><TD CLASS="l">293</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">294</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">295</TD><TD>                IfStatement ifStatement = (IfStatement) coveringStatement;</TD></TR><TR CLASS="z"><TD CLASS="l">296</TD><TD>                if (ifStatement.getElseStatement() != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">297</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">298</TD><TD>                }</TD></TR><TR><TD CLASS="l">299</TD><TD>                // check that 'then' is 'continue'</TD></TR><TR CLASS="z"><TD CLASS="l">300</TD><TD>                if (!(ifStatement.getThenStatement() instanceof ContinueStatement)) {</TD></TR><TR CLASS="z"><TD CLASS="l">301</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">302</TD><TD>                }</TD></TR><TR><TD CLASS="l">303</TD><TD>                // check that 'if' statement is statement in block that is body of loop</TD></TR><TR CLASS="z"><TD CLASS="l">304</TD><TD>                Block loopBlock = null;</TD></TR><TR CLASS="z"><TD CLASS="l">305</TD><TD>                if ((ifStatement.getParent() instanceof Block) &amp;&amp; (ifStatement.getParent().getParent() instanceof ForStatement)) {</TD></TR><TR CLASS="z"><TD CLASS="l">306</TD><TD>                        loopBlock = (Block) ifStatement.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">307</TD><TD>                } else if ((ifStatement.getParent() instanceof Block)</TD></TR><TR CLASS="z"><TD CLASS="l">308</TD><TD>                                &amp;&amp; (ifStatement.getParent().getParent() instanceof WhileStatement)) {</TD></TR><TR CLASS="z"><TD CLASS="l">309</TD><TD>                        loopBlock = (Block) ifStatement.getParent();</TD></TR><TR><TD CLASS="l">310</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">311</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">312</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">313</TD><TD>                if (resultingCollections == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">314</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">315</TD><TD>                }</TD></TR><TR><TD CLASS="l">316</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">317</TD><TD>                AST ast = coveringStatement.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">318</TD><TD>                ASTRewrite rewrite = ASTRewrite.create(ast);</TD></TR><TR><TD CLASS="l">319</TD><TD>                // create inverted 'if' statement</TD></TR><TR CLASS="z"><TD CLASS="l">320</TD><TD>                Expression inversedExpression = getInversedBooleanExpression(rewrite, ifStatement.getExpression());</TD></TR><TR CLASS="z"><TD CLASS="l">321</TD><TD>                IfStatement newIf = ast.newIfStatement();</TD></TR><TR CLASS="z"><TD CLASS="l">322</TD><TD>                newIf.setExpression(inversedExpression);</TD></TR><TR><TD CLASS="l">323</TD><TD>                // prepare 'then' for new 'if'</TD></TR><TR CLASS="z"><TD CLASS="l">324</TD><TD>                Block thenBlock = ast.newBlock();</TD></TR><TR CLASS="z"><TD CLASS="l">325</TD><TD>                int ifIndex = loopBlock.statements().indexOf(ifStatement);</TD></TR><TR CLASS="z"><TD CLASS="l">326</TD><TD>                for (int i = ifIndex + 1; i &lt; loopBlock.statements().size(); i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">327</TD><TD>                        Statement statement = (Statement) loopBlock.statements().get(i);</TD></TR><TR CLASS="z"><TD CLASS="l">328</TD><TD>                        thenBlock.statements().add(rewrite.createMoveTarget(statement));</TD></TR><TR><TD CLASS="l">329</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">330</TD><TD>                newIf.setThenStatement(thenBlock);</TD></TR><TR><TD CLASS="l">331</TD><TD>                // replace 'if' statement in loop</TD></TR><TR CLASS="z"><TD CLASS="l">332</TD><TD>                rewrite.replace(ifStatement, newIf, null);</TD></TR><TR><TD CLASS="l">333</TD><TD>                // add correction proposal</TD></TR><TR CLASS="z"><TD CLASS="l">334</TD><TD>                String label = CorrectionMessages.AdvancedQuickAssistProcessor_inverseIfContinue_description;</TD></TR><TR CLASS="z"><TD CLASS="l">335</TD><TD>                Image image = JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">336</TD><TD>                ASTRewriteCorrectionProposal proposal = new ASTRewriteCorrectionProposal(label, context.getCompilationUnit(),</TD></TR><TR CLASS="z"><TD CLASS="l">337</TD><TD>                                rewrite, 1, image);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="16">338</A></TD><TD>                resultingCollections.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l">339</TD><TD>                return true;</TD></TR><TR><TD CLASS="l">340</TD><TD>        }</TD></TR><TR><TD CLASS="l">341</TD><TD>        private static boolean getInverseIfIntoContinueInLoopsProposals(IInvocationContext context, ASTNode covering, Collection resultingCollections) {</TD></TR><TR CLASS="z"><TD CLASS="l">342</TD><TD>                Statement coveringStatement = ASTResolving.findParentStatement(covering);</TD></TR><TR CLASS="z"><TD CLASS="l">343</TD><TD>                if (!(coveringStatement instanceof IfStatement)) {</TD></TR><TR CLASS="z"><TD CLASS="l">344</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">345</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">346</TD><TD>                IfStatement ifStatement = (IfStatement) coveringStatement;</TD></TR><TR CLASS="z"><TD CLASS="l">347</TD><TD>                if (ifStatement.getElseStatement() != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">348</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">349</TD><TD>                }</TD></TR><TR><TD CLASS="l">350</TD><TD>                // prepare outer control structure and block that contains 'if' statement</TD></TR><TR CLASS="z"><TD CLASS="l">351</TD><TD>                ASTNode ifParent = ifStatement.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">352</TD><TD>                Block ifParentBlock = null;</TD></TR><TR CLASS="z"><TD CLASS="l">353</TD><TD>                ASTNode ifParentStructure = ifParent;</TD></TR><TR CLASS="z"><TD CLASS="l">354</TD><TD>                if (ifParentStructure instanceof Block) {</TD></TR><TR CLASS="z"><TD CLASS="l">355</TD><TD>                        ifParentBlock = (Block) ifParent;</TD></TR><TR CLASS="z"><TD CLASS="l">356</TD><TD>                        ifParentStructure = ifParentStructure.getParent();</TD></TR><TR><TD CLASS="l">357</TD><TD>                }</TD></TR><TR><TD CLASS="l">358</TD><TD>                // check that control structure is loop and 'if' statement if last statement</TD></TR><TR CLASS="z"><TD CLASS="l">359</TD><TD>                if (!(ifParentStructure instanceof ForStatement) &amp;&amp; !(ifParentStructure instanceof WhileStatement)&amp;&amp; !(ifParentStructure instanceof ForInStatement)) {</TD></TR><TR CLASS="z"><TD CLASS="l">360</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">361</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">362</TD><TD>                if ((ifParentBlock != null) &amp;&amp; (ifParentBlock.statements().indexOf(ifStatement) != ifParentBlock.statements().size() - 1)) {</TD></TR><TR CLASS="z"><TD CLASS="l">363</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">364</TD><TD>                }</TD></TR><TR><TD CLASS="l">365</TD><TD>                //  we could produce quick assist</TD></TR><TR CLASS="z"><TD CLASS="l">366</TD><TD>                if (resultingCollections == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">367</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">368</TD><TD>                }</TD></TR><TR><TD CLASS="l">369</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">370</TD><TD>                AST ast = coveringStatement.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">371</TD><TD>                ASTRewrite rewrite = ASTRewrite.create(ast);</TD></TR><TR><TD CLASS="l">372</TD><TD>                // create inverted 'if' statement</TD></TR><TR CLASS="z"><TD CLASS="l">373</TD><TD>                Expression inversedExpression = getInversedBooleanExpression(rewrite, ifStatement.getExpression());</TD></TR><TR CLASS="z"><TD CLASS="l">374</TD><TD>                IfStatement newIf = ast.newIfStatement();</TD></TR><TR CLASS="z"><TD CLASS="l">375</TD><TD>                newIf.setExpression(inversedExpression);</TD></TR><TR CLASS="z"><TD CLASS="l">376</TD><TD>                newIf.setThenStatement(ast.newContinueStatement());</TD></TR><TR><TD CLASS="l">377</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">378</TD><TD>                if (ifParentBlock == null) {</TD></TR><TR><TD CLASS="l">379</TD><TD>                        // if there is no block, create it</TD></TR><TR CLASS="z"><TD CLASS="l">380</TD><TD>                        ifParentBlock = ast.newBlock();</TD></TR><TR CLASS="z"><TD CLASS="l">381</TD><TD>                        ifParentBlock.statements().add(newIf);</TD></TR><TR CLASS="z"><TD CLASS="l">382</TD><TD>                        for (Iterator iter = getUnwrappedStatements(ifStatement.getThenStatement()).iterator(); iter.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">383</TD><TD>                                Statement statement = (Statement) iter.next();</TD></TR><TR CLASS="z"><TD CLASS="l">384</TD><TD>                                ifParentBlock.statements().add(rewrite.createMoveTarget(statement));</TD></TR><TR><TD CLASS="l">385</TD><TD>                        }</TD></TR><TR><TD CLASS="l">386</TD><TD>                        // replace 'if' statement as body with new block</TD></TR><TR CLASS="z"><TD CLASS="l">387</TD><TD>                        if (ifParentStructure instanceof ForStatement) {</TD></TR><TR CLASS="z"><TD CLASS="l">388</TD><TD>                                rewrite.set(ifParentStructure, ForStatement.BODY_PROPERTY, ifParentBlock, null);</TD></TR><TR CLASS="z"><TD CLASS="l">389</TD><TD>                        } else if (ifParentStructure instanceof WhileStatement) {</TD></TR><TR CLASS="z"><TD CLASS="l">390</TD><TD>                                rewrite.set(ifParentStructure, WhileStatement.BODY_PROPERTY, ifParentBlock, null);</TD></TR><TR><TD CLASS="l">391</TD><TD>                        }</TD></TR><TR><TD CLASS="l">392</TD><TD>                } else {</TD></TR><TR><TD CLASS="l">393</TD><TD>                        // if there was block, replace</TD></TR><TR CLASS="z"><TD CLASS="l">394</TD><TD>                        ListRewrite listRewriter = rewrite.getListRewrite(ifParentBlock,</TD></TR><TR CLASS="z"><TD CLASS="l">395</TD><TD>                                (ChildListPropertyDescriptor) ifStatement.getLocationInParent());</TD></TR><TR CLASS="z"><TD CLASS="l">396</TD><TD>                        listRewriter.replace(ifStatement, newIf, null);</TD></TR><TR><TD CLASS="l">397</TD><TD>                        // add statements from 'then' to the end of block</TD></TR><TR CLASS="z"><TD CLASS="l">398</TD><TD>                        for (Iterator iter = getUnwrappedStatements(ifStatement.getThenStatement()).iterator(); iter.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">399</TD><TD>                                Statement statement = (Statement) iter.next();</TD></TR><TR CLASS="z"><TD CLASS="l">400</TD><TD>                                listRewriter.insertLast(rewrite.createMoveTarget(statement), null);</TD></TR><TR><TD CLASS="l">401</TD><TD>                        }</TD></TR><TR><TD CLASS="l">402</TD><TD>                }</TD></TR><TR><TD CLASS="l">403</TD><TD>                // add correction proposal</TD></TR><TR CLASS="z"><TD CLASS="l">404</TD><TD>                String label = CorrectionMessages.AdvancedQuickAssistProcessor_inverseIfToContinue_description;</TD></TR><TR CLASS="z"><TD CLASS="l">405</TD><TD>                Image image = JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">406</TD><TD>                ASTRewriteCorrectionProposal proposal = new ASTRewriteCorrectionProposal(label, context.getCompilationUnit(),</TD></TR><TR CLASS="z"><TD CLASS="l">407</TD><TD>                                rewrite, 1, image);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="2d">408</A></TD><TD>                resultingCollections.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l">409</TD><TD>                return true;</TD></TR><TR><TD CLASS="l">410</TD><TD>        }</TD></TR><TR><TD CLASS="l">411</TD><TD>        private static ArrayList getUnwrappedStatements(Statement body) {</TD></TR><TR CLASS="z"><TD CLASS="l">412</TD><TD>                ArrayList statements = new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">413</TD><TD>                if (body instanceof Block) {</TD></TR><TR CLASS="z"><TD CLASS="l">414</TD><TD>                        for (Iterator iter = ((Block) body).statements().iterator(); iter.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">415</TD><TD>                                Statement statement = (Statement) iter.next();</TD></TR><TR CLASS="z"><TD CLASS="l">416</TD><TD>                                statements.add(statement);</TD></TR><TR><TD CLASS="l">417</TD><TD>                        }</TD></TR><TR><TD CLASS="l">418</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">419</TD><TD>                        statements.add(body);</TD></TR><TR><TD CLASS="l"><A NAME="13">420</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">421</TD><TD>                return statements;</TD></TR><TR><TD CLASS="l">422</TD><TD>        }</TD></TR><TR><TD CLASS="l">423</TD><TD>        private static boolean getInverseConditionProposals(IInvocationContext context, ASTNode covering, ArrayList coveredNodes, Collection resultingCollections) {</TD></TR><TR CLASS="z"><TD CLASS="l">424</TD><TD>                if (coveredNodes.isEmpty()) {</TD></TR><TR CLASS="z"><TD CLASS="l">425</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">426</TD><TD>                }</TD></TR><TR><TD CLASS="l">427</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">428</TD><TD>                final AST ast = covering.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">429</TD><TD>                final ASTRewrite rewrite = ASTRewrite.create(ast);</TD></TR><TR><TD CLASS="l">430</TD><TD>                // check sub-expressions in fully covered nodes</TD></TR><TR CLASS="z"><TD CLASS="l">431</TD><TD>                boolean hasChanges = false;</TD></TR><TR CLASS="z"><TD CLASS="l">432</TD><TD>                for (Iterator iter = coveredNodes.iterator(); iter.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">433</TD><TD>                        ASTNode covered = (ASTNode) iter.next();</TD></TR><TR CLASS="z"><TD CLASS="l">434</TD><TD>                        Expression coveredExpression= getBooleanExpression(covered);</TD></TR><TR CLASS="z"><TD CLASS="l">435</TD><TD>                        if (coveredExpression != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">436</TD><TD>                                Expression inversedExpression = getInversedBooleanExpression(rewrite, coveredExpression);</TD></TR><TR CLASS="z"><TD CLASS="l">437</TD><TD>                                rewrite.replace(coveredExpression, inversedExpression, null);</TD></TR><TR CLASS="z"><TD CLASS="l">438</TD><TD>                                hasChanges = true;</TD></TR><TR><TD CLASS="l">439</TD><TD>                        }</TD></TR><TR><TD CLASS="l">440</TD><TD>                }</TD></TR><TR><TD CLASS="l">441</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">442</TD><TD>                if (!hasChanges) {</TD></TR><TR CLASS="z"><TD CLASS="l">443</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">444</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">445</TD><TD>                if (resultingCollections == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">446</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">447</TD><TD>                }</TD></TR><TR><TD CLASS="l">448</TD><TD>                // add correction proposal</TD></TR><TR CLASS="z"><TD CLASS="l">449</TD><TD>                String label = CorrectionMessages.AdvancedQuickAssistProcessor_inverseConditions_description;</TD></TR><TR CLASS="z"><TD CLASS="l">450</TD><TD>                Image image = JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">451</TD><TD>                ASTRewriteCorrectionProposal proposal = new ASTRewriteCorrectionProposal(label, context.getCompilationUnit(),</TD></TR><TR CLASS="z"><TD CLASS="l">452</TD><TD>                                rewrite, 1, image);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1a">453</A></TD><TD>                resultingCollections.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l">454</TD><TD>                return true;</TD></TR><TR><TD CLASS="l">455</TD><TD>        }</TD></TR><TR><TD CLASS="l">456</TD><TD>        private static Expression getInversedBooleanExpression(ASTRewrite rewrite, Expression expression) {</TD></TR><TR CLASS="z"><TD CLASS="l">457</TD><TD>                return getInversedBooleanExpression(rewrite, expression, null);</TD></TR><TR><TD CLASS="l">458</TD><TD>        }</TD></TR><TR><TD CLASS="l">459</TD><TD>        private interface SimpleNameRenameProvider {</TD></TR><TR><TD CLASS="l">460</TD><TD>                SimpleName getRenamed(SimpleName name);</TD></TR><TR><TD CLASS="l"><A NAME="27">461</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">462</TD><TD>        private static Expression getRenamedNameCopy(SimpleNameRenameProvider provider,</TD></TR><TR><TD CLASS="l">463</TD><TD>                        ASTRewrite rewrite,</TD></TR><TR><TD CLASS="l">464</TD><TD>                        Expression expression) {</TD></TR><TR CLASS="z"><TD CLASS="l">465</TD><TD>                if (provider != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">466</TD><TD>                        if (expression instanceof SimpleName) {</TD></TR><TR CLASS="z"><TD CLASS="l">467</TD><TD>                                SimpleName name= (SimpleName) expression;</TD></TR><TR CLASS="z"><TD CLASS="l">468</TD><TD>                                SimpleName newName= provider.getRenamed(name);</TD></TR><TR CLASS="z"><TD CLASS="l">469</TD><TD>                                if (newName != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">470</TD><TD>                                        return newName;</TD></TR><TR><TD CLASS="l">471</TD><TD>                                }</TD></TR><TR><TD CLASS="l">472</TD><TD>                        }</TD></TR><TR><TD CLASS="l"><A NAME="1b">473</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">474</TD><TD>                return (Expression) rewrite.createCopyTarget(expression);</TD></TR><TR><TD CLASS="l">475</TD><TD>        }</TD></TR><TR><TD CLASS="l">476</TD><TD>        private static Expression getInversedBooleanExpression(ASTRewrite rewrite, Expression expression, SimpleNameRenameProvider provider) {</TD></TR><TR CLASS="z"><TD CLASS="l">477</TD><TD>                if (!isBoolean(expression)) {</TD></TR><TR CLASS="z"><TD CLASS="l">478</TD><TD>                        return (Expression) rewrite.createCopyTarget(expression);</TD></TR><TR><TD CLASS="l">479</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">480</TD><TD>                AST ast= rewrite.getAST();</TD></TR><TR><TD CLASS="l">481</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">482</TD><TD>                if (expression instanceof BooleanLiteral) {</TD></TR><TR CLASS="z"><TD CLASS="l">483</TD><TD>                        return ast.newBooleanLiteral(!((BooleanLiteral) expression).booleanValue());</TD></TR><TR><TD CLASS="l">484</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">485</TD><TD>                if (expression instanceof InfixExpression) {</TD></TR><TR CLASS="z"><TD CLASS="l">486</TD><TD>                        InfixExpression infixExpression= (InfixExpression) expression;</TD></TR><TR CLASS="z"><TD CLASS="l">487</TD><TD>                        InfixExpression.Operator operator= infixExpression.getOperator();</TD></TR><TR CLASS="z"><TD CLASS="l">488</TD><TD>                        if (operator == InfixExpression.Operator.LESS) {</TD></TR><TR CLASS="z"><TD CLASS="l">489</TD><TD>                                return getInversedInfixBooleanExpression(rewrite, infixExpression, InfixExpression.Operator.GREATER_EQUALS, provider);</TD></TR><TR><TD CLASS="l">490</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">491</TD><TD>                        if (operator == InfixExpression.Operator.GREATER) {</TD></TR><TR CLASS="z"><TD CLASS="l">492</TD><TD>                                return getInversedInfixBooleanExpression(rewrite, infixExpression, InfixExpression.Operator.LESS_EQUALS, provider);</TD></TR><TR><TD CLASS="l">493</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">494</TD><TD>                        if (operator == InfixExpression.Operator.LESS_EQUALS) {</TD></TR><TR CLASS="z"><TD CLASS="l">495</TD><TD>                                return getInversedInfixBooleanExpression(rewrite, infixExpression, InfixExpression.Operator.GREATER, provider);</TD></TR><TR><TD CLASS="l">496</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">497</TD><TD>                        if (operator == InfixExpression.Operator.GREATER_EQUALS) {</TD></TR><TR CLASS="z"><TD CLASS="l">498</TD><TD>                                return getInversedInfixBooleanExpression(rewrite, infixExpression, InfixExpression.Operator.LESS, provider);</TD></TR><TR><TD CLASS="l">499</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">500</TD><TD>                        if (operator == InfixExpression.Operator.EQUALS) {</TD></TR><TR CLASS="z"><TD CLASS="l">501</TD><TD>                                return getInversedInfixBooleanExpression(rewrite, infixExpression, InfixExpression.Operator.NOT_EQUALS, provider);</TD></TR><TR><TD CLASS="l">502</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">503</TD><TD>                        if (operator == InfixExpression.Operator.NOT_EQUALS) {</TD></TR><TR CLASS="z"><TD CLASS="l">504</TD><TD>                                return getInversedInfixBooleanExpression(rewrite, infixExpression, InfixExpression.Operator.EQUALS, provider);</TD></TR><TR><TD CLASS="l">505</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">506</TD><TD>                        if (operator == InfixExpression.Operator.CONDITIONAL_AND) {</TD></TR><TR CLASS="z"><TD CLASS="l">507</TD><TD>                                return getInversedAndOrExpression(rewrite, infixExpression, InfixExpression.Operator.CONDITIONAL_OR, provider);</TD></TR><TR><TD CLASS="l">508</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">509</TD><TD>                        if (operator == InfixExpression.Operator.CONDITIONAL_OR) {</TD></TR><TR CLASS="z"><TD CLASS="l">510</TD><TD>                                return getInversedAndOrExpression(rewrite, infixExpression, InfixExpression.Operator.CONDITIONAL_AND, provider);</TD></TR><TR><TD CLASS="l">511</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">512</TD><TD>                        if (operator == InfixExpression.Operator.AND) {</TD></TR><TR CLASS="z"><TD CLASS="l">513</TD><TD>                                return getInversedAndOrExpression(rewrite, infixExpression, InfixExpression.Operator.OR, provider);</TD></TR><TR><TD CLASS="l">514</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">515</TD><TD>                        if (operator == InfixExpression.Operator.OR) {</TD></TR><TR CLASS="z"><TD CLASS="l">516</TD><TD>                                return getInversedAndOrExpression(rewrite, infixExpression, InfixExpression.Operator.AND, provider);</TD></TR><TR><TD CLASS="l">517</TD><TD>                        }</TD></TR><TR><TD CLASS="l">518</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">519</TD><TD>                if (expression instanceof PrefixExpression) {</TD></TR><TR CLASS="z"><TD CLASS="l">520</TD><TD>                        PrefixExpression prefixExpression= (PrefixExpression) expression;</TD></TR><TR CLASS="z"><TD CLASS="l">521</TD><TD>                        if (prefixExpression.getOperator() == PrefixExpression.Operator.NOT) {</TD></TR><TR CLASS="z"><TD CLASS="l">522</TD><TD>                                return getRenamedNameCopy(provider, rewrite, prefixExpression.getOperand());</TD></TR><TR><TD CLASS="l">523</TD><TD>                        }</TD></TR><TR><TD CLASS="l">524</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">525</TD><TD>                if (expression instanceof InstanceofExpression) {</TD></TR><TR CLASS="z"><TD CLASS="l">526</TD><TD>                        PrefixExpression prefixExpression= ast.newPrefixExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">527</TD><TD>                        prefixExpression.setOperator(PrefixExpression.Operator.NOT);</TD></TR><TR CLASS="z"><TD CLASS="l">528</TD><TD>                        ParenthesizedExpression parenthesizedExpression= ast.newParenthesizedExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">529</TD><TD>                        parenthesizedExpression.setExpression((Expression) rewrite.createCopyTarget(expression));</TD></TR><TR CLASS="z"><TD CLASS="l">530</TD><TD>                        prefixExpression.setOperand(parenthesizedExpression);</TD></TR><TR CLASS="z"><TD CLASS="l">531</TD><TD>                        return prefixExpression;</TD></TR><TR><TD CLASS="l">532</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">533</TD><TD>                if (expression instanceof ParenthesizedExpression) {</TD></TR><TR CLASS="z"><TD CLASS="l">534</TD><TD>                        ParenthesizedExpression parenthesizedExpression= (ParenthesizedExpression) expression;</TD></TR><TR CLASS="z"><TD CLASS="l">535</TD><TD>                        Expression innerExpression= parenthesizedExpression.getExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">536</TD><TD>                        while (innerExpression instanceof ParenthesizedExpression) {</TD></TR><TR CLASS="z"><TD CLASS="l">537</TD><TD>                                innerExpression= ((ParenthesizedExpression) innerExpression).getExpression();</TD></TR><TR><TD CLASS="l">538</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">539</TD><TD>                        if (innerExpression instanceof InstanceofExpression) {</TD></TR><TR CLASS="z"><TD CLASS="l">540</TD><TD>                                return getInversedBooleanExpression(rewrite, innerExpression, provider);</TD></TR><TR><TD CLASS="l">541</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">542</TD><TD>                        parenthesizedExpression= ast.newParenthesizedExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">543</TD><TD>                        parenthesizedExpression.setExpression(getInversedBooleanExpression(rewrite, innerExpression, provider));</TD></TR><TR CLASS="z"><TD CLASS="l">544</TD><TD>                        return parenthesizedExpression;</TD></TR><TR><TD CLASS="l">545</TD><TD>                }</TD></TR><TR><TD CLASS="l">546</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">547</TD><TD>                PrefixExpression prefixExpression= ast.newPrefixExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">548</TD><TD>                prefixExpression.setOperator(PrefixExpression.Operator.NOT);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="30">549</A></TD><TD>                prefixExpression.setOperand(getRenamedNameCopy(provider, rewrite, expression));</TD></TR><TR CLASS="z"><TD CLASS="l">550</TD><TD>                return prefixExpression;</TD></TR><TR><TD CLASS="l">551</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="1c">552</A></TD><TD>        private static boolean isBoolean(Expression expression) {</TD></TR><TR CLASS="z"><TD CLASS="l">553</TD><TD>                return expression.resolveTypeBinding() == expression.getAST().resolveWellKnownType(&#34;boolean&#34;); //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">554</TD><TD>        }</TD></TR><TR><TD CLASS="l">555</TD><TD>        private static Expression getInversedInfixBooleanExpression(ASTRewrite rewrite, InfixExpression expression, InfixExpression.Operator newOperator, SimpleNameRenameProvider provider) {</TD></TR><TR CLASS="z"><TD CLASS="l">556</TD><TD>                InfixExpression newExpression = rewrite.getAST().newInfixExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">557</TD><TD>                newExpression.setOperator(newOperator);</TD></TR><TR CLASS="z"><TD CLASS="l">558</TD><TD>                newExpression.setLeftOperand(getInversedBooleanExpression(rewrite, expression.getLeftOperand(), provider));</TD></TR><TR CLASS="z"><TD CLASS="l">559</TD><TD>                newExpression.setRightOperand(getInversedBooleanExpression(rewrite, expression.getRightOperand(), provider));</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="35">560</A></TD><TD>                return newExpression;</TD></TR><TR><TD CLASS="l">561</TD><TD>        }</TD></TR><TR><TD CLASS="l">562</TD><TD>        </TD></TR><TR><TD CLASS="l">563</TD><TD>        private static Expression parenthesizeIfRequired(Expression operand, int newOperatorPrecedence) {</TD></TR><TR CLASS="z"><TD CLASS="l">564</TD><TD>                if (newOperatorPrecedence &lt; getExpressionPrecedence(operand)) {</TD></TR><TR CLASS="z"><TD CLASS="l">565</TD><TD>                        return getParenthesizedExpression(operand.getAST(), operand);</TD></TR><TR><TD CLASS="l">566</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="19">567</A></TD><TD>                return operand;</TD></TR><TR><TD CLASS="l">568</TD><TD>        }</TD></TR><TR><TD CLASS="l">569</TD><TD>        </TD></TR><TR><TD CLASS="l">570</TD><TD>        private static Expression getInversedAndOrExpression(ASTRewrite rewrite, InfixExpression infixExpression, Operator newOperator, SimpleNameRenameProvider provider) {</TD></TR><TR CLASS="z"><TD CLASS="l">571</TD><TD>                InfixExpression newExpression = rewrite.getAST().newInfixExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">572</TD><TD>                newExpression.setOperator(newOperator);</TD></TR><TR><TD CLASS="l">573</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">574</TD><TD>                int newOperatorPrecedence = getInfixOperatorPrecedence(newOperator);</TD></TR><TR><TD CLASS="l">575</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">576</TD><TD>                Expression leftOperand = getInversedBooleanExpression(rewrite, infixExpression.getLeftOperand(), provider);</TD></TR><TR CLASS="z"><TD CLASS="l">577</TD><TD>                newExpression.setLeftOperand(parenthesizeIfRequired(leftOperand, newOperatorPrecedence));</TD></TR><TR><TD CLASS="l">578</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">579</TD><TD>                Expression rightOperand = getInversedBooleanExpression(rewrite, infixExpression.getRightOperand(), provider);</TD></TR><TR CLASS="z"><TD CLASS="l">580</TD><TD>                newExpression.setRightOperand(parenthesizeIfRequired(rightOperand, newOperatorPrecedence));</TD></TR><TR><TD CLASS="l">581</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">582</TD><TD>                List extraOperands= infixExpression.extendedOperands();</TD></TR><TR CLASS="z"><TD CLASS="l">583</TD><TD>                List newExtraOperands= newExpression.extendedOperands();</TD></TR><TR CLASS="z"><TD CLASS="l">584</TD><TD>                for (int i= 0; i &lt; extraOperands.size(); i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">585</TD><TD>                        Expression extraOperand = getInversedBooleanExpression(rewrite, (Expression) extraOperands.get(i), provider);</TD></TR><TR CLASS="z"><TD CLASS="l">586</TD><TD>                        newExtraOperands.add(parenthesizeIfRequired(extraOperand, newOperatorPrecedence));</TD></TR><TR><TD CLASS="l">587</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">588</TD><TD>                return newExpression;</TD></TR><TR><TD CLASS="l"><A NAME="26">589</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">590</TD><TD>        private static boolean getRemoveExtraParenthesisProposals(IInvocationContext context, ASTNode covering, ArrayList coveredNodes,</TD></TR><TR><TD CLASS="l">591</TD><TD>                        Collection resultingCollections) {</TD></TR><TR><TD CLASS="l">592</TD><TD>                ArrayList nodes;</TD></TR><TR CLASS="z"><TD CLASS="l">593</TD><TD>                if ((context.getSelectionLength() == 0) &amp;&amp; (covering instanceof ParenthesizedExpression)) {</TD></TR><TR CLASS="z"><TD CLASS="l">594</TD><TD>                        nodes = new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">595</TD><TD>                        nodes.add(covering);</TD></TR><TR><TD CLASS="l">596</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">597</TD><TD>                        nodes= coveredNodes;</TD></TR><TR><TD CLASS="l">598</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">599</TD><TD>                if (nodes.isEmpty())</TD></TR><TR CLASS="z"><TD CLASS="l">600</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">601</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">602</TD><TD>                IFix fix= ExpressionsFix.createRemoveUnnecessaryParenthesisFix(context.getASTRoot(), (ASTNode[])nodes.toArray(new ASTNode[nodes.size()]));</TD></TR><TR CLASS="z"><TD CLASS="l">603</TD><TD>                if (fix == null)</TD></TR><TR CLASS="z"><TD CLASS="l">604</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">605</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">606</TD><TD>                if (resultingCollections == null)</TD></TR><TR CLASS="z"><TD CLASS="l">607</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">608</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">609</TD><TD>                Image image= JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_REMOVE);</TD></TR><TR CLASS="z"><TD CLASS="l">610</TD><TD>                Map options= new Hashtable();</TD></TR><TR CLASS="z"><TD CLASS="l">611</TD><TD>                options.put(CleanUpConstants.EXPRESSIONS_USE_PARENTHESES, CleanUpConstants.TRUE);</TD></TR><TR CLASS="z"><TD CLASS="l">612</TD><TD>                options.put(CleanUpConstants.EXPRESSIONS_USE_PARENTHESES_NEVER, CleanUpConstants.TRUE);</TD></TR><TR CLASS="z"><TD CLASS="l">613</TD><TD>                FixCorrectionProposal proposal= new FixCorrectionProposal(fix, new ExpressionsCleanUp(options), 1, image, context);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="f">614</A></TD><TD>                resultingCollections.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l">615</TD><TD>                return true;</TD></TR><TR><TD CLASS="l">616</TD><TD>        }</TD></TR><TR><TD CLASS="l">617</TD><TD>        private static int getExpressionPrecedence(Expression expression) {</TD></TR><TR CLASS="z"><TD CLASS="l">618</TD><TD>                if (expression instanceof PostfixExpression) {</TD></TR><TR CLASS="z"><TD CLASS="l">619</TD><TD>                        return 0;</TD></TR><TR><TD CLASS="l">620</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">621</TD><TD>                if (expression instanceof PrefixExpression) {</TD></TR><TR CLASS="z"><TD CLASS="l">622</TD><TD>                        return 1;</TD></TR><TR><TD CLASS="l">623</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">624</TD><TD>                if ((expression instanceof ClassInstanceCreation) || (expression instanceof CastExpression)) {</TD></TR><TR CLASS="z"><TD CLASS="l">625</TD><TD>                        return 2;</TD></TR><TR><TD CLASS="l">626</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">627</TD><TD>                if (expression instanceof InfixExpression) {</TD></TR><TR CLASS="z"><TD CLASS="l">628</TD><TD>                        InfixExpression infixExpression = (InfixExpression) expression;</TD></TR><TR CLASS="z"><TD CLASS="l">629</TD><TD>                        InfixExpression.Operator operator = infixExpression.getOperator();</TD></TR><TR CLASS="z"><TD CLASS="l">630</TD><TD>                        return getInfixOperatorPrecedence(operator);</TD></TR><TR><TD CLASS="l">631</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">632</TD><TD>                if (expression instanceof InstanceofExpression) {</TD></TR><TR CLASS="z"><TD CLASS="l">633</TD><TD>                        return 6;</TD></TR><TR><TD CLASS="l">634</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">635</TD><TD>                if (expression instanceof ConditionalExpression) {</TD></TR><TR CLASS="z"><TD CLASS="l">636</TD><TD>                        return 13;</TD></TR><TR><TD CLASS="l">637</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">638</TD><TD>                if (expression instanceof Assignment) {</TD></TR><TR CLASS="z"><TD CLASS="l">639</TD><TD>                        return 14;</TD></TR><TR><TD CLASS="l">640</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">641</TD><TD>                if (expression instanceof FunctionInvocation) {</TD></TR><TR CLASS="z"><TD CLASS="l">642</TD><TD>                        return 2;</TD></TR><TR><TD CLASS="l"><A NAME="12">643</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">644</TD><TD>                return -1;</TD></TR><TR><TD CLASS="l">645</TD><TD>        }</TD></TR><TR><TD CLASS="l">646</TD><TD>        private static int getInfixOperatorPrecedence(InfixExpression.Operator operator) {</TD></TR><TR CLASS="z"><TD CLASS="l">647</TD><TD>                if ((operator == InfixExpression.Operator.TIMES) || (operator == InfixExpression.Operator.DIVIDE)</TD></TR><TR CLASS="z"><TD CLASS="l">648</TD><TD>                                || (operator == InfixExpression.Operator.REMAINDER)) {</TD></TR><TR CLASS="z"><TD CLASS="l">649</TD><TD>                        return 3;</TD></TR><TR><TD CLASS="l">650</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">651</TD><TD>                if ((operator == InfixExpression.Operator.PLUS) || (operator == InfixExpression.Operator.MINUS)) {</TD></TR><TR CLASS="z"><TD CLASS="l">652</TD><TD>                        return 4;</TD></TR><TR><TD CLASS="l">653</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">654</TD><TD>                if ((operator == InfixExpression.Operator.LEFT_SHIFT)</TD></TR><TR CLASS="z"><TD CLASS="l">655</TD><TD>                                || (operator == InfixExpression.Operator.RIGHT_SHIFT_SIGNED)</TD></TR><TR CLASS="z"><TD CLASS="l">656</TD><TD>                                || (operator == InfixExpression.Operator.RIGHT_SHIFT_UNSIGNED)) {</TD></TR><TR CLASS="z"><TD CLASS="l">657</TD><TD>                        return 5;</TD></TR><TR><TD CLASS="l">658</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">659</TD><TD>                if ((operator == InfixExpression.Operator.LESS) || (operator == InfixExpression.Operator.GREATER)</TD></TR><TR CLASS="z"><TD CLASS="l">660</TD><TD>                                || (operator == InfixExpression.Operator.LESS_EQUALS)</TD></TR><TR CLASS="z"><TD CLASS="l">661</TD><TD>                                || (operator == InfixExpression.Operator.GREATER_EQUALS)) {</TD></TR><TR CLASS="z"><TD CLASS="l">662</TD><TD>                        return 6;</TD></TR><TR><TD CLASS="l">663</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">664</TD><TD>                if ((operator == InfixExpression.Operator.EQUALS) || (operator == InfixExpression.Operator.NOT_EQUALS) </TD></TR><TR CLASS="z"><TD CLASS="l">665</TD><TD>                        ||(operator == InfixExpression.Operator.EQUAL_EQUAL_EQUAL) || (operator == InfixExpression.Operator.NOT_EQUAL_EQUAL)</TD></TR><TR CLASS="z"><TD CLASS="l">666</TD><TD>                        ||(operator == InfixExpression.Operator.INSTANCEOF)) {                        return 7;</TD></TR><TR><TD CLASS="l">667</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">668</TD><TD>                if (operator == InfixExpression.Operator.AND) {</TD></TR><TR CLASS="z"><TD CLASS="l">669</TD><TD>                        return 8;</TD></TR><TR><TD CLASS="l">670</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">671</TD><TD>                if (operator == InfixExpression.Operator.XOR) {</TD></TR><TR CLASS="z"><TD CLASS="l">672</TD><TD>                        return 9;</TD></TR><TR><TD CLASS="l">673</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">674</TD><TD>                if (operator == InfixExpression.Operator.OR) {</TD></TR><TR CLASS="z"><TD CLASS="l">675</TD><TD>                        return 10;</TD></TR><TR><TD CLASS="l">676</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">677</TD><TD>                if (operator == InfixExpression.Operator.CONDITIONAL_AND) {</TD></TR><TR CLASS="z"><TD CLASS="l">678</TD><TD>                        return 11;</TD></TR><TR><TD CLASS="l">679</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">680</TD><TD>                if (operator == InfixExpression.Operator.CONDITIONAL_OR) {</TD></TR><TR CLASS="z"><TD CLASS="l">681</TD><TD>                        return 12;</TD></TR><TR><TD CLASS="l">682</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">683</TD><TD>                return -1;</TD></TR><TR><TD CLASS="l">684</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="8">685</A></TD><TD>        </TD></TR><TR><TD CLASS="l">686</TD><TD>        private static boolean getAddParanoidalParenthesisProposals(IInvocationContext context, ASTNode covering, ArrayList coveredNodes,</TD></TR><TR><TD CLASS="l">687</TD><TD>                        Collection resultingCollections) throws CoreException {</TD></TR><TR><TD CLASS="l">688</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">689</TD><TD>                IFix fix= ExpressionsFix.createAddParanoidalParenthesisFix(context.getASTRoot(), (ASTNode[])coveredNodes.toArray(new ASTNode[coveredNodes.size()]));</TD></TR><TR CLASS="z"><TD CLASS="l">690</TD><TD>                if (fix == null)</TD></TR><TR CLASS="z"><TD CLASS="l">691</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">692</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">693</TD><TD>                if (resultingCollections == null)</TD></TR><TR CLASS="z"><TD CLASS="l">694</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">695</TD><TD> </TD></TR><TR><TD CLASS="l">696</TD><TD>                // add correction proposal</TD></TR><TR CLASS="z"><TD CLASS="l">697</TD><TD>                Image image = JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">698</TD><TD>                Map options= new Hashtable();</TD></TR><TR CLASS="z"><TD CLASS="l">699</TD><TD>                options.put(CleanUpConstants.EXPRESSIONS_USE_PARENTHESES, CleanUpConstants.TRUE);</TD></TR><TR CLASS="z"><TD CLASS="l">700</TD><TD>                options.put(CleanUpConstants.EXPRESSIONS_USE_PARENTHESES_ALWAYS, CleanUpConstants.TRUE);</TD></TR><TR CLASS="z"><TD CLASS="l">701</TD><TD>                FixCorrectionProposal proposal= new FixCorrectionProposal(fix, new ExpressionsCleanUp(options), 1, image, context);</TD></TR><TR CLASS="z"><TD CLASS="l">702</TD><TD>                resultingCollections.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="10">703</A></TD><TD>                return true;</TD></TR><TR><TD CLASS="l">704</TD><TD>        }</TD></TR><TR><TD CLASS="l">705</TD><TD>        </TD></TR><TR><TD CLASS="l"><A NAME="37">706</A></TD><TD>        private static ArrayList getFullyCoveredNodes(IInvocationContext context, ASTNode coveringNode) {</TD></TR><TR CLASS="z"><TD CLASS="l">707</TD><TD>                final ArrayList coveredNodes = new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="3a">708</A></TD><TD>                final int selectionBegin = context.getSelectionOffset();</TD></TR><TR CLASS="z"><TD CLASS="l">709</TD><TD>                final int selectionEnd = selectionBegin + context.getSelectionLength();</TD></TR><TR CLASS="z"><TD CLASS="l">710</TD><TD>                coveringNode.accept(new GenericVisitor() {</TD></TR><TR><TD CLASS="l">711</TD><TD>                        protected boolean visitNode(ASTNode node) {</TD></TR><TR CLASS="z"><TD CLASS="l">712</TD><TD>                                int nodeStart= node.getStartPosition();</TD></TR><TR CLASS="z"><TD CLASS="l">713</TD><TD>                                int nodeEnd= nodeStart + node.getLength();</TD></TR><TR><TD CLASS="l">714</TD><TD>                                // if node does not intersects with selection, don't visit children</TD></TR><TR CLASS="z"><TD CLASS="l">715</TD><TD>                                if (nodeEnd &lt; selectionBegin || selectionEnd &lt; nodeStart) {</TD></TR><TR CLASS="z"><TD CLASS="l">716</TD><TD>                                        return false;</TD></TR><TR><TD CLASS="l">717</TD><TD>                                }</TD></TR><TR><TD CLASS="l">718</TD><TD>                                // if node is fully covered, we don't need to visit children</TD></TR><TR CLASS="z"><TD CLASS="l">719</TD><TD>                                if (isCovered(node)) {</TD></TR><TR CLASS="z"><TD CLASS="l">720</TD><TD>                                        ASTNode parent = node.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">721</TD><TD>                                        if ((parent == null) || !isCovered(parent)) {</TD></TR><TR CLASS="z"><TD CLASS="l">722</TD><TD>                                                coveredNodes.add(node);</TD></TR><TR CLASS="z"><TD CLASS="l">723</TD><TD>                                                return false;</TD></TR><TR><TD CLASS="l">724</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">725</TD><TD>                                }</TD></TR><TR><TD CLASS="l"><A NAME="39">726</A></TD><TD>                                // if node only partly intersects with selection, we try to find fully covered children</TD></TR><TR CLASS="z"><TD CLASS="l">727</TD><TD>                                return true;</TD></TR><TR><TD CLASS="l">728</TD><TD>                        }</TD></TR><TR><TD CLASS="l">729</TD><TD>                        private boolean isCovered(ASTNode node) {</TD></TR><TR CLASS="z"><TD CLASS="l">730</TD><TD>                                int begin = node.getStartPosition();</TD></TR><TR CLASS="z"><TD CLASS="l">731</TD><TD>                                int end = begin + node.getLength();</TD></TR><TR CLASS="z"><TD CLASS="l">732</TD><TD>                                return (begin &gt;= selectionBegin) &amp;&amp; (end &lt;= selectionEnd);</TD></TR><TR><TD CLASS="l">733</TD><TD>                        }</TD></TR><TR><TD CLASS="l">734</TD><TD>                });</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1d">735</A></TD><TD>                return coveredNodes;</TD></TR><TR><TD CLASS="l">736</TD><TD>        }</TD></TR><TR><TD CLASS="l">737</TD><TD>        private static boolean getJoinAndIfStatementsProposals(IInvocationContext context, ASTNode node,</TD></TR><TR><TD CLASS="l">738</TD><TD>                        Collection resultingCollections) {</TD></TR><TR CLASS="z"><TD CLASS="l">739</TD><TD>                Operator andOperator = InfixExpression.Operator.CONDITIONAL_AND;</TD></TR><TR CLASS="z"><TD CLASS="l">740</TD><TD>                boolean result = false;</TD></TR><TR><TD CLASS="l">741</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">742</TD><TD>                Statement statement = ASTResolving.findParentStatement(node);</TD></TR><TR CLASS="z"><TD CLASS="l">743</TD><TD>                if (!(statement instanceof IfStatement)) {</TD></TR><TR CLASS="z"><TD CLASS="l">744</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">745</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">746</TD><TD>                IfStatement ifStatement = (IfStatement) statement;</TD></TR><TR CLASS="z"><TD CLASS="l">747</TD><TD>                if (ifStatement.getElseStatement() != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">748</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">749</TD><TD>                }</TD></TR><TR><TD CLASS="l">750</TD><TD>                // case when current IfStatement is sole child of another IfStatement</TD></TR><TR><TD CLASS="l">751</TD><TD>                {</TD></TR><TR CLASS="z"><TD CLASS="l">752</TD><TD>                        IfStatement outerIf = null;</TD></TR><TR CLASS="z"><TD CLASS="l">753</TD><TD>                        if (ifStatement.getParent() instanceof IfStatement) {</TD></TR><TR CLASS="z"><TD CLASS="l">754</TD><TD>                                outerIf = (IfStatement) ifStatement.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">755</TD><TD>                        } else if (ifStatement.getParent() instanceof Block) {</TD></TR><TR CLASS="z"><TD CLASS="l">756</TD><TD>                                Block block = (Block) ifStatement.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">757</TD><TD>                                if ((block.getParent() instanceof IfStatement) &amp;&amp; (block.statements().size() == 1)) {</TD></TR><TR CLASS="z"><TD CLASS="l">758</TD><TD>                                        outerIf = (IfStatement) block.getParent();</TD></TR><TR><TD CLASS="l">759</TD><TD>                                }</TD></TR><TR><TD CLASS="l">760</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">761</TD><TD>                        if ((outerIf != null) &amp;&amp; (outerIf.getElseStatement() == null)) {</TD></TR><TR CLASS="z"><TD CLASS="l">762</TD><TD>                                if (resultingCollections == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">763</TD><TD>                                        return true;</TD></TR><TR><TD CLASS="l">764</TD><TD>                                }</TD></TR><TR><TD CLASS="l">765</TD><TD>                                //</TD></TR><TR CLASS="z"><TD CLASS="l">766</TD><TD>                                AST ast = statement.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">767</TD><TD>                                ASTRewrite rewrite = ASTRewrite.create(ast);</TD></TR><TR><TD CLASS="l">768</TD><TD>                                // prepare condition parts, add parenthesis if needed</TD></TR><TR CLASS="z"><TD CLASS="l">769</TD><TD>                                Expression outerCondition = getParenthesizedForAndIfNeeded(ast, rewrite, outerIf.getExpression());</TD></TR><TR CLASS="z"><TD CLASS="l">770</TD><TD>                                Expression innerCondition = getParenthesizedForAndIfNeeded(ast, rewrite, ifStatement.getExpression());</TD></TR><TR><TD CLASS="l">771</TD><TD>                                // create compound condition</TD></TR><TR CLASS="z"><TD CLASS="l">772</TD><TD>                                InfixExpression condition = ast.newInfixExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">773</TD><TD>                                condition.setOperator(andOperator);</TD></TR><TR CLASS="z"><TD CLASS="l">774</TD><TD>                                condition.setLeftOperand(outerCondition);</TD></TR><TR CLASS="z"><TD CLASS="l">775</TD><TD>                                condition.setRightOperand(innerCondition);</TD></TR><TR><TD CLASS="l">776</TD><TD>                                // create new IfStatement</TD></TR><TR CLASS="z"><TD CLASS="l">777</TD><TD>                                IfStatement newIf = ast.newIfStatement();</TD></TR><TR CLASS="z"><TD CLASS="l">778</TD><TD>                                newIf.setExpression(condition);</TD></TR><TR CLASS="z"><TD CLASS="l">779</TD><TD>                                Statement bodyPlaceholder = (Statement) rewrite.createCopyTarget(ifStatement.getThenStatement());</TD></TR><TR CLASS="z"><TD CLASS="l">780</TD><TD>                                newIf.setThenStatement(bodyPlaceholder);</TD></TR><TR CLASS="z"><TD CLASS="l">781</TD><TD>                                rewrite.replace(outerIf, newIf, null);</TD></TR><TR><TD CLASS="l">782</TD><TD>                                // add correction proposal</TD></TR><TR CLASS="z"><TD CLASS="l">783</TD><TD>                                String label = CorrectionMessages.AdvancedQuickAssistProcessor_joinWithOuter_description;</TD></TR><TR CLASS="z"><TD CLASS="l">784</TD><TD>                                Image image = JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">785</TD><TD>                                ASTRewriteCorrectionProposal proposal = new ASTRewriteCorrectionProposal(label,</TD></TR><TR CLASS="z"><TD CLASS="l">786</TD><TD>                                                context.getCompilationUnit(), rewrite, 1, image);</TD></TR><TR CLASS="z"><TD CLASS="l">787</TD><TD>                                resultingCollections.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l">788</TD><TD>                                result = true;</TD></TR><TR><TD CLASS="l">789</TD><TD>                        }</TD></TR><TR><TD CLASS="l">790</TD><TD>                }</TD></TR><TR><TD CLASS="l">791</TD><TD>                // case when current IfStatement has another IfStatement as sole child</TD></TR><TR><TD CLASS="l">792</TD><TD>                {</TD></TR><TR CLASS="z"><TD CLASS="l">793</TD><TD>                        IfStatement innerIf = null;</TD></TR><TR CLASS="z"><TD CLASS="l">794</TD><TD>                        if (ifStatement.getThenStatement() instanceof IfStatement) {</TD></TR><TR CLASS="z"><TD CLASS="l">795</TD><TD>                                innerIf = (IfStatement) ifStatement.getThenStatement();</TD></TR><TR CLASS="z"><TD CLASS="l">796</TD><TD>                        } else if (ifStatement.getThenStatement() instanceof Block) {</TD></TR><TR CLASS="z"><TD CLASS="l">797</TD><TD>                                Block block = (Block) ifStatement.getThenStatement();</TD></TR><TR CLASS="z"><TD CLASS="l">798</TD><TD>                                if ((block.statements().size() == 1) &amp;&amp; (block.statements().get(0) instanceof IfStatement)) {</TD></TR><TR CLASS="z"><TD CLASS="l">799</TD><TD>                                        innerIf = (IfStatement) block.statements().get(0);</TD></TR><TR><TD CLASS="l">800</TD><TD>                                }</TD></TR><TR><TD CLASS="l">801</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">802</TD><TD>                        if ((innerIf != null) &amp;&amp; (innerIf.getElseStatement() == null)) {</TD></TR><TR CLASS="z"><TD CLASS="l">803</TD><TD>                                if (resultingCollections == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">804</TD><TD>                                        return true;</TD></TR><TR><TD CLASS="l">805</TD><TD>                                }</TD></TR><TR><TD CLASS="l">806</TD><TD>                                //</TD></TR><TR CLASS="z"><TD CLASS="l">807</TD><TD>                                AST ast = statement.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">808</TD><TD>                                ASTRewrite rewrite = ASTRewrite.create(ast);</TD></TR><TR><TD CLASS="l">809</TD><TD>                                // prepare condition parts, add parenthesis if needed</TD></TR><TR CLASS="z"><TD CLASS="l">810</TD><TD>                                Expression outerCondition = getParenthesizedForAndIfNeeded(ast, rewrite, ifStatement.getExpression());</TD></TR><TR CLASS="z"><TD CLASS="l">811</TD><TD>                                Expression innerCondition = getParenthesizedForAndIfNeeded(ast, rewrite, innerIf.getExpression());</TD></TR><TR><TD CLASS="l">812</TD><TD>                                // create compound condition</TD></TR><TR CLASS="z"><TD CLASS="l">813</TD><TD>                                InfixExpression condition = ast.newInfixExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">814</TD><TD>                                condition.setOperator(andOperator);</TD></TR><TR CLASS="z"><TD CLASS="l">815</TD><TD>                                condition.setLeftOperand(outerCondition);</TD></TR><TR CLASS="z"><TD CLASS="l">816</TD><TD>                                condition.setRightOperand(innerCondition);</TD></TR><TR><TD CLASS="l">817</TD><TD>                                // create new IfStatement</TD></TR><TR CLASS="z"><TD CLASS="l">818</TD><TD>                                IfStatement newIf = ast.newIfStatement();</TD></TR><TR CLASS="z"><TD CLASS="l">819</TD><TD>                                newIf.setExpression(condition);</TD></TR><TR CLASS="z"><TD CLASS="l">820</TD><TD>                                Statement bodyPlaceholder = (Statement) rewrite.createCopyTarget(innerIf.getThenStatement());</TD></TR><TR CLASS="z"><TD CLASS="l">821</TD><TD>                                newIf.setThenStatement(bodyPlaceholder);</TD></TR><TR CLASS="z"><TD CLASS="l">822</TD><TD>                                rewrite.replace(ifStatement, newIf, null);</TD></TR><TR><TD CLASS="l">823</TD><TD>                                // add correction proposal</TD></TR><TR CLASS="z"><TD CLASS="l">824</TD><TD>                                String label = CorrectionMessages.AdvancedQuickAssistProcessor_joinWithInner_description;</TD></TR><TR CLASS="z"><TD CLASS="l">825</TD><TD>                                Image image = JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">826</TD><TD>                                ASTRewriteCorrectionProposal proposal = new ASTRewriteCorrectionProposal(label,</TD></TR><TR CLASS="z"><TD CLASS="l">827</TD><TD>                                                context.getCompilationUnit(), rewrite, 1, image);</TD></TR><TR CLASS="z"><TD CLASS="l">828</TD><TD>                                resultingCollections.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l">829</TD><TD>                                result = true;</TD></TR><TR><TD CLASS="l">830</TD><TD>                        }</TD></TR><TR><TD CLASS="l"><A NAME="21">831</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">832</TD><TD>                return result;</TD></TR><TR><TD CLASS="l">833</TD><TD>        }</TD></TR><TR><TD CLASS="l">834</TD><TD>        private static Expression getParenthesizedForAndIfNeeded(AST ast, ASTRewrite rewrite, Expression expression) {</TD></TR><TR CLASS="z"><TD CLASS="l">835</TD><TD>                boolean addParentheses = false;</TD></TR><TR CLASS="z"><TD CLASS="l">836</TD><TD>                int nodeType = expression.getNodeType();</TD></TR><TR CLASS="z"><TD CLASS="l">837</TD><TD>                if (nodeType == ASTNode.INFIX_EXPRESSION) {</TD></TR><TR CLASS="z"><TD CLASS="l">838</TD><TD>                        InfixExpression infixExpression = (InfixExpression) expression;</TD></TR><TR CLASS="z"><TD CLASS="l">839</TD><TD>                        addParentheses = infixExpression.getOperator() == InfixExpression.Operator.CONDITIONAL_OR;</TD></TR><TR><TD CLASS="l">840</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">841</TD><TD>                        addParentheses = nodeType == ASTNode.CONDITIONAL_EXPRESSION || nodeType == ASTNode.ASSIGNMENT</TD></TR><TR CLASS="z"><TD CLASS="l">842</TD><TD>                                        || nodeType == ASTNode.INSTANCEOF_EXPRESSION;</TD></TR><TR><TD CLASS="l">843</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">844</TD><TD>                expression = (Expression) rewrite.createCopyTarget(expression);</TD></TR><TR CLASS="z"><TD CLASS="l">845</TD><TD>                if (addParentheses) {</TD></TR><TR CLASS="z"><TD CLASS="l">846</TD><TD>                        return getParenthesizedExpression(ast, expression);</TD></TR><TR><TD CLASS="l"><A NAME="20">847</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">848</TD><TD>                return expression;</TD></TR><TR><TD CLASS="l">849</TD><TD>        }</TD></TR><TR><TD CLASS="l">850</TD><TD>        private static Expression getParenthesizedExpression(AST ast, Expression expression) {</TD></TR><TR CLASS="z"><TD CLASS="l">851</TD><TD>                ParenthesizedExpression parenthesizedExpression = ast.newParenthesizedExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">852</TD><TD>                parenthesizedExpression.setExpression(expression);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="2b">853</A></TD><TD>                return parenthesizedExpression;</TD></TR><TR><TD CLASS="l">854</TD><TD>        }</TD></TR><TR><TD CLASS="l">855</TD><TD>        private static boolean getSplitAndConditionProposals(IInvocationContext context, ASTNode node,</TD></TR><TR><TD CLASS="l">856</TD><TD>                        Collection resultingCollections) {</TD></TR><TR CLASS="z"><TD CLASS="l">857</TD><TD>                Operator andOperator = InfixExpression.Operator.CONDITIONAL_AND;</TD></TR><TR><TD CLASS="l">858</TD><TD>                // check that user invokes quick assist on infix expression</TD></TR><TR CLASS="z"><TD CLASS="l">859</TD><TD>                if (!(node instanceof InfixExpression)) {</TD></TR><TR CLASS="z"><TD CLASS="l">860</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">861</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">862</TD><TD>                InfixExpression infixExpression = (InfixExpression) node;</TD></TR><TR CLASS="z"><TD CLASS="l">863</TD><TD>                if (infixExpression.getOperator() != andOperator) {</TD></TR><TR CLASS="z"><TD CLASS="l">864</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">865</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">866</TD><TD>                int offset= isOperatorSelected(infixExpression, context.getSelectionOffset(), context.getSelectionLength());</TD></TR><TR CLASS="z"><TD CLASS="l">867</TD><TD>                if (offset == -1) {</TD></TR><TR CLASS="z"><TD CLASS="l">868</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">869</TD><TD>                }</TD></TR><TR><TD CLASS="l">870</TD><TD> </TD></TR><TR><TD CLASS="l">871</TD><TD>                // check that infix expression belongs to IfStatement</TD></TR><TR CLASS="z"><TD CLASS="l">872</TD><TD>                Statement statement = ASTResolving.findParentStatement(node);</TD></TR><TR CLASS="z"><TD CLASS="l">873</TD><TD>                if (!(statement instanceof IfStatement)) {</TD></TR><TR CLASS="z"><TD CLASS="l">874</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">875</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">876</TD><TD>                IfStatement ifStatement = (IfStatement) statement;</TD></TR><TR CLASS="z"><TD CLASS="l">877</TD><TD>                if (ifStatement.getElseStatement() != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">878</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">879</TD><TD>                }</TD></TR><TR><TD CLASS="l">880</TD><TD>                // check that infix expression is part of first level &amp;&amp; condition of IfStatement</TD></TR><TR CLASS="z"><TD CLASS="l">881</TD><TD>                InfixExpression topInfixExpression = infixExpression;</TD></TR><TR CLASS="z"><TD CLASS="l">882</TD><TD>                while ((topInfixExpression.getParent() instanceof InfixExpression)</TD></TR><TR CLASS="z"><TD CLASS="l">883</TD><TD>                                &amp;&amp; ((InfixExpression) topInfixExpression.getParent()).getOperator() == andOperator) {</TD></TR><TR CLASS="z"><TD CLASS="l">884</TD><TD>                        topInfixExpression = (InfixExpression) topInfixExpression.getParent();</TD></TR><TR><TD CLASS="l">885</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">886</TD><TD>                if (ifStatement.getExpression() != topInfixExpression) {</TD></TR><TR CLASS="z"><TD CLASS="l">887</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">888</TD><TD>                }</TD></TR><TR><TD CLASS="l">889</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">890</TD><TD>                if (resultingCollections == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">891</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">892</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">893</TD><TD>                AST ast = ifStatement.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">894</TD><TD>                ASTRewrite rewrite = ASTRewrite.create(ast);</TD></TR><TR><TD CLASS="l">895</TD><TD>                </TD></TR><TR><TD CLASS="l">896</TD><TD>                // prepare left and right conditions</TD></TR><TR CLASS="z"><TD CLASS="l">897</TD><TD>                Expression[] newOperands= { null, null };</TD></TR><TR CLASS="z"><TD CLASS="l">898</TD><TD>                breakInfixOperationAtOperation(rewrite, topInfixExpression, andOperator, offset, true, newOperands);</TD></TR><TR><TD CLASS="l">899</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">900</TD><TD>                Expression leftCondition= newOperands[0];</TD></TR><TR CLASS="z"><TD CLASS="l">901</TD><TD>                Expression rightCondition= newOperands[1];</TD></TR><TR><TD CLASS="l">902</TD><TD>                </TD></TR><TR><TD CLASS="l">903</TD><TD>                // replace condition in inner IfStatement</TD></TR><TR CLASS="z"><TD CLASS="l">904</TD><TD>                rewrite.set(ifStatement, IfStatement.EXPRESSION_PROPERTY, rightCondition, null);</TD></TR><TR><TD CLASS="l">905</TD><TD>                // prepare outer IfStatement</TD></TR><TR CLASS="z"><TD CLASS="l">906</TD><TD>                IfStatement outerIfStatement = ast.newIfStatement();</TD></TR><TR CLASS="z"><TD CLASS="l">907</TD><TD>                outerIfStatement.setExpression(leftCondition);</TD></TR><TR CLASS="z"><TD CLASS="l">908</TD><TD>                Block outerBlock = ast.newBlock();</TD></TR><TR CLASS="z"><TD CLASS="l">909</TD><TD>                outerIfStatement.setThenStatement(outerBlock);</TD></TR><TR CLASS="z"><TD CLASS="l">910</TD><TD>                ASTNode ifPlaceholder = rewrite.createMoveTarget(ifStatement);</TD></TR><TR CLASS="z"><TD CLASS="l">911</TD><TD>                outerBlock.statements().add(ifPlaceholder);</TD></TR><TR><TD CLASS="l">912</TD><TD>                // replace ifStatement</TD></TR><TR CLASS="z"><TD CLASS="l">913</TD><TD>                rewrite.replace(ifStatement, outerIfStatement, null);</TD></TR><TR><TD CLASS="l">914</TD><TD>                // add correction proposal</TD></TR><TR CLASS="z"><TD CLASS="l">915</TD><TD>                String label = CorrectionMessages.AdvancedQuickAssistProcessor_splitAndCondition_description;</TD></TR><TR CLASS="z"><TD CLASS="l">916</TD><TD>                Image image = JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">917</TD><TD>                ASTRewriteCorrectionProposal proposal = new ASTRewriteCorrectionProposal(label, context.getCompilationUnit(),</TD></TR><TR CLASS="z"><TD CLASS="l">918</TD><TD>                                rewrite, 1, image);</TD></TR><TR CLASS="z"><TD CLASS="l">919</TD><TD>                resultingCollections.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="33">920</A></TD><TD>                return true;</TD></TR><TR><TD CLASS="l">921</TD><TD>        }</TD></TR><TR><TD CLASS="l">922</TD><TD>        private static boolean isSelectingOperator(ASTNode n1, ASTNode n2, int offset, int length) {</TD></TR><TR><TD CLASS="l">923</TD><TD>                // between the nodes</TD></TR><TR CLASS="z"><TD CLASS="l">924</TD><TD>                if (offset + length &lt;= n2.getStartPosition() &amp;&amp; offset &gt;= ASTNodes.getExclusiveEnd(n1)) {</TD></TR><TR CLASS="z"><TD CLASS="l">925</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">926</TD><TD>                }</TD></TR><TR><TD CLASS="l">927</TD><TD>                // or exactly select the node (but not with infix expressions)</TD></TR><TR CLASS="z"><TD CLASS="l">928</TD><TD>                if (n1.getStartPosition() == offset &amp;&amp; ASTNodes.getExclusiveEnd(n2) == offset + length) {</TD></TR><TR CLASS="z"><TD CLASS="l">929</TD><TD>                        if (n1 instanceof InfixExpression || n2 instanceof InfixExpression) {</TD></TR><TR CLASS="z"><TD CLASS="l">930</TD><TD>                                return false;</TD></TR><TR><TD CLASS="l">931</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">932</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">933</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="32">934</A></TD><TD>                return false;</TD></TR><TR><TD CLASS="l">935</TD><TD>        }</TD></TR><TR><TD CLASS="l">936</TD><TD>        </TD></TR><TR><TD CLASS="l">937</TD><TD>        private static int isOperatorSelected(InfixExpression infixExpression, int offset, int length) {</TD></TR><TR CLASS="z"><TD CLASS="l">938</TD><TD>                ASTNode left= infixExpression.getLeftOperand();</TD></TR><TR CLASS="z"><TD CLASS="l">939</TD><TD>                ASTNode right= infixExpression.getRightOperand();</TD></TR><TR><TD CLASS="l">940</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">941</TD><TD>                if (isSelectingOperator(left, right, offset, length)) {</TD></TR><TR CLASS="z"><TD CLASS="l">942</TD><TD>                        return ASTNodes.getExclusiveEnd(left);</TD></TR><TR><TD CLASS="l">943</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">944</TD><TD>                List extended= infixExpression.extendedOperands();</TD></TR><TR CLASS="z"><TD CLASS="l">945</TD><TD>                for (int i= 0; i &lt; extended.size(); i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">946</TD><TD>                        left= right;</TD></TR><TR CLASS="z"><TD CLASS="l">947</TD><TD>                        right= (ASTNode) extended.get(i);</TD></TR><TR CLASS="z"><TD CLASS="l">948</TD><TD>                        if (isSelectingOperator(left, right, offset, length)) {</TD></TR><TR CLASS="z"><TD CLASS="l">949</TD><TD>                                return ASTNodes.getExclusiveEnd(left);</TD></TR><TR><TD CLASS="l">950</TD><TD>                        }</TD></TR><TR><TD CLASS="l">951</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">952</TD><TD>                return -1;</TD></TR><TR><TD CLASS="l"><A NAME="1f">953</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">954</TD><TD>        </TD></TR><TR><TD CLASS="l">955</TD><TD>        private static boolean getJoinOrIfStatementsProposals(IInvocationContext context, ASTNode covering, ArrayList coveredNodes,</TD></TR><TR><TD CLASS="l">956</TD><TD>                        Collection resultingCollections) {</TD></TR><TR CLASS="z"><TD CLASS="l">957</TD><TD>                Operator orOperator = InfixExpression.Operator.CONDITIONAL_OR;</TD></TR><TR CLASS="z"><TD CLASS="l">958</TD><TD>                if (coveredNodes.size() &lt; 2)</TD></TR><TR CLASS="z"><TD CLASS="l">959</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">960</TD><TD>                // check that all covered nodes are IfStatement's with same 'then' statement and without 'else'</TD></TR><TR CLASS="z"><TD CLASS="l">961</TD><TD>                String commonThenSource = null;</TD></TR><TR CLASS="z"><TD CLASS="l">962</TD><TD>                for (Iterator iter = coveredNodes.iterator(); iter.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">963</TD><TD>                        ASTNode node = (ASTNode) iter.next();</TD></TR><TR CLASS="z"><TD CLASS="l">964</TD><TD>                        if (!(node instanceof IfStatement))</TD></TR><TR CLASS="z"><TD CLASS="l">965</TD><TD>                                return false;</TD></TR><TR><TD CLASS="l">966</TD><TD>                        //</TD></TR><TR CLASS="z"><TD CLASS="l">967</TD><TD>                        IfStatement ifStatement = (IfStatement) node;</TD></TR><TR CLASS="z"><TD CLASS="l">968</TD><TD>                        if (ifStatement.getElseStatement() != null)</TD></TR><TR CLASS="z"><TD CLASS="l">969</TD><TD>                                return false;</TD></TR><TR><TD CLASS="l">970</TD><TD>                        //</TD></TR><TR CLASS="z"><TD CLASS="l">971</TD><TD>                        Statement thenStatement = ifStatement.getThenStatement();</TD></TR><TR><TD CLASS="l">972</TD><TD>                        try {</TD></TR><TR CLASS="z"><TD CLASS="l">973</TD><TD>                                String thenSource = context.getCompilationUnit().getBuffer().getText(thenStatement.getStartPosition(),</TD></TR><TR CLASS="z"><TD CLASS="l">974</TD><TD>                                        thenStatement.getLength());</TD></TR><TR CLASS="z"><TD CLASS="l">975</TD><TD>                                if (commonThenSource == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">976</TD><TD>                                        commonThenSource = thenSource;</TD></TR><TR><TD CLASS="l">977</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">978</TD><TD>                                        if (!commonThenSource.equals(thenSource))</TD></TR><TR CLASS="z"><TD CLASS="l">979</TD><TD>                                                return false;</TD></TR><TR><TD CLASS="l">980</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">981</TD><TD>                        } catch (Throwable e) {</TD></TR><TR CLASS="z"><TD CLASS="l">982</TD><TD>                                return false;</TD></TR><TR><TD CLASS="l">983</TD><TD>                        }</TD></TR><TR><TD CLASS="l">984</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">985</TD><TD>                if (resultingCollections == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">986</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">987</TD><TD>                }</TD></TR><TR><TD CLASS="l">988</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">989</TD><TD>                final AST ast = covering.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">990</TD><TD>                final ASTRewrite rewrite = ASTRewrite.create(ast);</TD></TR><TR><TD CLASS="l">991</TD><TD>                // prepare OR'ed condition</TD></TR><TR CLASS="z"><TD CLASS="l">992</TD><TD>                InfixExpression condition = null;</TD></TR><TR CLASS="z"><TD CLASS="l">993</TD><TD>                boolean hasRightOperand = false;</TD></TR><TR CLASS="z"><TD CLASS="l">994</TD><TD>                Statement thenStatement = null;</TD></TR><TR CLASS="z"><TD CLASS="l">995</TD><TD>                for (Iterator iter = coveredNodes.iterator(); iter.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">996</TD><TD>                        IfStatement ifStatement = (IfStatement) iter.next();</TD></TR><TR CLASS="z"><TD CLASS="l">997</TD><TD>                        if (thenStatement == null)</TD></TR><TR CLASS="z"><TD CLASS="l">998</TD><TD>                                thenStatement = (Statement) rewrite.createCopyTarget(ifStatement.getThenStatement());</TD></TR><TR CLASS="z"><TD CLASS="l">999</TD><TD>                        Expression ifCondition = getParenthesizedForOrIfNeeded(ast, rewrite, ifStatement.getExpression());</TD></TR><TR CLASS="z"><TD CLASS="l">1000</TD><TD>                        if (condition == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1001</TD><TD>                                condition = ast.newInfixExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">1002</TD><TD>                                condition.setOperator(orOperator);</TD></TR><TR CLASS="z"><TD CLASS="l">1003</TD><TD>                                condition.setLeftOperand(ifCondition);</TD></TR><TR CLASS="z"><TD CLASS="l">1004</TD><TD>                        } else if (!hasRightOperand) {</TD></TR><TR CLASS="z"><TD CLASS="l">1005</TD><TD>                                condition.setRightOperand(ifCondition);</TD></TR><TR CLASS="z"><TD CLASS="l">1006</TD><TD>                                hasRightOperand = true;</TD></TR><TR><TD CLASS="l">1007</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1008</TD><TD>                                InfixExpression newCondition = ast.newInfixExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">1009</TD><TD>                                newCondition.setOperator(orOperator);</TD></TR><TR CLASS="z"><TD CLASS="l">1010</TD><TD>                                newCondition.setLeftOperand(condition);</TD></TR><TR CLASS="z"><TD CLASS="l">1011</TD><TD>                                newCondition.setRightOperand(ifCondition);</TD></TR><TR CLASS="z"><TD CLASS="l">1012</TD><TD>                                condition = newCondition;</TD></TR><TR><TD CLASS="l">1013</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1014</TD><TD>                }</TD></TR><TR><TD CLASS="l">1015</TD><TD>                // prepare new IfStatement with OR'ed condition</TD></TR><TR CLASS="z"><TD CLASS="l">1016</TD><TD>                IfStatement newIf = ast.newIfStatement();</TD></TR><TR CLASS="z"><TD CLASS="l">1017</TD><TD>                newIf.setExpression(condition);</TD></TR><TR CLASS="z"><TD CLASS="l">1018</TD><TD>                newIf.setThenStatement(thenStatement);</TD></TR><TR><TD CLASS="l">1019</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">1020</TD><TD>                ListRewrite listRewriter = null;</TD></TR><TR CLASS="z"><TD CLASS="l">1021</TD><TD>                for (Iterator iter = coveredNodes.iterator(); iter.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">1022</TD><TD>                        IfStatement ifStatement = (IfStatement) iter.next();</TD></TR><TR CLASS="z"><TD CLASS="l">1023</TD><TD>                        if (listRewriter == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1024</TD><TD>                                Block sourceBlock = (Block) ifStatement.getParent();</TD></TR><TR><TD CLASS="l">1025</TD><TD>                                //int insertIndex = sourceBlock.statements().indexOf(ifStatement);</TD></TR><TR CLASS="z"><TD CLASS="l">1026</TD><TD>                                listRewriter = rewrite.getListRewrite(sourceBlock,</TD></TR><TR CLASS="z"><TD CLASS="l">1027</TD><TD>                                        (ChildListPropertyDescriptor) ifStatement.getLocationInParent());</TD></TR><TR><TD CLASS="l">1028</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1029</TD><TD>                        if (newIf != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1030</TD><TD>                                listRewriter.replace(ifStatement, newIf, null);</TD></TR><TR CLASS="z"><TD CLASS="l">1031</TD><TD>                                newIf = null;</TD></TR><TR><TD CLASS="l">1032</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1033</TD><TD>                                listRewriter.remove(ifStatement, null);</TD></TR><TR><TD CLASS="l">1034</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1035</TD><TD>                }</TD></TR><TR><TD CLASS="l">1036</TD><TD>                // add correction proposal</TD></TR><TR CLASS="z"><TD CLASS="l">1037</TD><TD>                String label = CorrectionMessages.AdvancedQuickAssistProcessor_joinWithOr_description;</TD></TR><TR CLASS="z"><TD CLASS="l">1038</TD><TD>                Image image = JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">1039</TD><TD>                ASTRewriteCorrectionProposal proposal = new ASTRewriteCorrectionProposal(label, context.getCompilationUnit(),</TD></TR><TR CLASS="z"><TD CLASS="l">1040</TD><TD>                                rewrite, 1, image);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="22">1041</A></TD><TD>                resultingCollections.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l">1042</TD><TD>                return true;</TD></TR><TR><TD CLASS="l">1043</TD><TD>        }</TD></TR><TR><TD CLASS="l">1044</TD><TD>        private static Expression getParenthesizedForOrIfNeeded(AST ast, ASTRewrite rewrite, Expression expression) {</TD></TR><TR CLASS="z"><TD CLASS="l">1045</TD><TD>                boolean addParentheses = false;</TD></TR><TR CLASS="z"><TD CLASS="l">1046</TD><TD>                int nodeType = expression.getNodeType();</TD></TR><TR CLASS="z"><TD CLASS="l">1047</TD><TD>                addParentheses = nodeType == ASTNode.CONDITIONAL_EXPRESSION || nodeType == ASTNode.ASSIGNMENT</TD></TR><TR CLASS="z"><TD CLASS="l">1048</TD><TD>                                || nodeType == ASTNode.INSTANCEOF_EXPRESSION;</TD></TR><TR CLASS="z"><TD CLASS="l">1049</TD><TD>                expression = (Expression) rewrite.createCopyTarget(expression);</TD></TR><TR CLASS="z"><TD CLASS="l">1050</TD><TD>                if (addParentheses) {</TD></TR><TR CLASS="z"><TD CLASS="l">1051</TD><TD>                        return getParenthesizedExpression(ast, expression);</TD></TR><TR><TD CLASS="l">1052</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="2c">1053</A></TD><TD>                return expression;</TD></TR><TR><TD CLASS="l">1054</TD><TD>        }</TD></TR><TR><TD CLASS="l">1055</TD><TD>        private static boolean getSplitOrConditionProposals(IInvocationContext context, ASTNode node,</TD></TR><TR><TD CLASS="l">1056</TD><TD>                        Collection resultingCollections) {</TD></TR><TR CLASS="z"><TD CLASS="l">1057</TD><TD>                Operator orOperator = InfixExpression.Operator.CONDITIONAL_OR;</TD></TR><TR><TD CLASS="l">1058</TD><TD>                // check that user invokes quick assist on infix expression</TD></TR><TR CLASS="z"><TD CLASS="l">1059</TD><TD>                if (!(node instanceof InfixExpression)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1060</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1061</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1062</TD><TD>                InfixExpression infixExpression = (InfixExpression) node;</TD></TR><TR CLASS="z"><TD CLASS="l">1063</TD><TD>                if (infixExpression.getOperator() != orOperator) {</TD></TR><TR CLASS="z"><TD CLASS="l">1064</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1065</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1066</TD><TD>                int offset= isOperatorSelected(infixExpression, context.getSelectionOffset(), context.getSelectionLength());</TD></TR><TR CLASS="z"><TD CLASS="l">1067</TD><TD>                if (offset == -1) {</TD></TR><TR CLASS="z"><TD CLASS="l">1068</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1069</TD><TD>                }</TD></TR><TR><TD CLASS="l">1070</TD><TD>                // check that infix expression belongs to IfStatement</TD></TR><TR CLASS="z"><TD CLASS="l">1071</TD><TD>                Statement statement = ASTResolving.findParentStatement(node);</TD></TR><TR CLASS="z"><TD CLASS="l">1072</TD><TD>                if (!(statement instanceof IfStatement)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1073</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1074</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1075</TD><TD>                IfStatement ifStatement = (IfStatement) statement;</TD></TR><TR CLASS="z"><TD CLASS="l">1076</TD><TD>                if (ifStatement.getElseStatement() != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1077</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1078</TD><TD>                }</TD></TR><TR><TD CLASS="l">1079</TD><TD>                // check that infix expression is part of first level || condition of IfStatement</TD></TR><TR CLASS="z"><TD CLASS="l">1080</TD><TD>                InfixExpression topInfixExpression = infixExpression;</TD></TR><TR CLASS="z"><TD CLASS="l">1081</TD><TD>                while ((topInfixExpression.getParent() instanceof InfixExpression)</TD></TR><TR CLASS="z"><TD CLASS="l">1082</TD><TD>                                &amp;&amp; ((InfixExpression) topInfixExpression.getParent()).getOperator() == orOperator) {</TD></TR><TR CLASS="z"><TD CLASS="l">1083</TD><TD>                        topInfixExpression = (InfixExpression) topInfixExpression.getParent();</TD></TR><TR><TD CLASS="l">1084</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1085</TD><TD>                if (ifStatement.getExpression() != topInfixExpression) {</TD></TR><TR CLASS="z"><TD CLASS="l">1086</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1087</TD><TD>                }</TD></TR><TR><TD CLASS="l">1088</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">1089</TD><TD>                if (resultingCollections == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1090</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">1091</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1092</TD><TD>                AST ast = ifStatement.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">1093</TD><TD>                ASTRewrite rewrite = ASTRewrite.create(ast);</TD></TR><TR><TD CLASS="l">1094</TD><TD> </TD></TR><TR><TD CLASS="l">1095</TD><TD>                // prepare left and right conditions</TD></TR><TR CLASS="z"><TD CLASS="l">1096</TD><TD>                Expression[] newOperands= { null, null };</TD></TR><TR CLASS="z"><TD CLASS="l">1097</TD><TD>                breakInfixOperationAtOperation(rewrite, topInfixExpression, orOperator, offset, true, newOperands);</TD></TR><TR><TD CLASS="l">1098</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">1099</TD><TD>                Expression leftCondition= newOperands[0];</TD></TR><TR CLASS="z"><TD CLASS="l">1100</TD><TD>                Expression rightCondition= newOperands[1];</TD></TR><TR><TD CLASS="l">1101</TD><TD>                </TD></TR><TR><TD CLASS="l">1102</TD><TD>                // prepare first statement</TD></TR><TR CLASS="z"><TD CLASS="l">1103</TD><TD>                IfStatement firstIf = ast.newIfStatement();</TD></TR><TR CLASS="z"><TD CLASS="l">1104</TD><TD>                firstIf.setExpression(leftCondition);</TD></TR><TR CLASS="z"><TD CLASS="l">1105</TD><TD>                firstIf.setThenStatement((Statement) rewrite.createCopyTarget(ifStatement.getThenStatement()));</TD></TR><TR><TD CLASS="l">1106</TD><TD>                // prepare second statement</TD></TR><TR CLASS="z"><TD CLASS="l">1107</TD><TD>                IfStatement secondIf = ast.newIfStatement();</TD></TR><TR CLASS="z"><TD CLASS="l">1108</TD><TD>                secondIf.setExpression(rightCondition);</TD></TR><TR CLASS="z"><TD CLASS="l">1109</TD><TD>                secondIf.setThenStatement((Statement) rewrite.createCopyTarget(ifStatement.getThenStatement()));</TD></TR><TR><TD CLASS="l">1110</TD><TD>                // add first and second IfStatement's</TD></TR><TR CLASS="z"><TD CLASS="l">1111</TD><TD>                Block sourceBlock = (Block) ifStatement.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">1112</TD><TD>                int insertIndex = sourceBlock.statements().indexOf(ifStatement);</TD></TR><TR CLASS="z"><TD CLASS="l">1113</TD><TD>                ListRewrite listRewriter = rewrite.getListRewrite(sourceBlock,</TD></TR><TR CLASS="z"><TD CLASS="l">1114</TD><TD>                        (ChildListPropertyDescriptor) statement.getLocationInParent());</TD></TR><TR CLASS="z"><TD CLASS="l">1115</TD><TD>                listRewriter.replace(ifStatement, firstIf, null);</TD></TR><TR CLASS="z"><TD CLASS="l">1116</TD><TD>                listRewriter.insertAt(secondIf, insertIndex + 1, null);</TD></TR><TR><TD CLASS="l">1117</TD><TD>                // add correction proposal</TD></TR><TR CLASS="z"><TD CLASS="l">1118</TD><TD>                String label = CorrectionMessages.AdvancedQuickAssistProcessor_splitOrCondition_description;</TD></TR><TR CLASS="z"><TD CLASS="l">1119</TD><TD>                Image image = JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">1120</TD><TD>                ASTRewriteCorrectionProposal proposal = new ASTRewriteCorrectionProposal(label, context.getCompilationUnit(),</TD></TR><TR CLASS="z"><TD CLASS="l">1121</TD><TD>                                rewrite, 1, image);</TD></TR><TR CLASS="z"><TD CLASS="l">1122</TD><TD>                resultingCollections.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l">1123</TD><TD>                return true;</TD></TR><TR><TD CLASS="l"><A NAME="14">1124</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">1125</TD><TD>        private static boolean getInverseConditionalExpressionProposals(IInvocationContext context, ASTNode covering,</TD></TR><TR><TD CLASS="l">1126</TD><TD>                        Collection resultingCollections) {</TD></TR><TR><TD CLASS="l">1127</TD><TD>                // try to find conditional expression as parent</TD></TR><TR CLASS="z"><TD CLASS="l">1128</TD><TD>                while (covering instanceof Expression) {</TD></TR><TR CLASS="z"><TD CLASS="l">1129</TD><TD>                        if (covering instanceof ConditionalExpression)</TD></TR><TR CLASS="z"><TD CLASS="l">1130</TD><TD>                                break;</TD></TR><TR CLASS="z"><TD CLASS="l">1131</TD><TD>                        covering = covering.getParent();</TD></TR><TR><TD CLASS="l">1132</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1133</TD><TD>                if (!(covering instanceof ConditionalExpression)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1134</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1135</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1136</TD><TD>                ConditionalExpression expression = (ConditionalExpression) covering;</TD></TR><TR><TD CLASS="l">1137</TD><TD>                //  we could produce quick assist</TD></TR><TR CLASS="z"><TD CLASS="l">1138</TD><TD>                if (resultingCollections == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1139</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">1140</TD><TD>                }</TD></TR><TR><TD CLASS="l">1141</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">1142</TD><TD>                AST ast = covering.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">1143</TD><TD>                ASTRewrite rewrite = ASTRewrite.create(ast);</TD></TR><TR><TD CLASS="l">1144</TD><TD>                // prepare new conditional expression</TD></TR><TR CLASS="z"><TD CLASS="l">1145</TD><TD>                ConditionalExpression newExpression = ast.newConditionalExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">1146</TD><TD>                newExpression.setExpression(getInversedBooleanExpression(rewrite, expression.getExpression()));</TD></TR><TR CLASS="z"><TD CLASS="l">1147</TD><TD>                newExpression.setThenExpression((Expression) rewrite.createCopyTarget(expression.getElseExpression()));</TD></TR><TR CLASS="z"><TD CLASS="l">1148</TD><TD>                newExpression.setElseExpression((Expression) rewrite.createCopyTarget(expression.getThenExpression()));</TD></TR><TR><TD CLASS="l">1149</TD><TD>                // replace old expression with new</TD></TR><TR CLASS="z"><TD CLASS="l">1150</TD><TD>                rewrite.replace(expression, newExpression, null);</TD></TR><TR><TD CLASS="l">1151</TD><TD>                // add correction proposal</TD></TR><TR CLASS="z"><TD CLASS="l">1152</TD><TD>                String label = CorrectionMessages.AdvancedQuickAssistProcessor_inverseConditionalExpression_description;</TD></TR><TR CLASS="z"><TD CLASS="l">1153</TD><TD>                Image image = JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">1154</TD><TD>                ASTRewriteCorrectionProposal proposal = new ASTRewriteCorrectionProposal(label, context.getCompilationUnit(),</TD></TR><TR CLASS="z"><TD CLASS="l">1155</TD><TD>                                rewrite, 1, image);</TD></TR><TR CLASS="z"><TD CLASS="l">1156</TD><TD>                resultingCollections.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="d">1157</A></TD><TD>                return true;</TD></TR><TR><TD CLASS="l">1158</TD><TD>        }</TD></TR><TR><TD CLASS="l">1159</TD><TD>        private static boolean getExchangeInnerAndOuterIfConditionsProposals(IInvocationContext context, ASTNode node,</TD></TR><TR><TD CLASS="l">1160</TD><TD>                        Collection resultingCollections) {</TD></TR><TR CLASS="z"><TD CLASS="l">1161</TD><TD>                boolean result = false;</TD></TR><TR><TD CLASS="l">1162</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">1163</TD><TD>                Statement statement = ASTResolving.findParentStatement(node);</TD></TR><TR CLASS="z"><TD CLASS="l">1164</TD><TD>                if (!(statement instanceof IfStatement)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1165</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1166</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1167</TD><TD>                IfStatement ifStatement = (IfStatement) statement;</TD></TR><TR CLASS="z"><TD CLASS="l">1168</TD><TD>                if (ifStatement.getElseStatement() != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1169</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1170</TD><TD>                }</TD></TR><TR><TD CLASS="l">1171</TD><TD>                // case when current IfStatement is sole child of another IfStatement</TD></TR><TR><TD CLASS="l">1172</TD><TD>                {</TD></TR><TR CLASS="z"><TD CLASS="l">1173</TD><TD>                        IfStatement outerIf = null;</TD></TR><TR CLASS="z"><TD CLASS="l">1174</TD><TD>                        if (ifStatement.getParent() instanceof IfStatement) {</TD></TR><TR CLASS="z"><TD CLASS="l">1175</TD><TD>                                outerIf = (IfStatement) ifStatement.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">1176</TD><TD>                        } else if (ifStatement.getParent() instanceof Block) {</TD></TR><TR CLASS="z"><TD CLASS="l">1177</TD><TD>                                Block block = (Block) ifStatement.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">1178</TD><TD>                                if ((block.getParent() instanceof IfStatement) &amp;&amp; (block.statements().size() == 1)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1179</TD><TD>                                        outerIf = (IfStatement) block.getParent();</TD></TR><TR><TD CLASS="l">1180</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1181</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1182</TD><TD>                        if ((outerIf != null) &amp;&amp; (outerIf.getElseStatement() == null)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1183</TD><TD>                                if (resultingCollections == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1184</TD><TD>                                        return true;</TD></TR><TR><TD CLASS="l">1185</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1186</TD><TD>                                //</TD></TR><TR CLASS="z"><TD CLASS="l">1187</TD><TD>                                AST ast = statement.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">1188</TD><TD>                                ASTRewrite rewrite = ASTRewrite.create(ast);</TD></TR><TR><TD CLASS="l">1189</TD><TD>                                // prepare conditions</TD></TR><TR CLASS="z"><TD CLASS="l">1190</TD><TD>                                Expression outerCondition = (Expression) rewrite.createCopyTarget(outerIf.getExpression());</TD></TR><TR CLASS="z"><TD CLASS="l">1191</TD><TD>                                Expression innerCondition = (Expression) rewrite.createCopyTarget(ifStatement.getExpression());</TD></TR><TR><TD CLASS="l">1192</TD><TD>                                // exchange conditions</TD></TR><TR CLASS="z"><TD CLASS="l">1193</TD><TD>                                rewrite.replace(outerIf.getExpression(), innerCondition, null);</TD></TR><TR CLASS="z"><TD CLASS="l">1194</TD><TD>                                rewrite.replace(ifStatement.getExpression(), outerCondition, null);</TD></TR><TR><TD CLASS="l">1195</TD><TD>                                // add correction proposal</TD></TR><TR CLASS="z"><TD CLASS="l">1196</TD><TD>                                String label = CorrectionMessages.AdvancedQuickAssistProcessor_exchangeInnerAndOuterIfConditions_description;</TD></TR><TR CLASS="z"><TD CLASS="l">1197</TD><TD>                                Image image = JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">1198</TD><TD>                                ASTRewriteCorrectionProposal proposal = new ASTRewriteCorrectionProposal(label,</TD></TR><TR CLASS="z"><TD CLASS="l">1199</TD><TD>                                                context.getCompilationUnit(), rewrite, 1, image);</TD></TR><TR CLASS="z"><TD CLASS="l">1200</TD><TD>                                resultingCollections.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l">1201</TD><TD>                                result = true;</TD></TR><TR><TD CLASS="l">1202</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1203</TD><TD>                }</TD></TR><TR><TD CLASS="l">1204</TD><TD>                // case when current IfStatement has another IfStatement as sole child</TD></TR><TR><TD CLASS="l">1205</TD><TD>                {</TD></TR><TR CLASS="z"><TD CLASS="l">1206</TD><TD>                        IfStatement innerIf = null;</TD></TR><TR CLASS="z"><TD CLASS="l">1207</TD><TD>                        if (ifStatement.getThenStatement() instanceof IfStatement) {</TD></TR><TR CLASS="z"><TD CLASS="l">1208</TD><TD>                                innerIf = (IfStatement) ifStatement.getThenStatement();</TD></TR><TR CLASS="z"><TD CLASS="l">1209</TD><TD>                        } else if (ifStatement.getThenStatement() instanceof Block) {</TD></TR><TR CLASS="z"><TD CLASS="l">1210</TD><TD>                                Block block = (Block) ifStatement.getThenStatement();</TD></TR><TR CLASS="z"><TD CLASS="l">1211</TD><TD>                                if ((block.statements().size() == 1) &amp;&amp; (block.statements().get(0) instanceof IfStatement)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1212</TD><TD>                                        innerIf = (IfStatement) block.statements().get(0);</TD></TR><TR><TD CLASS="l">1213</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1214</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1215</TD><TD>                        if ((innerIf != null) &amp;&amp; (innerIf.getElseStatement() == null)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1216</TD><TD>                                if (resultingCollections == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1217</TD><TD>                                        return true;</TD></TR><TR><TD CLASS="l">1218</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1219</TD><TD>                                //</TD></TR><TR CLASS="z"><TD CLASS="l">1220</TD><TD>                                AST ast = statement.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">1221</TD><TD>                                ASTRewrite rewrite = ASTRewrite.create(ast);</TD></TR><TR><TD CLASS="l">1222</TD><TD>                                // prepare conditions</TD></TR><TR CLASS="z"><TD CLASS="l">1223</TD><TD>                                Expression innerCondition = (Expression) rewrite.createCopyTarget(innerIf.getExpression());</TD></TR><TR CLASS="z"><TD CLASS="l">1224</TD><TD>                                Expression outerCondition = (Expression) rewrite.createCopyTarget(ifStatement.getExpression());</TD></TR><TR><TD CLASS="l">1225</TD><TD>                                // exchange conditions</TD></TR><TR CLASS="z"><TD CLASS="l">1226</TD><TD>                                rewrite.replace(innerIf.getExpression(), outerCondition, null);</TD></TR><TR CLASS="z"><TD CLASS="l">1227</TD><TD>                                rewrite.replace(ifStatement.getExpression(), innerCondition, null);</TD></TR><TR><TD CLASS="l">1228</TD><TD>                                // add correction proposal</TD></TR><TR CLASS="z"><TD CLASS="l">1229</TD><TD>                                String label = CorrectionMessages.AdvancedQuickAssistProcessor_exchangeInnerAndOuterIfConditions_description;</TD></TR><TR CLASS="z"><TD CLASS="l">1230</TD><TD>                                Image image = JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">1231</TD><TD>                                ASTRewriteCorrectionProposal proposal = new ASTRewriteCorrectionProposal(label,</TD></TR><TR CLASS="z"><TD CLASS="l">1232</TD><TD>                                                context.getCompilationUnit(), rewrite, 1, image);</TD></TR><TR CLASS="z"><TD CLASS="l">1233</TD><TD>                                resultingCollections.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l">1234</TD><TD>                                result = true;</TD></TR><TR><TD CLASS="l">1235</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1236</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1237</TD><TD>                return result;</TD></TR><TR><TD CLASS="l"><A NAME="e">1238</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">1239</TD><TD>        private static boolean getExchangeOperandsProposals(IInvocationContext context, ASTNode node,</TD></TR><TR><TD CLASS="l">1240</TD><TD>                        Collection resultingCollections) {</TD></TR><TR><TD CLASS="l">1241</TD><TD>                // check that user invokes quick assist on infix expression</TD></TR><TR CLASS="z"><TD CLASS="l">1242</TD><TD>                if (!(node instanceof InfixExpression)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1243</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1244</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1245</TD><TD>                InfixExpression infixExpression = (InfixExpression) node;</TD></TR><TR CLASS="z"><TD CLASS="l">1246</TD><TD>                Operator operator = infixExpression.getOperator();</TD></TR><TR CLASS="z"><TD CLASS="l">1247</TD><TD>                if ((operator != InfixExpression.Operator.CONDITIONAL_AND) &amp;&amp; (operator != InfixExpression.Operator.AND)</TD></TR><TR CLASS="z"><TD CLASS="l">1248</TD><TD>                                &amp;&amp; (operator != InfixExpression.Operator.CONDITIONAL_OR) &amp;&amp; (operator != InfixExpression.Operator.OR)</TD></TR><TR CLASS="z"><TD CLASS="l">1249</TD><TD>                                &amp;&amp; (operator != InfixExpression.Operator.EQUALS) &amp;&amp; (operator != InfixExpression.Operator.PLUS)</TD></TR><TR CLASS="z"><TD CLASS="l">1250</TD><TD>                                &amp;&amp; (operator != InfixExpression.Operator.TIMES) &amp;&amp; (operator != InfixExpression.Operator.XOR)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1251</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1252</TD><TD>                }</TD></TR><TR><TD CLASS="l">1253</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">1254</TD><TD>                int offset= isOperatorSelected(infixExpression, context.getSelectionOffset(), context.getSelectionLength());</TD></TR><TR CLASS="z"><TD CLASS="l">1255</TD><TD>                if (offset == -1) {</TD></TR><TR CLASS="z"><TD CLASS="l">1256</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1257</TD><TD>                }</TD></TR><TR><TD CLASS="l">1258</TD><TD>                </TD></TR><TR><TD CLASS="l">1259</TD><TD>                //  we could produce quick assist</TD></TR><TR CLASS="z"><TD CLASS="l">1260</TD><TD>                if (resultingCollections == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1261</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">1262</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1263</TD><TD>                AST ast = infixExpression.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">1264</TD><TD>                ASTRewrite rewrite = ASTRewrite.create(ast);</TD></TR><TR><TD CLASS="l">1265</TD><TD>                // prepare left and right expressions</TD></TR><TR CLASS="z"><TD CLASS="l">1266</TD><TD>                Expression leftExpression = null;</TD></TR><TR CLASS="z"><TD CLASS="l">1267</TD><TD>                Expression rightExpression = null;</TD></TR><TR CLASS="z"><TD CLASS="l">1268</TD><TD>                InfixExpression currentExpression = infixExpression;</TD></TR><TR CLASS="z"><TD CLASS="l">1269</TD><TD>                leftExpression= combineOperands(rewrite, leftExpression, infixExpression.getLeftOperand(), true, operator);</TD></TR><TR CLASS="z"><TD CLASS="l">1270</TD><TD>                if (infixExpression.getRightOperand().getStartPosition() &lt;= context.getSelectionOffset()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1271</TD><TD>                        leftExpression= combineOperands(rewrite, leftExpression, infixExpression.getRightOperand(), true, operator);</TD></TR><TR><TD CLASS="l">1272</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1273</TD><TD>                        rightExpression= combineOperands(rewrite, rightExpression, infixExpression.getRightOperand(), true, operator);</TD></TR><TR><TD CLASS="l">1274</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1275</TD><TD>                for (Iterator iter= currentExpression.extendedOperands().iterator(); iter.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">1276</TD><TD>                        Expression extendedOperand= (Expression) iter.next();</TD></TR><TR CLASS="z"><TD CLASS="l">1277</TD><TD>                        if (extendedOperand.getStartPosition() &lt;= context.getSelectionOffset()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1278</TD><TD>                                leftExpression= combineOperands(rewrite, leftExpression, extendedOperand, true, operator);</TD></TR><TR><TD CLASS="l">1279</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1280</TD><TD>                                rightExpression= combineOperands(rewrite, rightExpression, extendedOperand, true, operator);</TD></TR><TR><TD CLASS="l">1281</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1282</TD><TD>                }</TD></TR><TR><TD CLASS="l">1283</TD><TD>                // create new infix expression</TD></TR><TR CLASS="z"><TD CLASS="l">1284</TD><TD>                InfixExpression newInfix = ast.newInfixExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">1285</TD><TD>                newInfix.setOperator(operator);</TD></TR><TR CLASS="z"><TD CLASS="l">1286</TD><TD>                newInfix.setLeftOperand(rightExpression);</TD></TR><TR CLASS="z"><TD CLASS="l">1287</TD><TD>                newInfix.setRightOperand(leftExpression);</TD></TR><TR CLASS="z"><TD CLASS="l">1288</TD><TD>                rewrite.replace(infixExpression, newInfix, null);</TD></TR><TR><TD CLASS="l">1289</TD><TD>                // add correction proposal</TD></TR><TR CLASS="z"><TD CLASS="l">1290</TD><TD>                String label = CorrectionMessages.AdvancedQuickAssistProcessor_exchangeOperands_description;</TD></TR><TR CLASS="z"><TD CLASS="l">1291</TD><TD>                Image image = JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">1292</TD><TD>                ASTRewriteCorrectionProposal proposal = new ASTRewriteCorrectionProposal(label, context.getCompilationUnit(), rewrite, 1, image);</TD></TR><TR CLASS="z"><TD CLASS="l">1293</TD><TD>                resultingCollections.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l">1294</TD><TD>                return true;</TD></TR><TR><TD CLASS="l">1295</TD><TD>        }</TD></TR><TR><TD CLASS="l">1296</TD><TD>        </TD></TR><TR><TD CLASS="l">1297</TD><TD>        /**</TD></TR><TR><TD CLASS="l">1298</TD><TD>         * Breaks an infix operation with possible extended operators at the given operator and returns the new left and right operands.  </TD></TR><TR><TD CLASS="l">1299</TD><TD>         * a &amp; b &amp; c   -&gt;  [[a' &amp; b' ] &amp; c' ]   (c' == copy of c)</TD></TR><TR><TD CLASS="l">1300</TD><TD>         * @param rewrite</TD></TR><TR><TD CLASS="l">1301</TD><TD>         * @param expression</TD></TR><TR><TD CLASS="l"><A NAME="2">1302</A></TD><TD>         * @param operator</TD></TR><TR><TD CLASS="l">1303</TD><TD>         * @param operatorOffset</TD></TR><TR><TD CLASS="l">1304</TD><TD>         */</TD></TR><TR><TD CLASS="l">1305</TD><TD>        private static void breakInfixOperationAtOperation(ASTRewrite rewrite, Expression expression, Operator operator, int operatorOffset, boolean removeParenthesis, Expression[] res) {</TD></TR><TR CLASS="z"><TD CLASS="l">1306</TD><TD>                if (expression.getStartPosition() + expression.getLength() &lt;= operatorOffset) {</TD></TR><TR><TD CLASS="l">1307</TD><TD>                        // add to the left</TD></TR><TR CLASS="z"><TD CLASS="l">1308</TD><TD>                        res[0]= combineOperands(rewrite, res[0], expression, removeParenthesis, operator);</TD></TR><TR CLASS="z"><TD CLASS="l">1309</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">1310</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1311</TD><TD>                if (operatorOffset &lt;= expression.getStartPosition()) {</TD></TR><TR><TD CLASS="l">1312</TD><TD>                        // add to the right</TD></TR><TR CLASS="z"><TD CLASS="l">1313</TD><TD>                        res[1]= combineOperands(rewrite, res[1], expression, removeParenthesis, operator);</TD></TR><TR CLASS="z"><TD CLASS="l">1314</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">1315</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1316</TD><TD>                if (!(expression instanceof InfixExpression)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1317</TD><TD>                        throw new IllegalArgumentException(&#34;Cannot break up non-infix expression&#34;); //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">1318</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1319</TD><TD>                InfixExpression infixExpression= (InfixExpression) expression;</TD></TR><TR CLASS="z"><TD CLASS="l">1320</TD><TD>                if (infixExpression.getOperator() != operator) {</TD></TR><TR CLASS="z"><TD CLASS="l">1321</TD><TD>                        throw new IllegalArgumentException(&#34;Incompatible operator&#34;); //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">1322</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1323</TD><TD>                breakInfixOperationAtOperation(rewrite, infixExpression.getLeftOperand(), operator, operatorOffset, removeParenthesis, res);</TD></TR><TR CLASS="z"><TD CLASS="l">1324</TD><TD>                breakInfixOperationAtOperation(rewrite, infixExpression.getRightOperand(), operator, operatorOffset, removeParenthesis, res);        </TD></TR><TR><TD CLASS="l">1325</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">1326</TD><TD>                List extended= infixExpression.extendedOperands();</TD></TR><TR CLASS="z"><TD CLASS="l">1327</TD><TD>                for (int i= 0; i &lt; extended.size(); i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1328</TD><TD>                        breakInfixOperationAtOperation(rewrite, (Expression) extended.get(i), operator, operatorOffset, removeParenthesis, res);        </TD></TR><TR><TD CLASS="l"><A NAME="3">1329</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1330</TD><TD>        }</TD></TR><TR><TD CLASS="l">1331</TD><TD>        </TD></TR><TR><TD CLASS="l">1332</TD><TD>        private static Expression combineOperands(ASTRewrite rewrite, Expression existing, Expression nodeToAdd, boolean removeParenthesis, Operator operator) {</TD></TR><TR CLASS="z"><TD CLASS="l">1333</TD><TD>                if (existing == null &amp;&amp; removeParenthesis) {</TD></TR><TR CLASS="z"><TD CLASS="l">1334</TD><TD>                        while (nodeToAdd instanceof ParenthesizedExpression) {</TD></TR><TR CLASS="z"><TD CLASS="l">1335</TD><TD>                                nodeToAdd= ((ParenthesizedExpression) nodeToAdd).getExpression();</TD></TR><TR><TD CLASS="l">1336</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1337</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1338</TD><TD>                Expression newRight= (Expression) rewrite.createMoveTarget(nodeToAdd);</TD></TR><TR CLASS="z"><TD CLASS="l">1339</TD><TD>                if (existing == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1340</TD><TD>                        return newRight;</TD></TR><TR><TD CLASS="l">1341</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1342</TD><TD>                AST ast= rewrite.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">1343</TD><TD>                InfixExpression infix= ast.newInfixExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">1344</TD><TD>                infix.setOperator(operator);</TD></TR><TR CLASS="z"><TD CLASS="l">1345</TD><TD>                infix.setLeftOperand(existing);</TD></TR><TR CLASS="z"><TD CLASS="l">1346</TD><TD>                infix.setRightOperand(newRight);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="b">1347</A></TD><TD>                return infix;</TD></TR><TR><TD CLASS="l">1348</TD><TD>        }</TD></TR><TR><TD CLASS="l">1349</TD><TD> </TD></TR><TR><TD CLASS="l">1350</TD><TD>        private static boolean getCastAndAssignIfStatementProposals(IInvocationContext context, ASTNode node, Collection resultingCollections) {</TD></TR><TR CLASS="z"><TD CLASS="l">1351</TD><TD>                if (!(node instanceof InstanceofExpression)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1352</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1353</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1354</TD><TD>                InstanceofExpression expression= (InstanceofExpression) node;</TD></TR><TR><TD CLASS="l">1355</TD><TD>                // test that we are the expression of a 'while' or 'if'</TD></TR><TR CLASS="z"><TD CLASS="l">1356</TD><TD>                while (node.getParent() instanceof Expression) {</TD></TR><TR CLASS="z"><TD CLASS="l">1357</TD><TD>                        node= node.getParent();</TD></TR><TR><TD CLASS="l">1358</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1359</TD><TD>                StructuralPropertyDescriptor locationInParent= node.getLocationInParent();</TD></TR><TR><TD CLASS="l">1360</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1361</TD><TD>                boolean negated= isNegated(expression);</TD></TR><TR><TD CLASS="l">1362</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">1363</TD><TD>                Statement body= null;</TD></TR><TR CLASS="z"><TD CLASS="l">1364</TD><TD>                ASTNode insertionPosition= null;</TD></TR><TR CLASS="z"><TD CLASS="l">1365</TD><TD>                if (negated) {</TD></TR><TR CLASS="z"><TD CLASS="l">1366</TD><TD>                        insertionPosition= node.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">1367</TD><TD>                        if (locationInParent == IfStatement.EXPRESSION_PROPERTY) {</TD></TR><TR CLASS="z"><TD CLASS="l">1368</TD><TD>                                body= ((IfStatement) node.getParent()).getElseStatement();</TD></TR><TR CLASS="z"><TD CLASS="l">1369</TD><TD>                                if (body != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1370</TD><TD>                                        negated= false;</TD></TR><TR><TD CLASS="l">1371</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1372</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1373</TD><TD>                        if (body == null &amp;&amp; insertionPosition.getParent() instanceof Block) {</TD></TR><TR CLASS="z"><TD CLASS="l">1374</TD><TD>                                body= (Statement)insertionPosition.getParent();</TD></TR><TR><TD CLASS="l">1375</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1376</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1377</TD><TD>                        if (locationInParent == IfStatement.EXPRESSION_PROPERTY) {</TD></TR><TR CLASS="z"><TD CLASS="l">1378</TD><TD>                                body= ((IfStatement) node.getParent()).getThenStatement();</TD></TR><TR CLASS="z"><TD CLASS="l">1379</TD><TD>                        } else if (locationInParent == WhileStatement.EXPRESSION_PROPERTY) {</TD></TR><TR CLASS="z"><TD CLASS="l">1380</TD><TD>                                body= ((WhileStatement) node.getParent()).getBody();</TD></TR><TR><TD CLASS="l">1381</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1382</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1383</TD><TD>                if (body == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1384</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1385</TD><TD>                }</TD></TR><TR><TD CLASS="l">1386</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1387</TD><TD>                Type originalType= expression.getRightOperand();</TD></TR><TR CLASS="z"><TD CLASS="l">1388</TD><TD>                if (originalType.resolveBinding() == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1389</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1390</TD><TD>                }</TD></TR><TR><TD CLASS="l">1391</TD><TD> </TD></TR><TR><TD CLASS="l">1392</TD><TD>                //  we could produce quick assist</TD></TR><TR CLASS="z"><TD CLASS="l">1393</TD><TD>                if (resultingCollections == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1394</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">1395</TD><TD>                }</TD></TR><TR><TD CLASS="l">1396</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1397</TD><TD>                final String KEY_NAME= &#34;name&#34;; //$NON-NLS-1$</TD></TR><TR CLASS="z"><TD CLASS="l">1398</TD><TD>                final String KEY_TYPE= &#34;type&#34;; //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">1399</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">1400</TD><TD>                AST ast= expression.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">1401</TD><TD>                ASTRewrite rewrite= ASTRewrite.create(ast);</TD></TR><TR CLASS="z"><TD CLASS="l">1402</TD><TD>                IJavaScriptUnit cu= context.getCompilationUnit();</TD></TR><TR><TD CLASS="l">1403</TD><TD>                // prepare correction proposal</TD></TR><TR CLASS="z"><TD CLASS="l">1404</TD><TD>                String label= CorrectionMessages.AdvancedQuickAssistProcessor_castAndAssign;</TD></TR><TR CLASS="z"><TD CLASS="l">1405</TD><TD>                Image image= JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_LOCAL);</TD></TR><TR CLASS="z"><TD CLASS="l">1406</TD><TD>                LinkedCorrectionProposal proposal= new LinkedCorrectionProposal(label, cu, rewrite, 7, image);</TD></TR><TR><TD CLASS="l">1407</TD><TD>                // prepare possible variable names</TD></TR><TR CLASS="z"><TD CLASS="l">1408</TD><TD>                String[] varNames= suggestLocalVariableNames(cu, originalType.resolveBinding());</TD></TR><TR CLASS="z"><TD CLASS="l">1409</TD><TD>                for (int i= 0; i &lt; varNames.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1410</TD><TD>                        proposal.addLinkedPositionProposal(KEY_NAME, varNames[i], null);</TD></TR><TR><TD CLASS="l">1411</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1412</TD><TD>                CastExpression castExpression= ast.newCastExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">1413</TD><TD>                castExpression.setExpression((Expression) rewrite.createCopyTarget(expression.getLeftOperand()));</TD></TR><TR CLASS="z"><TD CLASS="l">1414</TD><TD>                castExpression.setType((Type) ASTNode.copySubtree(ast, originalType));</TD></TR><TR><TD CLASS="l">1415</TD><TD>                // prepare new variable declaration</TD></TR><TR CLASS="z"><TD CLASS="l">1416</TD><TD>                VariableDeclarationFragment vdf= ast.newVariableDeclarationFragment();</TD></TR><TR CLASS="z"><TD CLASS="l">1417</TD><TD>                vdf.setName(ast.newSimpleName(varNames[0]));</TD></TR><TR CLASS="z"><TD CLASS="l">1418</TD><TD>                vdf.setInitializer(castExpression);</TD></TR><TR><TD CLASS="l">1419</TD><TD>                // prepare new variable declaration statement</TD></TR><TR CLASS="z"><TD CLASS="l">1420</TD><TD>                VariableDeclarationStatement vds= ast.newVariableDeclarationStatement(vdf);</TD></TR><TR CLASS="z"><TD CLASS="l">1421</TD><TD>                vds.setType((Type) ASTNode.copySubtree(ast, originalType));</TD></TR><TR><TD CLASS="l">1422</TD><TD>                </TD></TR><TR><TD CLASS="l">1423</TD><TD>                // add new variable declaration statement                </TD></TR><TR CLASS="z"><TD CLASS="l">1424</TD><TD>                if (negated) {</TD></TR><TR CLASS="z"><TD CLASS="l">1425</TD><TD>                        ListRewrite listRewriter= rewrite.getListRewrite(body, Block.STATEMENTS_PROPERTY);</TD></TR><TR CLASS="z"><TD CLASS="l">1426</TD><TD>                        listRewriter.insertAfter(vds, insertionPosition, null);</TD></TR><TR><TD CLASS="l">1427</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1428</TD><TD>                        if (body instanceof Block) {</TD></TR><TR CLASS="z"><TD CLASS="l">1429</TD><TD>                                ListRewrite listRewriter= rewrite.getListRewrite(body, Block.STATEMENTS_PROPERTY);</TD></TR><TR CLASS="z"><TD CLASS="l">1430</TD><TD>                                listRewriter.insertAt(vds, 0, null);</TD></TR><TR><TD CLASS="l">1431</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1432</TD><TD>                                Block newBlock= ast.newBlock();</TD></TR><TR CLASS="z"><TD CLASS="l">1433</TD><TD>                                List statements= newBlock.statements();</TD></TR><TR CLASS="z"><TD CLASS="l">1434</TD><TD>                                statements.add(vds);</TD></TR><TR CLASS="z"><TD CLASS="l">1435</TD><TD>                                statements.add(rewrite.createMoveTarget(body));</TD></TR><TR CLASS="z"><TD CLASS="l">1436</TD><TD>                                rewrite.replace(body, newBlock, null);</TD></TR><TR><TD CLASS="l">1437</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1438</TD><TD>                }</TD></TR><TR><TD CLASS="l">1439</TD><TD> </TD></TR><TR><TD CLASS="l">1440</TD><TD>                // setup linked positions</TD></TR><TR CLASS="z"><TD CLASS="l">1441</TD><TD>                proposal.addLinkedPosition(rewrite.track(vdf.getName()), true, KEY_NAME);</TD></TR><TR CLASS="z"><TD CLASS="l">1442</TD><TD>                proposal.addLinkedPosition(rewrite.track(vds.getType()), false, KEY_TYPE);</TD></TR><TR CLASS="z"><TD CLASS="l">1443</TD><TD>                proposal.addLinkedPosition(rewrite.track(castExpression.getType()), false, KEY_TYPE);</TD></TR><TR CLASS="z"><TD CLASS="l">1444</TD><TD>                proposal.setEndPosition(rewrite.track(vds)); // set cursor after expression statement</TD></TR><TR><TD CLASS="l">1445</TD><TD>                // add correction proposal</TD></TR><TR CLASS="z"><TD CLASS="l">1446</TD><TD>                resultingCollections.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="31">1447</A></TD><TD>                return true;</TD></TR><TR><TD CLASS="l">1448</TD><TD>        }</TD></TR><TR><TD CLASS="l">1449</TD><TD> </TD></TR><TR><TD CLASS="l">1450</TD><TD>        private static boolean isNegated(Expression expression) {</TD></TR><TR CLASS="z"><TD CLASS="l">1451</TD><TD>                if (!(expression.getParent() instanceof ParenthesizedExpression))</TD></TR><TR CLASS="z"><TD CLASS="l">1452</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1453</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">1454</TD><TD>                ParenthesizedExpression parenthesis= (ParenthesizedExpression)expression.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">1455</TD><TD>                if (!(parenthesis.getParent() instanceof PrefixExpression))</TD></TR><TR CLASS="z"><TD CLASS="l">1456</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1457</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">1458</TD><TD>                PrefixExpression prefix= (PrefixExpression)parenthesis.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">1459</TD><TD>                if (!(prefix.getOperator() == PrefixExpression.Operator.NOT))</TD></TR><TR CLASS="z"><TD CLASS="l">1460</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l"><A NAME="36">1461</A></TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">1462</TD><TD>                return true;</TD></TR><TR><TD CLASS="l">1463</TD><TD>        }</TD></TR><TR><TD CLASS="l">1464</TD><TD>        private static String[] suggestLocalVariableNames(IJavaScriptUnit cu, ITypeBinding binding) {</TD></TR><TR CLASS="z"><TD CLASS="l">1465</TD><TD>                return StubUtility.getVariableNameSuggestions(StubUtility.LOCAL, cu.getJavaScriptProject(), binding, null, null);</TD></TR><TR><TD CLASS="l"><A NAME="23">1466</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">1467</TD><TD> </TD></TR><TR><TD CLASS="l">1468</TD><TD>        private static boolean getPickOutStringProposals(IInvocationContext context, ASTNode node, Collection resultingCollections) {</TD></TR><TR><TD CLASS="l">1469</TD><TD>                // we work with String's</TD></TR><TR CLASS="z"><TD CLASS="l">1470</TD><TD>                if (!(node instanceof StringLiteral)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1471</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1472</TD><TD>                }</TD></TR><TR><TD CLASS="l">1473</TD><TD>                // user should select part of String</TD></TR><TR CLASS="z"><TD CLASS="l">1474</TD><TD>                int selectionPos= context.getSelectionOffset();</TD></TR><TR CLASS="z"><TD CLASS="l">1475</TD><TD>                int selectionLen= context.getSelectionLength();</TD></TR><TR CLASS="z"><TD CLASS="l">1476</TD><TD>                if (selectionLen == 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1477</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1478</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1479</TD><TD>                int valueStart= node.getStartPosition() + 1;</TD></TR><TR CLASS="z"><TD CLASS="l">1480</TD><TD>                int valueEnd= node.getStartPosition() + node.getLength() - 1;</TD></TR><TR><TD CLASS="l">1481</TD><TD> </TD></TR><TR><TD CLASS="l">1482</TD><TD>                // selection must be inside node and the quotes and not contain the full value</TD></TR><TR CLASS="z"><TD CLASS="l">1483</TD><TD>                if ((selectionPos &lt; valueStart) || (selectionPos + selectionLen &gt; valueEnd) || (valueEnd - valueStart == selectionLen)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1484</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1485</TD><TD>                }</TD></TR><TR><TD CLASS="l">1486</TD><TD> </TD></TR><TR><TD CLASS="l">1487</TD><TD>                // prepare string parts positions</TD></TR><TR CLASS="z"><TD CLASS="l">1488</TD><TD>                StringLiteral stringLiteral= (StringLiteral) node;</TD></TR><TR CLASS="z"><TD CLASS="l">1489</TD><TD>                String stringValue= stringLiteral.getEscapedValue();</TD></TR><TR><TD CLASS="l">1490</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1491</TD><TD>                int firstPos= selectionPos - node.getStartPosition();</TD></TR><TR CLASS="z"><TD CLASS="l">1492</TD><TD>                int secondPos= firstPos + selectionLen;</TD></TR><TR><TD CLASS="l">1493</TD><TD> </TD></TR><TR><TD CLASS="l">1494</TD><TD> </TD></TR><TR><TD CLASS="l">1495</TD><TD>                // prepare new string literals</TD></TR><TR><TD CLASS="l">1496</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1497</TD><TD>                AST ast= node.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">1498</TD><TD>                StringLiteral leftLiteral= ast.newStringLiteral();</TD></TR><TR CLASS="z"><TD CLASS="l">1499</TD><TD>                StringLiteral centerLiteral= ast.newStringLiteral();</TD></TR><TR CLASS="z"><TD CLASS="l">1500</TD><TD>                StringLiteral rightLiteral= ast.newStringLiteral();</TD></TR><TR><TD CLASS="l">1501</TD><TD>                try {</TD></TR><TR CLASS="z"><TD CLASS="l">1502</TD><TD>                        leftLiteral.setEscapedValue('&#34;' + stringValue.substring(1, firstPos) + '&#34;');</TD></TR><TR CLASS="z"><TD CLASS="l">1503</TD><TD>                        centerLiteral.setEscapedValue('&#34;' + stringValue.substring(firstPos, secondPos) + '&#34;');</TD></TR><TR CLASS="z"><TD CLASS="l">1504</TD><TD>                        rightLiteral.setEscapedValue('&#34;' + stringValue.substring(secondPos, stringValue.length() - 1)  + '&#34;');</TD></TR><TR CLASS="z"><TD CLASS="l">1505</TD><TD>                } catch (IllegalArgumentException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">1506</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1507</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1508</TD><TD>                if (resultingCollections == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1509</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">1510</TD><TD>                }</TD></TR><TR><TD CLASS="l">1511</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1512</TD><TD>                ASTRewrite rewrite= ASTRewrite.create(ast);</TD></TR><TR><TD CLASS="l">1513</TD><TD> </TD></TR><TR><TD CLASS="l">1514</TD><TD>                // prepare new expression instead of StringLiteral</TD></TR><TR CLASS="z"><TD CLASS="l">1515</TD><TD>                InfixExpression expression= ast.newInfixExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">1516</TD><TD>                expression.setOperator(InfixExpression.Operator.PLUS);</TD></TR><TR CLASS="z"><TD CLASS="l">1517</TD><TD>                if (firstPos != 1 ) {</TD></TR><TR CLASS="z"><TD CLASS="l">1518</TD><TD>                        expression.setLeftOperand(leftLiteral);</TD></TR><TR><TD CLASS="l">1519</TD><TD>                }</TD></TR><TR><TD CLASS="l">1520</TD><TD> </TD></TR><TR><TD CLASS="l">1521</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1522</TD><TD>                if (firstPos == 1) {</TD></TR><TR CLASS="z"><TD CLASS="l">1523</TD><TD>                        expression.setLeftOperand(centerLiteral);</TD></TR><TR><TD CLASS="l">1524</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1525</TD><TD>                        expression.setRightOperand(centerLiteral);</TD></TR><TR><TD CLASS="l">1526</TD><TD>                }</TD></TR><TR><TD CLASS="l">1527</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1528</TD><TD>                if (secondPos &lt; stringValue.length() - 1) {</TD></TR><TR CLASS="z"><TD CLASS="l">1529</TD><TD>                        if (firstPos == 1) {</TD></TR><TR CLASS="z"><TD CLASS="l">1530</TD><TD>                                expression.setRightOperand(rightLiteral);</TD></TR><TR><TD CLASS="l">1531</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1532</TD><TD>                                expression.extendedOperands().add(rightLiteral);</TD></TR><TR><TD CLASS="l">1533</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1534</TD><TD>                }</TD></TR><TR><TD CLASS="l">1535</TD><TD>                // use new expression instead of old StirngLiteral</TD></TR><TR CLASS="z"><TD CLASS="l">1536</TD><TD>                rewrite.replace(stringLiteral, expression, null);</TD></TR><TR><TD CLASS="l">1537</TD><TD>                // add correction proposal</TD></TR><TR CLASS="z"><TD CLASS="l">1538</TD><TD>                String label= CorrectionMessages.AdvancedQuickAssistProcessor_pickSelectedString;</TD></TR><TR CLASS="z"><TD CLASS="l">1539</TD><TD>                Image image= JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">1540</TD><TD>                LinkedCorrectionProposal proposal= new LinkedCorrectionProposal(label, context.getCompilationUnit(), rewrite, 1, image);</TD></TR><TR CLASS="z"><TD CLASS="l">1541</TD><TD>                proposal.addLinkedPosition(rewrite.track(centerLiteral), true, &#34;CENTER_STRING&#34;); //$NON-NLS-1$</TD></TR><TR CLASS="z"><TD CLASS="l">1542</TD><TD>                resultingCollections.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="2a">1543</A></TD><TD>                return true;</TD></TR><TR><TD CLASS="l">1544</TD><TD>        }</TD></TR><TR><TD CLASS="l">1545</TD><TD> </TD></TR><TR><TD CLASS="l">1546</TD><TD>        private static Statement getSingleStatement(Statement statement) {</TD></TR><TR CLASS="z"><TD CLASS="l">1547</TD><TD>                if (statement instanceof Block) {</TD></TR><TR CLASS="z"><TD CLASS="l">1548</TD><TD>                        List blockStatements= ((Block) statement).statements();</TD></TR><TR CLASS="z"><TD CLASS="l">1549</TD><TD>                        if (blockStatements.size() != 1) {</TD></TR><TR CLASS="z"><TD CLASS="l">1550</TD><TD>                                return null;</TD></TR><TR><TD CLASS="l">1551</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1552</TD><TD>                        return (Statement) blockStatements.get(0);</TD></TR><TR><TD CLASS="l">1553</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="29">1554</A></TD><TD>                return statement;</TD></TR><TR><TD CLASS="l">1555</TD><TD>        }</TD></TR><TR><TD CLASS="l">1556</TD><TD> </TD></TR><TR><TD CLASS="l">1557</TD><TD>        private static boolean getReplaceIfElseWithConditionalProposals(IInvocationContext context, ASTNode node, Collection resultingCollections) {</TD></TR><TR CLASS="z"><TD CLASS="l">1558</TD><TD>                if (!(node instanceof IfStatement)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1559</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1560</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1561</TD><TD>                IfStatement ifStatement= (IfStatement) node;</TD></TR><TR CLASS="z"><TD CLASS="l">1562</TD><TD>                Statement thenStatement= getSingleStatement(ifStatement.getThenStatement());</TD></TR><TR CLASS="z"><TD CLASS="l">1563</TD><TD>                Statement elseStatement= getSingleStatement(ifStatement.getElseStatement());</TD></TR><TR CLASS="z"><TD CLASS="l">1564</TD><TD>                if (thenStatement == null || elseStatement == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1565</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1566</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1567</TD><TD>                Expression assigned= null;</TD></TR><TR CLASS="z"><TD CLASS="l">1568</TD><TD>                Expression thenExpression= null;</TD></TR><TR CLASS="z"><TD CLASS="l">1569</TD><TD>                Expression elseExpression= null;</TD></TR><TR><TD CLASS="l">1570</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">1571</TD><TD>                ITypeBinding exprBinding= null;</TD></TR><TR CLASS="z"><TD CLASS="l">1572</TD><TD>                if (thenStatement instanceof ReturnStatement &amp;&amp; elseStatement instanceof ReturnStatement) {</TD></TR><TR CLASS="z"><TD CLASS="l">1573</TD><TD>                        thenExpression= ((ReturnStatement) thenStatement).getExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">1574</TD><TD>                        elseExpression= ((ReturnStatement) elseStatement).getExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">1575</TD><TD>                        FunctionDeclaration declaration= ASTResolving.findParentMethodDeclaration(node);</TD></TR><TR CLASS="z"><TD CLASS="l">1576</TD><TD>                        if (declaration == null || declaration.isConstructor()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1577</TD><TD>                                return false;</TD></TR><TR><TD CLASS="l">1578</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1579</TD><TD>                        exprBinding= declaration.getReturnType2().resolveBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">1580</TD><TD>                } else if (thenStatement instanceof ExpressionStatement &amp;&amp; elseStatement instanceof ExpressionStatement) {</TD></TR><TR CLASS="z"><TD CLASS="l">1581</TD><TD>                        Expression inner1= ((ExpressionStatement) thenStatement).getExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">1582</TD><TD>                        Expression inner2= ((ExpressionStatement) elseStatement).getExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">1583</TD><TD>                        if (inner1 instanceof Assignment &amp;&amp; inner2 instanceof Assignment) {</TD></TR><TR CLASS="z"><TD CLASS="l">1584</TD><TD>                                Assignment assign1= (Assignment) inner1;</TD></TR><TR CLASS="z"><TD CLASS="l">1585</TD><TD>                                Assignment assign2= (Assignment) inner2;</TD></TR><TR CLASS="z"><TD CLASS="l">1586</TD><TD>                                Expression left1= assign1.getLeftHandSide();</TD></TR><TR CLASS="z"><TD CLASS="l">1587</TD><TD>                                Expression left2= assign2.getLeftHandSide();</TD></TR><TR CLASS="z"><TD CLASS="l">1588</TD><TD>                                if (left1 instanceof Name &amp;&amp; left2 instanceof Name &amp;&amp; assign1.getOperator() == assign2.getOperator()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1589</TD><TD>                                        IBinding bind1= ((Name) left1).resolveBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">1590</TD><TD>                                        IBinding bind2= ((Name) left2).resolveBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">1591</TD><TD>                                        if (bind1 == bind2 &amp;&amp; bind1 instanceof IVariableBinding) {</TD></TR><TR CLASS="z"><TD CLASS="l">1592</TD><TD>                                                assigned= left1;</TD></TR><TR CLASS="z"><TD CLASS="l">1593</TD><TD>                                                exprBinding= ((IVariableBinding) bind1).getType();</TD></TR><TR CLASS="z"><TD CLASS="l">1594</TD><TD>                                                thenExpression= assign1.getRightHandSide();</TD></TR><TR CLASS="z"><TD CLASS="l">1595</TD><TD>                                                elseExpression= assign2.getRightHandSide();</TD></TR><TR><TD CLASS="l">1596</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">1597</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1598</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1599</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1600</TD><TD>                if (thenExpression == null || elseExpression == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1601</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1602</TD><TD>                }</TD></TR><TR><TD CLASS="l">1603</TD><TD> </TD></TR><TR><TD CLASS="l">1604</TD><TD>                //  we could produce quick assist</TD></TR><TR CLASS="z"><TD CLASS="l">1605</TD><TD>                if (resultingCollections == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1606</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">1607</TD><TD>                }</TD></TR><TR><TD CLASS="l">1608</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">1609</TD><TD>                AST ast= node.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">1610</TD><TD>                ASTRewrite rewrite= ASTRewrite.create(ast);</TD></TR><TR><TD CLASS="l">1611</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">1612</TD><TD>                String label= CorrectionMessages.AdvancedQuickAssistProcessor_replaceIfWithConditional;</TD></TR><TR CLASS="z"><TD CLASS="l">1613</TD><TD>                Image image= JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">1614</TD><TD>                ASTRewriteCorrectionProposal proposal= new ASTRewriteCorrectionProposal(label, context.getCompilationUnit(), rewrite, 1, image);</TD></TR><TR><TD CLASS="l">1615</TD><TD> </TD></TR><TR><TD CLASS="l">1616</TD><TD>                </TD></TR><TR><TD CLASS="l">1617</TD><TD>                // prepare conditional expression</TD></TR><TR CLASS="z"><TD CLASS="l">1618</TD><TD>                ConditionalExpression conditionalExpression = ast.newConditionalExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">1619</TD><TD>                Expression conditionCopy= (Expression) rewrite.createCopyTarget(ifStatement.getExpression());</TD></TR><TR CLASS="z"><TD CLASS="l">1620</TD><TD>                conditionalExpression.setExpression(conditionCopy);</TD></TR><TR CLASS="z"><TD CLASS="l">1621</TD><TD>                Expression thenCopy= (Expression) rewrite.createCopyTarget(thenExpression);</TD></TR><TR CLASS="z"><TD CLASS="l">1622</TD><TD>                Expression elseCopy= (Expression) rewrite.createCopyTarget(elseExpression);</TD></TR><TR><TD CLASS="l">1623</TD><TD> </TD></TR><TR><TD CLASS="l">1624</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">1625</TD><TD>                if (!JavaModelUtil.is50OrHigher(context.getCompilationUnit().getJavaScriptProject())) {</TD></TR><TR CLASS="z"><TD CLASS="l">1626</TD><TD>                        ITypeBinding thenBinding= thenExpression.resolveTypeBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">1627</TD><TD>                        ITypeBinding elseBinding= elseExpression.resolveTypeBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">1628</TD><TD>                        if (thenBinding != null &amp;&amp; elseBinding != null &amp;&amp; exprBinding != null &amp;&amp; !elseBinding.isAssignmentCompatible(thenBinding)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1629</TD><TD>                                CastExpression castException= ast.newCastExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">1630</TD><TD>                                proposal.createImportRewrite(context.getASTRoot());</TD></TR><TR CLASS="z"><TD CLASS="l">1631</TD><TD>                                castException.setType(proposal.getImportRewrite().addImport(exprBinding, ast));</TD></TR><TR CLASS="z"><TD CLASS="l">1632</TD><TD>                                castException.setExpression(elseCopy);</TD></TR><TR CLASS="z"><TD CLASS="l">1633</TD><TD>                                elseCopy= castException;</TD></TR><TR><TD CLASS="l">1634</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1635</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1636</TD><TD>                conditionalExpression.setThenExpression(thenCopy);</TD></TR><TR CLASS="z"><TD CLASS="l">1637</TD><TD>                conditionalExpression.setElseExpression(elseCopy);</TD></TR><TR><TD CLASS="l">1638</TD><TD>                </TD></TR><TR><TD CLASS="l">1639</TD><TD>                // replace 'if' statement with conditional expression</TD></TR><TR CLASS="z"><TD CLASS="l">1640</TD><TD>                if (assigned == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1641</TD><TD>                        ReturnStatement returnStatement = ast.newReturnStatement();</TD></TR><TR CLASS="z"><TD CLASS="l">1642</TD><TD>                        returnStatement.setExpression(conditionalExpression);</TD></TR><TR CLASS="z"><TD CLASS="l">1643</TD><TD>                        rewrite.replace(ifStatement, returnStatement, null);</TD></TR><TR><TD CLASS="l">1644</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1645</TD><TD>                        Assignment assignment= ast.newAssignment();</TD></TR><TR CLASS="z"><TD CLASS="l">1646</TD><TD>                        assignment.setLeftHandSide((Expression) rewrite.createCopyTarget(assigned));</TD></TR><TR CLASS="z"><TD CLASS="l">1647</TD><TD>                        assignment.setRightHandSide(conditionalExpression);</TD></TR><TR CLASS="z"><TD CLASS="l">1648</TD><TD>                        assignment.setOperator(((Assignment) assigned.getParent()).getOperator());</TD></TR><TR><TD CLASS="l">1649</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">1650</TD><TD>                        ExpressionStatement expressionStatement = ast.newExpressionStatement(assignment);</TD></TR><TR CLASS="z"><TD CLASS="l">1651</TD><TD>                        rewrite.replace(ifStatement, expressionStatement, null);</TD></TR><TR><TD CLASS="l">1652</TD><TD>                }</TD></TR><TR><TD CLASS="l">1653</TD><TD> </TD></TR><TR><TD CLASS="l">1654</TD><TD>                // add correction proposal</TD></TR><TR CLASS="z"><TD CLASS="l">1655</TD><TD>                resultingCollections.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="6">1656</A></TD><TD>                return true;</TD></TR><TR><TD CLASS="l">1657</TD><TD>        }</TD></TR><TR><TD CLASS="l">1658</TD><TD> </TD></TR><TR><TD CLASS="l">1659</TD><TD>        private static ReturnStatement createReturnExpression(ASTRewrite rewrite, Expression expression) {</TD></TR><TR CLASS="z"><TD CLASS="l">1660</TD><TD>                AST ast= rewrite.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">1661</TD><TD>                ReturnStatement thenReturn = ast.newReturnStatement();</TD></TR><TR CLASS="z"><TD CLASS="l">1662</TD><TD>                thenReturn.setExpression((Expression) rewrite.createCopyTarget(expression));</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="5">1663</A></TD><TD>                return thenReturn;</TD></TR><TR><TD CLASS="l">1664</TD><TD>        }</TD></TR><TR><TD CLASS="l">1665</TD><TD> </TD></TR><TR><TD CLASS="l">1666</TD><TD>        private static Statement createAssignmentStatement(ASTRewrite rewrite, Assignment.Operator assignmentOperator, Expression origAssignee, Expression origAssigned) {</TD></TR><TR CLASS="z"><TD CLASS="l">1667</TD><TD>                AST ast= rewrite.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">1668</TD><TD>                Assignment elseAssignment= ast.newAssignment();</TD></TR><TR CLASS="z"><TD CLASS="l">1669</TD><TD>                elseAssignment.setOperator(assignmentOperator);</TD></TR><TR CLASS="z"><TD CLASS="l">1670</TD><TD>                elseAssignment.setLeftHandSide((Expression) rewrite.createCopyTarget(origAssignee));</TD></TR><TR CLASS="z"><TD CLASS="l">1671</TD><TD>                elseAssignment.setRightHandSide((Expression) rewrite.createCopyTarget(origAssigned));</TD></TR><TR CLASS="z"><TD CLASS="l">1672</TD><TD>                ExpressionStatement statement = ast.newExpressionStatement(elseAssignment);</TD></TR><TR CLASS="z"><TD CLASS="l">1673</TD><TD>                return statement;</TD></TR><TR><TD CLASS="l"><A NAME="28">1674</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">1675</TD><TD> </TD></TR><TR><TD CLASS="l">1676</TD><TD>        private static boolean getReplaceConditionalWithIfElseProposals(IInvocationContext context, ASTNode covering, Collection resultingCollections) {</TD></TR><TR><TD CLASS="l">1677</TD><TD>                // check that parent statement is assignment</TD></TR><TR CLASS="z"><TD CLASS="l">1678</TD><TD>                while (!(covering instanceof ConditionalExpression) &amp;&amp; covering instanceof Expression) {</TD></TR><TR CLASS="z"><TD CLASS="l">1679</TD><TD>                        covering= covering.getParent();</TD></TR><TR><TD CLASS="l">1680</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1681</TD><TD>                if (!(covering instanceof ConditionalExpression)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1682</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1683</TD><TD>                }</TD></TR><TR><TD CLASS="l">1684</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1685</TD><TD>                StructuralPropertyDescriptor locationInParent= covering.getLocationInParent();</TD></TR><TR CLASS="z"><TD CLASS="l">1686</TD><TD>                if (locationInParent == Assignment.RIGHT_HAND_SIDE_PROPERTY) {</TD></TR><TR CLASS="z"><TD CLASS="l">1687</TD><TD>                        if (covering.getParent().getLocationInParent() != ExpressionStatement.EXPRESSION_PROPERTY) {</TD></TR><TR CLASS="z"><TD CLASS="l">1688</TD><TD>                                return false;</TD></TR><TR><TD CLASS="l">1689</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1690</TD><TD>                } else if (locationInParent == VariableDeclarationFragment.INITIALIZER_PROPERTY) {</TD></TR><TR CLASS="z"><TD CLASS="l">1691</TD><TD>                        ASTNode statement= covering.getParent().getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">1692</TD><TD>                        if (!(statement instanceof VariableDeclarationStatement) || statement.getLocationInParent() != Block.STATEMENTS_PROPERTY) {</TD></TR><TR CLASS="z"><TD CLASS="l">1693</TD><TD>                                return false;</TD></TR><TR><TD CLASS="l">1694</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1695</TD><TD>                } else if (locationInParent != ReturnStatement.EXPRESSION_PROPERTY) {</TD></TR><TR CLASS="z"><TD CLASS="l">1696</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1697</TD><TD>                }</TD></TR><TR><TD CLASS="l">1698</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1699</TD><TD>                ConditionalExpression conditional= (ConditionalExpression) covering;</TD></TR><TR><TD CLASS="l">1700</TD><TD>                //  we could produce quick assist</TD></TR><TR CLASS="z"><TD CLASS="l">1701</TD><TD>                if (resultingCollections == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1702</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">1703</TD><TD>                }</TD></TR><TR><TD CLASS="l">1704</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">1705</TD><TD>                AST ast= covering.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">1706</TD><TD>                ASTRewrite rewrite= ASTRewrite.create(ast);</TD></TR><TR><TD CLASS="l">1707</TD><TD>                // prepare new 'if' statement</TD></TR><TR CLASS="z"><TD CLASS="l">1708</TD><TD>                Expression expression= conditional.getExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">1709</TD><TD>                while (expression instanceof ParenthesizedExpression) {</TD></TR><TR CLASS="z"><TD CLASS="l">1710</TD><TD>                        expression= ((ParenthesizedExpression) expression).getExpression();</TD></TR><TR><TD CLASS="l">1711</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1712</TD><TD>                IfStatement ifStatement= ast.newIfStatement();</TD></TR><TR CLASS="z"><TD CLASS="l">1713</TD><TD>                ifStatement.setExpression((Expression) rewrite.createCopyTarget(expression));</TD></TR><TR CLASS="z"><TD CLASS="l">1714</TD><TD>                if (locationInParent == Assignment.RIGHT_HAND_SIDE_PROPERTY) {</TD></TR><TR CLASS="z"><TD CLASS="l">1715</TD><TD>                        Assignment assignment= (Assignment) covering.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">1716</TD><TD>                        Expression assignee= assignment.getLeftHandSide();</TD></TR><TR CLASS="z"><TD CLASS="l">1717</TD><TD>                        Assignment.Operator op= assignment.getOperator();</TD></TR><TR><TD CLASS="l">1718</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">1719</TD><TD>                        ifStatement.setThenStatement(createAssignmentStatement(rewrite, op, assignee, conditional.getThenExpression()));</TD></TR><TR CLASS="z"><TD CLASS="l">1720</TD><TD>                        ifStatement.setElseStatement(createAssignmentStatement(rewrite, op, assignee, conditional.getElseExpression()));</TD></TR><TR><TD CLASS="l">1721</TD><TD> </TD></TR><TR><TD CLASS="l">1722</TD><TD>                        // replace return conditional expression with if/then/else/return</TD></TR><TR CLASS="z"><TD CLASS="l">1723</TD><TD>                        rewrite.replace(covering.getParent().getParent(), ifStatement, null);</TD></TR><TR><TD CLASS="l">1724</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1725</TD><TD>                } else if (locationInParent == ReturnStatement.EXPRESSION_PROPERTY) {</TD></TR><TR CLASS="z"><TD CLASS="l">1726</TD><TD>                        ifStatement.setThenStatement(createReturnExpression(rewrite, conditional.getThenExpression()));</TD></TR><TR CLASS="z"><TD CLASS="l">1727</TD><TD>                        ifStatement.setElseStatement(createReturnExpression(rewrite, conditional.getElseExpression()));</TD></TR><TR><TD CLASS="l">1728</TD><TD>                        //</TD></TR><TR><TD CLASS="l">1729</TD><TD>                        // replace return conditional expression with if/then/else/return</TD></TR><TR CLASS="z"><TD CLASS="l">1730</TD><TD>                        rewrite.replace(conditional.getParent(), ifStatement, null);</TD></TR><TR CLASS="z"><TD CLASS="l">1731</TD><TD>                } else if (locationInParent == VariableDeclarationFragment.INITIALIZER_PROPERTY) {</TD></TR><TR CLASS="z"><TD CLASS="l">1732</TD><TD>                        VariableDeclarationFragment frag= (VariableDeclarationFragment) covering.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">1733</TD><TD>                        Assignment.Operator op= Assignment.Operator.ASSIGN;</TD></TR><TR><TD CLASS="l">1734</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">1735</TD><TD>                        Expression assignee= frag.getName();</TD></TR><TR CLASS="z"><TD CLASS="l">1736</TD><TD>                        ifStatement.setThenStatement(createAssignmentStatement(rewrite, op, assignee, conditional.getThenExpression()));</TD></TR><TR CLASS="z"><TD CLASS="l">1737</TD><TD>                        ifStatement.setElseStatement(createAssignmentStatement(rewrite, op, assignee, conditional.getElseExpression()));</TD></TR><TR><TD CLASS="l">1738</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1739</TD><TD>                        rewrite.set(frag, VariableDeclarationFragment.INITIALIZER_PROPERTY, null, null); // clear initializer</TD></TR><TR><TD CLASS="l">1740</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1741</TD><TD>                        ASTNode statement= frag.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">1742</TD><TD>                        rewrite.getListRewrite(statement.getParent(), Block.STATEMENTS_PROPERTY).insertAfter(ifStatement, statement, null);</TD></TR><TR><TD CLASS="l">1743</TD><TD>                }</TD></TR><TR><TD CLASS="l">1744</TD><TD> </TD></TR><TR><TD CLASS="l">1745</TD><TD>                // add correction proposal</TD></TR><TR CLASS="z"><TD CLASS="l">1746</TD><TD>                String label= CorrectionMessages.AdvancedQuickAssistProcessor_replaceConditionalWithIf;</TD></TR><TR CLASS="z"><TD CLASS="l">1747</TD><TD>                Image image= JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">1748</TD><TD>                ASTRewriteCorrectionProposal proposal= new ASTRewriteCorrectionProposal(label, context.getCompilationUnit(), rewrite, 1, image);</TD></TR><TR CLASS="z"><TD CLASS="l">1749</TD><TD>                resultingCollections.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l">1750</TD><TD>                return true;</TD></TR><TR><TD CLASS="l"><A NAME="18">1751</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">1752</TD><TD>        private static boolean getInverseLocalVariableProposals(IInvocationContext context,</TD></TR><TR><TD CLASS="l">1753</TD><TD>                        ASTNode covering,</TD></TR><TR><TD CLASS="l">1754</TD><TD>                        Collection resultingCollections) {</TD></TR><TR CLASS="z"><TD CLASS="l">1755</TD><TD>                final AST ast= covering.getAST();</TD></TR><TR><TD CLASS="l">1756</TD><TD>                // cursor should be placed on variable name</TD></TR><TR CLASS="z"><TD CLASS="l">1757</TD><TD>                if (!(covering instanceof SimpleName)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1758</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1759</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1760</TD><TD>                SimpleName coveringName= (SimpleName) covering;</TD></TR><TR CLASS="z"><TD CLASS="l">1761</TD><TD>                if (!coveringName.isDeclaration()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1762</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1763</TD><TD>                }</TD></TR><TR><TD CLASS="l">1764</TD><TD>                // prepare bindings</TD></TR><TR CLASS="z"><TD CLASS="l">1765</TD><TD>                final IBinding variableBinding= coveringName.resolveBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">1766</TD><TD>                if (!(variableBinding instanceof IVariableBinding)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1767</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1768</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1769</TD><TD>                IVariableBinding binding= (IVariableBinding) variableBinding;</TD></TR><TR CLASS="z"><TD CLASS="l">1770</TD><TD>                if (binding.isField()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1771</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1772</TD><TD>                }</TD></TR><TR><TD CLASS="l">1773</TD><TD>                // we operate only on boolean variable</TD></TR><TR CLASS="z"><TD CLASS="l">1774</TD><TD>                if (!isBoolean(coveringName)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1775</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1776</TD><TD>                }</TD></TR><TR><TD CLASS="l">1777</TD><TD>                //  we could produce quick assist</TD></TR><TR CLASS="z"><TD CLASS="l">1778</TD><TD>                if (resultingCollections == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1779</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">1780</TD><TD>                }</TD></TR><TR><TD CLASS="l">1781</TD><TD>                // find linked nodes</TD></TR><TR CLASS="z"><TD CLASS="l">1782</TD><TD>                final FunctionDeclaration method= ASTResolving.findParentMethodDeclaration(covering);</TD></TR><TR CLASS="z"><TD CLASS="l">1783</TD><TD>                SimpleName[] linkedNodes= LinkedNodeFinder.findByBinding(method, variableBinding);</TD></TR><TR><TD CLASS="l">1784</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">1785</TD><TD>                final ASTRewrite rewrite= ASTRewrite.create(ast);</TD></TR><TR><TD CLASS="l">1786</TD><TD>                // create proposal</TD></TR><TR CLASS="z"><TD CLASS="l">1787</TD><TD>                String label= CorrectionMessages.AdvancedQuickAssistProcessor_inverseBooleanVariable;</TD></TR><TR CLASS="z"><TD CLASS="l">1788</TD><TD>                Image image= JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">1789</TD><TD>                final String KEY_NAME= &#34;name&#34;; //$NON-NLS-1$</TD></TR><TR CLASS="z"><TD CLASS="l">1790</TD><TD>                final LinkedCorrectionProposal proposal= new LinkedCorrectionProposal(label,</TD></TR><TR CLASS="z"><TD CLASS="l">1791</TD><TD>                        context.getCompilationUnit(),</TD></TR><TR CLASS="z"><TD CLASS="l">1792</TD><TD>                        rewrite,</TD></TR><TR CLASS="z"><TD CLASS="l">1793</TD><TD>                        1,</TD></TR><TR CLASS="z"><TD CLASS="l">1794</TD><TD>                        image);</TD></TR><TR><TD CLASS="l">1795</TD><TD>                // prepare new variable identifier</TD></TR><TR CLASS="z"><TD CLASS="l">1796</TD><TD>                final String oldIdentifier= coveringName.getIdentifier();</TD></TR><TR CLASS="z"><TD CLASS="l">1797</TD><TD>                final String notString = Messages.format(CorrectionMessages.AdvancedQuickAssistProcessor_negatedVariableName, &#34;&#34;);  //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">1798</TD><TD>                final String newIdentifier;</TD></TR><TR CLASS="z"><TD CLASS="l">1799</TD><TD>                if (oldIdentifier.startsWith(notString)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1800</TD><TD>                        int notLength= notString.length();</TD></TR><TR CLASS="z"><TD CLASS="l">1801</TD><TD>                        if (oldIdentifier.length() &gt; notLength) {</TD></TR><TR CLASS="z"><TD CLASS="l">1802</TD><TD>                                newIdentifier= Character.toLowerCase(oldIdentifier.charAt(notLength)) + oldIdentifier.substring(notLength + 1);</TD></TR><TR><TD CLASS="l">1803</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1804</TD><TD>                                newIdentifier= oldIdentifier;</TD></TR><TR><TD CLASS="l">1805</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1806</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1807</TD><TD>                        newIdentifier= Messages.format(CorrectionMessages.AdvancedQuickAssistProcessor_negatedVariableName, Character.toUpperCase(oldIdentifier.charAt(0)) + oldIdentifier.substring(1));</TD></TR><TR><TD CLASS="l">1808</TD><TD>                }</TD></TR><TR><TD CLASS="l">1809</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">1810</TD><TD>                proposal.addLinkedPositionProposal(KEY_NAME, newIdentifier, null);</TD></TR><TR CLASS="z"><TD CLASS="l">1811</TD><TD>                proposal.addLinkedPositionProposal(KEY_NAME, oldIdentifier, null);</TD></TR><TR><TD CLASS="l">1812</TD><TD>                // iterate over linked nodes and replace variable references with negated reference</TD></TR><TR CLASS="z"><TD CLASS="l">1813</TD><TD>                final HashSet renamedNames= new HashSet();</TD></TR><TR CLASS="z"><TD CLASS="l">1814</TD><TD>                for (int i= 0; i &lt; linkedNodes.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1815</TD><TD>                        SimpleName name= linkedNodes[i];</TD></TR><TR CLASS="z"><TD CLASS="l">1816</TD><TD>                        if (renamedNames.contains(name)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1817</TD><TD>                                continue;</TD></TR><TR><TD CLASS="l">1818</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1819</TD><TD>                        // prepare new name with new identifier</TD></TR><TR CLASS="z"><TD CLASS="l">1820</TD><TD>                        SimpleName newName= ast.newSimpleName(newIdentifier);</TD></TR><TR CLASS="z"><TD CLASS="l">1821</TD><TD>                        proposal.addLinkedPosition(rewrite.track(newName), name == coveringName, KEY_NAME);</TD></TR><TR><TD CLASS="l">1822</TD><TD>                        //</TD></TR><TR CLASS="z"><TD CLASS="l">1823</TD><TD>                        StructuralPropertyDescriptor location= name.getLocationInParent();</TD></TR><TR CLASS="z"><TD CLASS="l">1824</TD><TD>                        if (location == SingleVariableDeclaration.NAME_PROPERTY) {</TD></TR><TR><TD CLASS="l">1825</TD><TD>                                // set new name</TD></TR><TR CLASS="z"><TD CLASS="l">1826</TD><TD>                                rewrite.replace(name, newName, null);</TD></TR><TR CLASS="z"><TD CLASS="l">1827</TD><TD>                        } else if (location == Assignment.LEFT_HAND_SIDE_PROPERTY) {</TD></TR><TR CLASS="z"><TD CLASS="l">1828</TD><TD>                                Assignment assignment= (Assignment) name.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">1829</TD><TD>                                Expression expression= assignment.getRightHandSide();</TD></TR><TR CLASS="z"><TD CLASS="l">1830</TD><TD>                                int exStart= expression.getStartPosition();</TD></TR><TR CLASS="z"><TD CLASS="l">1831</TD><TD>                                int exEnd= exStart + expression.getLength();</TD></TR><TR><TD CLASS="l">1832</TD><TD>                                // collect all names that are used in assignments</TD></TR><TR CLASS="z"><TD CLASS="l">1833</TD><TD>                                HashSet overlapNames= new HashSet();</TD></TR><TR CLASS="z"><TD CLASS="l">1834</TD><TD>                                for (int j= 0; j &lt; linkedNodes.length; j++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1835</TD><TD>                                        SimpleName name2= linkedNodes[j];</TD></TR><TR CLASS="z"><TD CLASS="l">1836</TD><TD>                                        if (name2 == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1837</TD><TD>                                                continue;</TD></TR><TR><TD CLASS="l">1838</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1839</TD><TD>                                        int name2Start= name2.getStartPosition();</TD></TR><TR CLASS="z"><TD CLASS="l">1840</TD><TD>                                        if (exStart &lt;= name2Start &amp;&amp; name2Start &lt; exEnd) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="3b">1841</A></TD><TD>                                                overlapNames.add(name2);</TD></TR><TR><TD CLASS="l">1842</TD><TD>                                        }</TD></TR><TR><TD CLASS="l"><A NAME="3d">1843</A></TD><TD>                                }</TD></TR><TR><TD CLASS="l">1844</TD><TD>                                // prepare inverted expression</TD></TR><TR CLASS="z"><TD CLASS="l">1845</TD><TD>                                SimpleNameRenameProvider provider= new SimpleNameRenameProvider() {</TD></TR><TR><TD CLASS="l">1846</TD><TD>                                        public SimpleName getRenamed(SimpleName simpleName) {</TD></TR><TR CLASS="z"><TD CLASS="l">1847</TD><TD>                                                if (simpleName.resolveBinding() == variableBinding) {</TD></TR><TR CLASS="z"><TD CLASS="l">1848</TD><TD>                                                        renamedNames.add(simpleName);</TD></TR><TR CLASS="z"><TD CLASS="l">1849</TD><TD>                                                        return ast.newSimpleName(newIdentifier);</TD></TR><TR><TD CLASS="l">1850</TD><TD>                                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1851</TD><TD>                                                return null;</TD></TR><TR><TD CLASS="l">1852</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">1853</TD><TD>                                };</TD></TR><TR CLASS="z"><TD CLASS="l">1854</TD><TD>                                Expression inversedExpression= getInversedBooleanExpression(rewrite, expression, provider);</TD></TR><TR><TD CLASS="l">1855</TD><TD>                                // if any name was not renamed during expression inverting, we can not already rename it, so fail to create assist</TD></TR><TR CLASS="z"><TD CLASS="l">1856</TD><TD>                                for (Iterator iter= overlapNames.iterator(); iter.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">1857</TD><TD>                                        Object o= iter.next();</TD></TR><TR CLASS="z"><TD CLASS="l">1858</TD><TD>                                        if (!renamedNames.contains(o)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1859</TD><TD>                                                return false;</TD></TR><TR><TD CLASS="l">1860</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">1861</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1862</TD><TD>                                // check operator and replace if needed</TD></TR><TR CLASS="z"><TD CLASS="l">1863</TD><TD>                                Assignment.Operator operator= assignment.getOperator();</TD></TR><TR CLASS="z"><TD CLASS="l">1864</TD><TD>                                if (operator == Assignment.Operator.BIT_AND_ASSIGN) {</TD></TR><TR CLASS="z"><TD CLASS="l">1865</TD><TD>                                        Assignment newAssignment= ast.newAssignment();</TD></TR><TR CLASS="z"><TD CLASS="l">1866</TD><TD>                                        newAssignment.setLeftHandSide(newName);</TD></TR><TR CLASS="z"><TD CLASS="l">1867</TD><TD>                                        newAssignment.setRightHandSide(inversedExpression);</TD></TR><TR CLASS="z"><TD CLASS="l">1868</TD><TD>                                        newAssignment.setOperator(Assignment.Operator.BIT_OR_ASSIGN);</TD></TR><TR CLASS="z"><TD CLASS="l">1869</TD><TD>                                        rewrite.replace(assignment, newAssignment, null);</TD></TR><TR CLASS="z"><TD CLASS="l">1870</TD><TD>                                } else if (operator == Assignment.Operator.BIT_OR_ASSIGN) {</TD></TR><TR CLASS="z"><TD CLASS="l">1871</TD><TD>                                        Assignment newAssignment= ast.newAssignment();</TD></TR><TR CLASS="z"><TD CLASS="l">1872</TD><TD>                                        newAssignment.setLeftHandSide(newName);</TD></TR><TR CLASS="z"><TD CLASS="l">1873</TD><TD>                                        newAssignment.setRightHandSide(inversedExpression);</TD></TR><TR CLASS="z"><TD CLASS="l">1874</TD><TD>                                        newAssignment.setOperator(Assignment.Operator.BIT_AND_ASSIGN);</TD></TR><TR CLASS="z"><TD CLASS="l">1875</TD><TD>                                        rewrite.replace(assignment, newAssignment, null);</TD></TR><TR><TD CLASS="l">1876</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1877</TD><TD>                                        rewrite.replace(expression, inversedExpression, null);</TD></TR><TR><TD CLASS="l">1878</TD><TD>                                        // set new name</TD></TR><TR CLASS="z"><TD CLASS="l">1879</TD><TD>                                        rewrite.replace(name, newName, null);</TD></TR><TR><TD CLASS="l">1880</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1881</TD><TD>                        } else if (location == VariableDeclarationFragment.NAME_PROPERTY) {</TD></TR><TR><TD CLASS="l">1882</TD><TD>                                // replace initializer for variable</TD></TR><TR CLASS="z"><TD CLASS="l">1883</TD><TD>                                VariableDeclarationFragment vdf= (VariableDeclarationFragment) name.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">1884</TD><TD>                                Expression expression= vdf.getInitializer();</TD></TR><TR CLASS="z"><TD CLASS="l">1885</TD><TD>                                if (expression != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1886</TD><TD>                                        rewrite.replace(expression, getInversedBooleanExpression(rewrite, expression), null);</TD></TR><TR><TD CLASS="l">1887</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1888</TD><TD>                                // set new name</TD></TR><TR CLASS="z"><TD CLASS="l">1889</TD><TD>                                rewrite.replace(name, newName, null);</TD></TR><TR CLASS="z"><TD CLASS="l">1890</TD><TD>                        } else if ((name.getParent() instanceof PrefixExpression)</TD></TR><TR CLASS="z"><TD CLASS="l">1891</TD><TD>                                &amp;&amp; (((PrefixExpression) name.getParent()).getOperator() == PrefixExpression.Operator.NOT)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1892</TD><TD>                                rewrite.replace(name.getParent(), newName, null);</TD></TR><TR><TD CLASS="l">1893</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1894</TD><TD>                                PrefixExpression expression= ast.newPrefixExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">1895</TD><TD>                                expression.setOperator(PrefixExpression.Operator.NOT);</TD></TR><TR CLASS="z"><TD CLASS="l">1896</TD><TD>                                expression.setOperand(newName);</TD></TR><TR CLASS="z"><TD CLASS="l">1897</TD><TD>                                rewrite.replace(name, expression, null);</TD></TR><TR><TD CLASS="l">1898</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1899</TD><TD>                }</TD></TR><TR><TD CLASS="l">1900</TD><TD>                // add correction proposal</TD></TR><TR CLASS="z"><TD CLASS="l">1901</TD><TD>                resultingCollections.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l">1902</TD><TD>                return true;</TD></TR><TR><TD CLASS="l"><A NAME="25">1903</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">1904</TD><TD>        private static boolean getPushNegationDownProposals(IInvocationContext context,</TD></TR><TR><TD CLASS="l">1905</TD><TD>                        ASTNode covering,</TD></TR><TR><TD CLASS="l">1906</TD><TD>                        Collection resultingCollections) {</TD></TR><TR CLASS="z"><TD CLASS="l">1907</TD><TD>                PrefixExpression negationExpression= null;</TD></TR><TR CLASS="z"><TD CLASS="l">1908</TD><TD>                ParenthesizedExpression parenthesizedExpression= null;</TD></TR><TR><TD CLASS="l">1909</TD><TD>                // check for case when cursor is on '!' before parentheses</TD></TR><TR CLASS="z"><TD CLASS="l">1910</TD><TD>                if (covering instanceof PrefixExpression) {</TD></TR><TR CLASS="z"><TD CLASS="l">1911</TD><TD>                        PrefixExpression prefixExpression= (PrefixExpression) covering;</TD></TR><TR CLASS="z"><TD CLASS="l">1912</TD><TD>                        if ((prefixExpression.getOperator() == PrefixExpression.Operator.NOT)</TD></TR><TR CLASS="z"><TD CLASS="l">1913</TD><TD>                                &amp;&amp; (prefixExpression.getOperand() instanceof ParenthesizedExpression)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1914</TD><TD>                                negationExpression= prefixExpression;</TD></TR><TR CLASS="z"><TD CLASS="l">1915</TD><TD>                                parenthesizedExpression= (ParenthesizedExpression) prefixExpression.getOperand();</TD></TR><TR><TD CLASS="l">1916</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1917</TD><TD>                }</TD></TR><TR><TD CLASS="l">1918</TD><TD>                // check for case when cursor is on parenthesized expression that is negated</TD></TR><TR CLASS="z"><TD CLASS="l">1919</TD><TD>                if ((covering instanceof ParenthesizedExpression)</TD></TR><TR CLASS="z"><TD CLASS="l">1920</TD><TD>                        &amp;&amp; (covering.getParent() instanceof PrefixExpression)</TD></TR><TR CLASS="z"><TD CLASS="l">1921</TD><TD>                        &amp;&amp; (((PrefixExpression) covering.getParent()).getOperator() == PrefixExpression.Operator.NOT)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1922</TD><TD>                        negationExpression= (PrefixExpression) covering.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">1923</TD><TD>                        parenthesizedExpression= (ParenthesizedExpression) covering;</TD></TR><TR><TD CLASS="l">1924</TD><TD>                }</TD></TR><TR><TD CLASS="l">1925</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">1926</TD><TD>                if (negationExpression == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1927</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">1928</TD><TD>                }</TD></TR><TR><TD CLASS="l">1929</TD><TD>                //  we could produce quick assist</TD></TR><TR CLASS="z"><TD CLASS="l">1930</TD><TD>                if (resultingCollections == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1931</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">1932</TD><TD>                }</TD></TR><TR><TD CLASS="l">1933</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">1934</TD><TD>                final AST ast= covering.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">1935</TD><TD>                final ASTRewrite rewrite= ASTRewrite.create(ast);</TD></TR><TR><TD CLASS="l">1936</TD><TD>                // prepared inverted expression</TD></TR><TR CLASS="z"><TD CLASS="l">1937</TD><TD>                Expression inversedExpression= getInversedBooleanExpression(rewrite, parenthesizedExpression.getExpression());</TD></TR><TR><TD CLASS="l">1938</TD><TD>                // check, may be we should keep parentheses</TD></TR><TR CLASS="z"><TD CLASS="l">1939</TD><TD>                boolean keepParentheses= false;</TD></TR><TR CLASS="z"><TD CLASS="l">1940</TD><TD>                if (negationExpression.getParent() instanceof Expression) {</TD></TR><TR CLASS="z"><TD CLASS="l">1941</TD><TD>                        int parentPrecedence= getExpressionPrecedence((Expression) negationExpression.getParent());</TD></TR><TR CLASS="z"><TD CLASS="l">1942</TD><TD>                        int inversedExpressionPrecedence= getExpressionPrecedence(inversedExpression);</TD></TR><TR CLASS="z"><TD CLASS="l">1943</TD><TD>                        keepParentheses= parentPrecedence &lt; inversedExpressionPrecedence;</TD></TR><TR><TD CLASS="l">1944</TD><TD>                }</TD></TR><TR><TD CLASS="l">1945</TD><TD>                // replace negated expression with inverted one</TD></TR><TR CLASS="z"><TD CLASS="l">1946</TD><TD>                if (keepParentheses) {</TD></TR><TR CLASS="z"><TD CLASS="l">1947</TD><TD>                        ParenthesizedExpression pe= ast.newParenthesizedExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">1948</TD><TD>                        pe.setExpression(inversedExpression);</TD></TR><TR CLASS="z"><TD CLASS="l">1949</TD><TD>                        rewrite.replace(negationExpression, pe, null);</TD></TR><TR><TD CLASS="l">1950</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1951</TD><TD>                        rewrite.replace(negationExpression, inversedExpression, null);</TD></TR><TR><TD CLASS="l">1952</TD><TD>                }</TD></TR><TR><TD CLASS="l">1953</TD><TD>                // add correction proposal</TD></TR><TR CLASS="z"><TD CLASS="l">1954</TD><TD>                String label= CorrectionMessages.AdvancedQuickAssistProcessor_pushNegationDown;</TD></TR><TR CLASS="z"><TD CLASS="l">1955</TD><TD>                Image image= JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">1956</TD><TD>                ASTRewriteCorrectionProposal proposal= new ASTRewriteCorrectionProposal(label, context.getCompilationUnit(), rewrite, 1, image);</TD></TR><TR CLASS="z"><TD CLASS="l">1957</TD><TD>                resultingCollections.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="a">1958</A></TD><TD>                return true;</TD></TR><TR><TD CLASS="l">1959</TD><TD>        }</TD></TR><TR><TD CLASS="l">1960</TD><TD>        </TD></TR><TR><TD CLASS="l">1961</TD><TD>        private static Expression getBooleanExpression(ASTNode node) {</TD></TR><TR CLASS="z"><TD CLASS="l">1962</TD><TD>                if (!(node instanceof Expression)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1963</TD><TD>                        return null;</TD></TR><TR><TD CLASS="l">1964</TD><TD>                }</TD></TR><TR><TD CLASS="l">1965</TD><TD> </TD></TR><TR><TD CLASS="l">1966</TD><TD>                // check if the node is a location where it can be negated</TD></TR><TR CLASS="z"><TD CLASS="l">1967</TD><TD>                StructuralPropertyDescriptor locationInParent= node.getLocationInParent();</TD></TR><TR CLASS="z"><TD CLASS="l">1968</TD><TD>                if (locationInParent == QualifiedName.NAME_PROPERTY) {</TD></TR><TR CLASS="z"><TD CLASS="l">1969</TD><TD>                        node= node.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">1970</TD><TD>                        locationInParent= node.getLocationInParent();</TD></TR><TR><TD CLASS="l">1971</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1972</TD><TD>                while (locationInParent == ParenthesizedExpression.EXPRESSION_PROPERTY) {</TD></TR><TR CLASS="z"><TD CLASS="l">1973</TD><TD>                        node= node.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">1974</TD><TD>                        locationInParent= node.getLocationInParent();</TD></TR><TR><TD CLASS="l">1975</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1976</TD><TD>                Expression expression= (Expression) node;</TD></TR><TR CLASS="z"><TD CLASS="l">1977</TD><TD>                if (!isBoolean(expression)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1978</TD><TD>                        return null;</TD></TR><TR><TD CLASS="l">1979</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1980</TD><TD>                if (expression.getParent() instanceof InfixExpression) {</TD></TR><TR CLASS="z"><TD CLASS="l">1981</TD><TD>                        return expression;</TD></TR><TR><TD CLASS="l">1982</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1983</TD><TD>                if (locationInParent == Assignment.RIGHT_HAND_SIDE_PROPERTY </TD></TR><TR CLASS="z"><TD CLASS="l">1984</TD><TD>                                || locationInParent == IfStatement.EXPRESSION_PROPERTY </TD></TR><TR CLASS="z"><TD CLASS="l">1985</TD><TD>                                || locationInParent == WhileStatement.EXPRESSION_PROPERTY </TD></TR><TR CLASS="z"><TD CLASS="l">1986</TD><TD>                                || locationInParent == DoStatement.EXPRESSION_PROPERTY </TD></TR><TR CLASS="z"><TD CLASS="l">1987</TD><TD>                                || locationInParent == ReturnStatement.EXPRESSION_PROPERTY </TD></TR><TR CLASS="z"><TD CLASS="l">1988</TD><TD>                                || locationInParent == ForStatement.EXPRESSION_PROPERTY </TD></TR><TR CLASS="z"><TD CLASS="l">1989</TD><TD>                                || locationInParent == FunctionInvocation.ARGUMENTS_PROPERTY </TD></TR><TR CLASS="z"><TD CLASS="l">1990</TD><TD>                                || locationInParent == ConstructorInvocation.ARGUMENTS_PROPERTY </TD></TR><TR CLASS="z"><TD CLASS="l">1991</TD><TD>                                || locationInParent == SuperMethodInvocation.ARGUMENTS_PROPERTY </TD></TR><TR CLASS="z"><TD CLASS="l">1992</TD><TD>                                || locationInParent == SuperConstructorInvocation.ARGUMENTS_PROPERTY </TD></TR><TR CLASS="z"><TD CLASS="l">1993</TD><TD>                                || locationInParent == ClassInstanceCreation.ARGUMENTS_PROPERTY </TD></TR><TR CLASS="z"><TD CLASS="l">1994</TD><TD>                                || locationInParent == ConditionalExpression.EXPRESSION_PROPERTY </TD></TR><TR CLASS="z"><TD CLASS="l">1995</TD><TD>                                || locationInParent == PrefixExpression.OPERAND_PROPERTY) {</TD></TR><TR CLASS="z"><TD CLASS="l">1996</TD><TD>                        return expression;</TD></TR><TR><TD CLASS="l">1997</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1998</TD><TD>                return null;</TD></TR><TR><TD CLASS="l">1999</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="24">2000</A></TD><TD>        </TD></TR><TR><TD CLASS="l">2001</TD><TD>        </TD></TR><TR><TD CLASS="l">2002</TD><TD>        </TD></TR><TR><TD CLASS="l">2003</TD><TD>        private static boolean getPullNegationUpProposals(IInvocationContext context, ASTNode covering, ArrayList coveredNodes, Collection resultingCollections) {</TD></TR><TR CLASS="z"><TD CLASS="l">2004</TD><TD>                if (coveredNodes.size() != 1) {</TD></TR><TR CLASS="z"><TD CLASS="l">2005</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">2006</TD><TD>                }</TD></TR><TR><TD CLASS="l">2007</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">2008</TD><TD>                ASTNode fullyCoveredNode= (ASTNode) coveredNodes.get(0);</TD></TR><TR><TD CLASS="l">2009</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">2010</TD><TD>                Expression expression= getBooleanExpression(fullyCoveredNode);</TD></TR><TR CLASS="z"><TD CLASS="l">2011</TD><TD>                if (expression == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">2012</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">2013</TD><TD>                }</TD></TR><TR><TD CLASS="l">2014</TD><TD>                //  we could produce quick assist</TD></TR><TR CLASS="z"><TD CLASS="l">2015</TD><TD>                if (resultingCollections == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">2016</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">2017</TD><TD>                }</TD></TR><TR><TD CLASS="l">2018</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">2019</TD><TD>                AST ast= expression.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">2020</TD><TD>                final ASTRewrite rewrite= ASTRewrite.create(ast);</TD></TR><TR><TD CLASS="l">2021</TD><TD>                // prepared inverted expression</TD></TR><TR CLASS="z"><TD CLASS="l">2022</TD><TD>                Expression inversedExpression= getInversedBooleanExpression(rewrite, expression);</TD></TR><TR><TD CLASS="l">2023</TD><TD>                // prepare ParenthesizedExpression</TD></TR><TR CLASS="z"><TD CLASS="l">2024</TD><TD>                ParenthesizedExpression parenthesizedExpression = ast.newParenthesizedExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">2025</TD><TD>                parenthesizedExpression.setExpression(inversedExpression);</TD></TR><TR><TD CLASS="l">2026</TD><TD>                // prepare NOT prefix expression</TD></TR><TR CLASS="z"><TD CLASS="l">2027</TD><TD>                PrefixExpression prefixExpression = ast.newPrefixExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">2028</TD><TD>                prefixExpression.setOperator(PrefixExpression.Operator.NOT);</TD></TR><TR CLASS="z"><TD CLASS="l">2029</TD><TD>                prefixExpression.setOperand(parenthesizedExpression);</TD></TR><TR><TD CLASS="l">2030</TD><TD>                // replace old expression</TD></TR><TR CLASS="z"><TD CLASS="l">2031</TD><TD>                rewrite.replace(expression, prefixExpression, null);</TD></TR><TR><TD CLASS="l">2032</TD><TD>                // add correction proposal</TD></TR><TR CLASS="z"><TD CLASS="l">2033</TD><TD>                String label= CorrectionMessages.AdvancedQuickAssistProcessor_pullNegationUp;</TD></TR><TR CLASS="z"><TD CLASS="l">2034</TD><TD>                Image image= JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">2035</TD><TD>                ASTRewriteCorrectionProposal proposal= new ASTRewriteCorrectionProposal(label, context.getCompilationUnit(), rewrite, 1, image);</TD></TR><TR CLASS="z"><TD CLASS="l">2036</TD><TD>                resultingCollections.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l">2037</TD><TD>                return true;</TD></TR><TR><TD CLASS="l">2038</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="1e">2039</A></TD><TD>        private static boolean getJoinIfListInIfElseIfProposals(IInvocationContext context,</TD></TR><TR><TD CLASS="l">2040</TD><TD>                        ASTNode covering,</TD></TR><TR><TD CLASS="l">2041</TD><TD>                        ArrayList coveredNodes,</TD></TR><TR><TD CLASS="l">2042</TD><TD>                        Collection resultingCollections) {</TD></TR><TR CLASS="z"><TD CLASS="l">2043</TD><TD>                if (coveredNodes.isEmpty()) {</TD></TR><TR CLASS="z"><TD CLASS="l">2044</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">2045</TD><TD>                }</TD></TR><TR><TD CLASS="l">2046</TD><TD>                // check that we have more than one covered statement</TD></TR><TR CLASS="z"><TD CLASS="l">2047</TD><TD>                if (coveredNodes.size() &lt; 2) {</TD></TR><TR CLASS="z"><TD CLASS="l">2048</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">2049</TD><TD>                }</TD></TR><TR><TD CLASS="l">2050</TD><TD>                // check that all selected nodes are 'if' statements with only 'then' statement</TD></TR><TR CLASS="z"><TD CLASS="l">2051</TD><TD>                for (Iterator iter= coveredNodes.iterator(); iter.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">2052</TD><TD>                        ASTNode node= (ASTNode) iter.next();</TD></TR><TR CLASS="z"><TD CLASS="l">2053</TD><TD>                        if (!(node instanceof IfStatement)) {</TD></TR><TR CLASS="z"><TD CLASS="l">2054</TD><TD>                                return false;</TD></TR><TR><TD CLASS="l">2055</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">2056</TD><TD>                        IfStatement ifStatement= (IfStatement) node;</TD></TR><TR CLASS="z"><TD CLASS="l">2057</TD><TD>                        if (ifStatement.getElseStatement() != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">2058</TD><TD>                                return false;</TD></TR><TR><TD CLASS="l">2059</TD><TD>                        }</TD></TR><TR><TD CLASS="l">2060</TD><TD>                }</TD></TR><TR><TD CLASS="l">2061</TD><TD>                //  we could produce quick assist</TD></TR><TR CLASS="z"><TD CLASS="l">2062</TD><TD>                if (resultingCollections == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">2063</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">2064</TD><TD>                }</TD></TR><TR><TD CLASS="l">2065</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">2066</TD><TD>                final AST ast= covering.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">2067</TD><TD>                final ASTRewrite rewrite= ASTRewrite.create(ast);</TD></TR><TR><TD CLASS="l">2068</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">2069</TD><TD>                IfStatement firstIfStatement= (IfStatement) coveredNodes.get(0);</TD></TR><TR CLASS="z"><TD CLASS="l">2070</TD><TD>                IfStatement firstNewIfStatement= null;</TD></TR><TR><TD CLASS="l">2071</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">2072</TD><TD>                IfStatement prevIfStatement= null;</TD></TR><TR CLASS="z"><TD CLASS="l">2073</TD><TD>                for (Iterator iter= coveredNodes.iterator(); iter.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">2074</TD><TD>                        IfStatement ifStatement= (IfStatement) iter.next();</TD></TR><TR><TD CLASS="l">2075</TD><TD>                        // prepare new 'if' statement</TD></TR><TR CLASS="z"><TD CLASS="l">2076</TD><TD>                        IfStatement newIfStatement= ast.newIfStatement();</TD></TR><TR CLASS="z"><TD CLASS="l">2077</TD><TD>                        newIfStatement.setExpression((Expression) rewrite.createMoveTarget(ifStatement.getExpression()));</TD></TR><TR><TD CLASS="l">2078</TD><TD>                        // prepare 'then' statement and convert into block if needed</TD></TR><TR CLASS="z"><TD CLASS="l">2079</TD><TD>                        Statement thenStatement= (Statement) rewrite.createMoveTarget(ifStatement.getThenStatement());</TD></TR><TR CLASS="z"><TD CLASS="l">2080</TD><TD>                        if (ifStatement.getThenStatement() instanceof IfStatement) {</TD></TR><TR CLASS="z"><TD CLASS="l">2081</TD><TD>                                IfStatement ifBodyStatement= (IfStatement) ifStatement.getThenStatement();</TD></TR><TR CLASS="z"><TD CLASS="l">2082</TD><TD>                                if (ifBodyStatement.getElseStatement() == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">2083</TD><TD>                                        Block thenBlock= ast.newBlock();</TD></TR><TR CLASS="z"><TD CLASS="l">2084</TD><TD>                                        thenBlock.statements().add(thenStatement);</TD></TR><TR CLASS="z"><TD CLASS="l">2085</TD><TD>                                        thenStatement= thenBlock;</TD></TR><TR><TD CLASS="l">2086</TD><TD>                                }</TD></TR><TR><TD CLASS="l">2087</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">2088</TD><TD>                        newIfStatement.setThenStatement(thenStatement);</TD></TR><TR><TD CLASS="l">2089</TD><TD>                        //</TD></TR><TR CLASS="z"><TD CLASS="l">2090</TD><TD>                        if (prevIfStatement != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">2091</TD><TD>                                prevIfStatement.setElseStatement(newIfStatement);</TD></TR><TR CLASS="z"><TD CLASS="l">2092</TD><TD>                                rewrite.remove(ifStatement, null);</TD></TR><TR><TD CLASS="l">2093</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">2094</TD><TD>                                firstNewIfStatement= newIfStatement;</TD></TR><TR><TD CLASS="l">2095</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">2096</TD><TD>                        prevIfStatement= newIfStatement;</TD></TR><TR><TD CLASS="l">2097</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">2098</TD><TD>                rewrite.replace(firstIfStatement, firstNewIfStatement, null);</TD></TR><TR><TD CLASS="l">2099</TD><TD>                // add correction proposal</TD></TR><TR CLASS="z"><TD CLASS="l">2100</TD><TD>                String label= CorrectionMessages.AdvancedQuickAssistProcessor_joinIfSequence;</TD></TR><TR CLASS="z"><TD CLASS="l">2101</TD><TD>                Image image= JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">2102</TD><TD>                ASTRewriteCorrectionProposal proposal= new ASTRewriteCorrectionProposal(label, context.getCompilationUnit(), rewrite, 1, image);</TD></TR><TR CLASS="z"><TD CLASS="l">2103</TD><TD>                resultingCollections.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l">2104</TD><TD>                return true;</TD></TR><TR><TD CLASS="l"><A NAME="c">2105</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">2106</TD><TD>        private static boolean getConvertSwitchToIfProposals(IInvocationContext context,</TD></TR><TR><TD CLASS="l">2107</TD><TD>                        ASTNode covering,</TD></TR><TR><TD CLASS="l">2108</TD><TD>                        Collection resultingCollections) {</TD></TR><TR CLASS="z"><TD CLASS="l">2109</TD><TD>                if (!(covering instanceof SwitchStatement)) {</TD></TR><TR CLASS="z"><TD CLASS="l">2110</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">2111</TD><TD>                }</TD></TR><TR><TD CLASS="l">2112</TD><TD>                //  we could produce quick assist (if all 'case' statements end with 'break')</TD></TR><TR CLASS="z"><TD CLASS="l">2113</TD><TD>                if (resultingCollections == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">2114</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">2115</TD><TD>                }</TD></TR><TR><TD CLASS="l">2116</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">2117</TD><TD>                final AST ast= covering.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">2118</TD><TD>                final ASTRewrite rewrite= ASTRewrite.create(ast);</TD></TR><TR CLASS="z"><TD CLASS="l">2119</TD><TD>                final ImportRewrite importRewrite= CodeStyleConfiguration.createImportRewrite(context.getASTRoot(), true);</TD></TR><TR><TD CLASS="l">2120</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">2121</TD><TD>                SwitchStatement switchStatement= (SwitchStatement) covering;</TD></TR><TR CLASS="z"><TD CLASS="l">2122</TD><TD>                IfStatement firstIfStatement= null;</TD></TR><TR CLASS="z"><TD CLASS="l">2123</TD><TD>                IfStatement currentIfStatement= null;</TD></TR><TR CLASS="z"><TD CLASS="l">2124</TD><TD>                Block currentBlock= null;</TD></TR><TR CLASS="z"><TD CLASS="l">2125</TD><TD>                boolean hasStopAsLastExecutableStatement = false;</TD></TR><TR CLASS="z"><TD CLASS="l">2126</TD><TD>                Block defaultBlock= null;</TD></TR><TR CLASS="z"><TD CLASS="l">2127</TD><TD>                InfixExpression currentCondition= null;</TD></TR><TR CLASS="z"><TD CLASS="l">2128</TD><TD>                boolean defaultFound= false;</TD></TR><TR CLASS="z"><TD CLASS="l">2129</TD><TD>                int caseCount = 0;</TD></TR><TR><TD CLASS="l">2130</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">2131</TD><TD>                ArrayList allBlocks= new ArrayList();</TD></TR><TR><TD CLASS="l">2132</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">2133</TD><TD>                for (Iterator iter= switchStatement.statements().iterator(); iter.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">2134</TD><TD>                        Statement statement= (Statement) iter.next();</TD></TR><TR CLASS="z"><TD CLASS="l">2135</TD><TD>                        if (statement instanceof SwitchCase) {</TD></TR><TR CLASS="z"><TD CLASS="l">2136</TD><TD>                                SwitchCase switchCase= (SwitchCase) statement;</TD></TR><TR CLASS="z"><TD CLASS="l">2137</TD><TD>                                caseCount++;</TD></TR><TR><TD CLASS="l">2138</TD><TD>                                // special case: pass through</TD></TR><TR CLASS="z"><TD CLASS="l">2139</TD><TD>                                if (currentBlock != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">2140</TD><TD>                                        if (!hasStopAsLastExecutableStatement) {</TD></TR><TR CLASS="z"><TD CLASS="l">2141</TD><TD>                                                return false;</TD></TR><TR><TD CLASS="l">2142</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">2143</TD><TD>                                        currentBlock= null;</TD></TR><TR><TD CLASS="l">2144</TD><TD>                                }</TD></TR><TR><TD CLASS="l">2145</TD><TD>                                // for 'default' we just will not create condition</TD></TR><TR CLASS="z"><TD CLASS="l">2146</TD><TD>                                if (switchCase.isDefault()) {</TD></TR><TR CLASS="z"><TD CLASS="l">2147</TD><TD>                                        defaultFound= true;</TD></TR><TR CLASS="z"><TD CLASS="l">2148</TD><TD>                                        if (currentCondition != null) {</TD></TR><TR><TD CLASS="l">2149</TD><TD>                                                // we can not convert one or more 'case' statements and 'default' nor in conditional if, nor in 'else' without code duplication</TD></TR><TR CLASS="z"><TD CLASS="l">2150</TD><TD>                                                return false;</TD></TR><TR><TD CLASS="l">2151</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">2152</TD><TD>                                        continue;</TD></TR><TR><TD CLASS="l">2153</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">2154</TD><TD>                                if (defaultFound) {</TD></TR><TR CLASS="z"><TD CLASS="l">2155</TD><TD>                                        return false;</TD></TR><TR><TD CLASS="l">2156</TD><TD>                                }</TD></TR><TR><TD CLASS="l">2157</TD><TD>                                // prepare condition</TD></TR><TR CLASS="z"><TD CLASS="l">2158</TD><TD>                                InfixExpression switchCaseCondition= createSwitchCaseCondition(ast, rewrite, importRewrite, switchStatement, switchCase);</TD></TR><TR CLASS="z"><TD CLASS="l">2159</TD><TD>                                if (currentCondition == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">2160</TD><TD>                                        currentCondition= switchCaseCondition;</TD></TR><TR><TD CLASS="l">2161</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">2162</TD><TD>                                        InfixExpression condition= ast.newInfixExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">2163</TD><TD>                                        condition.setOperator(InfixExpression.Operator.CONDITIONAL_OR);</TD></TR><TR CLASS="z"><TD CLASS="l">2164</TD><TD>                                        condition.setLeftOperand(currentCondition);</TD></TR><TR CLASS="z"><TD CLASS="l">2165</TD><TD>                                        condition.setRightOperand(switchCaseCondition);</TD></TR><TR CLASS="z"><TD CLASS="l">2166</TD><TD>                                        currentCondition= condition;</TD></TR><TR><TD CLASS="l">2167</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">2168</TD><TD>                        } else if (statement instanceof BreakStatement) {</TD></TR><TR CLASS="z"><TD CLASS="l">2169</TD><TD>                                currentBlock= null;</TD></TR><TR><TD CLASS="l">2170</TD><TD>                        } else {</TD></TR><TR><TD CLASS="l">2171</TD><TD>                                // ensure that current block exists as 'then' statement of 'if'</TD></TR><TR CLASS="z"><TD CLASS="l">2172</TD><TD>                                if (currentBlock == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">2173</TD><TD>                                        defaultFound= false;</TD></TR><TR CLASS="z"><TD CLASS="l">2174</TD><TD>                                        if (currentCondition != null) {</TD></TR><TR><TD CLASS="l">2175</TD><TD>                                                IfStatement ifStatement;</TD></TR><TR CLASS="z"><TD CLASS="l">2176</TD><TD>                                                if (firstIfStatement == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">2177</TD><TD>                                                        firstIfStatement= ast.newIfStatement();</TD></TR><TR CLASS="z"><TD CLASS="l">2178</TD><TD>                                                        ifStatement= firstIfStatement;</TD></TR><TR><TD CLASS="l">2179</TD><TD>                                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">2180</TD><TD>                                                        ifStatement= ast.newIfStatement();</TD></TR><TR CLASS="z"><TD CLASS="l">2181</TD><TD>                                                        currentIfStatement.setElseStatement(ifStatement);</TD></TR><TR><TD CLASS="l">2182</TD><TD>                                                }</TD></TR><TR CLASS="z"><TD CLASS="l">2183</TD><TD>                                                currentIfStatement= ifStatement;</TD></TR><TR CLASS="z"><TD CLASS="l">2184</TD><TD>                                                ifStatement.setExpression(currentCondition);</TD></TR><TR CLASS="z"><TD CLASS="l">2185</TD><TD>                                                currentCondition= null;</TD></TR><TR CLASS="z"><TD CLASS="l">2186</TD><TD>                                                currentBlock= ast.newBlock();</TD></TR><TR CLASS="z"><TD CLASS="l">2187</TD><TD>                                                ifStatement.setThenStatement(currentBlock);</TD></TR><TR CLASS="z"><TD CLASS="l">2188</TD><TD>                                                allBlocks.add(currentBlock);</TD></TR><TR><TD CLASS="l">2189</TD><TD>                                        } else {</TD></TR><TR><TD CLASS="l">2190</TD><TD>                                                // case for default:</TD></TR><TR CLASS="z"><TD CLASS="l">2191</TD><TD>                                                defaultBlock= ast.newBlock();</TD></TR><TR CLASS="z"><TD CLASS="l">2192</TD><TD>                                                currentBlock= defaultBlock;</TD></TR><TR CLASS="z"><TD CLASS="l">2193</TD><TD>                                                allBlocks.add(currentBlock);</TD></TR><TR><TD CLASS="l">2194</TD><TD>                                                // delay adding of default block</TD></TR><TR><TD CLASS="l">2195</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">2196</TD><TD>                                }</TD></TR><TR><TD CLASS="l">2197</TD><TD>                                // add current statement in current block</TD></TR><TR><TD CLASS="l">2198</TD><TD>                                {</TD></TR><TR CLASS="z"><TD CLASS="l">2199</TD><TD>                                        hasStopAsLastExecutableStatement = hasStopAsLastExecutableStatement(statement);</TD></TR><TR CLASS="z"><TD CLASS="l">2200</TD><TD>                                        Statement copyStatement= copyStatementExceptBreak(ast, rewrite, statement);</TD></TR><TR><TD CLASS="l">2201</TD><TD>                                                                                </TD></TR><TR><TD CLASS="l">2202</TD><TD>                                        </TD></TR><TR CLASS="z"><TD CLASS="l">2203</TD><TD>                                        currentBlock.statements().add(copyStatement);</TD></TR><TR><TD CLASS="l">2204</TD><TD>                                }</TD></TR><TR><TD CLASS="l">2205</TD><TD>                        }</TD></TR><TR><TD CLASS="l">2206</TD><TD>                }</TD></TR><TR><TD CLASS="l">2207</TD><TD>                // check, may be we have delayed default block</TD></TR><TR CLASS="z"><TD CLASS="l">2208</TD><TD>                if (defaultBlock != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">2209</TD><TD>                        currentIfStatement.setElseStatement(defaultBlock);</TD></TR><TR><TD CLASS="l">2210</TD><TD>                }</TD></TR><TR><TD CLASS="l">2211</TD><TD>                // remove unnecessary blocks in blocks</TD></TR><TR CLASS="z"><TD CLASS="l">2212</TD><TD>                for (int i= 0; i &lt; allBlocks.size(); i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">2213</TD><TD>                        Block block= (Block) allBlocks.get(i);</TD></TR><TR CLASS="z"><TD CLASS="l">2214</TD><TD>                        List statements= block.statements();</TD></TR><TR CLASS="z"><TD CLASS="l">2215</TD><TD>                        if (statements.size() == 1 &amp;&amp; statements.get(0) instanceof Block) {</TD></TR><TR CLASS="z"><TD CLASS="l">2216</TD><TD>                                Block innerBlock= (Block) statements.remove(0);</TD></TR><TR CLASS="z"><TD CLASS="l">2217</TD><TD>                                block.getParent().setStructuralProperty(block.getLocationInParent(), innerBlock);</TD></TR><TR><TD CLASS="l">2218</TD><TD>                        }</TD></TR><TR><TD CLASS="l">2219</TD><TD>                }</TD></TR><TR><TD CLASS="l">2220</TD><TD>                // replace 'switch' with single if-else-if statement</TD></TR><TR CLASS="z"><TD CLASS="l">2221</TD><TD>                rewrite.replace(switchStatement, firstIfStatement, null);</TD></TR><TR><TD CLASS="l">2222</TD><TD>                // prepare label, specially for Daniel :-)</TD></TR><TR CLASS="z"><TD CLASS="l">2223</TD><TD>                String label= CorrectionMessages.AdvancedQuickAssistProcessor_convertSwitchToIf;</TD></TR><TR><TD CLASS="l">2224</TD><TD> </TD></TR><TR><TD CLASS="l">2225</TD><TD>                // add correction proposal</TD></TR><TR CLASS="z"><TD CLASS="l">2226</TD><TD>                Image image= JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">2227</TD><TD>                ASTRewriteCorrectionProposal proposal= new ASTRewriteCorrectionProposal(label,</TD></TR><TR CLASS="z"><TD CLASS="l">2228</TD><TD>                        context.getCompilationUnit(),</TD></TR><TR CLASS="z"><TD CLASS="l">2229</TD><TD>                        rewrite,</TD></TR><TR CLASS="z"><TD CLASS="l">2230</TD><TD>                        1,</TD></TR><TR CLASS="z"><TD CLASS="l">2231</TD><TD>                        image);</TD></TR><TR CLASS="z"><TD CLASS="l">2232</TD><TD>                proposal.setImportRewrite(importRewrite);</TD></TR><TR CLASS="z"><TD CLASS="l">2233</TD><TD>                resultingCollections.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="7">2234</A></TD><TD>                return true;</TD></TR><TR><TD CLASS="l">2235</TD><TD>        }</TD></TR><TR><TD CLASS="l">2236</TD><TD>        private static InfixExpression createSwitchCaseCondition(AST ast, ASTRewrite rewrite, ImportRewrite importRewrite,</TD></TR><TR><TD CLASS="l">2237</TD><TD>                                                              SwitchStatement switchStatement, SwitchCase switchCase) {</TD></TR><TR CLASS="z"><TD CLASS="l">2238</TD><TD>                InfixExpression condition= ast.newInfixExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">2239</TD><TD>                condition.setOperator(InfixExpression.Operator.EQUALS);</TD></TR><TR><TD CLASS="l">2240</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">2241</TD><TD>                Expression leftExpression= (Expression) rewrite.createCopyTarget(switchStatement.getExpression());</TD></TR><TR CLASS="z"><TD CLASS="l">2242</TD><TD>                condition.setLeftOperand(leftExpression);</TD></TR><TR><TD CLASS="l">2243</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">2244</TD><TD>                Expression rightExpression= null;</TD></TR><TR CLASS="z"><TD CLASS="l">2245</TD><TD>                Expression expression= switchCase.getExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">2246</TD><TD>                if (expression instanceof SimpleName &amp;&amp; ((SimpleName) expression).resolveBinding() instanceof IVariableBinding) {</TD></TR><TR CLASS="z"><TD CLASS="l">2247</TD><TD>                        IVariableBinding binding= (IVariableBinding) ((SimpleName) expression).resolveBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">2248</TD><TD>                        if (binding.isEnumConstant()) {</TD></TR><TR CLASS="z"><TD CLASS="l">2249</TD><TD>                                String qualifiedName= importRewrite.addImport(binding.getDeclaringClass()) + '.' + binding.getName();</TD></TR><TR CLASS="z"><TD CLASS="l">2250</TD><TD>                                rightExpression= ast.newName(qualifiedName);</TD></TR><TR><TD CLASS="l">2251</TD><TD>                        }</TD></TR><TR><TD CLASS="l">2252</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">2253</TD><TD>                if (rightExpression == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">2254</TD><TD>                        rightExpression= (Expression) rewrite.createCopyTarget(expression);</TD></TR><TR><TD CLASS="l">2255</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">2256</TD><TD>                condition.setRightOperand(rightExpression);</TD></TR><TR><TD CLASS="l">2257</TD><TD>                //</TD></TR><TR CLASS="z"><TD CLASS="l">2258</TD><TD>                return condition;</TD></TR><TR><TD CLASS="l"><A NAME="2f">2259</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">2260</TD><TD>        </TD></TR><TR><TD CLASS="l">2261</TD><TD>        </TD></TR><TR><TD CLASS="l">2262</TD><TD>        private static boolean hasStopAsLastExecutableStatement(Statement lastStatement) {</TD></TR><TR CLASS="z"><TD CLASS="l">2263</TD><TD>                if ((lastStatement instanceof ReturnStatement) || (lastStatement instanceof BreakStatement)) {</TD></TR><TR CLASS="z"><TD CLASS="l">2264</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">2265</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">2266</TD><TD>                if (lastStatement instanceof Block) {</TD></TR><TR CLASS="z"><TD CLASS="l">2267</TD><TD>                        Block block= (Block)lastStatement;</TD></TR><TR CLASS="z"><TD CLASS="l">2268</TD><TD>                        lastStatement = (Statement) block.statements().get(block.statements().size() - 1);</TD></TR><TR CLASS="z"><TD CLASS="l">2269</TD><TD>                        return hasStopAsLastExecutableStatement(lastStatement);</TD></TR><TR><TD CLASS="l"><A NAME="4">2270</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">2271</TD><TD>                return false;</TD></TR><TR><TD CLASS="l">2272</TD><TD>        }</TD></TR><TR><TD CLASS="l">2273</TD><TD>        private static Statement copyStatementExceptBreak(AST ast, ASTRewrite rewrite, Statement source) {</TD></TR><TR CLASS="z"><TD CLASS="l">2274</TD><TD>                if (source instanceof Block) {</TD></TR><TR CLASS="z"><TD CLASS="l">2275</TD><TD>                        Block block= (Block) source;</TD></TR><TR CLASS="z"><TD CLASS="l">2276</TD><TD>                        Block newBlock= ast.newBlock();</TD></TR><TR CLASS="z"><TD CLASS="l">2277</TD><TD>                        for (Iterator iter= block.statements().iterator(); iter.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">2278</TD><TD>                                Statement statement= (Statement) iter.next();</TD></TR><TR CLASS="z"><TD CLASS="l">2279</TD><TD>                                if (statement instanceof BreakStatement) {</TD></TR><TR CLASS="z"><TD CLASS="l">2280</TD><TD>                                        continue;</TD></TR><TR><TD CLASS="l">2281</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">2282</TD><TD>                                newBlock.statements().add(copyStatementExceptBreak(ast, rewrite, statement));</TD></TR><TR><TD CLASS="l">2283</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">2284</TD><TD>                        return newBlock;</TD></TR><TR><TD CLASS="l">2285</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">2286</TD><TD>                return (Statement) rewrite.createMoveTarget(source);</TD></TR><TR><TD CLASS="l">2287</TD><TD>        }</TD></TR><TR><TD CLASS="l">2288</TD><TD>}</TD></TR></TABLE><P></P><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TD CLASS="nv">[<A HREF="../xslUnitTestCoverage.html">all classes</A>][<A HREF="177.html">org.eclipse.wst.jsdt.internal.ui.text.correction</A>]</TD></TR><TR><TD CLASS="tl"><A HREF="http://www.eclemma.org/support.html">EMMA 2.0.5312 EclEmma Fix 1</A> (C) Vladimir Roubtsov</TD></TR></TABLE></BODY></HTML>