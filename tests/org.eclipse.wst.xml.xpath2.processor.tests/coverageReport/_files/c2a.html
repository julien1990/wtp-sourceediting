<HTML><HEAD><META CONTENT="text/html; charset=UTF-8" HTTP-EQUIV="Content-Type"/><TITLE>EMMA Coverage Report</TITLE><STYLE TYPE="text/css"> TABLE,TD,TH {border-style:solid; border-color:black;} TD,TH {background:white;margin:0;line-height:100%;padding-left:0.5em;padding-right:0.5em;} TD {border-width:0 1px 0 0;} TH {border-width:1px 1px 1px 0;} TR TD.h {color:red;} TABLE {border-spacing:0; border-collapse:collapse;border-width:0 0 1px 1px;} P,H1,H2,H3,TH {font-family:verdana,arial,sans-serif;font-size:10pt;} TD {font-family:courier,monospace;font-size:10pt;} TABLE.hdft {border-spacing:0;border-collapse:collapse;border-style:none;} TABLE.hdft TH,TABLE.hdft TD {border-style:none;line-height:normal;} TABLE.hdft TH.tl,TABLE.hdft TD.tl {background:#6699CC;color:white;} TABLE.hdft TD.nv {background:#6633DD;color:white;} .nv A:link {color:white;} .nv A:visited {color:white;} .nv A:active {color:yellow;} TABLE.hdft A:link {color:white;} TABLE.hdft A:visited {color:white;} TABLE.hdft A:active {color:yellow;} .in {color:#356085;} TABLE.s TD {padding-left:0.25em;padding-right:0.25em;} TABLE.s TD.l {padding-left:0.25em;padding-right:0.25em;text-align:right;background:#F0F0F0;} TABLE.s TR.z TD {background:#FF9999;} TABLE.s TR.p TD {background:#FFFF88;} TABLE.s TR.c TD {background:#CCFFCC;} A:link {color:#0000EE;text-decoration:none;} A:visited {color:#0000EE;text-decoration:none;} A:hover {color:#0000EE;text-decoration:underline;} TABLE.cn {border-width:0 0 1px 0;} TABLE.s {border-width:1px 0 1px 1px;} TD.h {color:red;border-width:0 1px 0 0;} TD.f {border-width:0 1px 0 1px;} TD.hf {color:red;border-width:0 1px 0 1px;} TH.f {border-width:1px 1px 1px 1px;} TR.cis TD {background:#F0F0F0;} TR.cis TD {border-width:1px 1px 1px 0;} TR.cis TD.h {color:red;border-width:1px 1px 1px 0;} TR.cis TD.f {border-width:1px 1px 1px 1px;} TR.cis TD.hf {color:red;border-width:1px 1px 1px 1px;} TD.b {border-style:none;background:transparent;line-height:50%;}  TD.bt {border-width:1px 0 0 0;background:transparent;line-height:50%;} TR.o TD {background:#F0F0F0;}TABLE.it {border-style:none;}TABLE.it TD,TABLE.it TH {border-style:none;}</STYLE></HEAD><BODY><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="tl"><A HREF="http://www.eclemma.org/">EMMA</A> Coverage Report (generated Tue Jun 09 19:59:05 GMT 2009)</TH></TR><TR><TD CLASS="nv">[<A HREF="../xslUnitTestCoverage.html">all classes</A>][<A HREF="124.html">org.eclipse.wst.jsdt.internal.core</A>]</TD></TR></TABLE><H2>COVERAGE SUMMARY FOR SOURCE FILE [<SPAN CLASS="in">DeltaProcessor.java</SPAN>]</H2><TABLE CELLSPACING="0" WIDTH="100%"><TR><TH>name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD>DeltaProcessor.java</TD><TD CLASS="h">0%   (0/8)</TD><TD CLASS="h">0%   (0/71)</TD><TD CLASS="h">0%   (0/4935)</TD><TD CLASS="h">0%   (0/1249)</TD></TR></TABLE><H3>COVERAGE BREAKDOWN BY CLASS AND METHOD</H3><TABLE CLASS="cn" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="f">name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#0">DeltaProcessor</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/54)</TD><TD CLASS="h">0%   (0/4510)</TD><TD CLASS="h">0%   (0/1157)</TD></TR><TR><TD CLASS="f"><A HREF="#0">&lt;static initializer&gt;</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2">DeltaProcessor (DeltaProcessingState, JavaModelManager): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/45)</TD><TD CLASS="h">0%   (0/12)</TD></TR><TR><TD CLASS="f"><A HREF="#3">addClasspathChange (IProject, IIncludePathEntry [], IPath, IIncludePathEntry ...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/48)</TD><TD CLASS="h">0%   (0/11)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#4">addDependentProjects (IJavaScriptProject, HashMap, HashSet): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/37)</TD><TD CLASS="h">0%   (0/9)</TD></TR><TR><TD CLASS="f"><A HREF="#5">addForRefresh (IJavaScriptElement): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/14)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#6">addToParentInfo (Openable): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/19)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR><TD CLASS="f"><A HREF="#7">addToRootsToRefreshWithDependents (IJavaScriptProject): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/14)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#8">checkExternalArchiveChanges (IJavaScriptElement [], IProgressMonitor): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/118)</TD><TD CLASS="h">0%   (0/28)</TD></TR><TR><TD CLASS="f"><A HREF="#9">checkProjectReferenceChange (IProject, JavaProject): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/17)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#a">checkProjectsBeingAddedOrRemoved (IResourceDelta): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/265)</TD><TD CLASS="h">0%   (0/78)</TD></TR><TR><TD CLASS="f"><A HREF="#b">checkSourceAttachmentChange (IResourceDelta, IResource): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/58)</TD><TD CLASS="h">0%   (0/19)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#c">close (Openable): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR><TD CLASS="f"><A HREF="#d">contentChanged (Openable): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/50)</TD><TD CLASS="h">0%   (0/14)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#e">createElement (IResource, int, DeltaProcessor$RootInfo): Openable</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/246)</TD><TD CLASS="h">0%   (0/63)</TD></TR><TR><TD CLASS="f"><A HREF="#f">createExternalArchiveDelta (IProgressMonitor): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/449)</TD><TD CLASS="h">0%   (0/100)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#10">currentDelta (): JavaElementDelta</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/14)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR><TD CLASS="f"><A HREF="#11">deleting (IProject): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/56)</TD><TD CLASS="h">0%   (0/18)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#12">elementAdded (Openable, IResourceDelta, DeltaProcessor$RootInfo): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/188)</TD><TD CLASS="h">0%   (0/48)</TD></TR><TR><TD CLASS="f"><A HREF="#13">elementRemoved (Openable, IResourceDelta, DeltaProcessor$RootInfo): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/164)</TD><TD CLASS="h">0%   (0/48)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#14">elementType (IResource, int, int, DeltaProcessor$RootInfo): int</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/155)</TD><TD CLASS="h">0%   (0/32)</TD></TR><TR><TD CLASS="f"><A HREF="#15">enclosingRootInfo (IPath, int): DeltaProcessor$RootInfo</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/21)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#16">fire (IJavaScriptElementDelta, int): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/96)</TD><TD CLASS="h">0%   (0/25)</TD></TR><TR><TD CLASS="f"><A HREF="#17">firePostChangeDelta (IJavaScriptElementDelta, IElementChangedListener [], int...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/36)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#18">fireReconcileDelta (IElementChangedListener [], int [], int): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/42)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR><TD CLASS="f"><A HREF="#19">flush (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1a">getSourceElementParser (Openable): SourceElementParser</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/15)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR><TD CLASS="f"><A HREF="#1b">getTimeStamp (File): long</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1c">isAffectedBy (IResourceDelta): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/15)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR><TD CLASS="f"><A HREF="#1d">isPrimaryWorkingCopy (IJavaScriptElement, int): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/18)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1e">isResFilteredFromOutput (DeltaProcessor$RootInfo, DeltaProcessor$OutputsInfo,...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/87)</TD><TD CLASS="h">0%   (0/22)</TD></TR><TR><TD CLASS="f"><A HREF="#1f">mergeDeltas (Collection): IJavaScriptElementDelta</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/125)</TD><TD CLASS="h">0%   (0/27)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#20">nonJavaResourcesChanged (Openable, IResourceDelta): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/68)</TD><TD CLASS="h">0%   (0/23)</TD></TR><TR><TD CLASS="f"><A HREF="#21">notifyListeners (IJavaScriptElementDelta, int, IElementChangedListener [], in...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/68)</TD><TD CLASS="h">0%   (0/12)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#22">notifyTypeHierarchies (IElementChangedListener [], int): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/22)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR><TD CLASS="f"><A HREF="#23">otherRootsInfo (IPath, int): ArrayList</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/17)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#24">outputsInfo (DeltaProcessor$RootInfo, IResource): DeltaProcessor$OutputsInfo</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/109)</TD><TD CLASS="h">0%   (0/23)</TD></TR><TR><TD CLASS="f"><A HREF="#25">popUntilPrefixOf (IPath): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/61)</TD><TD CLASS="h">0%   (0/16)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#26">processResourceDelta (IResourceDelta): IJavaScriptElementDelta</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/135)</TD><TD CLASS="h">0%   (0/36)</TD></TR><TR><TD CLASS="f"><A HREF="#27">readRawClasspath (JavaProject): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/12)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#28">refreshPackageFragmentRoots (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/15)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR><TD CLASS="f"><A HREF="#29">registerJavaModelDelta (IJavaScriptElementDelta): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2a">removeFromParentInfo (Openable): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/19)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR><TD CLASS="f"><A HREF="#2b">resetProjectCaches (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/48)</TD><TD CLASS="h">0%   (0/15)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2c">resourceChanged (IResourceChangeEvent): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/245)</TD><TD CLASS="h">0%   (0/69)</TD></TR><TR><TD CLASS="f"><A HREF="#2d">rootInfo (IPath, int): DeltaProcessor$RootInfo</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/17)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2e">startDeltas (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#2f">stopDeltas (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#30">traverseDelta (IResourceDelta, int, DeltaProcessor$RootInfo, DeltaProcessor$O...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/294)</TD><TD CLASS="h">0%   (0/85)</TD></TR><TR><TD CLASS="f"><A HREF="#31">updateCurrentDeltaAndIndex (IResourceDelta, int, DeltaProcessor$RootInfo): bo...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/350)</TD><TD CLASS="h">0%   (0/74)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#32">updateIndex (Openable, IResourceDelta): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/265)</TD><TD CLASS="h">0%   (0/73)</TD></TR><TR><TD CLASS="f"><A HREF="#33">updateJavaModel (IJavaScriptElementDelta): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/29)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#34">updateRootIndex (PackageFragmentRoot, String [], IResourceDelta): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/42)</TD><TD CLASS="h">0%   (0/10)</TD></TR><TR><TD CLASS="f"><A HREF="#35">validateClasspaths (IResourceDelta): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/101)</TD><TD CLASS="h">0%   (0/26)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#36">validateClasspaths (IResourceDelta, HashSet): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/143)</TD><TD CLASS="h">0%   (0/39)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#37">DeltaProcessor$1</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/2)</TD><TD CLASS="h">0%   (0/43)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR><TD CLASS="f"><A HREF="#37">DeltaProcessor$1 (DeltaProcessor, int, IProject []): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/12)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#39">run (IProgressMonitor): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/31)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#3a">DeltaProcessor$1$FoundRelevantDeltaException</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#3a">DeltaProcessor$1$FoundRelevantDeltaException (DeltaProcessor): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#3c">DeltaProcessor$2</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/2)</TD><TD CLASS="h">0%   (0/32)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR><TD CLASS="f"><A HREF="#3c">DeltaProcessor$2 (DeltaProcessor): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#3e">visit (IResourceDelta): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/26)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#3f">DeltaProcessor$3</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/37)</TD><TD CLASS="h">0%   (0/12)</TD></TR><TR><TD CLASS="f"><A HREF="#3f">DeltaProcessor$3 (DeltaProcessor, IElementChangedListener, ElementChangedEven...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/12)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#41">handleException (Throwable): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#42">run (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/21)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#43">DeltaProcessor$4</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/26)</TD><TD CLASS="h">0%   (0/9)</TD></TR><TR><TD CLASS="f"><A HREF="#43">DeltaProcessor$4 (DeltaProcessor, IElementChangedListener): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#45">handleException (Throwable): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#46">run (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/13)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#47">DeltaProcessor$OutputsInfo</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/2)</TD><TD CLASS="h">0%   (0/82)</TD><TD CLASS="h">0%   (0/22)</TD></TR><TR><TD CLASS="f"><A HREF="#47">DeltaProcessor$OutputsInfo (IPath [], int [], int): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/12)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#49">toString (): String</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/70)</TD><TD CLASS="h">0%   (0/17)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#4a">DeltaProcessor$RootInfo</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/199)</TD><TD CLASS="h">0%   (0/39)</TD></TR><TR><TD CLASS="f"><A HREF="#4a">DeltaProcessor$RootInfo (JavaProject, IPath, char [][], char [][], int): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/18)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#4c">getPackageFragmentRoot (IResource): IPackageFragmentRoot</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/41)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR><TD CLASS="f"><A HREF="#4d">isRootOfProject (IPath): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/16)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#4e">toString (): String</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/124)</TD><TD CLASS="h">0%   (0/23)</TD></TR></TABLE><P></P><TABLE CLASS="s" CELLSPACING="0" WIDTH="100%"><TR CLASS="z"><TD CLASS="l">1</TD><TD>/*******************************************************************************</TD></TR><TR><TD CLASS="l">2</TD><TD> * Copyright (c) 2000, 2009 IBM Corporation and others.</TD></TR><TR><TD CLASS="l">3</TD><TD> * All rights reserved. This program and the accompanying materials</TD></TR><TR><TD CLASS="l">4</TD><TD> * are made available under the terms of the Eclipse Public License v1.0</TD></TR><TR><TD CLASS="l">5</TD><TD> * which accompanies this distribution, and is available at</TD></TR><TR><TD CLASS="l">6</TD><TD> * http://www.eclipse.org/legal/epl-v10.html</TD></TR><TR><TD CLASS="l">7</TD><TD> *</TD></TR><TR><TD CLASS="l">8</TD><TD> * Contributors:</TD></TR><TR><TD CLASS="l">9</TD><TD> *     IBM Corporation - initial API and implementation</TD></TR><TR><TD CLASS="l">10</TD><TD> *******************************************************************************/</TD></TR><TR><TD CLASS="l">11</TD><TD>package org.eclipse.wst.jsdt.internal.core;</TD></TR><TR><TD CLASS="l">12</TD><TD> </TD></TR><TR><TD CLASS="l">13</TD><TD>import java.io.File;</TD></TR><TR><TD CLASS="l">14</TD><TD>import java.util.ArrayList;</TD></TR><TR><TD CLASS="l">15</TD><TD>import java.util.Collection;</TD></TR><TR><TD CLASS="l">16</TD><TD>import java.util.HashMap;</TD></TR><TR><TD CLASS="l">17</TD><TD>import java.util.HashSet;</TD></TR><TR><TD CLASS="l">18</TD><TD>import java.util.Iterator;</TD></TR><TR><TD CLASS="l">19</TD><TD>import java.util.Map;</TD></TR><TR><TD CLASS="l">20</TD><TD> </TD></TR><TR><TD CLASS="l">21</TD><TD>import org.eclipse.core.resources.IFile;</TD></TR><TR><TD CLASS="l">22</TD><TD>import org.eclipse.core.resources.IFolder;</TD></TR><TR><TD CLASS="l">23</TD><TD>import org.eclipse.core.resources.IProject;</TD></TR><TR><TD CLASS="l">24</TD><TD>import org.eclipse.core.resources.IResource;</TD></TR><TR><TD CLASS="l">25</TD><TD>import org.eclipse.core.resources.IResourceChangeEvent;</TD></TR><TR><TD CLASS="l">26</TD><TD>import org.eclipse.core.resources.IResourceDelta;</TD></TR><TR><TD CLASS="l">27</TD><TD>import org.eclipse.core.resources.IResourceDeltaVisitor;</TD></TR><TR><TD CLASS="l">28</TD><TD>import org.eclipse.core.resources.IWorkspaceRoot;</TD></TR><TR><TD CLASS="l">29</TD><TD>import org.eclipse.core.resources.IWorkspaceRunnable;</TD></TR><TR><TD CLASS="l">30</TD><TD>import org.eclipse.core.resources.ResourcesPlugin;</TD></TR><TR><TD CLASS="l">31</TD><TD>import org.eclipse.core.runtime.CoreException;</TD></TR><TR><TD CLASS="l">32</TD><TD>import org.eclipse.core.runtime.IPath;</TD></TR><TR><TD CLASS="l">33</TD><TD>import org.eclipse.core.runtime.IProgressMonitor;</TD></TR><TR><TD CLASS="l">34</TD><TD>import org.eclipse.core.runtime.ISafeRunnable;</TD></TR><TR><TD CLASS="l">35</TD><TD>import org.eclipse.core.runtime.OperationCanceledException;</TD></TR><TR><TD CLASS="l">36</TD><TD>import org.eclipse.core.runtime.PerformanceStats;</TD></TR><TR><TD CLASS="l">37</TD><TD>import org.eclipse.core.runtime.SafeRunner;</TD></TR><TR><TD CLASS="l">38</TD><TD>import org.eclipse.wst.jsdt.core.ElementChangedEvent;</TD></TR><TR><TD CLASS="l">39</TD><TD>import org.eclipse.wst.jsdt.core.IElementChangedListener;</TD></TR><TR><TD CLASS="l">40</TD><TD>import org.eclipse.wst.jsdt.core.IIncludePathEntry;</TD></TR><TR><TD CLASS="l">41</TD><TD>import org.eclipse.wst.jsdt.core.IJavaScriptElement;</TD></TR><TR><TD CLASS="l">42</TD><TD>import org.eclipse.wst.jsdt.core.IJavaScriptElementDelta;</TD></TR><TR><TD CLASS="l">43</TD><TD>import org.eclipse.wst.jsdt.core.IJavaScriptModel;</TD></TR><TR><TD CLASS="l">44</TD><TD>import org.eclipse.wst.jsdt.core.IJavaScriptProject;</TD></TR><TR><TD CLASS="l">45</TD><TD>import org.eclipse.wst.jsdt.core.IPackageFragment;</TD></TR><TR><TD CLASS="l">46</TD><TD>import org.eclipse.wst.jsdt.core.IPackageFragmentRoot;</TD></TR><TR><TD CLASS="l">47</TD><TD>import org.eclipse.wst.jsdt.core.JavaScriptCore;</TD></TR><TR><TD CLASS="l">48</TD><TD>import org.eclipse.wst.jsdt.core.JavaScriptModelException;</TD></TR><TR><TD CLASS="l">49</TD><TD>import org.eclipse.wst.jsdt.core.compiler.CharOperation;</TD></TR><TR><TD CLASS="l">50</TD><TD>import org.eclipse.wst.jsdt.internal.compiler.SourceElementParser;</TD></TR><TR><TD CLASS="l">51</TD><TD>import org.eclipse.wst.jsdt.internal.core.builder.JavaBuilder;</TD></TR><TR><TD CLASS="l">52</TD><TD>import org.eclipse.wst.jsdt.internal.core.hierarchy.TypeHierarchy;</TD></TR><TR><TD CLASS="l">53</TD><TD>import org.eclipse.wst.jsdt.internal.core.search.AbstractSearchScope;</TD></TR><TR><TD CLASS="l">54</TD><TD>import org.eclipse.wst.jsdt.internal.core.search.JavaWorkspaceScope;</TD></TR><TR><TD CLASS="l">55</TD><TD>import org.eclipse.wst.jsdt.internal.core.search.indexing.IndexManager;</TD></TR><TR><TD CLASS="l">56</TD><TD>import org.eclipse.wst.jsdt.internal.core.util.Util;</TD></TR><TR><TD CLASS="l">57</TD><TD> </TD></TR><TR><TD CLASS="l">58</TD><TD>/**</TD></TR><TR><TD CLASS="l">59</TD><TD> * This class is used by &lt;code&gt;JavaModelManager&lt;/code&gt; to convert</TD></TR><TR><TD CLASS="l">60</TD><TD> * &lt;code&gt;IResourceDelta&lt;/code&gt;s into &lt;code&gt;IJavaScriptElementDelta&lt;/code&gt;s.</TD></TR><TR><TD CLASS="l">61</TD><TD> * It also does some processing on the &lt;code&gt;JavaElement&lt;/code&gt;s involved</TD></TR><TR><TD CLASS="l">62</TD><TD> * (e.g. closing them or updating classpaths).</TD></TR><TR><TD CLASS="l">63</TD><TD> * &lt;p&gt;</TD></TR><TR><TD CLASS="l">64</TD><TD> * High level summary of what the delta processor does:</TD></TR><TR><TD CLASS="l">65</TD><TD> * &lt;ul&gt;</TD></TR><TR><TD CLASS="l">66</TD><TD> * &lt;li&gt;reacts to resource deltas&lt;/li&gt;</TD></TR><TR><TD CLASS="l">67</TD><TD> * &lt;li&gt;fires corresponding Java element deltas&lt;/li&gt;</TD></TR><TR><TD CLASS="l">68</TD><TD> * &lt;li&gt;deltas also contain non-Java resources changes&lt;/li&gt;</TD></TR><TR><TD CLASS="l">69</TD><TD> * &lt;li&gt;updates the model to reflect the Java element changes&lt;/li&gt;</TD></TR><TR><TD CLASS="l">70</TD><TD> * &lt;li&gt;notifies type hierarchies of the changes&lt;/li&gt;</TD></TR><TR><TD CLASS="l">71</TD><TD> * &lt;li&gt;triggers indexing of the changed elements&lt;/li&gt;</TD></TR><TR><TD CLASS="l">72</TD><TD> * &lt;li&gt;refresh external archives (delta, model update, indexing)&lt;/li&gt;</TD></TR><TR><TD CLASS="l">73</TD><TD> * &lt;li&gt;is thread safe (one delta processor instance per thread, see DeltaProcessingState#resourceChanged(...))&lt;/li&gt;</TD></TR><TR><TD CLASS="l">74</TD><TD> * &lt;li&gt;handles .classpath changes (updates package fragment roots, update project references, validate classpath (.classpath format,</TD></TR><TR><TD CLASS="l">75</TD><TD> *                 resolved classpath, cycles))&lt;/li&gt;</TD></TR><TR><TD CLASS="l">76</TD><TD> * &lt;/ul&gt;</TD></TR><TR><TD CLASS="l">77</TD><TD> */</TD></TR><TR CLASS="z"><TD CLASS="l">78</TD><TD>public class DeltaProcessor {</TD></TR><TR><TD CLASS="l">79</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="47">80</A></TD><TD>        static class OutputsInfo {</TD></TR><TR><TD CLASS="l">81</TD><TD>                int outputCount;</TD></TR><TR><TD CLASS="l">82</TD><TD>                IPath[] paths;</TD></TR><TR><TD CLASS="l">83</TD><TD>                int[] traverseModes;</TD></TR><TR CLASS="z"><TD CLASS="l">84</TD><TD>                OutputsInfo(IPath[] paths, int[] traverseModes, int outputCount) {</TD></TR><TR CLASS="z"><TD CLASS="l">85</TD><TD>                        this.paths = paths;</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="49">86</A></TD><TD>                        this.traverseModes = traverseModes;</TD></TR><TR CLASS="z"><TD CLASS="l">87</TD><TD>                        this.outputCount = outputCount;</TD></TR><TR CLASS="z"><TD CLASS="l">88</TD><TD>                }</TD></TR><TR><TD CLASS="l">89</TD><TD>                public String toString() {</TD></TR><TR CLASS="z"><TD CLASS="l">90</TD><TD>                        if (this.paths == null) return &#34;&lt;none&gt;&#34;; //$NON-NLS-1$</TD></TR><TR CLASS="z"><TD CLASS="l">91</TD><TD>                        StringBuffer buffer = new StringBuffer();</TD></TR><TR CLASS="z"><TD CLASS="l">92</TD><TD>                        for (int i = 0; i &lt; this.outputCount; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">93</TD><TD>                                buffer.append(&#34;path=&#34;); //$NON-NLS-1$</TD></TR><TR CLASS="z"><TD CLASS="l">94</TD><TD>                                buffer.append(this.paths[i].toString());</TD></TR><TR CLASS="z"><TD CLASS="l">95</TD><TD>                                buffer.append(&#34;\n-&gt;traverse=&#34;); //$NON-NLS-1$</TD></TR><TR CLASS="z"><TD CLASS="l">96</TD><TD>                                switch (this.traverseModes[i]) {</TD></TR><TR><TD CLASS="l">97</TD><TD>                                        case BINARY:</TD></TR><TR CLASS="z"><TD CLASS="l">98</TD><TD>                                                buffer.append(&#34;BINARY&#34;); //$NON-NLS-1$</TD></TR><TR CLASS="z"><TD CLASS="l">99</TD><TD>                                                break;</TD></TR><TR><TD CLASS="l">100</TD><TD>                                        case IGNORE:</TD></TR><TR CLASS="z"><TD CLASS="l">101</TD><TD>                                                buffer.append(&#34;IGNORE&#34;); //$NON-NLS-1$</TD></TR><TR CLASS="z"><TD CLASS="l">102</TD><TD>                                                break;</TD></TR><TR><TD CLASS="l">103</TD><TD>                                        case SOURCE:</TD></TR><TR CLASS="z"><TD CLASS="l">104</TD><TD>                                                buffer.append(&#34;SOURCE&#34;); //$NON-NLS-1$</TD></TR><TR CLASS="z"><TD CLASS="l">105</TD><TD>                                                break;</TD></TR><TR><TD CLASS="l">106</TD><TD>                                        default:</TD></TR><TR CLASS="z"><TD CLASS="l">107</TD><TD>                                                buffer.append(&#34;&lt;unknown&gt;&#34;); //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">108</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">109</TD><TD>                                if (i+1 &lt; this.outputCount) {</TD></TR><TR CLASS="z"><TD CLASS="l">110</TD><TD>                                        buffer.append('\n');</TD></TR><TR><TD CLASS="l">111</TD><TD>                                }</TD></TR><TR><TD CLASS="l">112</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">113</TD><TD>                        return buffer.toString();</TD></TR><TR><TD CLASS="l">114</TD><TD>                }</TD></TR><TR><TD CLASS="l">115</TD><TD>        }</TD></TR><TR><TD CLASS="l">116</TD><TD> </TD></TR><TR><TD CLASS="l">117</TD><TD>        static class RootInfo {</TD></TR><TR><TD CLASS="l">118</TD><TD>                char[][] inclusionPatterns;</TD></TR><TR><TD CLASS="l">119</TD><TD>                char[][] exclusionPatterns;</TD></TR><TR><TD CLASS="l"><A NAME="4a">120</A></TD><TD>                JavaProject project;</TD></TR><TR><TD CLASS="l">121</TD><TD>                IPath rootPath;</TD></TR><TR><TD CLASS="l">122</TD><TD>                int entryKind;</TD></TR><TR><TD CLASS="l">123</TD><TD>                IPackageFragmentRoot root;</TD></TR><TR CLASS="z"><TD CLASS="l">124</TD><TD>                RootInfo(JavaProject project, IPath rootPath, char[][] inclusionPatterns, char[][] exclusionPatterns, int entryKind) {</TD></TR><TR CLASS="z"><TD CLASS="l">125</TD><TD>                        this.project = project;</TD></TR><TR CLASS="z"><TD CLASS="l">126</TD><TD>                        this.rootPath = rootPath;</TD></TR><TR CLASS="z"><TD CLASS="l">127</TD><TD>                        this.inclusionPatterns = inclusionPatterns;</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="4c">128</A></TD><TD>                        this.exclusionPatterns = exclusionPatterns;</TD></TR><TR CLASS="z"><TD CLASS="l">129</TD><TD>                        this.entryKind = entryKind;</TD></TR><TR CLASS="z"><TD CLASS="l">130</TD><TD>                }</TD></TR><TR><TD CLASS="l">131</TD><TD>                IPackageFragmentRoot getPackageFragmentRoot(IResource resource) {</TD></TR><TR CLASS="z"><TD CLASS="l">132</TD><TD>                        if (this.root == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">133</TD><TD>                                if (resource != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">134</TD><TD>                                        this.root = this.project.getPackageFragmentRoot(resource);</TD></TR><TR><TD CLASS="l">135</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">136</TD><TD>                                        Object target = JavaModel.getTarget(ResourcesPlugin.getWorkspace().getRoot(), this.rootPath, false/*don't check existence*/);</TD></TR><TR CLASS="z"><TD CLASS="l">137</TD><TD>                                        if (target instanceof IResource) {</TD></TR><TR CLASS="z"><TD CLASS="l">138</TD><TD>                                                this.root = this.project.getPackageFragmentRoot((IResource)target);</TD></TR><TR><TD CLASS="l">139</TD><TD>                                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">140</TD><TD>                                                this.root = this.project.getPackageFragmentRoot(this.rootPath.toOSString());</TD></TR><TR><TD CLASS="l">141</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">142</TD><TD>                                }</TD></TR><TR><TD CLASS="l"><A NAME="4d">143</A></TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">144</TD><TD>                        return this.root;</TD></TR><TR><TD CLASS="l">145</TD><TD>                }</TD></TR><TR><TD CLASS="l"><A NAME="4e">146</A></TD><TD>                boolean isRootOfProject(IPath path) {</TD></TR><TR CLASS="z"><TD CLASS="l">147</TD><TD>                        return this.rootPath.equals(path) &amp;&amp; this.project.getProject().getFullPath().isPrefixOf(path);</TD></TR><TR><TD CLASS="l">148</TD><TD>                }</TD></TR><TR><TD CLASS="l">149</TD><TD>                public String toString() {</TD></TR><TR CLASS="z"><TD CLASS="l">150</TD><TD>                        StringBuffer buffer = new StringBuffer(&#34;project=&#34;); //$NON-NLS-1$</TD></TR><TR CLASS="z"><TD CLASS="l">151</TD><TD>                        if (this.project == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">152</TD><TD>                                buffer.append(&#34;null&#34;); //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">153</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">154</TD><TD>                                buffer.append(this.project.getElementName());</TD></TR><TR><TD CLASS="l">155</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">156</TD><TD>                        buffer.append(&#34;\npath=&#34;); //$NON-NLS-1$</TD></TR><TR CLASS="z"><TD CLASS="l">157</TD><TD>                        if (this.rootPath == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">158</TD><TD>                                buffer.append(&#34;null&#34;); //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">159</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">160</TD><TD>                                buffer.append(this.rootPath.toString());</TD></TR><TR><TD CLASS="l">161</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">162</TD><TD>                        buffer.append(&#34;\nincluding=&#34;); //$NON-NLS-1$</TD></TR><TR CLASS="z"><TD CLASS="l">163</TD><TD>                        if (this.inclusionPatterns == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">164</TD><TD>                                buffer.append(&#34;null&#34;); //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">165</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">166</TD><TD>                                for (int i = 0, length = this.inclusionPatterns.length; i &lt; length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">167</TD><TD>                                        buffer.append(new String(this.inclusionPatterns[i]));</TD></TR><TR CLASS="z"><TD CLASS="l">168</TD><TD>                                        if (i &lt; length-1) {</TD></TR><TR CLASS="z"><TD CLASS="l">169</TD><TD>                                                buffer.append(&#34;|&#34;); //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">170</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">171</TD><TD>                                }</TD></TR><TR><TD CLASS="l">172</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">173</TD><TD>                        buffer.append(&#34;\nexcluding=&#34;); //$NON-NLS-1$</TD></TR><TR CLASS="z"><TD CLASS="l">174</TD><TD>                        if (this.exclusionPatterns == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">175</TD><TD>                                buffer.append(&#34;null&#34;); //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">176</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">177</TD><TD>                                for (int i = 0, length = this.exclusionPatterns.length; i &lt; length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">178</TD><TD>                                        buffer.append(new String(this.exclusionPatterns[i]));</TD></TR><TR CLASS="z"><TD CLASS="l">179</TD><TD>                                        if (i &lt; length-1) {</TD></TR><TR CLASS="z"><TD CLASS="l">180</TD><TD>                                                buffer.append(&#34;|&#34;); //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">181</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">182</TD><TD>                                }</TD></TR><TR><TD CLASS="l">183</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">184</TD><TD>                        return buffer.toString();</TD></TR><TR><TD CLASS="l">185</TD><TD>                }</TD></TR><TR><TD CLASS="l">186</TD><TD>        }</TD></TR><TR><TD CLASS="l">187</TD><TD> </TD></TR><TR><TD CLASS="l">188</TD><TD>        private final static int IGNORE = 0;</TD></TR><TR><TD CLASS="l">189</TD><TD>        private final static int SOURCE = 1;</TD></TR><TR><TD CLASS="l">190</TD><TD>        private final static int BINARY = 2;</TD></TR><TR><TD CLASS="l">191</TD><TD> </TD></TR><TR><TD CLASS="l">192</TD><TD>        private final static String EXTERNAL_JAR_ADDED = &#34;external jar added&#34;; //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">193</TD><TD>        private final static String EXTERNAL_JAR_CHANGED = &#34;external jar changed&#34;; //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">194</TD><TD>        private final static String EXTERNAL_JAR_REMOVED = &#34;external jar removed&#34;; //$NON-NLS-1$</TD></TR><TR><TD CLASS="l"><A NAME="0">195</A></TD><TD>        private final static String EXTERNAL_JAR_UNCHANGED = &#34;external jar unchanged&#34;; //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">196</TD><TD>        private final static String INTERNAL_JAR_IGNORE = &#34;internal jar ignore&#34;; //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">197</TD><TD> </TD></TR><TR><TD CLASS="l">198</TD><TD>        private final static int NON_JAVA_RESOURCE = -1;</TD></TR><TR CLASS="z"><TD CLASS="l">199</TD><TD>        public static boolean DEBUG = false;</TD></TR><TR CLASS="z"><TD CLASS="l">200</TD><TD>        public static boolean VERBOSE = false;</TD></TR><TR CLASS="z"><TD CLASS="l">201</TD><TD>        public static boolean PERF = false;</TD></TR><TR><TD CLASS="l">202</TD><TD> </TD></TR><TR><TD CLASS="l">203</TD><TD>        public static final int DEFAULT_CHANGE_EVENT = 0; // must not collide with ElementChangedEvent event masks</TD></TR><TR><TD CLASS="l">204</TD><TD> </TD></TR><TR><TD CLASS="l">205</TD><TD>        /*</TD></TR><TR><TD CLASS="l"><A NAME="1b">206</A></TD><TD>         * Answer a combination of the lastModified stamp and the size.</TD></TR><TR><TD CLASS="l">207</TD><TD>         * Used for detecting external JAR changes</TD></TR><TR><TD CLASS="l">208</TD><TD>         */</TD></TR><TR><TD CLASS="l">209</TD><TD>        public static long getTimeStamp(File file) {</TD></TR><TR CLASS="z"><TD CLASS="l">210</TD><TD>                return file.lastModified() + file.length();</TD></TR><TR><TD CLASS="l">211</TD><TD>        }</TD></TR><TR><TD CLASS="l">212</TD><TD> </TD></TR><TR><TD CLASS="l">213</TD><TD>        /*</TD></TR><TR><TD CLASS="l">214</TD><TD>         * The global state of delta processing.</TD></TR><TR><TD CLASS="l">215</TD><TD>         */</TD></TR><TR><TD CLASS="l">216</TD><TD>        private DeltaProcessingState state;</TD></TR><TR><TD CLASS="l">217</TD><TD> </TD></TR><TR><TD CLASS="l">218</TD><TD>        /*</TD></TR><TR><TD CLASS="l">219</TD><TD>         * The Java model manager</TD></TR><TR><TD CLASS="l">220</TD><TD>         */</TD></TR><TR><TD CLASS="l">221</TD><TD>        JavaModelManager manager;</TD></TR><TR><TD CLASS="l">222</TD><TD> </TD></TR><TR><TD CLASS="l">223</TD><TD>        /*</TD></TR><TR><TD CLASS="l">224</TD><TD>         * The &lt;code&gt;JavaElementDelta&lt;/code&gt; corresponding to the &lt;code&gt;IResourceDelta&lt;/code&gt; being translated.</TD></TR><TR><TD CLASS="l">225</TD><TD>         */</TD></TR><TR><TD CLASS="l">226</TD><TD>        private JavaElementDelta currentDelta;</TD></TR><TR><TD CLASS="l">227</TD><TD> </TD></TR><TR><TD CLASS="l">228</TD><TD>        /* The java element that was last created (see createElement(IResource)).</TD></TR><TR><TD CLASS="l">229</TD><TD>         * This is used as a stack of java elements (using getParent() to pop it, and</TD></TR><TR><TD CLASS="l">230</TD><TD>         * using the various get*(...) to push it. */</TD></TR><TR><TD CLASS="l">231</TD><TD>        private Openable currentElement;</TD></TR><TR><TD CLASS="l">232</TD><TD> </TD></TR><TR><TD CLASS="l">233</TD><TD>        /*</TD></TR><TR><TD CLASS="l">234</TD><TD>         * Queue of deltas created explicily by the Java Model that</TD></TR><TR><TD CLASS="l">235</TD><TD>         * have yet to be fired.</TD></TR><TR><TD CLASS="l">236</TD><TD>         */</TD></TR><TR CLASS="z"><TD CLASS="l">237</TD><TD>        public ArrayList javaModelDeltas= new ArrayList();</TD></TR><TR><TD CLASS="l">238</TD><TD> </TD></TR><TR><TD CLASS="l">239</TD><TD>        /*</TD></TR><TR><TD CLASS="l">240</TD><TD>         * Queue of reconcile deltas on working copies that have yet to be fired.</TD></TR><TR><TD CLASS="l">241</TD><TD>         * This is a table form IWorkingCopy to IJavaScriptElementDelta</TD></TR><TR><TD CLASS="l">242</TD><TD>         */</TD></TR><TR CLASS="z"><TD CLASS="l">243</TD><TD>        public HashMap reconcileDeltas = new HashMap();</TD></TR><TR><TD CLASS="l">244</TD><TD> </TD></TR><TR><TD CLASS="l">245</TD><TD>        /*</TD></TR><TR><TD CLASS="l">246</TD><TD>         * Turns delta firing on/off. By default it is on.</TD></TR><TR><TD CLASS="l">247</TD><TD>         */</TD></TR><TR CLASS="z"><TD CLASS="l">248</TD><TD>        private boolean isFiring= true;</TD></TR><TR><TD CLASS="l">249</TD><TD> </TD></TR><TR><TD CLASS="l">250</TD><TD>        /*</TD></TR><TR><TD CLASS="l">251</TD><TD>         * Used to update the JavaModel for &lt;code&gt;IJavaScriptElementDelta&lt;/code&gt;s.</TD></TR><TR><TD CLASS="l">252</TD><TD>         */</TD></TR><TR CLASS="z"><TD CLASS="l">253</TD><TD>        private final ModelUpdater modelUpdater = new ModelUpdater();</TD></TR><TR><TD CLASS="l">254</TD><TD> </TD></TR><TR><TD CLASS="l">255</TD><TD>        /* A set of IJavaScriptProject whose caches need to be reset */</TD></TR><TR CLASS="z"><TD CLASS="l">256</TD><TD>        public HashSet projectCachesToReset = new HashSet();</TD></TR><TR><TD CLASS="l">257</TD><TD> </TD></TR><TR><TD CLASS="l">258</TD><TD>        /*</TD></TR><TR><TD CLASS="l">259</TD><TD>         * A list of IJavaScriptElement used as a scope for external archives refresh during POST_CHANGE.</TD></TR><TR><TD CLASS="l">260</TD><TD>         * This is null if no refresh is needed.</TD></TR><TR><TD CLASS="l">261</TD><TD>         */</TD></TR><TR><TD CLASS="l">262</TD><TD>        private HashSet refreshedElements;</TD></TR><TR><TD CLASS="l">263</TD><TD> </TD></TR><TR><TD CLASS="l">264</TD><TD>        /* A table from IJavaScriptProject to an array of IPackageFragmentRoot.</TD></TR><TR><TD CLASS="l">265</TD><TD>         * This table contains the pkg fragment roots of the project that are being deleted.</TD></TR><TR><TD CLASS="l">266</TD><TD>         */</TD></TR><TR><TD CLASS="l">267</TD><TD>        public Map oldRoots;</TD></TR><TR><TD CLASS="l">268</TD><TD> </TD></TR><TR><TD CLASS="l">269</TD><TD>        /* A set of IJavaScriptProject whose package fragment roots need to be refreshed */</TD></TR><TR CLASS="z"><TD CLASS="l">270</TD><TD>        private HashSet rootsToRefresh = new HashSet();</TD></TR><TR><TD CLASS="l">271</TD><TD> </TD></TR><TR><TD CLASS="l">272</TD><TD>        /*</TD></TR><TR><TD CLASS="l">273</TD><TD>         * Type of event that should be processed no matter what the real event type is.</TD></TR><TR><TD CLASS="l">274</TD><TD>         */</TD></TR><TR CLASS="z"><TD CLASS="l">275</TD><TD>        public int overridenEventType = -1;</TD></TR><TR><TD CLASS="l">276</TD><TD> </TD></TR><TR><TD CLASS="l">277</TD><TD>        /*</TD></TR><TR><TD CLASS="l">278</TD><TD>         * Cache SourceElementParser for the project being visited</TD></TR><TR><TD CLASS="l">279</TD><TD>         */</TD></TR><TR><TD CLASS="l">280</TD><TD>        private SourceElementParser sourceElementParserCache;</TD></TR><TR><TD CLASS="l">281</TD><TD> </TD></TR><TR><TD CLASS="l">282</TD><TD>        /*</TD></TR><TR><TD CLASS="l"><A NAME="2">283</A></TD><TD>         * Map from IProject to ClasspathChange</TD></TR><TR><TD CLASS="l">284</TD><TD>         */</TD></TR><TR CLASS="z"><TD CLASS="l">285</TD><TD>        public HashMap classpathChanges = new HashMap();</TD></TR><TR><TD CLASS="l">286</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">287</TD><TD>        public DeltaProcessor(DeltaProcessingState state, JavaModelManager manager) {</TD></TR><TR CLASS="z"><TD CLASS="l">288</TD><TD>                this.state = state;</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="3">289</A></TD><TD>                this.manager = manager;</TD></TR><TR CLASS="z"><TD CLASS="l">290</TD><TD>        }</TD></TR><TR><TD CLASS="l">291</TD><TD> </TD></TR><TR><TD CLASS="l">292</TD><TD>        public ClasspathChange addClasspathChange(IProject project, IIncludePathEntry[] oldRawClasspath, IPath oldOutputLocation, IIncludePathEntry[] oldResolvedClasspath) {</TD></TR><TR CLASS="z"><TD CLASS="l">293</TD><TD>                ClasspathChange change = (ClasspathChange) this.classpathChanges.get(project);</TD></TR><TR CLASS="z"><TD CLASS="l">294</TD><TD>                if (change == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">295</TD><TD>                        change = new ClasspathChange((JavaProject) this.manager.getJavaModel().getJavaProject(project), oldRawClasspath, oldOutputLocation, oldResolvedClasspath);</TD></TR><TR CLASS="z"><TD CLASS="l">296</TD><TD>                        this.classpathChanges.put(project, change);</TD></TR><TR><TD CLASS="l">297</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">298</TD><TD>                        if (change.oldRawClasspath == null)</TD></TR><TR CLASS="z"><TD CLASS="l">299</TD><TD>                                change.oldRawClasspath = oldRawClasspath;</TD></TR><TR CLASS="z"><TD CLASS="l">300</TD><TD>                        if (change.oldOutputLocation == null)</TD></TR><TR CLASS="z"><TD CLASS="l">301</TD><TD>                                change.oldOutputLocation = oldOutputLocation;</TD></TR><TR CLASS="z"><TD CLASS="l">302</TD><TD>                        if (change.oldResolvedClasspath == null)</TD></TR><TR CLASS="z"><TD CLASS="l">303</TD><TD>                                change.oldResolvedClasspath = oldResolvedClasspath;</TD></TR><TR><TD CLASS="l">304</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">305</TD><TD>                return change;</TD></TR><TR><TD CLASS="l">306</TD><TD>        }</TD></TR><TR><TD CLASS="l">307</TD><TD> </TD></TR><TR><TD CLASS="l">308</TD><TD>        /*</TD></TR><TR><TD CLASS="l"><A NAME="4">309</A></TD><TD>         * Adds the dependents of the given project to the list of the projects</TD></TR><TR><TD CLASS="l">310</TD><TD>         * to update.</TD></TR><TR><TD CLASS="l">311</TD><TD>         */</TD></TR><TR><TD CLASS="l">312</TD><TD>        private void addDependentProjects(IJavaScriptProject project, HashMap projectDependencies, HashSet result) {</TD></TR><TR CLASS="z"><TD CLASS="l">313</TD><TD>                IJavaScriptProject[] dependents = (IJavaScriptProject[]) projectDependencies.get(project);</TD></TR><TR CLASS="z"><TD CLASS="l">314</TD><TD>                if (dependents == null) return;</TD></TR><TR CLASS="z"><TD CLASS="l">315</TD><TD>                for (int i = 0, length = dependents.length; i &lt; length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">316</TD><TD>                        IJavaScriptProject dependent = dependents[i];</TD></TR><TR CLASS="z"><TD CLASS="l">317</TD><TD>                        if (result.contains(dependent))</TD></TR><TR CLASS="z"><TD CLASS="l">318</TD><TD>                                continue; // no need to go further as the project is already known</TD></TR><TR CLASS="z"><TD CLASS="l">319</TD><TD>                        result.add(dependent);</TD></TR><TR CLASS="z"><TD CLASS="l">320</TD><TD>                        addDependentProjects(dependent, projectDependencies, result);</TD></TR><TR><TD CLASS="l">321</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">322</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="5">323</A></TD><TD>        /*</TD></TR><TR><TD CLASS="l">324</TD><TD>         * Adds the given element to the list of elements used as a scope for external jars refresh.</TD></TR><TR><TD CLASS="l">325</TD><TD>         */</TD></TR><TR><TD CLASS="l">326</TD><TD>        public void addForRefresh(IJavaScriptElement element) {</TD></TR><TR CLASS="z"><TD CLASS="l">327</TD><TD>                if (this.refreshedElements == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">328</TD><TD>                        this.refreshedElements = new HashSet();</TD></TR><TR><TD CLASS="l">329</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">330</TD><TD>                this.refreshedElements.add(element);</TD></TR><TR CLASS="z"><TD CLASS="l">331</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="6">332</A></TD><TD>        /*</TD></TR><TR><TD CLASS="l">333</TD><TD>         * Adds the given child handle to its parent's cache of children.</TD></TR><TR><TD CLASS="l">334</TD><TD>         */</TD></TR><TR><TD CLASS="l">335</TD><TD>        private void addToParentInfo(Openable child) {</TD></TR><TR CLASS="z"><TD CLASS="l">336</TD><TD>                Openable parent = (Openable) child.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">337</TD><TD>                if (parent != null &amp;&amp; parent.isOpen()) {</TD></TR><TR><TD CLASS="l">338</TD><TD>                        try {</TD></TR><TR CLASS="z"><TD CLASS="l">339</TD><TD>                                JavaElementInfo info = (JavaElementInfo)parent.getElementInfo();</TD></TR><TR CLASS="z"><TD CLASS="l">340</TD><TD>                                info.addChild(child);</TD></TR><TR CLASS="z"><TD CLASS="l">341</TD><TD>                        } catch (JavaScriptModelException e) {</TD></TR><TR><TD CLASS="l">342</TD><TD>                                // do nothing - we already checked if open</TD></TR><TR><TD CLASS="l">343</TD><TD>                        }</TD></TR><TR><TD CLASS="l">344</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">345</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="7">346</A></TD><TD>        /*</TD></TR><TR><TD CLASS="l">347</TD><TD>         * Adds the given project and its dependents to the list of the roots to refresh.</TD></TR><TR><TD CLASS="l">348</TD><TD>         */</TD></TR><TR><TD CLASS="l">349</TD><TD>        private void addToRootsToRefreshWithDependents(IJavaScriptProject javaProject) {</TD></TR><TR CLASS="z"><TD CLASS="l">350</TD><TD>                this.rootsToRefresh.add(javaProject);</TD></TR><TR CLASS="z"><TD CLASS="l">351</TD><TD>                this.addDependentProjects(javaProject, this.state.projectDependencies, this.rootsToRefresh);</TD></TR><TR CLASS="z"><TD CLASS="l">352</TD><TD>        }</TD></TR><TR><TD CLASS="l">353</TD><TD>        /*</TD></TR><TR><TD CLASS="l"><A NAME="8">354</A></TD><TD>         * Check all external archive (referenced by given roots, projects or model) status and issue a corresponding root delta.</TD></TR><TR><TD CLASS="l">355</TD><TD>         * Also triggers index updates</TD></TR><TR><TD CLASS="l">356</TD><TD>         */</TD></TR><TR><TD CLASS="l">357</TD><TD>        public void checkExternalArchiveChanges(IJavaScriptElement[] elementsToRefresh, IProgressMonitor monitor) throws JavaScriptModelException {</TD></TR><TR CLASS="z"><TD CLASS="l">358</TD><TD>                if (monitor != null &amp;&amp; monitor.isCanceled())</TD></TR><TR CLASS="z"><TD CLASS="l">359</TD><TD>                        throw new OperationCanceledException();</TD></TR><TR><TD CLASS="l">360</TD><TD>                try {</TD></TR><TR CLASS="z"><TD CLASS="l">361</TD><TD>                        if (monitor != null) monitor.beginTask(&#34;&#34;, 1); //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">362</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">363</TD><TD>                        for (int i = 0, length = elementsToRefresh.length; i &lt; length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">364</TD><TD>                                this.addForRefresh(elementsToRefresh[i]);</TD></TR><TR><TD CLASS="l">365</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">366</TD><TD>                        boolean hasDelta = this.createExternalArchiveDelta(monitor);</TD></TR><TR CLASS="z"><TD CLASS="l">367</TD><TD>                        if (monitor != null &amp;&amp; monitor.isCanceled()) return;</TD></TR><TR CLASS="z"><TD CLASS="l">368</TD><TD>                        if (hasDelta){</TD></TR><TR><TD CLASS="l">369</TD><TD>                                // force classpath marker refresh of affected projects</TD></TR><TR CLASS="z"><TD CLASS="l">370</TD><TD>                                JavaModel.flushExternalFileCache();</TD></TR><TR><TD CLASS="l">371</TD><TD> </TD></TR><TR><TD CLASS="l">372</TD><TD>                                // flush jar type cache</TD></TR><TR CLASS="z"><TD CLASS="l">373</TD><TD>                                JavaModelManager.getJavaModelManager().resetJarTypeCache();</TD></TR><TR><TD CLASS="l">374</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">375</TD><TD>                                IJavaScriptElementDelta[] projectDeltas = this.currentDelta.getAffectedChildren();</TD></TR><TR CLASS="z"><TD CLASS="l">376</TD><TD>                                final int length = projectDeltas.length;</TD></TR><TR CLASS="z"><TD CLASS="l">377</TD><TD>                                final IProject[] projectsToTouch = new IProject[length];</TD></TR><TR CLASS="z"><TD CLASS="l">378</TD><TD>                                for (int i = 0; i &lt; length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">379</TD><TD>                                        IJavaScriptElementDelta delta = projectDeltas[i];</TD></TR><TR CLASS="z"><TD CLASS="l">380</TD><TD>                                        JavaProject javaProject = (JavaProject)delta.getElement();</TD></TR><TR CLASS="z"><TD CLASS="l">381</TD><TD>                                        projectsToTouch[i] = javaProject.getProject();</TD></TR><TR><TD CLASS="l">382</TD><TD>                                }</TD></TR><TR><TD CLASS="l"><A NAME="37">383</A></TD><TD> </TD></TR><TR><TD CLASS="l">384</TD><TD>                                // touch the projects to force them to be recompiled while taking the workspace lock</TD></TR><TR><TD CLASS="l"><A NAME="39">385</A></TD><TD>                                // so that there is no concurrency with the Java builder</TD></TR><TR><TD CLASS="l">386</TD><TD>                                // see https://bugs.eclipse.org/bugs/show_bug.cgi?id=96575</TD></TR><TR CLASS="z"><TD CLASS="l">387</TD><TD>                                IWorkspaceRunnable runnable = new IWorkspaceRunnable() {</TD></TR><TR><TD CLASS="l">388</TD><TD>                                        public void run(IProgressMonitor progressMonitor) throws CoreException {</TD></TR><TR CLASS="z"><TD CLASS="l">389</TD><TD>                                                for (int i = 0; i &lt; length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">390</TD><TD>                                                        IProject project = projectsToTouch[i];</TD></TR><TR><TD CLASS="l">391</TD><TD> </TD></TR><TR><TD CLASS="l">392</TD><TD>                                                        // touch to force a build of this project</TD></TR><TR CLASS="z"><TD CLASS="l">393</TD><TD>                                                        if (JavaBuilder.DEBUG)</TD></TR><TR CLASS="z"><TD CLASS="l">394</TD><TD>                                                                System.out.println(&#34;Touching project &#34; + project.getName() + &#34; due to external jar file change&#34;); //$NON-NLS-1$ //$NON-NLS-2$</TD></TR><TR CLASS="z"><TD CLASS="l">395</TD><TD>                                                        project.touch(progressMonitor);</TD></TR><TR><TD CLASS="l">396</TD><TD>                                                }</TD></TR><TR CLASS="z"><TD CLASS="l">397</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">398</TD><TD>                                };</TD></TR><TR><TD CLASS="l">399</TD><TD>                                try {</TD></TR><TR CLASS="z"><TD CLASS="l">400</TD><TD>                                        ResourcesPlugin.getWorkspace().run(runnable, monitor);</TD></TR><TR CLASS="z"><TD CLASS="l">401</TD><TD>                                } catch (CoreException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">402</TD><TD>                                        throw new JavaScriptModelException(e);</TD></TR><TR><TD CLASS="l">403</TD><TD>                                }</TD></TR><TR><TD CLASS="l">404</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">405</TD><TD>                                if (this.currentDelta != null) { // if delta has not been fired while creating markers</TD></TR><TR CLASS="z"><TD CLASS="l">406</TD><TD>                                        this.fire(this.currentDelta, DEFAULT_CHANGE_EVENT);</TD></TR><TR><TD CLASS="l">407</TD><TD>                                }</TD></TR><TR><TD CLASS="l">408</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">409</TD><TD>                } finally {</TD></TR><TR CLASS="z"><TD CLASS="l">410</TD><TD>                        this.currentDelta = null;</TD></TR><TR CLASS="z"><TD CLASS="l">411</TD><TD>                        if (monitor != null) monitor.done();</TD></TR><TR CLASS="z"><TD CLASS="l">412</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">413</TD><TD>        }</TD></TR><TR><TD CLASS="l">414</TD><TD>        /*</TD></TR><TR><TD CLASS="l">415</TD><TD>         * Process the given delta and look for projects being added, opened, closed or</TD></TR><TR><TD CLASS="l">416</TD><TD>         * with a java nature being added or removed.</TD></TR><TR><TD CLASS="l">417</TD><TD>         * Note that projects being deleted are checked in deleting(IProject).</TD></TR><TR><TD CLASS="l"><A NAME="a">418</A></TD><TD>         * In all cases, add the project's dependents to the list of projects to update</TD></TR><TR><TD CLASS="l">419</TD><TD>         * so that the classpath related markers can be updated.</TD></TR><TR><TD CLASS="l">420</TD><TD>         */</TD></TR><TR><TD CLASS="l">421</TD><TD>        private void checkProjectsBeingAddedOrRemoved(IResourceDelta delta) {</TD></TR><TR CLASS="z"><TD CLASS="l">422</TD><TD>                IResource resource = delta.getResource();</TD></TR><TR CLASS="z"><TD CLASS="l">423</TD><TD>                IResourceDelta[] children = null;</TD></TR><TR><TD CLASS="l">424</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">425</TD><TD>                switch (resource.getType()) {</TD></TR><TR><TD CLASS="l">426</TD><TD>                        case IResource.ROOT :</TD></TR><TR><TD CLASS="l">427</TD><TD>                                // workaround for bug 15168 circular errors not reported</TD></TR><TR CLASS="z"><TD CLASS="l">428</TD><TD>                                this.state.getOldJavaProjecNames(); // force list to be computed</TD></TR><TR CLASS="z"><TD CLASS="l">429</TD><TD>                                children = delta.getAffectedChildren();</TD></TR><TR CLASS="z"><TD CLASS="l">430</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">431</TD><TD>                        case IResource.PROJECT :</TD></TR><TR><TD CLASS="l">432</TD><TD>                                // NB: No need to check project's nature as if the project is not a java project:</TD></TR><TR><TD CLASS="l">433</TD><TD>                                //     - if the project is added or changed this is a noop for projectsBeingDeleted</TD></TR><TR><TD CLASS="l">434</TD><TD>                                //     - if the project is closed, it has already lost its java nature</TD></TR><TR CLASS="z"><TD CLASS="l">435</TD><TD>                                IProject project = (IProject)resource;</TD></TR><TR CLASS="z"><TD CLASS="l">436</TD><TD>                                JavaProject javaProject = (JavaProject)JavaScriptCore.create(project);</TD></TR><TR CLASS="z"><TD CLASS="l">437</TD><TD>                                switch (delta.getKind()) {</TD></TR><TR><TD CLASS="l">438</TD><TD>                                        case IResourceDelta.ADDED :</TD></TR><TR CLASS="z"><TD CLASS="l">439</TD><TD>                                                this.manager.batchContainerInitializations = true;</TD></TR><TR><TD CLASS="l">440</TD><TD> </TD></TR><TR><TD CLASS="l">441</TD><TD>                                                // remember project and its dependents</TD></TR><TR CLASS="z"><TD CLASS="l">442</TD><TD>                                                addToRootsToRefreshWithDependents(javaProject);</TD></TR><TR><TD CLASS="l">443</TD><TD> </TD></TR><TR><TD CLASS="l">444</TD><TD>                                                // workaround for bug 15168 circular errors not reported</TD></TR><TR CLASS="z"><TD CLASS="l">445</TD><TD>                                                if (JavaProject.hasJavaNature(project)) {</TD></TR><TR CLASS="z"><TD CLASS="l">446</TD><TD>                                                        addToParentInfo(javaProject);</TD></TR><TR CLASS="z"><TD CLASS="l">447</TD><TD>                                                        readRawClasspath(javaProject);</TD></TR><TR><TD CLASS="l">448</TD><TD>                                                        // ensure project references are updated (see https://bugs.eclipse.org/bugs/show_bug.cgi?id=121569)</TD></TR><TR CLASS="z"><TD CLASS="l">449</TD><TD>                                                        checkProjectReferenceChange(project, javaProject);</TD></TR><TR><TD CLASS="l">450</TD><TD>                                                }</TD></TR><TR><TD CLASS="l">451</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">452</TD><TD>                                                this.state.rootsAreStale = true;</TD></TR><TR CLASS="z"><TD CLASS="l">453</TD><TD>                                                break;</TD></TR><TR><TD CLASS="l">454</TD><TD> </TD></TR><TR><TD CLASS="l">455</TD><TD>                                        case IResourceDelta.CHANGED :</TD></TR><TR CLASS="z"><TD CLASS="l">456</TD><TD>                                                        if ((delta.getFlags() &amp; IResourceDelta.OPEN) != 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">457</TD><TD>                                                                this.manager.batchContainerInitializations = true;</TD></TR><TR><TD CLASS="l">458</TD><TD> </TD></TR><TR><TD CLASS="l">459</TD><TD>                                                                // project opened or closed: remember  project and its dependents</TD></TR><TR CLASS="z"><TD CLASS="l">460</TD><TD>                                                                addToRootsToRefreshWithDependents(javaProject);</TD></TR><TR><TD CLASS="l">461</TD><TD> </TD></TR><TR><TD CLASS="l">462</TD><TD>                                                                // workaround for bug 15168 circular errors not reported</TD></TR><TR CLASS="z"><TD CLASS="l">463</TD><TD>                                                                if (project.isOpen()) {</TD></TR><TR CLASS="z"><TD CLASS="l">464</TD><TD>                                                                        if (JavaProject.hasJavaNature(project)) {</TD></TR><TR CLASS="z"><TD CLASS="l">465</TD><TD>                                                                                addToParentInfo(javaProject);</TD></TR><TR CLASS="z"><TD CLASS="l">466</TD><TD>                                                                                readRawClasspath(javaProject);</TD></TR><TR><TD CLASS="l">467</TD><TD>                                                                                // ensure project references are updated</TD></TR><TR CLASS="z"><TD CLASS="l">468</TD><TD>                                                                                checkProjectReferenceChange(project, javaProject);</TD></TR><TR><TD CLASS="l">469</TD><TD>                                                                        }</TD></TR><TR><TD CLASS="l">470</TD><TD>                                                                } else {</TD></TR><TR><TD CLASS="l">471</TD><TD>                                                                        try {</TD></TR><TR CLASS="z"><TD CLASS="l">472</TD><TD>                                                                                javaProject.close();</TD></TR><TR CLASS="z"><TD CLASS="l">473</TD><TD>                                                                        } catch (JavaScriptModelException e) {</TD></TR><TR><TD CLASS="l">474</TD><TD>                                                                                // java project doesn't exist: ignore</TD></TR><TR><TD CLASS="l">475</TD><TD>                                                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">476</TD><TD>                                                                        this.removeFromParentInfo(javaProject);</TD></TR><TR CLASS="z"><TD CLASS="l">477</TD><TD>                                                                        this.manager.removePerProjectInfo(javaProject);</TD></TR><TR CLASS="z"><TD CLASS="l">478</TD><TD>                                                                        this.manager.containerRemove(javaProject);</TD></TR><TR><TD CLASS="l">479</TD><TD>                                                                }</TD></TR><TR CLASS="z"><TD CLASS="l">480</TD><TD>                                                                this.state.rootsAreStale = true;</TD></TR><TR CLASS="z"><TD CLASS="l">481</TD><TD>                                                        } else if ((delta.getFlags() &amp; IResourceDelta.DESCRIPTION) != 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">482</TD><TD>                                                                boolean wasJavaProject = this.state.findJavaProject(project.getName()) != null;</TD></TR><TR CLASS="z"><TD CLASS="l">483</TD><TD>                                                                boolean isJavaProject = JavaProject.hasJavaNature(project);</TD></TR><TR CLASS="z"><TD CLASS="l">484</TD><TD>                                                                if (wasJavaProject != isJavaProject) {</TD></TR><TR CLASS="z"><TD CLASS="l">485</TD><TD>                                                                        this.manager.batchContainerInitializations = true;</TD></TR><TR><TD CLASS="l">486</TD><TD> </TD></TR><TR><TD CLASS="l">487</TD><TD>                                                                        // java nature added or removed: remember  project and its dependents</TD></TR><TR CLASS="z"><TD CLASS="l">488</TD><TD>                                                                        this.addToRootsToRefreshWithDependents(javaProject);</TD></TR><TR><TD CLASS="l">489</TD><TD> </TD></TR><TR><TD CLASS="l">490</TD><TD>                                                                        // workaround for bug 15168 circular errors not reported</TD></TR><TR CLASS="z"><TD CLASS="l">491</TD><TD>                                                                        if (isJavaProject) {</TD></TR><TR CLASS="z"><TD CLASS="l">492</TD><TD>                                                                                this.addToParentInfo(javaProject);</TD></TR><TR CLASS="z"><TD CLASS="l">493</TD><TD>                                                                                readRawClasspath(javaProject);</TD></TR><TR><TD CLASS="l">494</TD><TD>                                                                                // ensure project references are updated (see https://bugs.eclipse.org/bugs/show_bug.cgi?id=172666)</TD></TR><TR CLASS="z"><TD CLASS="l">495</TD><TD>                                                                                checkProjectReferenceChange(project, javaProject);</TD></TR><TR><TD CLASS="l">496</TD><TD>                                                                        } else {</TD></TR><TR><TD CLASS="l">497</TD><TD>                                                                                // remove classpath cache so that initializeRoots() will not consider the project has a classpath</TD></TR><TR CLASS="z"><TD CLASS="l">498</TD><TD>                                                                                this.manager.removePerProjectInfo(javaProject);</TD></TR><TR><TD CLASS="l">499</TD><TD>                                                                                // remove container cache for this project</TD></TR><TR CLASS="z"><TD CLASS="l">500</TD><TD>                                                                                this.manager.containerRemove(javaProject);</TD></TR><TR><TD CLASS="l">501</TD><TD>                                                                                // close project</TD></TR><TR><TD CLASS="l">502</TD><TD>                                                                                try {</TD></TR><TR CLASS="z"><TD CLASS="l">503</TD><TD>                                                                                        javaProject.close();</TD></TR><TR CLASS="z"><TD CLASS="l">504</TD><TD>                                                                                } catch (JavaScriptModelException e) {</TD></TR><TR><TD CLASS="l">505</TD><TD>                                                                                        // java project doesn't exist: ignore</TD></TR><TR><TD CLASS="l">506</TD><TD>                                                                                }</TD></TR><TR CLASS="z"><TD CLASS="l">507</TD><TD>                                                                                this.removeFromParentInfo(javaProject);</TD></TR><TR><TD CLASS="l">508</TD><TD>                                                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">509</TD><TD>                                                                        this.state.rootsAreStale = true;</TD></TR><TR><TD CLASS="l">510</TD><TD>                                                                } else {</TD></TR><TR><TD CLASS="l">511</TD><TD>                                                                        // in case the project was removed then added then changed (see bug 19799)</TD></TR><TR CLASS="z"><TD CLASS="l">512</TD><TD>                                                                        if (isJavaProject) { // need nature check - 18698</TD></TR><TR CLASS="z"><TD CLASS="l">513</TD><TD>                                                                                this.addToParentInfo(javaProject);</TD></TR><TR CLASS="z"><TD CLASS="l">514</TD><TD>                                                                                children = delta.getAffectedChildren();</TD></TR><TR><TD CLASS="l">515</TD><TD>                                                                        }</TD></TR><TR><TD CLASS="l">516</TD><TD>                                                                }</TD></TR><TR><TD CLASS="l">517</TD><TD>                                                        } else {</TD></TR><TR><TD CLASS="l">518</TD><TD>                                                                // workaround for bug 15168 circular errors not reported</TD></TR><TR><TD CLASS="l">519</TD><TD>                                                                // in case the project was removed then added then changed</TD></TR><TR CLASS="z"><TD CLASS="l">520</TD><TD>                                                                if (JavaProject.hasJavaNature(project)) { // need nature check - 18698</TD></TR><TR CLASS="z"><TD CLASS="l">521</TD><TD>                                                                        this.addToParentInfo(javaProject);</TD></TR><TR CLASS="z"><TD CLASS="l">522</TD><TD>                                                                        children = delta.getAffectedChildren();</TD></TR><TR><TD CLASS="l">523</TD><TD>                                                                }</TD></TR><TR><TD CLASS="l">524</TD><TD>                                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">525</TD><TD>                                                        break;</TD></TR><TR><TD CLASS="l">526</TD><TD> </TD></TR><TR><TD CLASS="l">527</TD><TD>                                        case IResourceDelta.REMOVED :</TD></TR><TR CLASS="z"><TD CLASS="l">528</TD><TD>                                                this.manager.batchContainerInitializations = true;</TD></TR><TR><TD CLASS="l">529</TD><TD> </TD></TR><TR><TD CLASS="l">530</TD><TD>                                                // remove classpath cache so that initializeRoots() will not consider the project has a classpath</TD></TR><TR CLASS="z"><TD CLASS="l">531</TD><TD>                                                this.manager.removePerProjectInfo(javaProject);</TD></TR><TR><TD CLASS="l">532</TD><TD>                                                // remove container cache for this project</TD></TR><TR CLASS="z"><TD CLASS="l">533</TD><TD>                                                this.manager.containerRemove(javaProject);</TD></TR><TR><TD CLASS="l">534</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">535</TD><TD>                                                this.state.rootsAreStale = true;</TD></TR><TR><TD CLASS="l">536</TD><TD>                                                break;</TD></TR><TR><TD CLASS="l">537</TD><TD>                                }</TD></TR><TR><TD CLASS="l">538</TD><TD> </TD></TR><TR><TD CLASS="l">539</TD><TD>                                // in all cases, refresh the external jars for this project</TD></TR><TR CLASS="z"><TD CLASS="l">540</TD><TD>                                addForRefresh(javaProject);</TD></TR><TR><TD CLASS="l">541</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">542</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">543</TD><TD>                        case IResource.FILE :</TD></TR><TR CLASS="z"><TD CLASS="l">544</TD><TD>                                IFile file = (IFile) resource;</TD></TR><TR><TD CLASS="l">545</TD><TD>                                /* classpath file change */</TD></TR><TR CLASS="z"><TD CLASS="l">546</TD><TD>                                if (file.getName().equals(JavaProject.CLASSPATH_FILENAME)) {</TD></TR><TR CLASS="z"><TD CLASS="l">547</TD><TD>                                        this.manager.batchContainerInitializations = true;</TD></TR><TR CLASS="z"><TD CLASS="l">548</TD><TD>                                        switch (delta.getKind()) {</TD></TR><TR><TD CLASS="l">549</TD><TD>                                                case IResourceDelta.CHANGED :</TD></TR><TR CLASS="z"><TD CLASS="l">550</TD><TD>                                                        int flags = delta.getFlags();</TD></TR><TR CLASS="z"><TD CLASS="l">551</TD><TD>                                                        if ((flags &amp; IResourceDelta.CONTENT) == 0  // only consider content change</TD></TR><TR CLASS="z"><TD CLASS="l">552</TD><TD>                                                                &amp;&amp; (flags &amp; IResourceDelta.ENCODING) == 0 // and encoding change</TD></TR><TR CLASS="z"><TD CLASS="l">553</TD><TD>                                                                &amp;&amp; (flags &amp; IResourceDelta.MOVED_FROM) == 0) {// and also move and overide scenario (see http://dev.eclipse.org/bugs/show_bug.cgi?id=21420)</TD></TR><TR CLASS="z"><TD CLASS="l">554</TD><TD>                                                                break;</TD></TR><TR><TD CLASS="l">555</TD><TD>                                                        }</TD></TR><TR><TD CLASS="l">556</TD><TD>                                                // fall through</TD></TR><TR><TD CLASS="l">557</TD><TD>                                                case IResourceDelta.ADDED :</TD></TR><TR CLASS="z"><TD CLASS="l">558</TD><TD>                                                        javaProject = (JavaProject)JavaScriptCore.create(file.getProject());</TD></TR><TR><TD CLASS="l">559</TD><TD> </TD></TR><TR><TD CLASS="l">560</TD><TD>                                                        // force to (re)read the .classpath file</TD></TR><TR><TD CLASS="l">561</TD><TD>                                                        try {</TD></TR><TR CLASS="z"><TD CLASS="l">562</TD><TD>                                                                javaProject.getPerProjectInfo().readAndCacheClasspath(javaProject);</TD></TR><TR CLASS="z"><TD CLASS="l">563</TD><TD>                                                        } catch (JavaScriptModelException e) {</TD></TR><TR><TD CLASS="l">564</TD><TD>                                                                // project doesn't exist</TD></TR><TR CLASS="z"><TD CLASS="l">565</TD><TD>                                                                return;</TD></TR><TR><TD CLASS="l">566</TD><TD>                                                        }</TD></TR><TR><TD CLASS="l">567</TD><TD>                                                        break;</TD></TR><TR><TD CLASS="l">568</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">569</TD><TD>                                        this.state.rootsAreStale = true;</TD></TR><TR><TD CLASS="l">570</TD><TD>                                }</TD></TR><TR><TD CLASS="l">571</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">572</TD><TD> </TD></TR><TR><TD CLASS="l">573</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">574</TD><TD>                if (children != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">575</TD><TD>                        for (int i = 0; i &lt; children.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">576</TD><TD>                                checkProjectsBeingAddedOrRemoved(children[i]);</TD></TR><TR><TD CLASS="l">577</TD><TD>                        }</TD></TR><TR><TD CLASS="l"><A NAME="9">578</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">579</TD><TD>        }</TD></TR><TR><TD CLASS="l">580</TD><TD> </TD></TR><TR><TD CLASS="l">581</TD><TD>        private void checkProjectReferenceChange(IProject project, JavaProject javaProject) {</TD></TR><TR CLASS="z"><TD CLASS="l">582</TD><TD>                ClasspathChange change = (ClasspathChange) this.classpathChanges.get(project);</TD></TR><TR CLASS="z"><TD CLASS="l">583</TD><TD>                this.state.addProjectReferenceChange(javaProject, change == null ? null : change.oldResolvedClasspath);</TD></TR><TR CLASS="z"><TD CLASS="l">584</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="27">585</A></TD><TD> </TD></TR><TR><TD CLASS="l">586</TD><TD>        private void readRawClasspath(JavaProject javaProject) {</TD></TR><TR><TD CLASS="l">587</TD><TD>                try {</TD></TR><TR><TD CLASS="l">588</TD><TD>                        // force to (re)read the .classpath file</TD></TR><TR CLASS="z"><TD CLASS="l">589</TD><TD>                        javaProject.getPerProjectInfo().readAndCacheClasspath(javaProject);</TD></TR><TR CLASS="z"><TD CLASS="l">590</TD><TD>                } catch (JavaScriptModelException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">591</TD><TD>                        if (VERBOSE) {</TD></TR><TR CLASS="z"><TD CLASS="l">592</TD><TD>                                e.printStackTrace();</TD></TR><TR><TD CLASS="l"><A NAME="b">593</A></TD><TD>                        }</TD></TR><TR><TD CLASS="l">594</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">595</TD><TD>        }</TD></TR><TR><TD CLASS="l">596</TD><TD>        private void checkSourceAttachmentChange(IResourceDelta delta, IResource res) {</TD></TR><TR CLASS="z"><TD CLASS="l">597</TD><TD>                IPath rootPath = (IPath)this.state.sourceAttachments.get(res.getFullPath());</TD></TR><TR CLASS="z"><TD CLASS="l">598</TD><TD>                if (rootPath != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">599</TD><TD>                        RootInfo rootInfo = this.rootInfo(rootPath, delta.getKind());</TD></TR><TR CLASS="z"><TD CLASS="l">600</TD><TD>                        if (rootInfo != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">601</TD><TD>                                IJavaScriptProject projectOfRoot = rootInfo.project;</TD></TR><TR CLASS="z"><TD CLASS="l">602</TD><TD>                                IPackageFragmentRoot root = null;</TD></TR><TR><TD CLASS="l">603</TD><TD>                                try {</TD></TR><TR><TD CLASS="l">604</TD><TD>                                        // close the root so that source attachement cache is flushed</TD></TR><TR CLASS="z"><TD CLASS="l">605</TD><TD>                                        root = projectOfRoot.findPackageFragmentRoot(rootPath);</TD></TR><TR CLASS="z"><TD CLASS="l">606</TD><TD>                                        if (root != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">607</TD><TD>                                                root.close();</TD></TR><TR><TD CLASS="l">608</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">609</TD><TD>                                } catch (JavaScriptModelException e) {</TD></TR><TR><TD CLASS="l">610</TD><TD>                                        // root doesn't exist: ignore</TD></TR><TR><TD CLASS="l">611</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">612</TD><TD>                                if (root == null) return;</TD></TR><TR CLASS="z"><TD CLASS="l">613</TD><TD>                                switch (delta.getKind()) {</TD></TR><TR><TD CLASS="l">614</TD><TD>                                        case IResourceDelta.ADDED:</TD></TR><TR CLASS="z"><TD CLASS="l">615</TD><TD>                                                currentDelta().sourceAttached(root);</TD></TR><TR CLASS="z"><TD CLASS="l">616</TD><TD>                                                break;</TD></TR><TR><TD CLASS="l">617</TD><TD>                                        case IResourceDelta.CHANGED:</TD></TR><TR CLASS="z"><TD CLASS="l">618</TD><TD>                                                currentDelta().sourceDetached(root);</TD></TR><TR CLASS="z"><TD CLASS="l">619</TD><TD>                                                currentDelta().sourceAttached(root);</TD></TR><TR CLASS="z"><TD CLASS="l">620</TD><TD>                                                break;</TD></TR><TR><TD CLASS="l">621</TD><TD>                                        case IResourceDelta.REMOVED:</TD></TR><TR CLASS="z"><TD CLASS="l">622</TD><TD>                                                currentDelta().sourceDetached(root);</TD></TR><TR><TD CLASS="l">623</TD><TD>                                                break;</TD></TR><TR><TD CLASS="l">624</TD><TD>                                }</TD></TR><TR><TD CLASS="l">625</TD><TD>                        }</TD></TR><TR><TD CLASS="l">626</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">627</TD><TD>        }</TD></TR><TR><TD CLASS="l">628</TD><TD>        /*</TD></TR><TR><TD CLASS="l"><A NAME="c">629</A></TD><TD>         * Closes the given element, which removes it from the cache of open elements.</TD></TR><TR><TD CLASS="l">630</TD><TD>         */</TD></TR><TR><TD CLASS="l">631</TD><TD>        private void close(Openable element) {</TD></TR><TR><TD CLASS="l">632</TD><TD>                try {</TD></TR><TR CLASS="z"><TD CLASS="l">633</TD><TD>                        element.close();</TD></TR><TR CLASS="z"><TD CLASS="l">634</TD><TD>                } catch (JavaScriptModelException e) {</TD></TR><TR><TD CLASS="l">635</TD><TD>                        // do nothing</TD></TR><TR><TD CLASS="l">636</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">637</TD><TD>        }</TD></TR><TR><TD CLASS="l">638</TD><TD>        /*</TD></TR><TR><TD CLASS="l">639</TD><TD>         * Generic processing for elements with changed contents:&lt;ul&gt;</TD></TR><TR><TD CLASS="l">640</TD><TD>         * &lt;li&gt;The element is closed such that any subsequent accesses will re-open</TD></TR><TR><TD CLASS="l">641</TD><TD>         * the element reflecting its new structure.</TD></TR><TR><TD CLASS="l">642</TD><TD>         * &lt;li&gt;An entry is made in the delta reporting a content change (K_CHANGE with F_CONTENT flag set).</TD></TR><TR><TD CLASS="l">643</TD><TD>         * &lt;/ul&gt;</TD></TR><TR><TD CLASS="l"><A NAME="d">644</A></TD><TD>         * Delta argument could be null if processing an external JAR change</TD></TR><TR><TD CLASS="l">645</TD><TD>         */</TD></TR><TR><TD CLASS="l">646</TD><TD>        private void contentChanged(Openable element) {</TD></TR><TR><TD CLASS="l">647</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">648</TD><TD>                boolean isPrimary = false;</TD></TR><TR CLASS="z"><TD CLASS="l">649</TD><TD>                boolean isPrimaryWorkingCopy = false;</TD></TR><TR CLASS="z"><TD CLASS="l">650</TD><TD>                if (element.getElementType() == IJavaScriptElement.JAVASCRIPT_UNIT) {</TD></TR><TR CLASS="z"><TD CLASS="l">651</TD><TD>                        CompilationUnit cu = (CompilationUnit)element;</TD></TR><TR CLASS="z"><TD CLASS="l">652</TD><TD>                        isPrimary = cu.isPrimary();</TD></TR><TR CLASS="z"><TD CLASS="l">653</TD><TD>                        isPrimaryWorkingCopy = isPrimary &amp;&amp; cu.isWorkingCopy();</TD></TR><TR><TD CLASS="l">654</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">655</TD><TD>                if (isPrimaryWorkingCopy) {</TD></TR><TR><TD CLASS="l">656</TD><TD>                        // filter out changes to primary compilation unit in working copy mode</TD></TR><TR><TD CLASS="l">657</TD><TD>                        // just report a change to the resource (see https://bugs.eclipse.org/bugs/show_bug.cgi?id=59500)</TD></TR><TR CLASS="z"><TD CLASS="l">658</TD><TD>                        currentDelta().changed(element, IJavaScriptElementDelta.F_PRIMARY_RESOURCE);</TD></TR><TR><TD CLASS="l">659</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">660</TD><TD>                        close(element);</TD></TR><TR CLASS="z"><TD CLASS="l">661</TD><TD>                        int flags = IJavaScriptElementDelta.F_CONTENT;</TD></TR><TR><TD CLASS="l">662</TD><TD>//                        if (element instanceof JarPackageFragmentRoot){</TD></TR><TR><TD CLASS="l">663</TD><TD>//                                flags |= IJavaScriptElementDelta.F_ARCHIVE_CONTENT_CHANGED;</TD></TR><TR><TD CLASS="l">664</TD><TD>//                                // need also to reset project cache otherwise it will be out-of-date</TD></TR><TR><TD CLASS="l">665</TD><TD>//                                // see bug https://bugs.eclipse.org/bugs/show_bug.cgi?id=162621</TD></TR><TR><TD CLASS="l">666</TD><TD>//                                this.projectCachesToReset.add(element.getJavaScriptProject());</TD></TR><TR><TD CLASS="l">667</TD><TD>//                        }</TD></TR><TR CLASS="z"><TD CLASS="l">668</TD><TD>                        if (isPrimary) {</TD></TR><TR CLASS="z"><TD CLASS="l">669</TD><TD>                                flags |= IJavaScriptElementDelta.F_PRIMARY_RESOURCE;</TD></TR><TR><TD CLASS="l">670</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">671</TD><TD>                        currentDelta().changed(element, flags);</TD></TR><TR><TD CLASS="l">672</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">673</TD><TD>        }</TD></TR><TR><TD CLASS="l">674</TD><TD>        /*</TD></TR><TR><TD CLASS="l"><A NAME="e">675</A></TD><TD>         * Creates the openables corresponding to this resource.</TD></TR><TR><TD CLASS="l">676</TD><TD>         * Returns null if none was found.</TD></TR><TR><TD CLASS="l">677</TD><TD>         */</TD></TR><TR><TD CLASS="l">678</TD><TD>        private Openable createElement(IResource resource, int elementType, RootInfo rootInfo) {</TD></TR><TR CLASS="z"><TD CLASS="l">679</TD><TD>                if (resource == null) return null;</TD></TR><TR><TD CLASS="l">680</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">681</TD><TD>                IPath path = resource.getFullPath();</TD></TR><TR CLASS="z"><TD CLASS="l">682</TD><TD>                IJavaScriptElement element = null;</TD></TR><TR CLASS="z"><TD CLASS="l">683</TD><TD>                switch (elementType) {</TD></TR><TR><TD CLASS="l">684</TD><TD> </TD></TR><TR><TD CLASS="l">685</TD><TD>                        case IJavaScriptElement.JAVASCRIPT_PROJECT:</TD></TR><TR><TD CLASS="l">686</TD><TD> </TD></TR><TR><TD CLASS="l">687</TD><TD>                                // note that non-java resources rooted at the project level will also enter this code with</TD></TR><TR><TD CLASS="l">688</TD><TD>                                // an elementType JAVASCRIPT_PROJECT (see #elementType(...)).</TD></TR><TR CLASS="z"><TD CLASS="l">689</TD><TD>                                if (resource instanceof IProject){</TD></TR><TR><TD CLASS="l">690</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">691</TD><TD>                                        this.popUntilPrefixOf(path);</TD></TR><TR><TD CLASS="l">692</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">693</TD><TD>                                        if (this.currentElement != null</TD></TR><TR CLASS="z"><TD CLASS="l">694</TD><TD>                                                &amp;&amp; this.currentElement.getElementType() == IJavaScriptElement.JAVASCRIPT_PROJECT</TD></TR><TR CLASS="z"><TD CLASS="l">695</TD><TD>                                                &amp;&amp; ((IJavaScriptProject)this.currentElement).getProject().equals(resource)) {</TD></TR><TR CLASS="z"><TD CLASS="l">696</TD><TD>                                                return this.currentElement;</TD></TR><TR><TD CLASS="l">697</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">698</TD><TD>                                        if  (rootInfo != null &amp;&amp; rootInfo.project.getProject().equals(resource)){</TD></TR><TR CLASS="z"><TD CLASS="l">699</TD><TD>                                                element = rootInfo.project;</TD></TR><TR CLASS="z"><TD CLASS="l">700</TD><TD>                                                break;</TD></TR><TR><TD CLASS="l">701</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">702</TD><TD>                                        IProject proj = (IProject)resource;</TD></TR><TR CLASS="z"><TD CLASS="l">703</TD><TD>                                        if (JavaProject.hasJavaNature(proj)) {</TD></TR><TR CLASS="z"><TD CLASS="l">704</TD><TD>                                                element = JavaScriptCore.create(proj);</TD></TR><TR><TD CLASS="l">705</TD><TD>                                        } else {</TD></TR><TR><TD CLASS="l">706</TD><TD>                                                // java project may have been been closed or removed (look for</TD></TR><TR><TD CLASS="l">707</TD><TD>                                                // element amongst old java project s list).</TD></TR><TR CLASS="z"><TD CLASS="l">708</TD><TD>                                                element =  this.state.findJavaProject(proj.getName());</TD></TR><TR><TD CLASS="l">709</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">710</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">711</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">712</TD><TD>                        case IJavaScriptElement.PACKAGE_FRAGMENT_ROOT:</TD></TR><TR CLASS="z"><TD CLASS="l">713</TD><TD>                                element = rootInfo == null ? JavaScriptCore.create(resource) : rootInfo.getPackageFragmentRoot(resource);</TD></TR><TR CLASS="z"><TD CLASS="l">714</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">715</TD><TD>                        case IJavaScriptElement.PACKAGE_FRAGMENT:</TD></TR><TR CLASS="z"><TD CLASS="l">716</TD><TD>                                if (rootInfo != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">717</TD><TD>                                        if (rootInfo.project.contains(resource)) {</TD></TR><TR CLASS="z"><TD CLASS="l">718</TD><TD>                                                PackageFragmentRoot root = (PackageFragmentRoot) rootInfo.getPackageFragmentRoot(null);</TD></TR><TR><TD CLASS="l">719</TD><TD>                                                // create package handle</TD></TR><TR CLASS="z"><TD CLASS="l">720</TD><TD>                                                IPath pkgPath = path.removeFirstSegments(rootInfo.rootPath.segmentCount());</TD></TR><TR CLASS="z"><TD CLASS="l">721</TD><TD>                                                String[] pkgName = pkgPath.segments();</TD></TR><TR CLASS="z"><TD CLASS="l">722</TD><TD>                                                element = root.getPackageFragment(pkgName);</TD></TR><TR><TD CLASS="l">723</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">724</TD><TD>                                } else {</TD></TR><TR><TD CLASS="l">725</TD><TD>                                        // find the element that encloses the resource</TD></TR><TR CLASS="z"><TD CLASS="l">726</TD><TD>                                        this.popUntilPrefixOf(path);</TD></TR><TR><TD CLASS="l">727</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">728</TD><TD>                                        if (this.currentElement == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">729</TD><TD>                                                element = JavaScriptCore.create(resource);</TD></TR><TR><TD CLASS="l">730</TD><TD>                                        } else {</TD></TR><TR><TD CLASS="l">731</TD><TD>                                                // find the root</TD></TR><TR CLASS="z"><TD CLASS="l">732</TD><TD>                                                PackageFragmentRoot root = this.currentElement.getPackageFragmentRoot();</TD></TR><TR CLASS="z"><TD CLASS="l">733</TD><TD>                                                if (root == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">734</TD><TD>                                                        element =  JavaScriptCore.create(resource);</TD></TR><TR CLASS="z"><TD CLASS="l">735</TD><TD>                                                } else if (((JavaProject)root.getJavaScriptProject()).contains(resource)) {</TD></TR><TR><TD CLASS="l">736</TD><TD>                                                        // create package handle</TD></TR><TR CLASS="z"><TD CLASS="l">737</TD><TD>                                                        IPath pkgPath = path.removeFirstSegments(root.getPath().segmentCount());</TD></TR><TR CLASS="z"><TD CLASS="l">738</TD><TD>                                                        String[] pkgName = pkgPath.segments();</TD></TR><TR CLASS="z"><TD CLASS="l">739</TD><TD>                                                        element = root.getPackageFragment(pkgName);</TD></TR><TR><TD CLASS="l">740</TD><TD>                                                }</TD></TR><TR><TD CLASS="l">741</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">742</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">743</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">744</TD><TD>                        case IJavaScriptElement.JAVASCRIPT_UNIT:</TD></TR><TR><TD CLASS="l">745</TD><TD>                        case IJavaScriptElement.CLASS_FILE:</TD></TR><TR><TD CLASS="l">746</TD><TD>                                // find the element that encloses the resource</TD></TR><TR CLASS="z"><TD CLASS="l">747</TD><TD>                                this.popUntilPrefixOf(path);</TD></TR><TR><TD CLASS="l">748</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">749</TD><TD>                                if (this.currentElement == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">750</TD><TD>                                        element =  rootInfo == null ? JavaScriptCore.create(resource) : JavaModelManager.create(resource, rootInfo.project);</TD></TR><TR><TD CLASS="l">751</TD><TD>                                } else {</TD></TR><TR><TD CLASS="l">752</TD><TD>                                        // find the package</TD></TR><TR CLASS="z"><TD CLASS="l">753</TD><TD>                                        IPackageFragment pkgFragment = null;</TD></TR><TR CLASS="z"><TD CLASS="l">754</TD><TD>                                        switch (this.currentElement.getElementType()) {</TD></TR><TR><TD CLASS="l">755</TD><TD>                                                case IJavaScriptElement.PACKAGE_FRAGMENT_ROOT:</TD></TR><TR CLASS="z"><TD CLASS="l">756</TD><TD>                                                        PackageFragmentRoot root = (PackageFragmentRoot)this.currentElement;</TD></TR><TR CLASS="z"><TD CLASS="l">757</TD><TD>                                                        IPath rootPath = root.getPath();</TD></TR><TR CLASS="z"><TD CLASS="l">758</TD><TD>                                                        IPath pkgPath = path.removeLastSegments(1);</TD></TR><TR CLASS="z"><TD CLASS="l">759</TD><TD>                                                        String[] pkgName = pkgPath.removeFirstSegments(rootPath.segmentCount()).segments();</TD></TR><TR CLASS="z"><TD CLASS="l">760</TD><TD>                                                        pkgFragment = root.getPackageFragment(pkgName);</TD></TR><TR CLASS="z"><TD CLASS="l">761</TD><TD>                                                        break;</TD></TR><TR><TD CLASS="l">762</TD><TD>                                                case IJavaScriptElement.PACKAGE_FRAGMENT:</TD></TR><TR CLASS="z"><TD CLASS="l">763</TD><TD>                                                        Openable pkg = this.currentElement;</TD></TR><TR CLASS="z"><TD CLASS="l">764</TD><TD>                                                        if (pkg.getPath().equals(path.removeLastSegments(1))) {</TD></TR><TR CLASS="z"><TD CLASS="l">765</TD><TD>                                                                pkgFragment = (IPackageFragment)pkg;</TD></TR><TR><TD CLASS="l">766</TD><TD>                                                        } // else case of package x which is a prefix of x.y</TD></TR><TR CLASS="z"><TD CLASS="l">767</TD><TD>                                                        break;</TD></TR><TR><TD CLASS="l">768</TD><TD>                                                case IJavaScriptElement.JAVASCRIPT_UNIT:</TD></TR><TR><TD CLASS="l">769</TD><TD>                                                case IJavaScriptElement.CLASS_FILE:</TD></TR><TR CLASS="z"><TD CLASS="l">770</TD><TD>                                                        pkgFragment = (IPackageFragment)this.currentElement.getParent();</TD></TR><TR><TD CLASS="l">771</TD><TD>                                                        break;</TD></TR><TR><TD CLASS="l">772</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">773</TD><TD>                                        if (pkgFragment == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">774</TD><TD>                                                element =  rootInfo == null ? JavaScriptCore.create(resource) : JavaModelManager.create(resource, rootInfo.project);</TD></TR><TR><TD CLASS="l">775</TD><TD>                                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">776</TD><TD>                                                if (elementType == IJavaScriptElement.JAVASCRIPT_UNIT) {</TD></TR><TR><TD CLASS="l">777</TD><TD>                                                        // create compilation unit handle</TD></TR><TR><TD CLASS="l">778</TD><TD>                                                        // fileName validation has been done in elementType(IResourceDelta, int, boolean)</TD></TR><TR CLASS="z"><TD CLASS="l">779</TD><TD>                                                        String fileName = path.lastSegment();</TD></TR><TR CLASS="z"><TD CLASS="l">780</TD><TD>                                                        element = pkgFragment.getJavaScriptUnit(fileName);</TD></TR><TR><TD CLASS="l">781</TD><TD>                                                } else {</TD></TR><TR><TD CLASS="l">782</TD><TD>                                                        // create class file handle</TD></TR><TR><TD CLASS="l">783</TD><TD>                                                        // fileName validation has been done in elementType(IResourceDelta, int, boolean)</TD></TR><TR CLASS="z"><TD CLASS="l">784</TD><TD>                                                        String fileName = path.lastSegment();</TD></TR><TR CLASS="z"><TD CLASS="l">785</TD><TD>                                                        element = pkgFragment.getClassFile(fileName);</TD></TR><TR><TD CLASS="l">786</TD><TD>                                                }</TD></TR><TR><TD CLASS="l">787</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">788</TD><TD>                                }</TD></TR><TR><TD CLASS="l">789</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">790</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">791</TD><TD>                if (element == null) return null;</TD></TR><TR CLASS="z"><TD CLASS="l">792</TD><TD>                this.currentElement = (Openable)element;</TD></TR><TR CLASS="z"><TD CLASS="l">793</TD><TD>                return this.currentElement;</TD></TR><TR><TD CLASS="l">794</TD><TD>        }</TD></TR><TR><TD CLASS="l">795</TD><TD>        /*</TD></TR><TR><TD CLASS="l">796</TD><TD>         * Check if external archives have changed and create the corresponding deltas.</TD></TR><TR><TD CLASS="l"><A NAME="f">797</A></TD><TD>         * Returns whether at least on delta was created.</TD></TR><TR><TD CLASS="l">798</TD><TD>         */</TD></TR><TR><TD CLASS="l">799</TD><TD>        private boolean createExternalArchiveDelta(IProgressMonitor monitor) {</TD></TR><TR><TD CLASS="l">800</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">801</TD><TD>                if (this.refreshedElements == null) return false;</TD></TR><TR><TD CLASS="l">802</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">803</TD><TD>                HashMap externalArchivesStatus = new HashMap();</TD></TR><TR CLASS="z"><TD CLASS="l">804</TD><TD>                boolean hasDelta = false;</TD></TR><TR><TD CLASS="l">805</TD><TD> </TD></TR><TR><TD CLASS="l">806</TD><TD>                // find JARs to refresh</TD></TR><TR CLASS="z"><TD CLASS="l">807</TD><TD>                HashSet archivePathsToRefresh = new HashSet();</TD></TR><TR CLASS="z"><TD CLASS="l">808</TD><TD>                Iterator iterator = this.refreshedElements.iterator();</TD></TR><TR CLASS="z"><TD CLASS="l">809</TD><TD>                this.refreshedElements = null; // null out early to avoid concurrent modification exception (see https://bugs.eclipse.org/bugs/show_bug.cgi?id=63534)</TD></TR><TR CLASS="z"><TD CLASS="l">810</TD><TD>                while (iterator.hasNext()) {</TD></TR><TR CLASS="z"><TD CLASS="l">811</TD><TD>                        IJavaScriptElement element = (IJavaScriptElement)iterator.next();</TD></TR><TR CLASS="z"><TD CLASS="l">812</TD><TD>                        switch(element.getElementType()){</TD></TR><TR><TD CLASS="l">813</TD><TD>                                case IJavaScriptElement.PACKAGE_FRAGMENT_ROOT :</TD></TR><TR CLASS="z"><TD CLASS="l">814</TD><TD>                                        archivePathsToRefresh.add(element.getPath());</TD></TR><TR CLASS="z"><TD CLASS="l">815</TD><TD>                                        break;</TD></TR><TR><TD CLASS="l">816</TD><TD>                                case IJavaScriptElement.JAVASCRIPT_PROJECT :</TD></TR><TR CLASS="z"><TD CLASS="l">817</TD><TD>                                        JavaProject javaProject = (JavaProject) element;</TD></TR><TR CLASS="z"><TD CLASS="l">818</TD><TD>                                        if (!JavaProject.hasJavaNature(javaProject.getProject())) {</TD></TR><TR><TD CLASS="l">819</TD><TD>                                                // project is not accessible or has lost its Java nature</TD></TR><TR CLASS="z"><TD CLASS="l">820</TD><TD>                                                break;</TD></TR><TR><TD CLASS="l">821</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">822</TD><TD>                                        IIncludePathEntry[] classpath;</TD></TR><TR><TD CLASS="l">823</TD><TD>                                        try {</TD></TR><TR CLASS="z"><TD CLASS="l">824</TD><TD>                                                classpath = javaProject.getResolvedClasspath();</TD></TR><TR CLASS="z"><TD CLASS="l">825</TD><TD>                                                for (int j = 0, cpLength = classpath.length; j &lt; cpLength; j++){</TD></TR><TR CLASS="z"><TD CLASS="l">826</TD><TD>                                                        if (classpath[j].getEntryKind() == IIncludePathEntry.CPE_LIBRARY){</TD></TR><TR CLASS="z"><TD CLASS="l">827</TD><TD>                                                                archivePathsToRefresh.add(classpath[j].getPath());</TD></TR><TR><TD CLASS="l">828</TD><TD>                                                        }</TD></TR><TR><TD CLASS="l">829</TD><TD>                                                }</TD></TR><TR CLASS="z"><TD CLASS="l">830</TD><TD>                                        } catch (JavaScriptModelException e) {</TD></TR><TR><TD CLASS="l">831</TD><TD>                                                // project doesn't exist -&gt; ignore</TD></TR><TR><TD CLASS="l">832</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">833</TD><TD>                                        break;</TD></TR><TR><TD CLASS="l">834</TD><TD>                                case IJavaScriptElement.JAVASCRIPT_MODEL :</TD></TR><TR CLASS="z"><TD CLASS="l">835</TD><TD>                                        Iterator projectNames = this.state.getOldJavaProjecNames().iterator();</TD></TR><TR CLASS="z"><TD CLASS="l">836</TD><TD>                                        while (projectNames.hasNext()) {</TD></TR><TR CLASS="z"><TD CLASS="l">837</TD><TD>                                                String projectName = (String) projectNames.next();</TD></TR><TR CLASS="z"><TD CLASS="l">838</TD><TD>                                                IProject project = ResourcesPlugin.getWorkspace().getRoot().getProject(projectName);</TD></TR><TR CLASS="z"><TD CLASS="l">839</TD><TD>                                                if (!JavaProject.hasJavaNature(project)) {</TD></TR><TR><TD CLASS="l">840</TD><TD>                                                        // project is not accessible or has lost its Java nature</TD></TR><TR CLASS="z"><TD CLASS="l">841</TD><TD>                                                        continue;</TD></TR><TR><TD CLASS="l">842</TD><TD>                                                }</TD></TR><TR CLASS="z"><TD CLASS="l">843</TD><TD>                                                javaProject = (JavaProject) JavaScriptCore.create(project);</TD></TR><TR><TD CLASS="l">844</TD><TD>                                                try {</TD></TR><TR CLASS="z"><TD CLASS="l">845</TD><TD>                                                        classpath = javaProject.getResolvedClasspath();</TD></TR><TR CLASS="z"><TD CLASS="l">846</TD><TD>                                                } catch (JavaScriptModelException e2) {</TD></TR><TR><TD CLASS="l">847</TD><TD>                                                        // project doesn't exist -&gt; ignore</TD></TR><TR CLASS="z"><TD CLASS="l">848</TD><TD>                                                        continue;</TD></TR><TR><TD CLASS="l">849</TD><TD>                                                }</TD></TR><TR CLASS="z"><TD CLASS="l">850</TD><TD>                                                for (int k = 0, cpLength = classpath.length; k &lt; cpLength; k++){</TD></TR><TR CLASS="z"><TD CLASS="l">851</TD><TD>                                                        if (classpath[k].getEntryKind() == IIncludePathEntry.CPE_LIBRARY){</TD></TR><TR CLASS="z"><TD CLASS="l">852</TD><TD>                                                                archivePathsToRefresh.add(classpath[k].getPath());</TD></TR><TR><TD CLASS="l">853</TD><TD>                                                        }</TD></TR><TR><TD CLASS="l">854</TD><TD>                                                }</TD></TR><TR><TD CLASS="l">855</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">856</TD><TD>                                        break;</TD></TR><TR><TD CLASS="l">857</TD><TD>                        }</TD></TR><TR><TD CLASS="l">858</TD><TD>                }</TD></TR><TR><TD CLASS="l">859</TD><TD> </TD></TR><TR><TD CLASS="l">860</TD><TD>                // perform refresh</TD></TR><TR CLASS="z"><TD CLASS="l">861</TD><TD>                Iterator projectNames = this.state.getOldJavaProjecNames().iterator();</TD></TR><TR CLASS="z"><TD CLASS="l">862</TD><TD>                IWorkspaceRoot wksRoot = ResourcesPlugin.getWorkspace().getRoot();</TD></TR><TR CLASS="z"><TD CLASS="l">863</TD><TD>                while (projectNames.hasNext()) {</TD></TR><TR><TD CLASS="l">864</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">865</TD><TD>                        if (monitor != null &amp;&amp; monitor.isCanceled()) break;</TD></TR><TR><TD CLASS="l">866</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">867</TD><TD>                        String projectName = (String) projectNames.next();</TD></TR><TR CLASS="z"><TD CLASS="l">868</TD><TD>                        IProject project = wksRoot.getProject(projectName);</TD></TR><TR CLASS="z"><TD CLASS="l">869</TD><TD>                        if (!JavaProject.hasJavaNature(project)) {</TD></TR><TR><TD CLASS="l">870</TD><TD>                                // project is not accessible or has lost its Java nature</TD></TR><TR CLASS="z"><TD CLASS="l">871</TD><TD>                                continue;</TD></TR><TR><TD CLASS="l">872</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">873</TD><TD>                        JavaProject javaProject = (JavaProject) JavaScriptCore.create(project);</TD></TR><TR><TD CLASS="l">874</TD><TD>                        IIncludePathEntry[] entries;</TD></TR><TR><TD CLASS="l">875</TD><TD>                        try {</TD></TR><TR CLASS="z"><TD CLASS="l">876</TD><TD>                                entries = javaProject.getResolvedClasspath();</TD></TR><TR CLASS="z"><TD CLASS="l">877</TD><TD>                        } catch (JavaScriptModelException e1) {</TD></TR><TR><TD CLASS="l">878</TD><TD>                                // project does not exist -&gt; ignore</TD></TR><TR CLASS="z"><TD CLASS="l">879</TD><TD>                                continue;</TD></TR><TR><TD CLASS="l">880</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">881</TD><TD>                        for (int j = 0; j &lt; entries.length; j++){</TD></TR><TR CLASS="z"><TD CLASS="l">882</TD><TD>                                if (entries[j].getEntryKind() == IIncludePathEntry.CPE_LIBRARY) {</TD></TR><TR><TD CLASS="l">883</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">884</TD><TD>                                        IPath entryPath = entries[j].getPath();</TD></TR><TR><TD CLASS="l">885</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">886</TD><TD>                                        if (!archivePathsToRefresh.contains(entryPath)) continue; // not supposed to be refreshed</TD></TR><TR><TD CLASS="l">887</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">888</TD><TD>                                        String status = (String)externalArchivesStatus.get(entryPath);</TD></TR><TR CLASS="z"><TD CLASS="l">889</TD><TD>                                        if (status == null){</TD></TR><TR><TD CLASS="l">890</TD><TD> </TD></TR><TR><TD CLASS="l">891</TD><TD>                                                // compute shared status</TD></TR><TR CLASS="z"><TD CLASS="l">892</TD><TD>                                                Object targetLibrary = JavaModel.getTarget(wksRoot, entryPath, true);</TD></TR><TR><TD CLASS="l">893</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">894</TD><TD>                                                if (targetLibrary == null){ // missing JAR</TD></TR><TR CLASS="z"><TD CLASS="l">895</TD><TD>                                                        if (this.state.getExternalLibTimeStamps().remove(entryPath) != null){</TD></TR><TR CLASS="z"><TD CLASS="l">896</TD><TD>                                                                externalArchivesStatus.put(entryPath, EXTERNAL_JAR_REMOVED);</TD></TR><TR><TD CLASS="l">897</TD><TD>                                                                // the jar was physically removed: remove the index</TD></TR><TR CLASS="z"><TD CLASS="l">898</TD><TD>                                                                this.manager.indexManager.removeIndex(entryPath);</TD></TR><TR><TD CLASS="l">899</TD><TD>                                                        }</TD></TR><TR><TD CLASS="l">900</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">901</TD><TD>                                                } else if (targetLibrary instanceof File){ // external JAR</TD></TR><TR><TD CLASS="l">902</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">903</TD><TD>                                                        File externalFile = (File)targetLibrary;</TD></TR><TR><TD CLASS="l">904</TD><TD> </TD></TR><TR><TD CLASS="l">905</TD><TD>                                                        // check timestamp to figure if JAR has changed in some way</TD></TR><TR CLASS="z"><TD CLASS="l">906</TD><TD>                                                        Long oldTimestamp =(Long) this.state.getExternalLibTimeStamps().get(entryPath);</TD></TR><TR CLASS="z"><TD CLASS="l">907</TD><TD>                                                        long newTimeStamp = getTimeStamp(externalFile);</TD></TR><TR CLASS="z"><TD CLASS="l">908</TD><TD>                                                        if (oldTimestamp != null){</TD></TR><TR><TD CLASS="l">909</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">910</TD><TD>                                                                if (newTimeStamp == 0){ // file doesn't exist</TD></TR><TR CLASS="z"><TD CLASS="l">911</TD><TD>                                                                        externalArchivesStatus.put(entryPath, EXTERNAL_JAR_REMOVED);</TD></TR><TR CLASS="z"><TD CLASS="l">912</TD><TD>                                                                        this.state.getExternalLibTimeStamps().remove(entryPath);</TD></TR><TR><TD CLASS="l">913</TD><TD>                                                                        // remove the index</TD></TR><TR CLASS="z"><TD CLASS="l">914</TD><TD>                                                                        this.manager.indexManager.removeIndex(entryPath);</TD></TR><TR><TD CLASS="l">915</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">916</TD><TD>                                                                } else if (oldTimestamp.longValue() != newTimeStamp){</TD></TR><TR CLASS="z"><TD CLASS="l">917</TD><TD>                                                                        externalArchivesStatus.put(entryPath, EXTERNAL_JAR_CHANGED);</TD></TR><TR CLASS="z"><TD CLASS="l">918</TD><TD>                                                                        this.state.getExternalLibTimeStamps().put(entryPath, new Long(newTimeStamp));</TD></TR><TR><TD CLASS="l">919</TD><TD>                                                                        // first remove the index so that it is forced to be re-indexed</TD></TR><TR CLASS="z"><TD CLASS="l">920</TD><TD>                                                                        this.manager.indexManager.removeIndex(entryPath);</TD></TR><TR><TD CLASS="l">921</TD><TD>                                                                        // then index the jar</TD></TR><TR CLASS="z"><TD CLASS="l">922</TD><TD>                                                                        this.manager.indexManager.indexLibrary(entries[j], project.getProject());</TD></TR><TR><TD CLASS="l">923</TD><TD>                                                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">924</TD><TD>                                                                        externalArchivesStatus.put(entryPath, EXTERNAL_JAR_UNCHANGED);</TD></TR><TR><TD CLASS="l">925</TD><TD>                                                                }</TD></TR><TR><TD CLASS="l">926</TD><TD>                                                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">927</TD><TD>                                                                if (newTimeStamp == 0){ // jar still doesn't exist</TD></TR><TR CLASS="z"><TD CLASS="l">928</TD><TD>                                                                        externalArchivesStatus.put(entryPath, EXTERNAL_JAR_UNCHANGED);</TD></TR><TR><TD CLASS="l">929</TD><TD>                                                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">930</TD><TD>                                                                        externalArchivesStatus.put(entryPath, EXTERNAL_JAR_ADDED);</TD></TR><TR CLASS="z"><TD CLASS="l">931</TD><TD>                                                                        this.state.getExternalLibTimeStamps().put(entryPath, new Long(newTimeStamp));</TD></TR><TR><TD CLASS="l">932</TD><TD>                                                                        // index the new jar</TD></TR><TR CLASS="z"><TD CLASS="l">933</TD><TD>                                                                        this.manager.indexManager.indexLibrary(entries[j], project.getProject());</TD></TR><TR><TD CLASS="l">934</TD><TD>                                                                }</TD></TR><TR><TD CLASS="l">935</TD><TD>                                                        }</TD></TR><TR><TD CLASS="l">936</TD><TD>                                                } else { // internal JAR</TD></TR><TR CLASS="z"><TD CLASS="l">937</TD><TD>                                                        externalArchivesStatus.put(entryPath, INTERNAL_JAR_IGNORE);</TD></TR><TR><TD CLASS="l">938</TD><TD>                                                }</TD></TR><TR><TD CLASS="l">939</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">940</TD><TD>                                        // according to computed status, generate a delta</TD></TR><TR CLASS="z"><TD CLASS="l">941</TD><TD>                                        status = (String)externalArchivesStatus.get(entryPath);</TD></TR><TR CLASS="z"><TD CLASS="l">942</TD><TD>                                        if (status != null){</TD></TR><TR CLASS="z"><TD CLASS="l">943</TD><TD>                                                if (status == EXTERNAL_JAR_ADDED){</TD></TR><TR CLASS="z"><TD CLASS="l">944</TD><TD>                                                        PackageFragmentRoot root = (PackageFragmentRoot) javaProject.getPackageFragmentRoot(entryPath.toString());</TD></TR><TR CLASS="z"><TD CLASS="l">945</TD><TD>                                                        if (VERBOSE){</TD></TR><TR CLASS="z"><TD CLASS="l">946</TD><TD>                                                                System.out.println(&#34;- External JAR ADDED, affecting root: &#34;+root.getElementName()); //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">947</TD><TD>                                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">948</TD><TD>                                                        elementAdded(root, null, null);</TD></TR><TR CLASS="z"><TD CLASS="l">949</TD><TD>                                                        this.state.addClasspathValidation(javaProject); // see https://bugs.eclipse.org/bugs/show_bug.cgi?id=185733</TD></TR><TR CLASS="z"><TD CLASS="l">950</TD><TD>                                                        hasDelta = true;</TD></TR><TR CLASS="z"><TD CLASS="l">951</TD><TD>                                                } else if (status == EXTERNAL_JAR_CHANGED) {</TD></TR><TR CLASS="z"><TD CLASS="l">952</TD><TD>                                                        PackageFragmentRoot root = (PackageFragmentRoot) javaProject.getPackageFragmentRoot(entryPath.toString());</TD></TR><TR CLASS="z"><TD CLASS="l">953</TD><TD>                                                        if (VERBOSE){</TD></TR><TR CLASS="z"><TD CLASS="l">954</TD><TD>                                                                System.out.println(&#34;- External JAR CHANGED, affecting root: &#34;+root.getElementName()); //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">955</TD><TD>                                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">956</TD><TD>                                                        contentChanged(root);</TD></TR><TR CLASS="z"><TD CLASS="l">957</TD><TD>                                                        hasDelta = true;</TD></TR><TR CLASS="z"><TD CLASS="l">958</TD><TD>                                                } else if (status == EXTERNAL_JAR_REMOVED) {</TD></TR><TR CLASS="z"><TD CLASS="l">959</TD><TD>                                                        PackageFragmentRoot root = (PackageFragmentRoot) javaProject.getPackageFragmentRoot(entryPath.toString());</TD></TR><TR CLASS="z"><TD CLASS="l">960</TD><TD>                                                        if (VERBOSE){</TD></TR><TR CLASS="z"><TD CLASS="l">961</TD><TD>                                                                System.out.println(&#34;- External JAR REMOVED, affecting root: &#34;+root.getElementName()); //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">962</TD><TD>                                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">963</TD><TD>                                                        elementRemoved(root, null, null);</TD></TR><TR CLASS="z"><TD CLASS="l">964</TD><TD>                                                        this.state.addClasspathValidation(javaProject); // see https://bugs.eclipse.org/bugs/show_bug.cgi?id=185733</TD></TR><TR CLASS="z"><TD CLASS="l">965</TD><TD>                                                        hasDelta = true;</TD></TR><TR><TD CLASS="l">966</TD><TD>                                                }</TD></TR><TR><TD CLASS="l">967</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">968</TD><TD>                                }</TD></TR><TR><TD CLASS="l">969</TD><TD>                        }</TD></TR><TR><TD CLASS="l"><A NAME="10">970</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">971</TD><TD>                return hasDelta;</TD></TR><TR><TD CLASS="l">972</TD><TD>        }</TD></TR><TR><TD CLASS="l">973</TD><TD>        private JavaElementDelta currentDelta() {</TD></TR><TR CLASS="z"><TD CLASS="l">974</TD><TD>                if (this.currentDelta == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">975</TD><TD>                        this.currentDelta = new JavaElementDelta(this.manager.getJavaModel());</TD></TR><TR><TD CLASS="l">976</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">977</TD><TD>                return this.currentDelta;</TD></TR><TR><TD CLASS="l">978</TD><TD>        }</TD></TR><TR><TD CLASS="l">979</TD><TD>        /*</TD></TR><TR><TD CLASS="l">980</TD><TD>         * Note that the project is about to be deleted.</TD></TR><TR><TD CLASS="l">981</TD><TD>         */</TD></TR><TR><TD CLASS="l">982</TD><TD>        private void deleting(IProject project) {</TD></TR><TR><TD CLASS="l"><A NAME="11">983</A></TD><TD> </TD></TR><TR><TD CLASS="l">984</TD><TD>                try {</TD></TR><TR><TD CLASS="l">985</TD><TD>                        // discard indexing jobs that belong to this project so that the project can be</TD></TR><TR><TD CLASS="l">986</TD><TD>                        // deleted without interferences from the index manager</TD></TR><TR CLASS="z"><TD CLASS="l">987</TD><TD>                        this.manager.indexManager.discardJobs(project.getName());</TD></TR><TR><TD CLASS="l">988</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">989</TD><TD>                        JavaProject javaProject = (JavaProject)JavaScriptCore.create(project);</TD></TR><TR><TD CLASS="l">990</TD><TD> </TD></TR><TR><TD CLASS="l">991</TD><TD>                        // remember roots of this project</TD></TR><TR CLASS="z"><TD CLASS="l">992</TD><TD>                        if (this.oldRoots == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">993</TD><TD>                                this.oldRoots = new HashMap();</TD></TR><TR><TD CLASS="l">994</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">995</TD><TD>                        if (javaProject.isOpen()) {</TD></TR><TR CLASS="z"><TD CLASS="l">996</TD><TD>                                this.oldRoots.put(javaProject, javaProject.getPackageFragmentRoots());</TD></TR><TR><TD CLASS="l">997</TD><TD>                        } else {</TD></TR><TR><TD CLASS="l">998</TD><TD>                                // compute roots without opening project</TD></TR><TR CLASS="z"><TD CLASS="l">999</TD><TD>                                this.oldRoots.put(</TD></TR><TR CLASS="z"><TD CLASS="l">1000</TD><TD>                                        javaProject,</TD></TR><TR CLASS="z"><TD CLASS="l">1001</TD><TD>                                        javaProject.computePackageFragmentRoots(</TD></TR><TR CLASS="z"><TD CLASS="l">1002</TD><TD>                                                javaProject.getResolvedClasspath(),</TD></TR><TR CLASS="z"><TD CLASS="l">1003</TD><TD>                                                false,</TD></TR><TR CLASS="z"><TD CLASS="l">1004</TD><TD>                                                null /*no reverse map*/));</TD></TR><TR><TD CLASS="l">1005</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1006</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1007</TD><TD>                        javaProject.close();</TD></TR><TR><TD CLASS="l">1008</TD><TD> </TD></TR><TR><TD CLASS="l">1009</TD><TD>                        // workaround for bug 15168 circular errors not reported</TD></TR><TR CLASS="z"><TD CLASS="l">1010</TD><TD>                        this.state.getOldJavaProjecNames(); // foce list to be computed</TD></TR><TR><TD CLASS="l">1011</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1012</TD><TD>                        this.removeFromParentInfo(javaProject);</TD></TR><TR><TD CLASS="l">1013</TD><TD> </TD></TR><TR><TD CLASS="l">1014</TD><TD>                        // remove preferences from per project info</TD></TR><TR CLASS="z"><TD CLASS="l">1015</TD><TD>                        this.manager.resetProjectPreferences(javaProject);</TD></TR><TR CLASS="z"><TD CLASS="l">1016</TD><TD>                } catch (JavaScriptModelException e) {</TD></TR><TR><TD CLASS="l">1017</TD><TD>                        // java project doesn't exist: ignore</TD></TR><TR><TD CLASS="l">1018</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1019</TD><TD>        }</TD></TR><TR><TD CLASS="l">1020</TD><TD>        /*</TD></TR><TR><TD CLASS="l">1021</TD><TD>         * Processing for an element that has been added:&lt;ul&gt;</TD></TR><TR><TD CLASS="l">1022</TD><TD>         * &lt;li&gt;If the element is a project, do nothing, and do not process</TD></TR><TR><TD CLASS="l">1023</TD><TD>         * children, as when a project is created it does not yet have any</TD></TR><TR><TD CLASS="l">1024</TD><TD>         * natures - specifically a java nature.</TD></TR><TR><TD CLASS="l">1025</TD><TD>         * &lt;li&gt;If the elemet is not a project, process it as added (see</TD></TR><TR><TD CLASS="l">1026</TD><TD>         * &lt;code&gt;basicElementAdded&lt;/code&gt;.</TD></TR><TR><TD CLASS="l"><A NAME="12">1027</A></TD><TD>         * &lt;/ul&gt;</TD></TR><TR><TD CLASS="l">1028</TD><TD>         * Delta argument could be null if processing an external JAR change</TD></TR><TR><TD CLASS="l">1029</TD><TD>         */</TD></TR><TR><TD CLASS="l">1030</TD><TD>        private void elementAdded(Openable element, IResourceDelta delta, RootInfo rootInfo) {</TD></TR><TR CLASS="z"><TD CLASS="l">1031</TD><TD>                int elementType = element.getElementType();</TD></TR><TR><TD CLASS="l">1032</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1033</TD><TD>                if (elementType == IJavaScriptElement.JAVASCRIPT_PROJECT) {</TD></TR><TR><TD CLASS="l">1034</TD><TD>                        // project add is handled by JavaProject.configure() because</TD></TR><TR><TD CLASS="l">1035</TD><TD>                        // when a project is created, it does not yet have a java nature</TD></TR><TR CLASS="z"><TD CLASS="l">1036</TD><TD>                        if (delta != null &amp;&amp; JavaProject.hasJavaNature((IProject)delta.getResource())) {</TD></TR><TR CLASS="z"><TD CLASS="l">1037</TD><TD>                                addToParentInfo(element);</TD></TR><TR CLASS="z"><TD CLASS="l">1038</TD><TD>                                if ((delta.getFlags() &amp; IResourceDelta.MOVED_FROM) != 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1039</TD><TD>                                        Openable movedFromElement = (Openable)element.getJavaScriptModel().getJavaScriptProject(delta.getMovedFromPath().lastSegment());</TD></TR><TR CLASS="z"><TD CLASS="l">1040</TD><TD>                                        currentDelta().movedTo(element, movedFromElement);</TD></TR><TR><TD CLASS="l">1041</TD><TD>                                } else {</TD></TR><TR><TD CLASS="l">1042</TD><TD>                                        // Force the project to be closed as it might have been opened</TD></TR><TR><TD CLASS="l">1043</TD><TD>                                        // before the resource modification came in and it might have a new child</TD></TR><TR><TD CLASS="l">1044</TD><TD>                                        // For example, in an IWorkspaceRunnable:</TD></TR><TR><TD CLASS="l">1045</TD><TD>                                        // 1. create a Java project P (where P=src)</TD></TR><TR><TD CLASS="l">1046</TD><TD>                                        // 2. open project P</TD></TR><TR><TD CLASS="l">1047</TD><TD>                                        // 3. add folder f in P's pkg fragment root</TD></TR><TR><TD CLASS="l">1048</TD><TD>                                        // When the resource delta comes in, only the addition of P is notified,</TD></TR><TR><TD CLASS="l">1049</TD><TD>                                        // but the pkg fragment root of project P is already opened, thus its children are not recomputed</TD></TR><TR><TD CLASS="l">1050</TD><TD>                                        // and it appears to contain only the default package.</TD></TR><TR CLASS="z"><TD CLASS="l">1051</TD><TD>                                        close(element);</TD></TR><TR><TD CLASS="l">1052</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1053</TD><TD>                                        currentDelta().added(element);</TD></TR><TR><TD CLASS="l">1054</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1055</TD><TD>                                this.state.updateRoots(element.getPath(), delta, this);</TD></TR><TR><TD CLASS="l">1056</TD><TD> </TD></TR><TR><TD CLASS="l">1057</TD><TD>                                // refresh pkg fragment roots and caches of the project (and its dependents)</TD></TR><TR CLASS="z"><TD CLASS="l">1058</TD><TD>                                this.rootsToRefresh.add(element);</TD></TR><TR CLASS="z"><TD CLASS="l">1059</TD><TD>                                this.projectCachesToReset.add(element);</TD></TR><TR><TD CLASS="l">1060</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1061</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1062</TD><TD>                        if (delta == null || (delta.getFlags() &amp; IResourceDelta.MOVED_FROM) == 0) {</TD></TR><TR><TD CLASS="l">1063</TD><TD>                                // regular element addition</TD></TR><TR CLASS="z"><TD CLASS="l">1064</TD><TD>                                if (isPrimaryWorkingCopy(element, elementType) ) {</TD></TR><TR><TD CLASS="l">1065</TD><TD>                                        // filter out changes to primary compilation unit in working copy mode</TD></TR><TR><TD CLASS="l">1066</TD><TD>                                        // just report a change to the resource (see https://bugs.eclipse.org/bugs/show_bug.cgi?id=59500)</TD></TR><TR CLASS="z"><TD CLASS="l">1067</TD><TD>                                        currentDelta().changed(element, IJavaScriptElementDelta.F_PRIMARY_RESOURCE);</TD></TR><TR><TD CLASS="l">1068</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1069</TD><TD>                                        addToParentInfo(element);</TD></TR><TR><TD CLASS="l">1070</TD><TD> </TD></TR><TR><TD CLASS="l">1071</TD><TD>                                        // Force the element to be closed as it might have been opened</TD></TR><TR><TD CLASS="l">1072</TD><TD>                                        // before the resource modification came in and it might have a new child</TD></TR><TR><TD CLASS="l">1073</TD><TD>                                        // For example, in an IWorkspaceRunnable:</TD></TR><TR><TD CLASS="l">1074</TD><TD>                                        // 1. create a package fragment p using a java model operation</TD></TR><TR><TD CLASS="l">1075</TD><TD>                                        // 2. open package p</TD></TR><TR><TD CLASS="l">1076</TD><TD>                                        // 3. add file X.js in folder p</TD></TR><TR><TD CLASS="l">1077</TD><TD>                                        // When the resource delta comes in, only the addition of p is notified,</TD></TR><TR><TD CLASS="l">1078</TD><TD>                                        // but the package p is already opened, thus its children are not recomputed</TD></TR><TR><TD CLASS="l">1079</TD><TD>                                        // and it appears empty.</TD></TR><TR CLASS="z"><TD CLASS="l">1080</TD><TD>                                        close(element);</TD></TR><TR><TD CLASS="l">1081</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1082</TD><TD>                                        currentDelta().added(element);</TD></TR><TR><TD CLASS="l">1083</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1084</TD><TD>                        } else {</TD></TR><TR><TD CLASS="l">1085</TD><TD>                                // element is moved</TD></TR><TR CLASS="z"><TD CLASS="l">1086</TD><TD>                                addToParentInfo(element);</TD></TR><TR CLASS="z"><TD CLASS="l">1087</TD><TD>                                close(element);</TD></TR><TR><TD CLASS="l">1088</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1089</TD><TD>                                IPath movedFromPath = delta.getMovedFromPath();</TD></TR><TR CLASS="z"><TD CLASS="l">1090</TD><TD>                                IResource res = delta.getResource();</TD></TR><TR><TD CLASS="l">1091</TD><TD>                                IResource movedFromRes;</TD></TR><TR CLASS="z"><TD CLASS="l">1092</TD><TD>                                if (res instanceof IFile) {</TD></TR><TR CLASS="z"><TD CLASS="l">1093</TD><TD>                                        movedFromRes = res.getWorkspace().getRoot().getFile(movedFromPath);</TD></TR><TR><TD CLASS="l">1094</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1095</TD><TD>                                        movedFromRes = res.getWorkspace().getRoot().getFolder(movedFromPath);</TD></TR><TR><TD CLASS="l">1096</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1097</TD><TD> </TD></TR><TR><TD CLASS="l">1098</TD><TD>                                // find the element type of the moved from element</TD></TR><TR CLASS="z"><TD CLASS="l">1099</TD><TD>                                RootInfo movedFromInfo = this.enclosingRootInfo(movedFromPath, IResourceDelta.REMOVED);</TD></TR><TR CLASS="z"><TD CLASS="l">1100</TD><TD>                                int movedFromType =</TD></TR><TR CLASS="z"><TD CLASS="l">1101</TD><TD>                                        this.elementType(</TD></TR><TR CLASS="z"><TD CLASS="l">1102</TD><TD>                                                movedFromRes,</TD></TR><TR CLASS="z"><TD CLASS="l">1103</TD><TD>                                                IResourceDelta.REMOVED,</TD></TR><TR CLASS="z"><TD CLASS="l">1104</TD><TD>                                                element.getParent().getElementType(),</TD></TR><TR CLASS="z"><TD CLASS="l">1105</TD><TD>                                                movedFromInfo);</TD></TR><TR><TD CLASS="l">1106</TD><TD> </TD></TR><TR><TD CLASS="l">1107</TD><TD>                                // reset current element as it might be inside a nested root (popUntilPrefixOf() may use the outer root)</TD></TR><TR CLASS="z"><TD CLASS="l">1108</TD><TD>                                this.currentElement = null;</TD></TR><TR><TD CLASS="l">1109</TD><TD> </TD></TR><TR><TD CLASS="l">1110</TD><TD>                                // create the moved from element</TD></TR><TR CLASS="z"><TD CLASS="l">1111</TD><TD>                                Openable movedFromElement =</TD></TR><TR CLASS="z"><TD CLASS="l">1112</TD><TD>                                        elementType != IJavaScriptElement.JAVASCRIPT_PROJECT &amp;&amp; movedFromType == IJavaScriptElement.JAVASCRIPT_PROJECT ?</TD></TR><TR CLASS="z"><TD CLASS="l">1113</TD><TD>                                                null : // outside classpath</TD></TR><TR CLASS="z"><TD CLASS="l">1114</TD><TD>                                                this.createElement(movedFromRes, movedFromType, movedFromInfo);</TD></TR><TR CLASS="z"><TD CLASS="l">1115</TD><TD>                                if (movedFromElement == null) {</TD></TR><TR><TD CLASS="l">1116</TD><TD>                                        // moved from outside classpath</TD></TR><TR CLASS="z"><TD CLASS="l">1117</TD><TD>                                        currentDelta().added(element);</TD></TR><TR><TD CLASS="l">1118</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1119</TD><TD>                                        currentDelta().movedTo(element, movedFromElement);</TD></TR><TR><TD CLASS="l">1120</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1121</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1122</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1123</TD><TD>                        switch (elementType) {</TD></TR><TR><TD CLASS="l">1124</TD><TD>                                case IJavaScriptElement.PACKAGE_FRAGMENT_ROOT :</TD></TR><TR><TD CLASS="l">1125</TD><TD>                                        // when a root is added, and is on the classpath, the project must be updated</TD></TR><TR CLASS="z"><TD CLASS="l">1126</TD><TD>                                        JavaProject project = (JavaProject) element.getJavaScriptProject();</TD></TR><TR><TD CLASS="l">1127</TD><TD> </TD></TR><TR><TD CLASS="l">1128</TD><TD>                                        // refresh pkg fragment roots and caches of the project (and its dependents)</TD></TR><TR CLASS="z"><TD CLASS="l">1129</TD><TD>                                        this.rootsToRefresh.add(project);</TD></TR><TR CLASS="z"><TD CLASS="l">1130</TD><TD>                                        this.projectCachesToReset.add(project);</TD></TR><TR><TD CLASS="l">1131</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1132</TD><TD>                                        break;</TD></TR><TR><TD CLASS="l">1133</TD><TD>                                case IJavaScriptElement.PACKAGE_FRAGMENT :</TD></TR><TR><TD CLASS="l">1134</TD><TD>                                        // reset project's package fragment cache</TD></TR><TR CLASS="z"><TD CLASS="l">1135</TD><TD>                                        project = (JavaProject) element.getJavaScriptProject();</TD></TR><TR CLASS="z"><TD CLASS="l">1136</TD><TD>                                        this.projectCachesToReset.add(project);</TD></TR><TR><TD CLASS="l">1137</TD><TD> </TD></TR><TR><TD CLASS="l">1138</TD><TD>                                        break;</TD></TR><TR><TD CLASS="l">1139</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1140</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1141</TD><TD>        }</TD></TR><TR><TD CLASS="l">1142</TD><TD>        /*</TD></TR><TR><TD CLASS="l">1143</TD><TD>         * Generic processing for a removed element:&lt;ul&gt;</TD></TR><TR><TD CLASS="l">1144</TD><TD>         * &lt;li&gt;Close the element, removing its structure from the cache</TD></TR><TR><TD CLASS="l">1145</TD><TD>         * &lt;li&gt;Remove the element from its parent's cache of children</TD></TR><TR><TD CLASS="l">1146</TD><TD>         * &lt;li&gt;Add a REMOVED entry in the delta</TD></TR><TR><TD CLASS="l">1147</TD><TD>         * &lt;/ul&gt;</TD></TR><TR><TD CLASS="l"><A NAME="13">1148</A></TD><TD>         * Delta argument could be null if processing an external JAR change</TD></TR><TR><TD CLASS="l">1149</TD><TD>         */</TD></TR><TR><TD CLASS="l">1150</TD><TD>        private void elementRemoved(Openable element, IResourceDelta delta, RootInfo rootInfo) {</TD></TR><TR><TD CLASS="l">1151</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1152</TD><TD>                int elementType = element.getElementType();</TD></TR><TR CLASS="z"><TD CLASS="l">1153</TD><TD>                if (delta == null || (delta.getFlags() &amp; IResourceDelta.MOVED_TO) == 0) {</TD></TR><TR><TD CLASS="l">1154</TD><TD>                        // regular element removal</TD></TR><TR CLASS="z"><TD CLASS="l">1155</TD><TD>                        if (isPrimaryWorkingCopy(element, elementType) ) {</TD></TR><TR><TD CLASS="l">1156</TD><TD>                                // filter out changes to primary compilation unit in working copy mode</TD></TR><TR><TD CLASS="l">1157</TD><TD>                                // just report a change to the resource (see https://bugs.eclipse.org/bugs/show_bug.cgi?id=59500)</TD></TR><TR CLASS="z"><TD CLASS="l">1158</TD><TD>                                currentDelta().changed(element, IJavaScriptElementDelta.F_PRIMARY_RESOURCE);</TD></TR><TR><TD CLASS="l">1159</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1160</TD><TD>                                close(element);</TD></TR><TR CLASS="z"><TD CLASS="l">1161</TD><TD>                                removeFromParentInfo(element);</TD></TR><TR CLASS="z"><TD CLASS="l">1162</TD><TD>                                currentDelta().removed(element);</TD></TR><TR><TD CLASS="l">1163</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1164</TD><TD>                } else {</TD></TR><TR><TD CLASS="l">1165</TD><TD>                        // element is moved</TD></TR><TR CLASS="z"><TD CLASS="l">1166</TD><TD>                        close(element);</TD></TR><TR CLASS="z"><TD CLASS="l">1167</TD><TD>                        removeFromParentInfo(element);</TD></TR><TR CLASS="z"><TD CLASS="l">1168</TD><TD>                        IPath movedToPath = delta.getMovedToPath();</TD></TR><TR CLASS="z"><TD CLASS="l">1169</TD><TD>                        IResource res = delta.getResource();</TD></TR><TR><TD CLASS="l">1170</TD><TD>                        IResource movedToRes;</TD></TR><TR CLASS="z"><TD CLASS="l">1171</TD><TD>                        switch (res.getType()) {</TD></TR><TR><TD CLASS="l">1172</TD><TD>                                case IResource.PROJECT:</TD></TR><TR CLASS="z"><TD CLASS="l">1173</TD><TD>                                        movedToRes = res.getWorkspace().getRoot().getProject(movedToPath.lastSegment());</TD></TR><TR CLASS="z"><TD CLASS="l">1174</TD><TD>                                        break;</TD></TR><TR><TD CLASS="l">1175</TD><TD>                                case IResource.FOLDER:</TD></TR><TR CLASS="z"><TD CLASS="l">1176</TD><TD>                                        movedToRes = res.getWorkspace().getRoot().getFolder(movedToPath);</TD></TR><TR CLASS="z"><TD CLASS="l">1177</TD><TD>                                        break;</TD></TR><TR><TD CLASS="l">1178</TD><TD>                                case IResource.FILE:</TD></TR><TR CLASS="z"><TD CLASS="l">1179</TD><TD>                                        movedToRes = res.getWorkspace().getRoot().getFile(movedToPath);</TD></TR><TR CLASS="z"><TD CLASS="l">1180</TD><TD>                                        break;</TD></TR><TR><TD CLASS="l">1181</TD><TD>                                default:</TD></TR><TR CLASS="z"><TD CLASS="l">1182</TD><TD>                                        return;</TD></TR><TR><TD CLASS="l">1183</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1184</TD><TD> </TD></TR><TR><TD CLASS="l">1185</TD><TD>                        // find the element type of the moved from element</TD></TR><TR CLASS="z"><TD CLASS="l">1186</TD><TD>                        RootInfo movedToInfo = this.enclosingRootInfo(movedToPath, IResourceDelta.ADDED);</TD></TR><TR CLASS="z"><TD CLASS="l">1187</TD><TD>                        int movedToType =</TD></TR><TR CLASS="z"><TD CLASS="l">1188</TD><TD>                                this.elementType(</TD></TR><TR CLASS="z"><TD CLASS="l">1189</TD><TD>                                        movedToRes,</TD></TR><TR CLASS="z"><TD CLASS="l">1190</TD><TD>                                        IResourceDelta.ADDED,</TD></TR><TR CLASS="z"><TD CLASS="l">1191</TD><TD>                                        element.getParent().getElementType(),</TD></TR><TR CLASS="z"><TD CLASS="l">1192</TD><TD>                                        movedToInfo);</TD></TR><TR><TD CLASS="l">1193</TD><TD> </TD></TR><TR><TD CLASS="l">1194</TD><TD>                        // reset current element as it might be inside a nested root (popUntilPrefixOf() may use the outer root)</TD></TR><TR CLASS="z"><TD CLASS="l">1195</TD><TD>                        this.currentElement = null;</TD></TR><TR><TD CLASS="l">1196</TD><TD> </TD></TR><TR><TD CLASS="l">1197</TD><TD>                        // create the moved To element</TD></TR><TR CLASS="z"><TD CLASS="l">1198</TD><TD>                        Openable movedToElement =</TD></TR><TR CLASS="z"><TD CLASS="l">1199</TD><TD>                                elementType != IJavaScriptElement.JAVASCRIPT_PROJECT &amp;&amp; movedToType == IJavaScriptElement.JAVASCRIPT_PROJECT ?</TD></TR><TR CLASS="z"><TD CLASS="l">1200</TD><TD>                                        null : // outside classpath</TD></TR><TR CLASS="z"><TD CLASS="l">1201</TD><TD>                                        this.createElement(movedToRes, movedToType, movedToInfo);</TD></TR><TR CLASS="z"><TD CLASS="l">1202</TD><TD>                        if (movedToElement == null) {</TD></TR><TR><TD CLASS="l">1203</TD><TD>                                // moved outside classpath</TD></TR><TR CLASS="z"><TD CLASS="l">1204</TD><TD>                                currentDelta().removed(element);</TD></TR><TR><TD CLASS="l">1205</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1206</TD><TD>                                currentDelta().movedFrom(element, movedToElement);</TD></TR><TR><TD CLASS="l">1207</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1208</TD><TD>                }</TD></TR><TR><TD CLASS="l">1209</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1210</TD><TD>                switch (elementType) {</TD></TR><TR><TD CLASS="l">1211</TD><TD>                        case IJavaScriptElement.JAVASCRIPT_MODEL :</TD></TR><TR CLASS="z"><TD CLASS="l">1212</TD><TD>                                this.manager.indexManager.reset();</TD></TR><TR CLASS="z"><TD CLASS="l">1213</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">1214</TD><TD>                        case IJavaScriptElement.JAVASCRIPT_PROJECT :</TD></TR><TR CLASS="z"><TD CLASS="l">1215</TD><TD>                                this.state.updateRoots(element.getPath(), delta, this);</TD></TR><TR><TD CLASS="l">1216</TD><TD> </TD></TR><TR><TD CLASS="l">1217</TD><TD>                                // refresh pkg fragment roots and caches of the project (and its dependents)</TD></TR><TR CLASS="z"><TD CLASS="l">1218</TD><TD>                                this.rootsToRefresh.add(element);</TD></TR><TR CLASS="z"><TD CLASS="l">1219</TD><TD>                                this.projectCachesToReset.add(element);</TD></TR><TR><TD CLASS="l">1220</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1221</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">1222</TD><TD>                        case IJavaScriptElement.PACKAGE_FRAGMENT_ROOT :</TD></TR><TR CLASS="z"><TD CLASS="l">1223</TD><TD>                                JavaProject project = (JavaProject) element.getJavaScriptProject();</TD></TR><TR><TD CLASS="l">1224</TD><TD> </TD></TR><TR><TD CLASS="l">1225</TD><TD>                                // refresh pkg fragment roots and caches of the project (and its dependents)</TD></TR><TR CLASS="z"><TD CLASS="l">1226</TD><TD>                                this.rootsToRefresh.add(project);</TD></TR><TR CLASS="z"><TD CLASS="l">1227</TD><TD>                                this.projectCachesToReset.add(project);</TD></TR><TR><TD CLASS="l">1228</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1229</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">1230</TD><TD>                        case IJavaScriptElement.PACKAGE_FRAGMENT :</TD></TR><TR><TD CLASS="l">1231</TD><TD>                                // reset package fragment cache</TD></TR><TR CLASS="z"><TD CLASS="l">1232</TD><TD>                                project = (JavaProject) element.getJavaScriptProject();</TD></TR><TR CLASS="z"><TD CLASS="l">1233</TD><TD>                                this.projectCachesToReset.add(project);</TD></TR><TR><TD CLASS="l">1234</TD><TD> </TD></TR><TR><TD CLASS="l">1235</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">1236</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1237</TD><TD>        }</TD></TR><TR><TD CLASS="l">1238</TD><TD>        /*</TD></TR><TR><TD CLASS="l"><A NAME="14">1239</A></TD><TD>         * Returns the type of the java element the given delta matches to.</TD></TR><TR><TD CLASS="l">1240</TD><TD>         * Returns NON_JAVA_RESOURCE if unknown (e.g. a non-java resource or excluded .js file)</TD></TR><TR><TD CLASS="l">1241</TD><TD>         */</TD></TR><TR><TD CLASS="l">1242</TD><TD>        private int elementType(IResource res, int kind, int parentType, RootInfo rootInfo) {</TD></TR><TR CLASS="z"><TD CLASS="l">1243</TD><TD>                switch (parentType) {</TD></TR><TR><TD CLASS="l">1244</TD><TD>                        case IJavaScriptElement.JAVASCRIPT_MODEL:</TD></TR><TR><TD CLASS="l">1245</TD><TD>                                // case of a movedTo or movedFrom project (other cases are handled in processResourceDelta(...)</TD></TR><TR CLASS="z"><TD CLASS="l">1246</TD><TD>                                return IJavaScriptElement.JAVASCRIPT_PROJECT;</TD></TR><TR><TD CLASS="l">1247</TD><TD> </TD></TR><TR><TD CLASS="l">1248</TD><TD>                        case NON_JAVA_RESOURCE:</TD></TR><TR><TD CLASS="l">1249</TD><TD>                        case IJavaScriptElement.JAVASCRIPT_PROJECT:</TD></TR><TR CLASS="z"><TD CLASS="l">1250</TD><TD>                                if (rootInfo == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1251</TD><TD>                                        rootInfo = this.enclosingRootInfo(res.getFullPath(), kind);</TD></TR><TR><TD CLASS="l">1252</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1253</TD><TD>                                if (rootInfo != null &amp;&amp; rootInfo.isRootOfProject(res.getFullPath())) {</TD></TR><TR CLASS="z"><TD CLASS="l">1254</TD><TD>                                        return IJavaScriptElement.PACKAGE_FRAGMENT_ROOT;</TD></TR><TR><TD CLASS="l">1255</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1256</TD><TD>                                // not yet in a package fragment root or root of another project</TD></TR><TR><TD CLASS="l">1257</TD><TD>                                // or package fragment to be included (see below)</TD></TR><TR><TD CLASS="l">1258</TD><TD>                                // -&gt; let it go through</TD></TR><TR><TD CLASS="l">1259</TD><TD> </TD></TR><TR><TD CLASS="l">1260</TD><TD>                        case IJavaScriptElement.PACKAGE_FRAGMENT_ROOT:</TD></TR><TR><TD CLASS="l">1261</TD><TD>                        case IJavaScriptElement.PACKAGE_FRAGMENT:</TD></TR><TR CLASS="z"><TD CLASS="l">1262</TD><TD>                                if (rootInfo == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1263</TD><TD>                                        rootInfo = this.enclosingRootInfo(res.getFullPath(), kind);</TD></TR><TR><TD CLASS="l">1264</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1265</TD><TD>                                if (rootInfo == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1266</TD><TD>                                        return NON_JAVA_RESOURCE;</TD></TR><TR><TD CLASS="l">1267</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1268</TD><TD>                                if (Util.isExcluded(res, rootInfo.inclusionPatterns, rootInfo.exclusionPatterns)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1269</TD><TD>                                        return NON_JAVA_RESOURCE;</TD></TR><TR><TD CLASS="l">1270</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1271</TD><TD>                                if (res.getType() == IResource.FOLDER) {</TD></TR><TR CLASS="z"><TD CLASS="l">1272</TD><TD>                                        if (parentType == NON_JAVA_RESOURCE &amp;&amp; !Util.isExcluded(res.getParent(), rootInfo.inclusionPatterns, rootInfo.exclusionPatterns)) {</TD></TR><TR><TD CLASS="l">1273</TD><TD>                                                // parent is a non-Java resource because it doesn't have a valid package name (see https://bugs.eclipse.org/bugs/show_bug.cgi?id=130982)</TD></TR><TR CLASS="z"><TD CLASS="l">1274</TD><TD>                                                return NON_JAVA_RESOURCE;</TD></TR><TR><TD CLASS="l">1275</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1276</TD><TD>                                        String sourceLevel = rootInfo.project == null ? null : rootInfo.project.getOption(JavaScriptCore.COMPILER_SOURCE, true);</TD></TR><TR CLASS="z"><TD CLASS="l">1277</TD><TD>                                        String complianceLevel = rootInfo.project == null ? null : rootInfo.project.getOption(JavaScriptCore.COMPILER_COMPLIANCE, true);</TD></TR><TR CLASS="z"><TD CLASS="l">1278</TD><TD>                                        if (Util.isValidFolderNameForPackage(res.getName(), sourceLevel, complianceLevel)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1279</TD><TD>                                                return IJavaScriptElement.PACKAGE_FRAGMENT;</TD></TR><TR><TD CLASS="l">1280</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1281</TD><TD>                                        return NON_JAVA_RESOURCE;</TD></TR><TR><TD CLASS="l">1282</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1283</TD><TD>                                String fileName = res.getName();</TD></TR><TR CLASS="z"><TD CLASS="l">1284</TD><TD>                                String sourceLevel = rootInfo.project == null ? null : rootInfo.project.getOption(JavaScriptCore.COMPILER_SOURCE, true);</TD></TR><TR CLASS="z"><TD CLASS="l">1285</TD><TD>                                String complianceLevel = rootInfo.project == null ? null : rootInfo.project.getOption(JavaScriptCore.COMPILER_COMPLIANCE, true);</TD></TR><TR CLASS="z"><TD CLASS="l">1286</TD><TD>                                if (Util.isValidCompilationUnitName(fileName, sourceLevel, complianceLevel)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1287</TD><TD>                                        return IJavaScriptElement.JAVASCRIPT_UNIT;</TD></TR><TR CLASS="z"><TD CLASS="l">1288</TD><TD>                                } else if (Util.isValidClassFileName(fileName, sourceLevel, complianceLevel) || Util.isMetadataFileName(fileName)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1289</TD><TD>                                        return IJavaScriptElement.CLASS_FILE;</TD></TR><TR CLASS="z"><TD CLASS="l">1290</TD><TD>                                } else if ((rootInfo = this.rootInfo(res.getFullPath(), kind)) != null</TD></TR><TR CLASS="z"><TD CLASS="l">1291</TD><TD>                                                &amp;&amp; rootInfo.project.getProject().getFullPath().isPrefixOf(res.getFullPath()) /*ensure root is a root of its project (see https://bugs.eclipse.org/bugs/show_bug.cgi?id=185310) */) {</TD></TR><TR><TD CLASS="l">1292</TD><TD>                                        // case of proj=src=bin and resource is a jar file on the classpath</TD></TR><TR CLASS="z"><TD CLASS="l">1293</TD><TD>                                        return IJavaScriptElement.PACKAGE_FRAGMENT_ROOT;</TD></TR><TR><TD CLASS="l">1294</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1295</TD><TD>                                        return NON_JAVA_RESOURCE;</TD></TR><TR><TD CLASS="l">1296</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1297</TD><TD> </TD></TR><TR><TD CLASS="l">1298</TD><TD>                        default:</TD></TR><TR CLASS="z"><TD CLASS="l">1299</TD><TD>                                return NON_JAVA_RESOURCE;</TD></TR><TR><TD CLASS="l">1300</TD><TD>                }</TD></TR><TR><TD CLASS="l">1301</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="19">1302</A></TD><TD>        /*</TD></TR><TR><TD CLASS="l">1303</TD><TD>         * Flushes all deltas without firing them.</TD></TR><TR><TD CLASS="l">1304</TD><TD>         */</TD></TR><TR><TD CLASS="l">1305</TD><TD>        public void flush() {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1a">1306</A></TD><TD>                this.javaModelDeltas = new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">1307</TD><TD>        }</TD></TR><TR><TD CLASS="l">1308</TD><TD> </TD></TR><TR><TD CLASS="l">1309</TD><TD>        private SourceElementParser getSourceElementParser(Openable element) {</TD></TR><TR CLASS="z"><TD CLASS="l">1310</TD><TD>                if (this.sourceElementParserCache == null)</TD></TR><TR CLASS="z"><TD CLASS="l">1311</TD><TD>                        this.sourceElementParserCache = this.manager.indexManager.getSourceElementParser(element.getJavaScriptProject(), null/*requestor will be set by indexer*/);</TD></TR><TR CLASS="z"><TD CLASS="l">1312</TD><TD>                return this.sourceElementParserCache;</TD></TR><TR><TD CLASS="l">1313</TD><TD>        }</TD></TR><TR><TD CLASS="l">1314</TD><TD>        /*</TD></TR><TR><TD CLASS="l"><A NAME="15">1315</A></TD><TD>         * Finds the root info this path is included in.</TD></TR><TR><TD CLASS="l">1316</TD><TD>         * Returns null if not found.</TD></TR><TR><TD CLASS="l">1317</TD><TD>         */</TD></TR><TR><TD CLASS="l">1318</TD><TD>        private RootInfo enclosingRootInfo(IPath path, int kind) {</TD></TR><TR CLASS="z"><TD CLASS="l">1319</TD><TD>                while (path != null &amp;&amp; path.segmentCount() &gt; 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1320</TD><TD>                        RootInfo rootInfo =  this.rootInfo(path, kind);</TD></TR><TR CLASS="z"><TD CLASS="l">1321</TD><TD>                        if (rootInfo != null) return rootInfo;</TD></TR><TR CLASS="z"><TD CLASS="l">1322</TD><TD>                        path = path.removeLastSegments(1);</TD></TR><TR><TD CLASS="l">1323</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1324</TD><TD>                return null;</TD></TR><TR><TD CLASS="l">1325</TD><TD>        }</TD></TR><TR><TD CLASS="l">1326</TD><TD>        /*</TD></TR><TR><TD CLASS="l"><A NAME="16">1327</A></TD><TD>         * Fire Java Model delta, flushing them after the fact after post_change notification.</TD></TR><TR><TD CLASS="l">1328</TD><TD>         * If the firing mode has been turned off, this has no effect.</TD></TR><TR><TD CLASS="l">1329</TD><TD>         */</TD></TR><TR><TD CLASS="l">1330</TD><TD>        public void fire(IJavaScriptElementDelta customDelta, int eventType) {</TD></TR><TR CLASS="z"><TD CLASS="l">1331</TD><TD>                if (!this.isFiring) return;</TD></TR><TR><TD CLASS="l">1332</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1333</TD><TD>                if (DEBUG) {</TD></TR><TR CLASS="z"><TD CLASS="l">1334</TD><TD>                        System.out.println(&#34;-----------------------------------------------------------------------------------------------------------------------&#34;);//$NON-NLS-1$</TD></TR><TR><TD CLASS="l">1335</TD><TD>                }</TD></TR><TR><TD CLASS="l">1336</TD><TD> </TD></TR><TR><TD CLASS="l">1337</TD><TD>                IJavaScriptElementDelta deltaToNotify;</TD></TR><TR CLASS="z"><TD CLASS="l">1338</TD><TD>                if (customDelta == null){</TD></TR><TR CLASS="z"><TD CLASS="l">1339</TD><TD>                        deltaToNotify = this.mergeDeltas(this.javaModelDeltas);</TD></TR><TR><TD CLASS="l">1340</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1341</TD><TD>                        deltaToNotify = customDelta;</TD></TR><TR><TD CLASS="l">1342</TD><TD>                }</TD></TR><TR><TD CLASS="l">1343</TD><TD> </TD></TR><TR><TD CLASS="l">1344</TD><TD>                // Refresh internal scopes</TD></TR><TR CLASS="z"><TD CLASS="l">1345</TD><TD>                if (deltaToNotify != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1346</TD><TD>                        Iterator scopes = this.manager.searchScopes.keySet().iterator();</TD></TR><TR CLASS="z"><TD CLASS="l">1347</TD><TD>                        while (scopes.hasNext()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1348</TD><TD>                                AbstractSearchScope scope = (AbstractSearchScope)scopes.next();</TD></TR><TR CLASS="z"><TD CLASS="l">1349</TD><TD>                                scope.processDelta(deltaToNotify);</TD></TR><TR><TD CLASS="l">1350</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1351</TD><TD>                        JavaWorkspaceScope workspaceScope = this.manager.workspaceScope;</TD></TR><TR CLASS="z"><TD CLASS="l">1352</TD><TD>                        if (workspaceScope != null)</TD></TR><TR CLASS="z"><TD CLASS="l">1353</TD><TD>                                workspaceScope.processDelta(deltaToNotify);</TD></TR><TR><TD CLASS="l">1354</TD><TD>                }</TD></TR><TR><TD CLASS="l">1355</TD><TD> </TD></TR><TR><TD CLASS="l">1356</TD><TD>                // Notification</TD></TR><TR><TD CLASS="l">1357</TD><TD> </TD></TR><TR><TD CLASS="l">1358</TD><TD>                // Important: if any listener reacts to notification by updating the listeners list or mask, these lists will</TD></TR><TR><TD CLASS="l">1359</TD><TD>                // be duplicated, so it is necessary to remember original lists in a variable (since field values may change under us)</TD></TR><TR><TD CLASS="l">1360</TD><TD>                IElementChangedListener[] listeners;</TD></TR><TR><TD CLASS="l">1361</TD><TD>                int[] listenerMask;</TD></TR><TR><TD CLASS="l">1362</TD><TD>                int listenerCount;</TD></TR><TR CLASS="z"><TD CLASS="l">1363</TD><TD>                synchronized (this.state) {</TD></TR><TR CLASS="z"><TD CLASS="l">1364</TD><TD>                        listeners = this.state.elementChangedListeners;</TD></TR><TR CLASS="z"><TD CLASS="l">1365</TD><TD>                        listenerMask = this.state.elementChangedListenerMasks;</TD></TR><TR CLASS="z"><TD CLASS="l">1366</TD><TD>                        listenerCount = this.state.elementChangedListenerCount;</TD></TR><TR><TD CLASS="l">1367</TD><TD>                }</TD></TR><TR><TD CLASS="l">1368</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1369</TD><TD>                switch (eventType) {</TD></TR><TR><TD CLASS="l">1370</TD><TD>                        case DEFAULT_CHANGE_EVENT:</TD></TR><TR CLASS="z"><TD CLASS="l">1371</TD><TD>                                firePostChangeDelta(deltaToNotify, listeners, listenerMask, listenerCount);</TD></TR><TR CLASS="z"><TD CLASS="l">1372</TD><TD>                                fireReconcileDelta(listeners, listenerMask, listenerCount);</TD></TR><TR CLASS="z"><TD CLASS="l">1373</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">1374</TD><TD>                        case ElementChangedEvent.POST_CHANGE:</TD></TR><TR CLASS="z"><TD CLASS="l">1375</TD><TD>                                firePostChangeDelta(deltaToNotify, listeners, listenerMask, listenerCount);</TD></TR><TR CLASS="z"><TD CLASS="l">1376</TD><TD>                                fireReconcileDelta(listeners, listenerMask, listenerCount);</TD></TR><TR><TD CLASS="l">1377</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">1378</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1379</TD><TD>        }</TD></TR><TR><TD CLASS="l">1380</TD><TD> </TD></TR><TR><TD CLASS="l">1381</TD><TD>        private void firePostChangeDelta(</TD></TR><TR><TD CLASS="l">1382</TD><TD>                IJavaScriptElementDelta deltaToNotify,</TD></TR><TR><TD CLASS="l">1383</TD><TD>                IElementChangedListener[] listeners,</TD></TR><TR><TD CLASS="l"><A NAME="17">1384</A></TD><TD>                int[] listenerMask,</TD></TR><TR><TD CLASS="l">1385</TD><TD>                int listenerCount) {</TD></TR><TR><TD CLASS="l">1386</TD><TD> </TD></TR><TR><TD CLASS="l">1387</TD><TD>                // post change deltas</TD></TR><TR CLASS="z"><TD CLASS="l">1388</TD><TD>                if (DEBUG){</TD></TR><TR CLASS="z"><TD CLASS="l">1389</TD><TD>                        System.out.println(&#34;FIRING POST_CHANGE Delta [&#34;+Thread.currentThread()+&#34;]:&#34;); //$NON-NLS-1$//$NON-NLS-2$</TD></TR><TR CLASS="z"><TD CLASS="l">1390</TD><TD>                        System.out.println(deltaToNotify == null ? &#34;&lt;NONE&gt;&#34; : deltaToNotify.toString()); //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">1391</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1392</TD><TD>                if (deltaToNotify != null) {</TD></TR><TR><TD CLASS="l">1393</TD><TD>                        // flush now so as to keep listener reactions to post their own deltas for subsequent iteration</TD></TR><TR CLASS="z"><TD CLASS="l">1394</TD><TD>                        this.flush();</TD></TR><TR><TD CLASS="l">1395</TD><TD> </TD></TR><TR><TD CLASS="l">1396</TD><TD>                        // mark the operation stack has not modifying resources since resource deltas are being fired</TD></TR><TR CLASS="z"><TD CLASS="l">1397</TD><TD>                        JavaModelOperation.setAttribute(JavaModelOperation.HAS_MODIFIED_RESOURCE_ATTR, null);</TD></TR><TR><TD CLASS="l">1398</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1399</TD><TD>                        notifyListeners(deltaToNotify, ElementChangedEvent.POST_CHANGE, listeners, listenerMask, listenerCount);</TD></TR><TR><TD CLASS="l">1400</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1401</TD><TD>        }</TD></TR><TR><TD CLASS="l">1402</TD><TD>        private void fireReconcileDelta(</TD></TR><TR><TD CLASS="l">1403</TD><TD>                IElementChangedListener[] listeners,</TD></TR><TR><TD CLASS="l"><A NAME="18">1404</A></TD><TD>                int[] listenerMask,</TD></TR><TR><TD CLASS="l">1405</TD><TD>                int listenerCount) {</TD></TR><TR><TD CLASS="l">1406</TD><TD> </TD></TR><TR><TD CLASS="l">1407</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1408</TD><TD>                IJavaScriptElementDelta deltaToNotify = mergeDeltas(this.reconcileDeltas.values());</TD></TR><TR CLASS="z"><TD CLASS="l">1409</TD><TD>                if (DEBUG){</TD></TR><TR CLASS="z"><TD CLASS="l">1410</TD><TD>                        System.out.println(&#34;FIRING POST_RECONCILE Delta [&#34;+Thread.currentThread()+&#34;]:&#34;); //$NON-NLS-1$//$NON-NLS-2$</TD></TR><TR CLASS="z"><TD CLASS="l">1411</TD><TD>                        System.out.println(deltaToNotify == null ? &#34;&lt;NONE&gt;&#34; : deltaToNotify.toString()); //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">1412</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1413</TD><TD>                if (deltaToNotify != null) {</TD></TR><TR><TD CLASS="l">1414</TD><TD>                        // flush now so as to keep listener reactions to post their own deltas for subsequent iteration</TD></TR><TR CLASS="z"><TD CLASS="l">1415</TD><TD>                        this.reconcileDeltas = new HashMap();</TD></TR><TR><TD CLASS="l">1416</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1417</TD><TD>                        notifyListeners(deltaToNotify, ElementChangedEvent.POST_RECONCILE, listeners, listenerMask, listenerCount);</TD></TR><TR><TD CLASS="l">1418</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1419</TD><TD>        }</TD></TR><TR><TD CLASS="l">1420</TD><TD>        /*</TD></TR><TR><TD CLASS="l">1421</TD><TD>         * Returns whether a given delta contains some information relevant to the JavaModel,</TD></TR><TR><TD CLASS="l">1422</TD><TD>         * in particular it will not consider SYNC or MARKER only deltas.</TD></TR><TR><TD CLASS="l"><A NAME="1c">1423</A></TD><TD>         */</TD></TR><TR><TD CLASS="l">1424</TD><TD>        private boolean isAffectedBy(IResourceDelta rootDelta){</TD></TR><TR><TD CLASS="l"><A NAME="3a">1425</A></TD><TD>                //if (rootDelta == null) System.out.println(&#34;NULL DELTA&#34;);</TD></TR><TR><TD CLASS="l">1426</TD><TD>                //long start = System.currentTimeMillis();</TD></TR><TR CLASS="z"><TD CLASS="l">1427</TD><TD>                if (rootDelta != null) {</TD></TR><TR><TD CLASS="l">1428</TD><TD>                        // use local exception to quickly escape from delta traversal</TD></TR><TR CLASS="z"><TD CLASS="l">1429</TD><TD>                        class FoundRelevantDeltaException extends RuntimeException {</TD></TR><TR><TD CLASS="l"><A NAME="3c">1430</A></TD><TD>                                private static final long serialVersionUID = 7137113252936111022L; // backward compatible</TD></TR><TR><TD CLASS="l">1431</TD><TD>                                // only the class name is used (to differenciate from other RuntimeExceptions)</TD></TR><TR><TD CLASS="l"><A NAME="3e">1432</A></TD><TD>                        }</TD></TR><TR><TD CLASS="l">1433</TD><TD>                        try {</TD></TR><TR CLASS="z"><TD CLASS="l">1434</TD><TD>                                rootDelta.accept(new IResourceDeltaVisitor() {</TD></TR><TR><TD CLASS="l">1435</TD><TD>                                        public boolean visit(IResourceDelta delta) /* throws CoreException */ {</TD></TR><TR CLASS="z"><TD CLASS="l">1436</TD><TD>                                                switch (delta.getKind()){</TD></TR><TR><TD CLASS="l">1437</TD><TD>                                                        case IResourceDelta.ADDED :</TD></TR><TR><TD CLASS="l">1438</TD><TD>                                                        case IResourceDelta.REMOVED :</TD></TR><TR CLASS="z"><TD CLASS="l">1439</TD><TD>                                                                throw new FoundRelevantDeltaException();</TD></TR><TR><TD CLASS="l">1440</TD><TD>                                                        case IResourceDelta.CHANGED :</TD></TR><TR><TD CLASS="l">1441</TD><TD>                                                                // if any flag is set but SYNC or MARKER, this delta should be considered</TD></TR><TR CLASS="z"><TD CLASS="l">1442</TD><TD>                                                                if (delta.getAffectedChildren().length == 0 // only check leaf delta nodes</TD></TR><TR CLASS="z"><TD CLASS="l">1443</TD><TD>                                                                                &amp;&amp; (delta.getFlags() &amp; ~(IResourceDelta.SYNC | IResourceDelta.MARKERS)) != 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1444</TD><TD>                                                                        throw new FoundRelevantDeltaException();</TD></TR><TR><TD CLASS="l">1445</TD><TD>                                                                }</TD></TR><TR><TD CLASS="l">1446</TD><TD>                                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1447</TD><TD>                                                return true;</TD></TR><TR><TD CLASS="l">1448</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">1449</TD><TD>                                });</TD></TR><TR CLASS="z"><TD CLASS="l">1450</TD><TD>                        } catch(FoundRelevantDeltaException e) {</TD></TR><TR><TD CLASS="l">1451</TD><TD>                                //System.out.println(&#34;RELEVANT DELTA detected in: &#34;+ (System.currentTimeMillis() - start));</TD></TR><TR CLASS="z"><TD CLASS="l">1452</TD><TD>                                return true;</TD></TR><TR CLASS="z"><TD CLASS="l">1453</TD><TD>                        } catch(CoreException e) { // ignore delta if not able to traverse</TD></TR><TR><TD CLASS="l">1454</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1455</TD><TD>                }</TD></TR><TR><TD CLASS="l">1456</TD><TD>                //System.out.println(&#34;IGNORE SYNC DELTA took: &#34;+ (System.currentTimeMillis() - start));</TD></TR><TR CLASS="z"><TD CLASS="l">1457</TD><TD>                return false;</TD></TR><TR><TD CLASS="l">1458</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="1d">1459</A></TD><TD>        /*</TD></TR><TR><TD CLASS="l">1460</TD><TD>         * Returns whether the given element is a primary compilation unit in working copy mode.</TD></TR><TR><TD CLASS="l">1461</TD><TD>         */</TD></TR><TR><TD CLASS="l">1462</TD><TD>        private boolean isPrimaryWorkingCopy(IJavaScriptElement element, int elementType) {</TD></TR><TR CLASS="z"><TD CLASS="l">1463</TD><TD>                if (elementType == IJavaScriptElement.JAVASCRIPT_UNIT) {</TD></TR><TR CLASS="z"><TD CLASS="l">1464</TD><TD>                        CompilationUnit cu = (CompilationUnit)element;</TD></TR><TR CLASS="z"><TD CLASS="l">1465</TD><TD>                        return cu.isPrimary() &amp;&amp; cu.isWorkingCopy();</TD></TR><TR><TD CLASS="l">1466</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1467</TD><TD>                return false;</TD></TR><TR><TD CLASS="l">1468</TD><TD>        }</TD></TR><TR><TD CLASS="l">1469</TD><TD>        /*</TD></TR><TR><TD CLASS="l"><A NAME="1e">1470</A></TD><TD>         * Returns whether the given resource is in one of the given output folders and if</TD></TR><TR><TD CLASS="l">1471</TD><TD>         * it is filtered out from this output folder.</TD></TR><TR><TD CLASS="l">1472</TD><TD>         */</TD></TR><TR><TD CLASS="l">1473</TD><TD>        private boolean isResFilteredFromOutput(RootInfo rootInfo, OutputsInfo info, IResource res, int elementType) {</TD></TR><TR CLASS="z"><TD CLASS="l">1474</TD><TD>                if (info != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1475</TD><TD>                        JavaProject javaProject = null;</TD></TR><TR CLASS="z"><TD CLASS="l">1476</TD><TD>                        String sourceLevel = null;</TD></TR><TR CLASS="z"><TD CLASS="l">1477</TD><TD>                        String complianceLevel = null;</TD></TR><TR CLASS="z"><TD CLASS="l">1478</TD><TD>                        IPath resPath = res.getFullPath();</TD></TR><TR CLASS="z"><TD CLASS="l">1479</TD><TD>                        for (int i = 0;  i &lt; info.outputCount; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1480</TD><TD>                                if (info.paths[i].isPrefixOf(resPath)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1481</TD><TD>                                        if (info.traverseModes[i] != IGNORE) {</TD></TR><TR><TD CLASS="l">1482</TD><TD>                                                // case of bin=src</TD></TR><TR CLASS="z"><TD CLASS="l">1483</TD><TD>                                                if (info.traverseModes[i] == SOURCE &amp;&amp; elementType == IJavaScriptElement.CLASS_FILE) {</TD></TR><TR CLASS="z"><TD CLASS="l">1484</TD><TD>                                                        return true;</TD></TR><TR><TD CLASS="l">1485</TD><TD>                                                }</TD></TR><TR><TD CLASS="l">1486</TD><TD>                                                // case of .class file under project and no source folder</TD></TR><TR><TD CLASS="l">1487</TD><TD>                                                // proj=bin</TD></TR><TR CLASS="z"><TD CLASS="l">1488</TD><TD>                                                if (elementType == IJavaScriptElement.JAVASCRIPT_PROJECT &amp;&amp; res instanceof IFile) {</TD></TR><TR CLASS="z"><TD CLASS="l">1489</TD><TD>                                                        if (sourceLevel == null) {</TD></TR><TR><TD CLASS="l">1490</TD><TD>                                                                // Get java project to use its source and compliance levels</TD></TR><TR CLASS="z"><TD CLASS="l">1491</TD><TD>                                                                javaProject = rootInfo == null ?</TD></TR><TR CLASS="z"><TD CLASS="l">1492</TD><TD>                                                                        (JavaProject)this.createElement(res.getProject(), IJavaScriptElement.JAVASCRIPT_PROJECT, null) :</TD></TR><TR CLASS="z"><TD CLASS="l">1493</TD><TD>                                                                        rootInfo.project;</TD></TR><TR CLASS="z"><TD CLASS="l">1494</TD><TD>                                                                if (javaProject != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1495</TD><TD>                                                                        sourceLevel = javaProject.getOption(JavaScriptCore.COMPILER_SOURCE, true);</TD></TR><TR CLASS="z"><TD CLASS="l">1496</TD><TD>                                                                        complianceLevel = javaProject.getOption(JavaScriptCore.COMPILER_COMPLIANCE, true);</TD></TR><TR><TD CLASS="l">1497</TD><TD>                                                                }</TD></TR><TR><TD CLASS="l">1498</TD><TD>                                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1499</TD><TD>                                                        if (Util.isValidClassFileName(res.getName(), sourceLevel, complianceLevel)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1500</TD><TD>                                                                return true;</TD></TR><TR><TD CLASS="l">1501</TD><TD>                                                        }</TD></TR><TR><TD CLASS="l">1502</TD><TD>                                                }</TD></TR><TR><TD CLASS="l">1503</TD><TD>                                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1504</TD><TD>                                                return true;</TD></TR><TR><TD CLASS="l">1505</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">1506</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1507</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1508</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1509</TD><TD>                return false;</TD></TR><TR><TD CLASS="l">1510</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="1f">1511</A></TD><TD>        /*</TD></TR><TR><TD CLASS="l">1512</TD><TD>         * Merges all awaiting deltas.</TD></TR><TR><TD CLASS="l">1513</TD><TD>         */</TD></TR><TR><TD CLASS="l">1514</TD><TD>        private IJavaScriptElementDelta mergeDeltas(Collection deltas) {</TD></TR><TR CLASS="z"><TD CLASS="l">1515</TD><TD>                if (deltas.size() == 0) return null;</TD></TR><TR CLASS="z"><TD CLASS="l">1516</TD><TD>                if (deltas.size() == 1) return (IJavaScriptElementDelta)deltas.iterator().next();</TD></TR><TR><TD CLASS="l">1517</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1518</TD><TD>                if (VERBOSE) {</TD></TR><TR CLASS="z"><TD CLASS="l">1519</TD><TD>                        System.out.println(&#34;MERGING &#34; + deltas.size() + &#34; DELTAS [&#34;+Thread.currentThread()+&#34;]&#34;); //$NON-NLS-1$ //$NON-NLS-2$ //$NON-NLS-3$</TD></TR><TR><TD CLASS="l">1520</TD><TD>                }</TD></TR><TR><TD CLASS="l">1521</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1522</TD><TD>                Iterator iterator = deltas.iterator();</TD></TR><TR CLASS="z"><TD CLASS="l">1523</TD><TD>                JavaElementDelta rootDelta = new JavaElementDelta(this.manager.javaModel);</TD></TR><TR CLASS="z"><TD CLASS="l">1524</TD><TD>                boolean insertedTree = false;</TD></TR><TR CLASS="z"><TD CLASS="l">1525</TD><TD>                while (iterator.hasNext()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1526</TD><TD>                        JavaElementDelta delta = (JavaElementDelta)iterator.next();</TD></TR><TR CLASS="z"><TD CLASS="l">1527</TD><TD>                        if (VERBOSE) {</TD></TR><TR CLASS="z"><TD CLASS="l">1528</TD><TD>                                System.out.println(delta.toString());</TD></TR><TR><TD CLASS="l">1529</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1530</TD><TD>                        IJavaScriptElement element = delta.getElement();</TD></TR><TR CLASS="z"><TD CLASS="l">1531</TD><TD>                        if (this.manager.javaModel.equals(element)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1532</TD><TD>                                IJavaScriptElementDelta[] children = delta.getAffectedChildren();</TD></TR><TR CLASS="z"><TD CLASS="l">1533</TD><TD>                                for (int j = 0; j &lt; children.length; j++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1534</TD><TD>                                        JavaElementDelta projectDelta = (JavaElementDelta) children[j];</TD></TR><TR CLASS="z"><TD CLASS="l">1535</TD><TD>                                        rootDelta.insertDeltaTree(projectDelta.getElement(), projectDelta);</TD></TR><TR CLASS="z"><TD CLASS="l">1536</TD><TD>                                        insertedTree = true;</TD></TR><TR><TD CLASS="l">1537</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1538</TD><TD>                                IResourceDelta[] resourceDeltas = delta.getResourceDeltas();</TD></TR><TR CLASS="z"><TD CLASS="l">1539</TD><TD>                                if (resourceDeltas != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1540</TD><TD>                                        for (int i = 0, length = resourceDeltas.length; i &lt; length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1541</TD><TD>                                                rootDelta.addResourceDelta(resourceDeltas[i]);</TD></TR><TR CLASS="z"><TD CLASS="l">1542</TD><TD>                                                insertedTree = true;</TD></TR><TR><TD CLASS="l">1543</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">1544</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1545</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1546</TD><TD>                                rootDelta.insertDeltaTree(element, delta);</TD></TR><TR CLASS="z"><TD CLASS="l">1547</TD><TD>                                insertedTree = true;</TD></TR><TR><TD CLASS="l">1548</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1549</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="21">1550</A></TD><TD>                if (insertedTree) return rootDelta;</TD></TR><TR CLASS="z"><TD CLASS="l">1551</TD><TD>                return null;</TD></TR><TR><TD CLASS="l">1552</TD><TD>        }</TD></TR><TR><TD CLASS="l">1553</TD><TD>        private void notifyListeners(IJavaScriptElementDelta deltaToNotify, int eventType, IElementChangedListener[] listeners, int[] listenerMask, int listenerCount) {</TD></TR><TR CLASS="z"><TD CLASS="l">1554</TD><TD>                final ElementChangedEvent extraEvent = new ElementChangedEvent(deltaToNotify, eventType);</TD></TR><TR CLASS="z"><TD CLASS="l">1555</TD><TD>                for (int i= 0; i &lt; listenerCount; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1556</TD><TD>                        if ((listenerMask[i] &amp; eventType) != 0){</TD></TR><TR CLASS="z"><TD CLASS="l">1557</TD><TD>                                final IElementChangedListener listener = listeners[i];</TD></TR><TR CLASS="z"><TD CLASS="l">1558</TD><TD>                                long start = -1;</TD></TR><TR CLASS="z"><TD CLASS="l">1559</TD><TD>                                if (VERBOSE) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="3f">1560</A></TD><TD>                                        System.out.print(&#34;Listener #&#34; + (i+1) + &#34;=&#34; + listener.toString());//$NON-NLS-1$//$NON-NLS-2$</TD></TR><TR CLASS="z"><TD CLASS="l">1561</TD><TD>                                        start = System.currentTimeMillis();</TD></TR><TR><TD CLASS="l"><A NAME="41">1562</A></TD><TD>                                }</TD></TR><TR><TD CLASS="l">1563</TD><TD>                                // wrap callbacks with Safe runnable for subsequent listeners to be called when some are causing grief</TD></TR><TR CLASS="z"><TD CLASS="l">1564</TD><TD>                                SafeRunner.run(new ISafeRunnable() {</TD></TR><TR><TD CLASS="l"><A NAME="42">1565</A></TD><TD>                                        public void handleException(Throwable exception) {</TD></TR><TR CLASS="z"><TD CLASS="l">1566</TD><TD>                                                Util.log(exception, &#34;Exception occurred in listener of Java element change notification&#34;); //$NON-NLS-1$</TD></TR><TR CLASS="z"><TD CLASS="l">1567</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">1568</TD><TD>                                        public void run() throws Exception {</TD></TR><TR CLASS="z"><TD CLASS="l">1569</TD><TD>                                                PerformanceStats stats = null;</TD></TR><TR CLASS="z"><TD CLASS="l">1570</TD><TD>                                                if(PERF) {</TD></TR><TR CLASS="z"><TD CLASS="l">1571</TD><TD>                                                        stats = PerformanceStats.getStats(JavaModelManager.DELTA_LISTENER_PERF, listener);</TD></TR><TR CLASS="z"><TD CLASS="l">1572</TD><TD>                                                        stats.startRun();</TD></TR><TR><TD CLASS="l">1573</TD><TD>                                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1574</TD><TD>                                                listener.elementChanged(extraEvent);</TD></TR><TR CLASS="z"><TD CLASS="l">1575</TD><TD>                                                if(PERF) {</TD></TR><TR CLASS="z"><TD CLASS="l">1576</TD><TD>                                                        stats.endRun();</TD></TR><TR><TD CLASS="l">1577</TD><TD>                                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1578</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">1579</TD><TD>                                });</TD></TR><TR CLASS="z"><TD CLASS="l">1580</TD><TD>                                if (VERBOSE) {</TD></TR><TR CLASS="z"><TD CLASS="l">1581</TD><TD>                                        System.out.println(&#34; -&gt; &#34; + (System.currentTimeMillis()-start) + &#34;ms&#34;); //$NON-NLS-1$ //$NON-NLS-2$</TD></TR><TR><TD CLASS="l">1582</TD><TD>                                }</TD></TR><TR><TD CLASS="l"><A NAME="22">1583</A></TD><TD>                        }</TD></TR><TR><TD CLASS="l">1584</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1585</TD><TD>        }</TD></TR><TR><TD CLASS="l">1586</TD><TD>        private void notifyTypeHierarchies(IElementChangedListener[] listeners, int listenerCount) {</TD></TR><TR CLASS="z"><TD CLASS="l">1587</TD><TD>                for (int i= 0; i &lt; listenerCount; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="43">1588</A></TD><TD>                        final IElementChangedListener listener = listeners[i];</TD></TR><TR CLASS="z"><TD CLASS="l">1589</TD><TD>                        if (!(listener instanceof TypeHierarchy)) continue;</TD></TR><TR><TD CLASS="l"><A NAME="45">1590</A></TD><TD> </TD></TR><TR><TD CLASS="l">1591</TD><TD>                        // wrap callbacks with Safe runnable for subsequent listeners to be called when some are causing grief</TD></TR><TR CLASS="z"><TD CLASS="l">1592</TD><TD>                        SafeRunner.run(new ISafeRunnable() {</TD></TR><TR><TD CLASS="l"><A NAME="46">1593</A></TD><TD>                                public void handleException(Throwable exception) {</TD></TR><TR CLASS="z"><TD CLASS="l">1594</TD><TD>                                        Util.log(exception, &#34;Exception occurred in listener of Java element change notification&#34;); //$NON-NLS-1$</TD></TR><TR CLASS="z"><TD CLASS="l">1595</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1596</TD><TD>                                public void run() throws Exception {</TD></TR><TR CLASS="z"><TD CLASS="l">1597</TD><TD>                                        TypeHierarchy typeHierarchy = (TypeHierarchy)listener;</TD></TR><TR CLASS="z"><TD CLASS="l">1598</TD><TD>                                        if (typeHierarchy.hasFineGrainChanges()) {</TD></TR><TR><TD CLASS="l">1599</TD><TD>                                                // case of changes in primary working copies</TD></TR><TR CLASS="z"><TD CLASS="l">1600</TD><TD>                                                typeHierarchy.needsRefresh = true;</TD></TR><TR CLASS="z"><TD CLASS="l">1601</TD><TD>                                                typeHierarchy.fireChange();</TD></TR><TR><TD CLASS="l">1602</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1603</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1604</TD><TD>                        });</TD></TR><TR><TD CLASS="l">1605</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1606</TD><TD>        }</TD></TR><TR><TD CLASS="l">1607</TD><TD>        /*</TD></TR><TR><TD CLASS="l">1608</TD><TD>         * Generic processing for elements with changed contents:&lt;ul&gt;</TD></TR><TR><TD CLASS="l">1609</TD><TD>         * &lt;li&gt;The element is closed such that any subsequent accesses will re-open</TD></TR><TR><TD CLASS="l">1610</TD><TD>         * the element reflecting its new structure.</TD></TR><TR><TD CLASS="l">1611</TD><TD>         * &lt;li&gt;An entry is made in the delta reporting a content change (K_CHANGE with F_CONTENT flag set).</TD></TR><TR><TD CLASS="l">1612</TD><TD>         * &lt;/ul&gt;</TD></TR><TR><TD CLASS="l">1613</TD><TD>         */</TD></TR><TR><TD CLASS="l"><A NAME="20">1614</A></TD><TD>        private void nonJavaResourcesChanged(Openable element, IResourceDelta delta)</TD></TR><TR><TD CLASS="l">1615</TD><TD>                throws JavaScriptModelException {</TD></TR><TR><TD CLASS="l">1616</TD><TD> </TD></TR><TR><TD CLASS="l">1617</TD><TD>                // reset non-java resources if element was open</TD></TR><TR CLASS="z"><TD CLASS="l">1618</TD><TD>                if (element.isOpen()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1619</TD><TD>                        JavaElementInfo info = (JavaElementInfo)element.getElementInfo();</TD></TR><TR CLASS="z"><TD CLASS="l">1620</TD><TD>                        switch (element.getElementType()) {</TD></TR><TR><TD CLASS="l">1621</TD><TD>                                case IJavaScriptElement.JAVASCRIPT_MODEL :</TD></TR><TR CLASS="z"><TD CLASS="l">1622</TD><TD>                                        ((JavaModelInfo) info).nonJavaResources = null;</TD></TR><TR CLASS="z"><TD CLASS="l">1623</TD><TD>                                        currentDelta().addResourceDelta(delta);</TD></TR><TR CLASS="z"><TD CLASS="l">1624</TD><TD>                                        return;</TD></TR><TR><TD CLASS="l">1625</TD><TD>                                case IJavaScriptElement.JAVASCRIPT_PROJECT :</TD></TR><TR CLASS="z"><TD CLASS="l">1626</TD><TD>                                        ((JavaProjectElementInfo) info).setNonJavaResources(null);</TD></TR><TR><TD CLASS="l">1627</TD><TD> </TD></TR><TR><TD CLASS="l">1628</TD><TD>                                        // if a package fragment root is the project, clear it too</TD></TR><TR CLASS="z"><TD CLASS="l">1629</TD><TD>                                        JavaProject project = (JavaProject) element;</TD></TR><TR CLASS="z"><TD CLASS="l">1630</TD><TD>                                        PackageFragmentRoot projectRoot =</TD></TR><TR CLASS="z"><TD CLASS="l">1631</TD><TD>                                                (PackageFragmentRoot) project.getPackageFragmentRoot(project.getProject());</TD></TR><TR CLASS="z"><TD CLASS="l">1632</TD><TD>                                        if (projectRoot.isOpen()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1633</TD><TD>                                                ((PackageFragmentRootInfo) projectRoot.getElementInfo()).setNonJavaResources(</TD></TR><TR CLASS="z"><TD CLASS="l">1634</TD><TD>                                                        null);</TD></TR><TR><TD CLASS="l">1635</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1636</TD><TD>                                        break;</TD></TR><TR><TD CLASS="l">1637</TD><TD>                                case IJavaScriptElement.PACKAGE_FRAGMENT :</TD></TR><TR CLASS="z"><TD CLASS="l">1638</TD><TD>                                         ((PackageFragmentInfo) info).setNonJavaResources(null);</TD></TR><TR CLASS="z"><TD CLASS="l">1639</TD><TD>                                        break;</TD></TR><TR><TD CLASS="l">1640</TD><TD>                                case IJavaScriptElement.PACKAGE_FRAGMENT_ROOT :</TD></TR><TR CLASS="z"><TD CLASS="l">1641</TD><TD>                                         ((PackageFragmentRootInfo) info).setNonJavaResources(null);</TD></TR><TR><TD CLASS="l">1642</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1643</TD><TD>                }</TD></TR><TR><TD CLASS="l">1644</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1645</TD><TD>                JavaElementDelta current = currentDelta();</TD></TR><TR CLASS="z"><TD CLASS="l">1646</TD><TD>                JavaElementDelta elementDelta = current.find(element);</TD></TR><TR CLASS="z"><TD CLASS="l">1647</TD><TD>                if (elementDelta == null) {</TD></TR><TR><TD CLASS="l">1648</TD><TD>                        // don't use find after creating the delta as it can be null (see https://bugs.eclipse.org/bugs/show_bug.cgi?id=63434)</TD></TR><TR CLASS="z"><TD CLASS="l">1649</TD><TD>                        elementDelta = current.changed(element, IJavaScriptElementDelta.F_CONTENT);</TD></TR><TR><TD CLASS="l">1650</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1651</TD><TD>                elementDelta.addResourceDelta(delta);</TD></TR><TR CLASS="z"><TD CLASS="l">1652</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="23">1653</A></TD><TD>        /*</TD></TR><TR><TD CLASS="l">1654</TD><TD>         * Returns the other root infos for the given path. Look in the old other roots table if kind is REMOVED.</TD></TR><TR><TD CLASS="l">1655</TD><TD>         */</TD></TR><TR><TD CLASS="l">1656</TD><TD>        private ArrayList otherRootsInfo(IPath path, int kind) {</TD></TR><TR CLASS="z"><TD CLASS="l">1657</TD><TD>                if (kind == IResourceDelta.REMOVED) {</TD></TR><TR CLASS="z"><TD CLASS="l">1658</TD><TD>                        return (ArrayList)this.state.oldOtherRoots.get(path);</TD></TR><TR><TD CLASS="l">1659</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1660</TD><TD>                return (ArrayList)this.state.otherRoots.get(path);</TD></TR><TR><TD CLASS="l">1661</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="24">1662</A></TD><TD> </TD></TR><TR><TD CLASS="l">1663</TD><TD>        private OutputsInfo outputsInfo(RootInfo rootInfo, IResource res) {</TD></TR><TR><TD CLASS="l">1664</TD><TD>                try {</TD></TR><TR CLASS="z"><TD CLASS="l">1665</TD><TD>                        JavaProject proj =</TD></TR><TR CLASS="z"><TD CLASS="l">1666</TD><TD>                                rootInfo == null ?</TD></TR><TR CLASS="z"><TD CLASS="l">1667</TD><TD>                                        (JavaProject)this.createElement(res.getProject(), IJavaScriptElement.JAVASCRIPT_PROJECT, null) :</TD></TR><TR CLASS="z"><TD CLASS="l">1668</TD><TD>                                        rootInfo.project;</TD></TR><TR CLASS="z"><TD CLASS="l">1669</TD><TD>                        if (proj != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1670</TD><TD>                                IPath projectOutput = proj.getOutputLocation();</TD></TR><TR CLASS="z"><TD CLASS="l">1671</TD><TD>                                int traverseMode = IGNORE;</TD></TR><TR CLASS="z"><TD CLASS="l">1672</TD><TD>                                if (proj.getProject().getFullPath().equals(projectOutput)){ // case of proj==bin==src</TD></TR><TR CLASS="z"><TD CLASS="l">1673</TD><TD>                                        return new OutputsInfo(new IPath[] {projectOutput}, new int[] {SOURCE}, 1);</TD></TR><TR><TD CLASS="l">1674</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1675</TD><TD>                                IIncludePathEntry[] classpath = proj.getResolvedClasspath();</TD></TR><TR CLASS="z"><TD CLASS="l">1676</TD><TD>                                IPath[] outputs = new IPath[classpath.length+1];</TD></TR><TR CLASS="z"><TD CLASS="l">1677</TD><TD>                                int[] traverseModes = new int[classpath.length+1];</TD></TR><TR CLASS="z"><TD CLASS="l">1678</TD><TD>                                int outputCount = 1;</TD></TR><TR CLASS="z"><TD CLASS="l">1679</TD><TD>                                outputs[0] = projectOutput;</TD></TR><TR CLASS="z"><TD CLASS="l">1680</TD><TD>                                traverseModes[0] = traverseMode;</TD></TR><TR CLASS="z"><TD CLASS="l">1681</TD><TD>                                for (int i = 0, length = classpath.length; i &lt; length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1682</TD><TD>                                        IIncludePathEntry entry = classpath[i];</TD></TR><TR CLASS="z"><TD CLASS="l">1683</TD><TD>                                        IPath entryPath = entry.getPath();</TD></TR><TR><TD CLASS="l">1684</TD><TD> </TD></TR><TR><TD CLASS="l">1685</TD><TD>                                        // check case of src==bin</TD></TR><TR CLASS="z"><TD CLASS="l">1686</TD><TD>                                        if (entryPath.equals(projectOutput)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1687</TD><TD>                                                traverseModes[0] = (entry.getEntryKind() == IIncludePathEntry.CPE_SOURCE) ? SOURCE : BINARY;</TD></TR><TR><TD CLASS="l">1688</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">1689</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1690</TD><TD>                                return new OutputsInfo(outputs, traverseModes, outputCount);</TD></TR><TR><TD CLASS="l">1691</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1692</TD><TD>                } catch (JavaScriptModelException e) {</TD></TR><TR><TD CLASS="l">1693</TD><TD>                        // java project doesn't exist: ignore</TD></TR><TR><TD CLASS="l"><A NAME="25">1694</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1695</TD><TD>                return null;</TD></TR><TR><TD CLASS="l">1696</TD><TD>        }</TD></TR><TR><TD CLASS="l">1697</TD><TD>        private void popUntilPrefixOf(IPath path) {</TD></TR><TR CLASS="z"><TD CLASS="l">1698</TD><TD>                while (this.currentElement != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1699</TD><TD>                        IPath currentElementPath = null;</TD></TR><TR CLASS="z"><TD CLASS="l">1700</TD><TD>                        if (this.currentElement instanceof IPackageFragmentRoot) {</TD></TR><TR CLASS="z"><TD CLASS="l">1701</TD><TD>                                currentElementPath = ((IPackageFragmentRoot)this.currentElement).getPath();</TD></TR><TR><TD CLASS="l">1702</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1703</TD><TD>                                IResource currentElementResource = this.currentElement.getResource();</TD></TR><TR CLASS="z"><TD CLASS="l">1704</TD><TD>                                if (currentElementResource != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1705</TD><TD>                                        currentElementPath = currentElementResource.getFullPath();</TD></TR><TR><TD CLASS="l">1706</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1707</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1708</TD><TD>                        if (currentElementPath != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1709</TD><TD>                                if (this.currentElement instanceof IPackageFragment</TD></TR><TR CLASS="z"><TD CLASS="l">1710</TD><TD>                                        &amp;&amp; ((IPackageFragment) this.currentElement).isDefaultPackage()</TD></TR><TR CLASS="z"><TD CLASS="l">1711</TD><TD>                                        &amp;&amp; currentElementPath.segmentCount() != path.segmentCount()-1) {</TD></TR><TR><TD CLASS="l">1712</TD><TD>                                                // default package and path is not a direct child</TD></TR><TR CLASS="z"><TD CLASS="l">1713</TD><TD>                                                this.currentElement = (Openable)this.currentElement.getParent();</TD></TR><TR><TD CLASS="l">1714</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1715</TD><TD>                                if (currentElementPath.isPrefixOf(path)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1716</TD><TD>                                        return;</TD></TR><TR><TD CLASS="l">1717</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1718</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1719</TD><TD>                        this.currentElement = (Openable)this.currentElement.getParent();</TD></TR><TR><TD CLASS="l">1720</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1721</TD><TD>        }</TD></TR><TR><TD CLASS="l">1722</TD><TD>        /*</TD></TR><TR><TD CLASS="l">1723</TD><TD>         * Converts a &lt;code&gt;IResourceDelta&lt;/code&gt; rooted in a &lt;code&gt;Workspace&lt;/code&gt; into</TD></TR><TR><TD CLASS="l">1724</TD><TD>         * the corresponding set of &lt;code&gt;IJavaScriptElementDelta&lt;/code&gt;, rooted in the</TD></TR><TR><TD CLASS="l">1725</TD><TD>         * relevant &lt;code&gt;JavaModel&lt;/code&gt;s.</TD></TR><TR><TD CLASS="l"><A NAME="26">1726</A></TD><TD>         */</TD></TR><TR><TD CLASS="l">1727</TD><TD>        private IJavaScriptElementDelta processResourceDelta(IResourceDelta changes) {</TD></TR><TR><TD CLASS="l">1728</TD><TD> </TD></TR><TR><TD CLASS="l">1729</TD><TD>                try {</TD></TR><TR CLASS="z"><TD CLASS="l">1730</TD><TD>                        IJavaScriptModel model = this.manager.getJavaModel();</TD></TR><TR CLASS="z"><TD CLASS="l">1731</TD><TD>                        if (!model.isOpen()) {</TD></TR><TR><TD CLASS="l">1732</TD><TD>                                // force opening of java model so that java element delta are reported</TD></TR><TR><TD CLASS="l">1733</TD><TD>                                try {</TD></TR><TR CLASS="z"><TD CLASS="l">1734</TD><TD>                                        model.open(null);</TD></TR><TR CLASS="z"><TD CLASS="l">1735</TD><TD>                                } catch (JavaScriptModelException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">1736</TD><TD>                                        if (VERBOSE) {</TD></TR><TR CLASS="z"><TD CLASS="l">1737</TD><TD>                                                e.printStackTrace();</TD></TR><TR><TD CLASS="l">1738</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1739</TD><TD>                                        return null;</TD></TR><TR><TD CLASS="l">1740</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1741</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1742</TD><TD>                        this.state.initializeRoots();</TD></TR><TR CLASS="z"><TD CLASS="l">1743</TD><TD>                        this.currentElement = null;</TD></TR><TR><TD CLASS="l">1744</TD><TD> </TD></TR><TR><TD CLASS="l">1745</TD><TD>                        // get the workspace delta, and start processing there.</TD></TR><TR CLASS="z"><TD CLASS="l">1746</TD><TD>                        IResourceDelta[] deltas = changes.getAffectedChildren();</TD></TR><TR CLASS="z"><TD CLASS="l">1747</TD><TD>                        for (int i = 0; i &lt; deltas.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1748</TD><TD>                                IResourceDelta delta = deltas[i];</TD></TR><TR CLASS="z"><TD CLASS="l">1749</TD><TD>                                IResource res = delta.getResource();</TD></TR><TR><TD CLASS="l">1750</TD><TD> </TD></TR><TR><TD CLASS="l">1751</TD><TD>                                // find out the element type</TD></TR><TR CLASS="z"><TD CLASS="l">1752</TD><TD>                                RootInfo rootInfo = null;</TD></TR><TR><TD CLASS="l">1753</TD><TD>                                int elementType;</TD></TR><TR CLASS="z"><TD CLASS="l">1754</TD><TD>                                IProject proj = (IProject)res;</TD></TR><TR CLASS="z"><TD CLASS="l">1755</TD><TD>                                boolean wasJavaProject = this.state.findJavaProject(proj.getName()) != null;</TD></TR><TR CLASS="z"><TD CLASS="l">1756</TD><TD>                                boolean isJavaProject = JavaProject.hasJavaNature(proj);</TD></TR><TR CLASS="z"><TD CLASS="l">1757</TD><TD>                                if (!wasJavaProject &amp;&amp; !isJavaProject) {</TD></TR><TR CLASS="z"><TD CLASS="l">1758</TD><TD>                                        elementType = NON_JAVA_RESOURCE;</TD></TR><TR><TD CLASS="l">1759</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1760</TD><TD>                                        rootInfo = this.enclosingRootInfo(res.getFullPath(), delta.getKind());</TD></TR><TR CLASS="z"><TD CLASS="l">1761</TD><TD>                                        if (rootInfo != null &amp;&amp; rootInfo.isRootOfProject(res.getFullPath())) {</TD></TR><TR CLASS="z"><TD CLASS="l">1762</TD><TD>                                                elementType = IJavaScriptElement.PACKAGE_FRAGMENT_ROOT;</TD></TR><TR><TD CLASS="l">1763</TD><TD>                                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1764</TD><TD>                                                elementType = IJavaScriptElement.JAVASCRIPT_PROJECT;</TD></TR><TR><TD CLASS="l">1765</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">1766</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1767</TD><TD> </TD></TR><TR><TD CLASS="l">1768</TD><TD>                                // traverse delta</TD></TR><TR CLASS="z"><TD CLASS="l">1769</TD><TD>                                this.traverseDelta(delta, elementType, rootInfo, null);</TD></TR><TR><TD CLASS="l">1770</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1771</TD><TD>                                if (elementType == NON_JAVA_RESOURCE</TD></TR><TR CLASS="z"><TD CLASS="l">1772</TD><TD>                                                || (wasJavaProject != isJavaProject &amp;&amp; (delta.getKind()) == IResourceDelta.CHANGED)) { // project has changed nature (description or open/closed)</TD></TR><TR><TD CLASS="l">1773</TD><TD>                                        try {</TD></TR><TR><TD CLASS="l">1774</TD><TD>                                                // add child as non java resource</TD></TR><TR CLASS="z"><TD CLASS="l">1775</TD><TD>                                                nonJavaResourcesChanged((JavaModel)model, delta);</TD></TR><TR CLASS="z"><TD CLASS="l">1776</TD><TD>                                        } catch (JavaScriptModelException e) {</TD></TR><TR><TD CLASS="l">1777</TD><TD>                                                // java model could not be opened</TD></TR><TR><TD CLASS="l">1778</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">1779</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1780</TD><TD> </TD></TR><TR><TD CLASS="l">1781</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1782</TD><TD>                        refreshPackageFragmentRoots();</TD></TR><TR CLASS="z"><TD CLASS="l">1783</TD><TD>                        resetProjectCaches();</TD></TR><TR><TD CLASS="l">1784</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1785</TD><TD>                        return this.currentDelta;</TD></TR><TR CLASS="z"><TD CLASS="l">1786</TD><TD>                } finally {</TD></TR><TR CLASS="z"><TD CLASS="l">1787</TD><TD>                        this.currentDelta = null;</TD></TR><TR CLASS="z"><TD CLASS="l">1788</TD><TD>                        this.rootsToRefresh.clear();</TD></TR><TR CLASS="z"><TD CLASS="l">1789</TD><TD>                        this.projectCachesToReset.clear();</TD></TR><TR CLASS="z"><TD CLASS="l">1790</TD><TD>                }</TD></TR><TR><TD CLASS="l">1791</TD><TD>        }</TD></TR><TR><TD CLASS="l">1792</TD><TD>        /*</TD></TR><TR><TD CLASS="l"><A NAME="2b">1793</A></TD><TD>         * Traverse the set of projects which have changed namespace, and reset their</TD></TR><TR><TD CLASS="l">1794</TD><TD>         * caches and their dependents</TD></TR><TR><TD CLASS="l">1795</TD><TD>         */</TD></TR><TR><TD CLASS="l">1796</TD><TD>        public void resetProjectCaches() {</TD></TR><TR CLASS="z"><TD CLASS="l">1797</TD><TD>                if (this.projectCachesToReset.size() == 0)</TD></TR><TR CLASS="z"><TD CLASS="l">1798</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">1799</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1800</TD><TD>                JavaModelManager.getJavaModelManager().resetJarTypeCache();</TD></TR><TR><TD CLASS="l">1801</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1802</TD><TD>                Iterator iterator = this.projectCachesToReset.iterator();</TD></TR><TR CLASS="z"><TD CLASS="l">1803</TD><TD>                HashMap projectDepencies = this.state.projectDependencies;</TD></TR><TR CLASS="z"><TD CLASS="l">1804</TD><TD>                HashSet affectedDependents = new HashSet();</TD></TR><TR CLASS="z"><TD CLASS="l">1805</TD><TD>                while (iterator.hasNext()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1806</TD><TD>                        JavaProject project = (JavaProject)iterator.next();</TD></TR><TR CLASS="z"><TD CLASS="l">1807</TD><TD>                        project.resetCaches();</TD></TR><TR CLASS="z"><TD CLASS="l">1808</TD><TD>                        addDependentProjects(project, projectDepencies, affectedDependents);</TD></TR><TR><TD CLASS="l">1809</TD><TD>                }</TD></TR><TR><TD CLASS="l">1810</TD><TD>                // reset caches of dependent projects</TD></TR><TR CLASS="z"><TD CLASS="l">1811</TD><TD>                iterator = affectedDependents.iterator();</TD></TR><TR CLASS="z"><TD CLASS="l">1812</TD><TD>                while (iterator.hasNext()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1813</TD><TD>                        JavaProject project = (JavaProject) iterator.next();</TD></TR><TR CLASS="z"><TD CLASS="l">1814</TD><TD>                        project.resetCaches();</TD></TR><TR><TD CLASS="l">1815</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1816</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="28">1817</A></TD><TD>        /*</TD></TR><TR><TD CLASS="l">1818</TD><TD>         * Refresh package fragment roots of projects that were affected</TD></TR><TR><TD CLASS="l">1819</TD><TD>         */</TD></TR><TR><TD CLASS="l">1820</TD><TD>        private void refreshPackageFragmentRoots() {</TD></TR><TR CLASS="z"><TD CLASS="l">1821</TD><TD>                Iterator iterator = this.rootsToRefresh.iterator();</TD></TR><TR CLASS="z"><TD CLASS="l">1822</TD><TD>                while (iterator.hasNext()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1823</TD><TD>                        JavaProject project = (JavaProject)iterator.next();</TD></TR><TR CLASS="z"><TD CLASS="l">1824</TD><TD>                        project.updatePackageFragmentRoots();</TD></TR><TR><TD CLASS="l">1825</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1826</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="29">1827</A></TD><TD>        /*</TD></TR><TR><TD CLASS="l">1828</TD><TD>         * Registers the given delta with this delta processor.</TD></TR><TR><TD CLASS="l">1829</TD><TD>         */</TD></TR><TR><TD CLASS="l">1830</TD><TD>        public void registerJavaModelDelta(IJavaScriptElementDelta delta) {</TD></TR><TR CLASS="z"><TD CLASS="l">1831</TD><TD>                this.javaModelDeltas.add(delta);</TD></TR><TR CLASS="z"><TD CLASS="l">1832</TD><TD>        }</TD></TR><TR><TD CLASS="l">1833</TD><TD>        /*</TD></TR><TR><TD CLASS="l">1834</TD><TD>         * Removes the given element from its parents cache of children. If the</TD></TR><TR><TD CLASS="l">1835</TD><TD>         * element does not have a parent, or the parent is not currently open,</TD></TR><TR><TD CLASS="l"><A NAME="2a">1836</A></TD><TD>         * this has no effect.</TD></TR><TR><TD CLASS="l">1837</TD><TD>         */</TD></TR><TR><TD CLASS="l">1838</TD><TD>        private void removeFromParentInfo(Openable child) {</TD></TR><TR><TD CLASS="l">1839</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1840</TD><TD>                Openable parent = (Openable) child.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">1841</TD><TD>                if (parent != null &amp;&amp; parent.isOpen()) {</TD></TR><TR><TD CLASS="l">1842</TD><TD>                        try {</TD></TR><TR CLASS="z"><TD CLASS="l">1843</TD><TD>                                JavaElementInfo info = (JavaElementInfo)parent.getElementInfo();</TD></TR><TR CLASS="z"><TD CLASS="l">1844</TD><TD>                                info.removeChild(child);</TD></TR><TR CLASS="z"><TD CLASS="l">1845</TD><TD>                        } catch (JavaScriptModelException e) {</TD></TR><TR><TD CLASS="l">1846</TD><TD>                                // do nothing - we already checked if open</TD></TR><TR><TD CLASS="l">1847</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1848</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1849</TD><TD>        }</TD></TR><TR><TD CLASS="l">1850</TD><TD>        /*</TD></TR><TR><TD CLASS="l">1851</TD><TD>         * Notification that some resource changes have happened</TD></TR><TR><TD CLASS="l">1852</TD><TD>         * on the platform, and that the Java Model should update any required</TD></TR><TR><TD CLASS="l">1853</TD><TD>         * internal structures such that its elements remain consistent.</TD></TR><TR><TD CLASS="l">1854</TD><TD>         * Translates &lt;code&gt;IResourceDeltas&lt;/code&gt; into &lt;code&gt;IJavaElementDeltas&lt;/code&gt;.</TD></TR><TR><TD CLASS="l">1855</TD><TD>         *</TD></TR><TR><TD CLASS="l">1856</TD><TD>         * @see IResourceDelta</TD></TR><TR><TD CLASS="l"><A NAME="2c">1857</A></TD><TD>         * @see IResource</TD></TR><TR><TD CLASS="l">1858</TD><TD>         */</TD></TR><TR><TD CLASS="l">1859</TD><TD>        public void resourceChanged(IResourceChangeEvent event) {</TD></TR><TR><TD CLASS="l">1860</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1861</TD><TD>                int eventType = this.overridenEventType == -1 ? event.getType() : this.overridenEventType;</TD></TR><TR CLASS="z"><TD CLASS="l">1862</TD><TD>                IResource resource = event.getResource();</TD></TR><TR CLASS="z"><TD CLASS="l">1863</TD><TD>                IResourceDelta delta = event.getDelta();</TD></TR><TR><TD CLASS="l">1864</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1865</TD><TD>                switch(eventType){</TD></TR><TR><TD CLASS="l">1866</TD><TD>                        case IResourceChangeEvent.PRE_DELETE :</TD></TR><TR><TD CLASS="l">1867</TD><TD>                                try {</TD></TR><TR CLASS="z"><TD CLASS="l">1868</TD><TD>                                        if(resource.getType() == IResource.PROJECT</TD></TR><TR CLASS="z"><TD CLASS="l">1869</TD><TD>                                                &amp;&amp; ((IProject) resource).hasNature(JavaScriptCore.NATURE_ID)) {</TD></TR><TR><TD CLASS="l">1870</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1871</TD><TD>                                                deleting((IProject)resource);</TD></TR><TR><TD CLASS="l">1872</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1873</TD><TD>                                } catch(CoreException e){</TD></TR><TR><TD CLASS="l">1874</TD><TD>                                        // project doesn't exist or is not open: ignore</TD></TR><TR><TD CLASS="l">1875</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1876</TD><TD>                                return;</TD></TR><TR><TD CLASS="l">1877</TD><TD> </TD></TR><TR><TD CLASS="l">1878</TD><TD>                        case IResourceChangeEvent.POST_CHANGE :</TD></TR><TR CLASS="z"><TD CLASS="l">1879</TD><TD>                                if (isAffectedBy(delta)) { // avoid populating for SYNC or MARKER deltas</TD></TR><TR><TD CLASS="l">1880</TD><TD>                                        try {</TD></TR><TR><TD CLASS="l">1881</TD><TD>                                                try {</TD></TR><TR CLASS="z"><TD CLASS="l">1882</TD><TD>                                                        stopDeltas();</TD></TR><TR CLASS="z"><TD CLASS="l">1883</TD><TD>                                                        checkProjectsBeingAddedOrRemoved(delta);</TD></TR><TR><TD CLASS="l">1884</TD><TD> </TD></TR><TR><TD CLASS="l">1885</TD><TD>                                                        // generate classpath change deltas</TD></TR><TR CLASS="z"><TD CLASS="l">1886</TD><TD>                                                        if (this.classpathChanges.size() &gt; 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1887</TD><TD>                                                                boolean hasDelta = this.currentDelta != null;</TD></TR><TR CLASS="z"><TD CLASS="l">1888</TD><TD>                                                                JavaElementDelta javaDelta = currentDelta();</TD></TR><TR CLASS="z"><TD CLASS="l">1889</TD><TD>                                                                Iterator changes = this.classpathChanges.values().iterator();</TD></TR><TR CLASS="z"><TD CLASS="l">1890</TD><TD>                                                                while (changes.hasNext()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1891</TD><TD>                                                                        ClasspathChange change = (ClasspathChange) changes.next();</TD></TR><TR CLASS="z"><TD CLASS="l">1892</TD><TD>                                                                        int result = change.generateDelta(javaDelta);</TD></TR><TR CLASS="z"><TD CLASS="l">1893</TD><TD>                                                                        if ((result &amp; ClasspathChange.HAS_DELTA) != 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1894</TD><TD>                                                                                hasDelta = true;</TD></TR><TR CLASS="z"><TD CLASS="l">1895</TD><TD>                                                                                change.requestIndexing();</TD></TR><TR CLASS="z"><TD CLASS="l">1896</TD><TD>                                                                                this.state.addClasspathValidation(change.project);</TD></TR><TR><TD CLASS="l">1897</TD><TD>                                                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1898</TD><TD>                                                                        if ((result &amp; ClasspathChange.HAS_PROJECT_CHANGE) != 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1899</TD><TD>                                                                                this.state.addProjectReferenceChange(change.project, change.oldResolvedClasspath);</TD></TR><TR><TD CLASS="l">1900</TD><TD>                                                                        }</TD></TR><TR><TD CLASS="l">1901</TD><TD>                                                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1902</TD><TD>                                                                this.classpathChanges.clear();</TD></TR><TR CLASS="z"><TD CLASS="l">1903</TD><TD>                                                                if (!hasDelta)</TD></TR><TR CLASS="z"><TD CLASS="l">1904</TD><TD>                                                                        this.currentDelta = null;</TD></TR><TR><TD CLASS="l">1905</TD><TD>                                                        }</TD></TR><TR><TD CLASS="l">1906</TD><TD> </TD></TR><TR><TD CLASS="l">1907</TD><TD>                                                        // generate external archive change deltas</TD></TR><TR CLASS="z"><TD CLASS="l">1908</TD><TD>                                                        if (this.refreshedElements != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1909</TD><TD>                                                                createExternalArchiveDelta(null);</TD></TR><TR><TD CLASS="l">1910</TD><TD>                                                        }</TD></TR><TR><TD CLASS="l">1911</TD><TD> </TD></TR><TR><TD CLASS="l">1912</TD><TD>                                                        // generate Java deltas from resource changes</TD></TR><TR CLASS="z"><TD CLASS="l">1913</TD><TD>                                                        IJavaScriptElementDelta translatedDelta = processResourceDelta(delta);</TD></TR><TR CLASS="z"><TD CLASS="l">1914</TD><TD>                                                        if (translatedDelta != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1915</TD><TD>                                                                registerJavaModelDelta(translatedDelta);</TD></TR><TR><TD CLASS="l">1916</TD><TD>                                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1917</TD><TD>                                                } finally {</TD></TR><TR CLASS="z"><TD CLASS="l">1918</TD><TD>                                                        this.sourceElementParserCache = null; // don't hold onto parser longer than necessary</TD></TR><TR CLASS="z"><TD CLASS="l">1919</TD><TD>                                                        startDeltas();</TD></TR><TR CLASS="z"><TD CLASS="l">1920</TD><TD>                                                }</TD></TR><TR><TD CLASS="l">1921</TD><TD>                                                IElementChangedListener[] listeners;</TD></TR><TR><TD CLASS="l">1922</TD><TD>                                                int listenerCount;</TD></TR><TR CLASS="z"><TD CLASS="l">1923</TD><TD>                                                synchronized (this.state) {</TD></TR><TR CLASS="z"><TD CLASS="l">1924</TD><TD>                                                        listeners = this.state.elementChangedListeners;</TD></TR><TR CLASS="z"><TD CLASS="l">1925</TD><TD>                                                        listenerCount = this.state.elementChangedListenerCount;</TD></TR><TR><TD CLASS="l">1926</TD><TD>                                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1927</TD><TD>                                                notifyTypeHierarchies(listeners, listenerCount);</TD></TR><TR CLASS="z"><TD CLASS="l">1928</TD><TD>                                                fire(null, ElementChangedEvent.POST_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">1929</TD><TD>                                        } finally {</TD></TR><TR><TD CLASS="l">1930</TD><TD>                                                // workaround for bug 15168 circular errors not reported</TD></TR><TR CLASS="z"><TD CLASS="l">1931</TD><TD>                                                this.state.resetOldJavaProjectNames();</TD></TR><TR CLASS="z"><TD CLASS="l">1932</TD><TD>                                                this.oldRoots = null;</TD></TR><TR CLASS="z"><TD CLASS="l">1933</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">1934</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1935</TD><TD>                                return;</TD></TR><TR><TD CLASS="l">1936</TD><TD> </TD></TR><TR><TD CLASS="l">1937</TD><TD>                        case IResourceChangeEvent.PRE_BUILD :</TD></TR><TR CLASS="z"><TD CLASS="l">1938</TD><TD>                                if(!isAffectedBy(delta))</TD></TR><TR CLASS="z"><TD CLASS="l">1939</TD><TD>                                        return; // avoid populating for SYNC or MARKER deltas</TD></TR><TR><TD CLASS="l">1940</TD><TD> </TD></TR><TR><TD CLASS="l">1941</TD><TD>                                // create classpath markers if necessary</TD></TR><TR CLASS="z"><TD CLASS="l">1942</TD><TD>                                boolean needCycleValidation = validateClasspaths(delta);</TD></TR><TR CLASS="z"><TD CLASS="l">1943</TD><TD>                                ClasspathValidation[] validations = this.state.removeClasspathValidations();</TD></TR><TR CLASS="z"><TD CLASS="l">1944</TD><TD>                                if (validations != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1945</TD><TD>                                        for (int i = 0, length = validations.length; i &lt; length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1946</TD><TD>                                                ClasspathValidation validation = validations[i];</TD></TR><TR CLASS="z"><TD CLASS="l">1947</TD><TD>                                                validation.validate();</TD></TR><TR><TD CLASS="l">1948</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">1949</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1950</TD><TD> </TD></TR><TR><TD CLASS="l">1951</TD><TD>                                // update project references if necessary</TD></TR><TR CLASS="z"><TD CLASS="l">1952</TD><TD>                            ProjectReferenceChange[] projectRefChanges = this.state.removeProjectReferenceChanges();</TD></TR><TR CLASS="z"><TD CLASS="l">1953</TD><TD>                                if (projectRefChanges != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1954</TD><TD>                                    for (int i = 0, length = projectRefChanges.length; i &lt; length; i++) {</TD></TR><TR><TD CLASS="l">1955</TD><TD>                                        try {</TD></TR><TR CLASS="z"><TD CLASS="l">1956</TD><TD>                                                projectRefChanges[i].updateProjectReferencesIfNecessary();</TD></TR><TR CLASS="z"><TD CLASS="l">1957</TD><TD>                                        } catch(JavaScriptModelException e) {</TD></TR><TR><TD CLASS="l">1958</TD><TD>                                            // project doesn't exist any longer, continue with next one</TD></TR><TR><TD CLASS="l">1959</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">1960</TD><TD>                                    }</TD></TR><TR><TD CLASS="l">1961</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1962</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1963</TD><TD>                                if (needCycleValidation || projectRefChanges != null) {</TD></TR><TR><TD CLASS="l">1964</TD><TD>                                        // update all cycle markers since the project references changes may have affected cycles</TD></TR><TR><TD CLASS="l">1965</TD><TD>                                        try {</TD></TR><TR CLASS="z"><TD CLASS="l">1966</TD><TD>                                                JavaProject.validateCycles(null);</TD></TR><TR CLASS="z"><TD CLASS="l">1967</TD><TD>                                        } catch (JavaScriptModelException e) {</TD></TR><TR><TD CLASS="l">1968</TD><TD>                                                // a project no longer exists</TD></TR><TR><TD CLASS="l">1969</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">1970</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1971</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1972</TD><TD>                                JavaModel.flushExternalFileCache();</TD></TR><TR CLASS="z"><TD CLASS="l">1973</TD><TD>                                JavaBuilder.buildStarting();</TD></TR><TR><TD CLASS="l">1974</TD><TD> </TD></TR><TR><TD CLASS="l">1975</TD><TD>                                // does not fire any deltas</TD></TR><TR CLASS="z"><TD CLASS="l">1976</TD><TD>                                return;</TD></TR><TR><TD CLASS="l">1977</TD><TD> </TD></TR><TR><TD CLASS="l">1978</TD><TD>                        case IResourceChangeEvent.POST_BUILD :</TD></TR><TR CLASS="z"><TD CLASS="l">1979</TD><TD>                                JavaBuilder.buildFinished();</TD></TR><TR CLASS="z"><TD CLASS="l">1980</TD><TD>                                return;</TD></TR><TR><TD CLASS="l">1981</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1982</TD><TD>        }</TD></TR><TR><TD CLASS="l">1983</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="2d">1984</A></TD><TD>        /*</TD></TR><TR><TD CLASS="l">1985</TD><TD>         * Returns the root info for the given path. Look in the old roots table if kind is REMOVED.</TD></TR><TR><TD CLASS="l">1986</TD><TD>         */</TD></TR><TR><TD CLASS="l">1987</TD><TD>        private RootInfo rootInfo(IPath path, int kind) {</TD></TR><TR CLASS="z"><TD CLASS="l">1988</TD><TD>                if (kind == IResourceDelta.REMOVED) {</TD></TR><TR CLASS="z"><TD CLASS="l">1989</TD><TD>                        return (RootInfo)this.state.oldRoots.get(path);</TD></TR><TR><TD CLASS="l">1990</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1991</TD><TD>                return (RootInfo)this.state.roots.get(path);</TD></TR><TR><TD CLASS="l">1992</TD><TD>        }</TD></TR><TR><TD CLASS="l">1993</TD><TD>        /*</TD></TR><TR><TD CLASS="l"><A NAME="2e">1994</A></TD><TD>         * Turns the firing mode to on. That is, deltas that are/have been</TD></TR><TR><TD CLASS="l">1995</TD><TD>         * registered will be fired.</TD></TR><TR><TD CLASS="l">1996</TD><TD>         */</TD></TR><TR><TD CLASS="l">1997</TD><TD>        private void startDeltas() {</TD></TR><TR CLASS="z"><TD CLASS="l">1998</TD><TD>                this.isFiring= true;</TD></TR><TR CLASS="z"><TD CLASS="l">1999</TD><TD>        }</TD></TR><TR><TD CLASS="l">2000</TD><TD>        /*</TD></TR><TR><TD CLASS="l"><A NAME="2f">2001</A></TD><TD>         * Turns the firing mode to off. That is, deltas that are/have been</TD></TR><TR><TD CLASS="l">2002</TD><TD>         * registered will not be fired until deltas are started again.</TD></TR><TR><TD CLASS="l">2003</TD><TD>         */</TD></TR><TR><TD CLASS="l">2004</TD><TD>        private void stopDeltas() {</TD></TR><TR CLASS="z"><TD CLASS="l">2005</TD><TD>                this.isFiring= false;</TD></TR><TR CLASS="z"><TD CLASS="l">2006</TD><TD>        }</TD></TR><TR><TD CLASS="l">2007</TD><TD>        /*</TD></TR><TR><TD CLASS="l">2008</TD><TD>         * Converts an &lt;code&gt;IResourceDelta&lt;/code&gt; and its children into</TD></TR><TR><TD CLASS="l">2009</TD><TD>         * the corresponding &lt;code&gt;IJavaScriptElementDelta&lt;/code&gt;s.</TD></TR><TR><TD CLASS="l">2010</TD><TD>         */</TD></TR><TR><TD CLASS="l">2011</TD><TD>        private void traverseDelta(</TD></TR><TR><TD CLASS="l">2012</TD><TD>                IResourceDelta delta,</TD></TR><TR><TD CLASS="l"><A NAME="30">2013</A></TD><TD>                int elementType,</TD></TR><TR><TD CLASS="l">2014</TD><TD>                RootInfo rootInfo,</TD></TR><TR><TD CLASS="l">2015</TD><TD>                OutputsInfo outputsInfo) {</TD></TR><TR><TD CLASS="l">2016</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">2017</TD><TD>                IResource res = delta.getResource();</TD></TR><TR><TD CLASS="l">2018</TD><TD> </TD></TR><TR><TD CLASS="l">2019</TD><TD>                // set stack of elements</TD></TR><TR CLASS="z"><TD CLASS="l">2020</TD><TD>                if (this.currentElement == null &amp;&amp; rootInfo != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">2021</TD><TD>                        this.currentElement = rootInfo.project;</TD></TR><TR><TD CLASS="l">2022</TD><TD>                }</TD></TR><TR><TD CLASS="l">2023</TD><TD> </TD></TR><TR><TD CLASS="l">2024</TD><TD>                // process current delta</TD></TR><TR CLASS="z"><TD CLASS="l">2025</TD><TD>                boolean processChildren = true;</TD></TR><TR CLASS="z"><TD CLASS="l">2026</TD><TD>                if (res instanceof IProject) {</TD></TR><TR><TD CLASS="l">2027</TD><TD>                        // reset source element parser cache</TD></TR><TR CLASS="z"><TD CLASS="l">2028</TD><TD>                        this.sourceElementParserCache = null;</TD></TR><TR><TD CLASS="l">2029</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">2030</TD><TD>                        processChildren =</TD></TR><TR CLASS="z"><TD CLASS="l">2031</TD><TD>                                this.updateCurrentDeltaAndIndex(</TD></TR><TR CLASS="z"><TD CLASS="l">2032</TD><TD>                                        delta,</TD></TR><TR CLASS="z"><TD CLASS="l">2033</TD><TD>                                        elementType == IJavaScriptElement.PACKAGE_FRAGMENT_ROOT ?</TD></TR><TR CLASS="z"><TD CLASS="l">2034</TD><TD>                                                IJavaScriptElement.JAVASCRIPT_PROJECT : // case of prj=src</TD></TR><TR CLASS="z"><TD CLASS="l">2035</TD><TD>                                                elementType,</TD></TR><TR CLASS="z"><TD CLASS="l">2036</TD><TD>                                        rootInfo);</TD></TR><TR CLASS="z"><TD CLASS="l">2037</TD><TD>                } else if (rootInfo != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">2038</TD><TD>                        processChildren = this.updateCurrentDeltaAndIndex(delta, elementType, rootInfo);</TD></TR><TR><TD CLASS="l">2039</TD><TD>                } else {</TD></TR><TR><TD CLASS="l">2040</TD><TD>                        // not yet inside a package fragment root</TD></TR><TR CLASS="z"><TD CLASS="l">2041</TD><TD>                        processChildren = true;</TD></TR><TR><TD CLASS="l">2042</TD><TD>                }</TD></TR><TR><TD CLASS="l">2043</TD><TD> </TD></TR><TR><TD CLASS="l">2044</TD><TD>                // get the project's output locations and traverse mode</TD></TR><TR CLASS="z"><TD CLASS="l">2045</TD><TD>                if (outputsInfo == null) outputsInfo = this.outputsInfo(rootInfo, res);</TD></TR><TR><TD CLASS="l">2046</TD><TD> </TD></TR><TR><TD CLASS="l">2047</TD><TD>                // process children if needed</TD></TR><TR CLASS="z"><TD CLASS="l">2048</TD><TD>                if (processChildren) {</TD></TR><TR CLASS="z"><TD CLASS="l">2049</TD><TD>                        IResourceDelta[] children = delta.getAffectedChildren();</TD></TR><TR CLASS="z"><TD CLASS="l">2050</TD><TD>                        boolean oneChildOnClasspath = false;</TD></TR><TR CLASS="z"><TD CLASS="l">2051</TD><TD>                        int length = children.length;</TD></TR><TR CLASS="z"><TD CLASS="l">2052</TD><TD>                        IResourceDelta[] orphanChildren = null;</TD></TR><TR CLASS="z"><TD CLASS="l">2053</TD><TD>                        Openable parent = null;</TD></TR><TR CLASS="z"><TD CLASS="l">2054</TD><TD>                        boolean isValidParent = true;</TD></TR><TR CLASS="z"><TD CLASS="l">2055</TD><TD>                        for (int i = 0; i &lt; length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">2056</TD><TD>                                IResourceDelta child = children[i];</TD></TR><TR CLASS="z"><TD CLASS="l">2057</TD><TD>                                IResource childRes = child.getResource();</TD></TR><TR><TD CLASS="l">2058</TD><TD> </TD></TR><TR><TD CLASS="l">2059</TD><TD>                                // check source attachment change</TD></TR><TR CLASS="z"><TD CLASS="l">2060</TD><TD>                                this.checkSourceAttachmentChange(child, childRes);</TD></TR><TR><TD CLASS="l">2061</TD><TD> </TD></TR><TR><TD CLASS="l">2062</TD><TD>                                // find out whether the child is a package fragment root of the current project</TD></TR><TR CLASS="z"><TD CLASS="l">2063</TD><TD>                                IPath childPath = childRes.getFullPath();</TD></TR><TR CLASS="z"><TD CLASS="l">2064</TD><TD>                                int childKind = child.getKind();</TD></TR><TR CLASS="z"><TD CLASS="l">2065</TD><TD>                                RootInfo childRootInfo = this.rootInfo(childPath, childKind);</TD></TR><TR CLASS="z"><TD CLASS="l">2066</TD><TD>                                if (childRootInfo != null &amp;&amp; !childRootInfo.isRootOfProject(childPath)) {</TD></TR><TR><TD CLASS="l">2067</TD><TD>                                        // package fragment root of another project (dealt with later)</TD></TR><TR CLASS="z"><TD CLASS="l">2068</TD><TD>                                        childRootInfo = null;</TD></TR><TR><TD CLASS="l">2069</TD><TD>                                }</TD></TR><TR><TD CLASS="l">2070</TD><TD> </TD></TR><TR><TD CLASS="l">2071</TD><TD>                                // compute child type</TD></TR><TR CLASS="z"><TD CLASS="l">2072</TD><TD>                                int childType =</TD></TR><TR CLASS="z"><TD CLASS="l">2073</TD><TD>                                        this.elementType(</TD></TR><TR CLASS="z"><TD CLASS="l">2074</TD><TD>                                                childRes,</TD></TR><TR CLASS="z"><TD CLASS="l">2075</TD><TD>                                                childKind,</TD></TR><TR CLASS="z"><TD CLASS="l">2076</TD><TD>                                                elementType,</TD></TR><TR CLASS="z"><TD CLASS="l">2077</TD><TD>                                                rootInfo == null ? childRootInfo : rootInfo</TD></TR><TR><TD CLASS="l">2078</TD><TD>                                        );</TD></TR><TR><TD CLASS="l">2079</TD><TD> </TD></TR><TR><TD CLASS="l">2080</TD><TD>                                // is childRes in the output folder and is it filtered out ?</TD></TR><TR CLASS="z"><TD CLASS="l">2081</TD><TD>                                boolean isResFilteredFromOutput = this.isResFilteredFromOutput(rootInfo, outputsInfo, childRes, childType);</TD></TR><TR><TD CLASS="l">2082</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">2083</TD><TD>                                boolean isNestedRoot = rootInfo != null &amp;&amp; childRootInfo != null;</TD></TR><TR CLASS="z"><TD CLASS="l">2084</TD><TD>                                if (!isResFilteredFromOutput</TD></TR><TR CLASS="z"><TD CLASS="l">2085</TD><TD>                                                &amp;&amp; !isNestedRoot) { // do not treat as non-java rsc if nested root</TD></TR><TR><TD CLASS="l">2086</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">2087</TD><TD>                                        this.traverseDelta(child, childType, rootInfo == null ? childRootInfo : rootInfo, outputsInfo); // traverse delta for child in the same project</TD></TR><TR><TD CLASS="l">2088</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">2089</TD><TD>                                        if (childType == NON_JAVA_RESOURCE) {</TD></TR><TR CLASS="z"><TD CLASS="l">2090</TD><TD>                                                if (rootInfo != null) { // if inside a package fragment root</TD></TR><TR CLASS="z"><TD CLASS="l">2091</TD><TD>                                                        if (!isValidParent) continue;</TD></TR><TR CLASS="z"><TD CLASS="l">2092</TD><TD>                                                        if (parent == null) {</TD></TR><TR><TD CLASS="l">2093</TD><TD>                                                                // find the parent of the non-java resource to attach to</TD></TR><TR CLASS="z"><TD CLASS="l">2094</TD><TD>                                                                if (this.currentElement == null</TD></TR><TR CLASS="z"><TD CLASS="l">2095</TD><TD>                                                                                || !rootInfo.project.equals(this.currentElement.getJavaScriptProject())) { // note if currentElement is the IJavaScriptModel, getJavaProject() is null</TD></TR><TR><TD CLASS="l">2096</TD><TD>                                                                        // force the currentProject to be used</TD></TR><TR CLASS="z"><TD CLASS="l">2097</TD><TD>                                                                        this.currentElement = rootInfo.project;</TD></TR><TR><TD CLASS="l">2098</TD><TD>                                                                }</TD></TR><TR CLASS="z"><TD CLASS="l">2099</TD><TD>                                                                if (elementType == IJavaScriptElement.JAVASCRIPT_PROJECT</TD></TR><TR CLASS="z"><TD CLASS="l">2100</TD><TD>                                                                        || (elementType == IJavaScriptElement.PACKAGE_FRAGMENT_ROOT</TD></TR><TR CLASS="z"><TD CLASS="l">2101</TD><TD>                                                                                &amp;&amp; res instanceof IProject)) {</TD></TR><TR><TD CLASS="l">2102</TD><TD>                                                                        // NB: attach non-java resource to project (not to its package fragment root)</TD></TR><TR CLASS="z"><TD CLASS="l">2103</TD><TD>                                                                        parent = rootInfo.project;</TD></TR><TR><TD CLASS="l">2104</TD><TD>                                                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">2105</TD><TD>                                                                        parent = this.createElement(res, elementType, rootInfo);</TD></TR><TR><TD CLASS="l">2106</TD><TD>                                                                }</TD></TR><TR CLASS="z"><TD CLASS="l">2107</TD><TD>                                                                if (parent == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">2108</TD><TD>                                                                        isValidParent = false;</TD></TR><TR CLASS="z"><TD CLASS="l">2109</TD><TD>                                                                        continue;</TD></TR><TR><TD CLASS="l">2110</TD><TD>                                                                }</TD></TR><TR><TD CLASS="l">2111</TD><TD>                                                        }</TD></TR><TR><TD CLASS="l">2112</TD><TD>                                                        // add child as non java resource</TD></TR><TR><TD CLASS="l">2113</TD><TD>                                                        try {</TD></TR><TR CLASS="z"><TD CLASS="l">2114</TD><TD>                                                                nonJavaResourcesChanged(parent, child);</TD></TR><TR CLASS="z"><TD CLASS="l">2115</TD><TD>                                                        } catch (JavaScriptModelException e) {</TD></TR><TR><TD CLASS="l">2116</TD><TD>                                                                // ignore</TD></TR><TR><TD CLASS="l">2117</TD><TD>                                                        }</TD></TR><TR><TD CLASS="l">2118</TD><TD>                                                } else {</TD></TR><TR><TD CLASS="l">2119</TD><TD>                                                        // the non-java resource (or its parent folder) will be attached to the java project</TD></TR><TR CLASS="z"><TD CLASS="l">2120</TD><TD>                                                        if (orphanChildren == null) orphanChildren = new IResourceDelta[length];</TD></TR><TR CLASS="z"><TD CLASS="l">2121</TD><TD>                                                        orphanChildren[i] = child;</TD></TR><TR><TD CLASS="l">2122</TD><TD>                                                }</TD></TR><TR><TD CLASS="l">2123</TD><TD>                                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">2124</TD><TD>                                                oneChildOnClasspath = true;</TD></TR><TR><TD CLASS="l">2125</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">2126</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">2127</TD><TD>                                        oneChildOnClasspath = true; // to avoid reporting child delta as non-java resource delta</TD></TR><TR><TD CLASS="l">2128</TD><TD>                                }</TD></TR><TR><TD CLASS="l">2129</TD><TD> </TD></TR><TR><TD CLASS="l">2130</TD><TD>                                // if child is a nested root</TD></TR><TR><TD CLASS="l">2131</TD><TD>                                // or if it is not a package fragment root of the current project</TD></TR><TR><TD CLASS="l">2132</TD><TD>                                // but it is a package fragment root of another project, traverse delta too</TD></TR><TR CLASS="z"><TD CLASS="l">2133</TD><TD>                                if (isNestedRoot</TD></TR><TR CLASS="z"><TD CLASS="l">2134</TD><TD>                                                || (childRootInfo == null &amp;&amp; (childRootInfo = this.rootInfo(childPath, childKind)) != null)) {</TD></TR><TR CLASS="z"><TD CLASS="l">2135</TD><TD>                                        this.traverseDelta(child, IJavaScriptElement.PACKAGE_FRAGMENT_ROOT, childRootInfo, null); // binary output of childRootInfo.project cannot be this root</TD></TR><TR><TD CLASS="l">2136</TD><TD>                                }</TD></TR><TR><TD CLASS="l">2137</TD><TD> </TD></TR><TR><TD CLASS="l">2138</TD><TD>                                // if the child is a package fragment root of one or several other projects</TD></TR><TR><TD CLASS="l">2139</TD><TD>                                ArrayList rootList;</TD></TR><TR CLASS="z"><TD CLASS="l">2140</TD><TD>                                if ((rootList = this.otherRootsInfo(childPath, childKind)) != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">2141</TD><TD>                                        Iterator iterator = rootList.iterator();</TD></TR><TR CLASS="z"><TD CLASS="l">2142</TD><TD>                                        while (iterator.hasNext()) {</TD></TR><TR CLASS="z"><TD CLASS="l">2143</TD><TD>                                                childRootInfo = (RootInfo) iterator.next();</TD></TR><TR CLASS="z"><TD CLASS="l">2144</TD><TD>                                                this.traverseDelta(child, IJavaScriptElement.PACKAGE_FRAGMENT_ROOT, childRootInfo, null); // binary output of childRootInfo.project cannot be this root</TD></TR><TR><TD CLASS="l">2145</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">2146</TD><TD>                                }</TD></TR><TR><TD CLASS="l">2147</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">2148</TD><TD>                        if (orphanChildren != null</TD></TR><TR CLASS="z"><TD CLASS="l">2149</TD><TD>                                        &amp;&amp; (oneChildOnClasspath // orphan children are siblings of a package fragment root</TD></TR><TR CLASS="z"><TD CLASS="l">2150</TD><TD>                                                || res instanceof IProject)) { // non-java resource directly under a project</TD></TR><TR><TD CLASS="l">2151</TD><TD> </TD></TR><TR><TD CLASS="l">2152</TD><TD>                                // attach orphan children</TD></TR><TR CLASS="z"><TD CLASS="l">2153</TD><TD>                                IProject rscProject = res.getProject();</TD></TR><TR CLASS="z"><TD CLASS="l">2154</TD><TD>                                JavaProject adoptiveProject = (JavaProject)JavaScriptCore.create(rscProject);</TD></TR><TR CLASS="z"><TD CLASS="l">2155</TD><TD>                                if (adoptiveProject != null</TD></TR><TR CLASS="z"><TD CLASS="l">2156</TD><TD>                                                &amp;&amp; JavaProject.hasJavaNature(rscProject)) { // delta iff Java project (18698)</TD></TR><TR CLASS="z"><TD CLASS="l">2157</TD><TD>                                        for (int i = 0; i &lt; length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">2158</TD><TD>                                                if (orphanChildren[i] != null) {</TD></TR><TR><TD CLASS="l">2159</TD><TD>                                                        try {</TD></TR><TR CLASS="z"><TD CLASS="l">2160</TD><TD>                                                                nonJavaResourcesChanged(adoptiveProject, orphanChildren[i]);</TD></TR><TR CLASS="z"><TD CLASS="l">2161</TD><TD>                                                        } catch (JavaScriptModelException e) {</TD></TR><TR><TD CLASS="l">2162</TD><TD>                                                                // ignore</TD></TR><TR><TD CLASS="l">2163</TD><TD>                                                        }</TD></TR><TR><TD CLASS="l">2164</TD><TD>                                                }</TD></TR><TR><TD CLASS="l">2165</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">2166</TD><TD>                                }</TD></TR><TR><TD CLASS="l">2167</TD><TD>                        } // else resource delta will be added by parent</TD></TR><TR><TD CLASS="l"><A NAME="36">2168</A></TD><TD>                } // else resource delta will be added by parent</TD></TR><TR CLASS="z"><TD CLASS="l">2169</TD><TD>        }</TD></TR><TR><TD CLASS="l">2170</TD><TD> </TD></TR><TR><TD CLASS="l">2171</TD><TD>        private void validateClasspaths(IResourceDelta delta, HashSet affectedProjects) {</TD></TR><TR CLASS="z"><TD CLASS="l">2172</TD><TD>                IResource resource = delta.getResource();</TD></TR><TR CLASS="z"><TD CLASS="l">2173</TD><TD>                boolean processChildren = false;</TD></TR><TR CLASS="z"><TD CLASS="l">2174</TD><TD>                switch (resource.getType()) {</TD></TR><TR><TD CLASS="l">2175</TD><TD>                        case IResource.ROOT :</TD></TR><TR CLASS="z"><TD CLASS="l">2176</TD><TD>                                if (delta.getKind() == IResourceDelta.CHANGED) {</TD></TR><TR CLASS="z"><TD CLASS="l">2177</TD><TD>                                        processChildren = true;</TD></TR><TR><TD CLASS="l">2178</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">2179</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">2180</TD><TD>                        case IResource.PROJECT :</TD></TR><TR CLASS="z"><TD CLASS="l">2181</TD><TD>                                IProject project = (IProject)resource;</TD></TR><TR CLASS="z"><TD CLASS="l">2182</TD><TD>                                int kind = delta.getKind();</TD></TR><TR CLASS="z"><TD CLASS="l">2183</TD><TD>                                boolean isJavaProject = JavaProject.hasJavaNature(project);</TD></TR><TR CLASS="z"><TD CLASS="l">2184</TD><TD>                                switch (kind) {</TD></TR><TR><TD CLASS="l">2185</TD><TD>                                        case IResourceDelta.ADDED:</TD></TR><TR CLASS="z"><TD CLASS="l">2186</TD><TD>                                                processChildren = isJavaProject;</TD></TR><TR CLASS="z"><TD CLASS="l">2187</TD><TD>                                                affectedProjects.add(project.getFullPath());</TD></TR><TR CLASS="z"><TD CLASS="l">2188</TD><TD>                                                break;</TD></TR><TR><TD CLASS="l">2189</TD><TD>                                        case IResourceDelta.CHANGED:</TD></TR><TR CLASS="z"><TD CLASS="l">2190</TD><TD>                                                processChildren = isJavaProject;</TD></TR><TR CLASS="z"><TD CLASS="l">2191</TD><TD>                                                if ((delta.getFlags() &amp; IResourceDelta.OPEN) != 0) {</TD></TR><TR><TD CLASS="l">2192</TD><TD>                                                        // project opened or closed</TD></TR><TR CLASS="z"><TD CLASS="l">2193</TD><TD>                                                        if (isJavaProject) {</TD></TR><TR CLASS="z"><TD CLASS="l">2194</TD><TD>                                                                JavaProject javaProject = (JavaProject)JavaScriptCore.create(project);</TD></TR><TR CLASS="z"><TD CLASS="l">2195</TD><TD>                                                                this.state.addClasspathValidation(javaProject); // in case .classpath got modified while closed</TD></TR><TR><TD CLASS="l">2196</TD><TD>                                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">2197</TD><TD>                                                        affectedProjects.add(project.getFullPath());</TD></TR><TR CLASS="z"><TD CLASS="l">2198</TD><TD>                                                } else if ((delta.getFlags() &amp; IResourceDelta.DESCRIPTION) != 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">2199</TD><TD>                                                        boolean wasJavaProject = this.state.findJavaProject(project.getName()) != null;</TD></TR><TR CLASS="z"><TD CLASS="l">2200</TD><TD>                                                        if (wasJavaProject  != isJavaProject) {</TD></TR><TR><TD CLASS="l">2201</TD><TD>                                                                // project gained or lost Java nature</TD></TR><TR CLASS="z"><TD CLASS="l">2202</TD><TD>                                                                JavaProject javaProject = (JavaProject)JavaScriptCore.create(project);</TD></TR><TR CLASS="z"><TD CLASS="l">2203</TD><TD>                                                                this.state.addClasspathValidation(javaProject); // add/remove classpath markers</TD></TR><TR CLASS="z"><TD CLASS="l">2204</TD><TD>                                                                affectedProjects.add(project.getFullPath());</TD></TR><TR><TD CLASS="l">2205</TD><TD>                                                        }</TD></TR><TR><TD CLASS="l">2206</TD><TD>                                                }</TD></TR><TR CLASS="z"><TD CLASS="l">2207</TD><TD>                                                break;</TD></TR><TR><TD CLASS="l">2208</TD><TD>                                        case IResourceDelta.REMOVED:</TD></TR><TR CLASS="z"><TD CLASS="l">2209</TD><TD>                                                affectedProjects.add(project.getFullPath());</TD></TR><TR><TD CLASS="l">2210</TD><TD>                                                break;</TD></TR><TR><TD CLASS="l">2211</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">2212</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">2213</TD><TD>                        case IResource.FILE :</TD></TR><TR><TD CLASS="l">2214</TD><TD>                                /* check classpath or prefs files change */</TD></TR><TR CLASS="z"><TD CLASS="l">2215</TD><TD>                                IFile file = (IFile) resource;</TD></TR><TR CLASS="z"><TD CLASS="l">2216</TD><TD>                                String fileName = file.getName();</TD></TR><TR CLASS="z"><TD CLASS="l">2217</TD><TD>                                if (fileName.equals(JavaProject.CLASSPATH_FILENAME)) {</TD></TR><TR CLASS="z"><TD CLASS="l">2218</TD><TD>                                        JavaProject javaProject = (JavaProject)JavaScriptCore.create(file.getProject());</TD></TR><TR CLASS="z"><TD CLASS="l">2219</TD><TD>                                        this.state.addClasspathValidation(javaProject);</TD></TR><TR CLASS="z"><TD CLASS="l">2220</TD><TD>                                        affectedProjects.add(file.getProject().getFullPath());</TD></TR><TR><TD CLASS="l">2221</TD><TD>                                }</TD></TR><TR><TD CLASS="l">2222</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">2223</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">2224</TD><TD>                if (processChildren) {</TD></TR><TR CLASS="z"><TD CLASS="l">2225</TD><TD>                        IResourceDelta[] children = delta.getAffectedChildren();</TD></TR><TR CLASS="z"><TD CLASS="l">2226</TD><TD>                        for (int i = 0; i &lt; children.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">2227</TD><TD>                                validateClasspaths(children[i], affectedProjects);</TD></TR><TR><TD CLASS="l">2228</TD><TD>                        }</TD></TR><TR><TD CLASS="l">2229</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">2230</TD><TD>        }</TD></TR><TR><TD CLASS="l">2231</TD><TD> </TD></TR><TR><TD CLASS="l">2232</TD><TD>        /*</TD></TR><TR><TD CLASS="l">2233</TD><TD>         * Validate the classpaths of the projects affected by the given delta.</TD></TR><TR><TD CLASS="l"><A NAME="35">2234</A></TD><TD>         * Create markers if necessary.</TD></TR><TR><TD CLASS="l">2235</TD><TD>         * Returns whether cycle markers should be recomputed.</TD></TR><TR><TD CLASS="l">2236</TD><TD>         */</TD></TR><TR><TD CLASS="l">2237</TD><TD>        private boolean validateClasspaths(IResourceDelta delta) {</TD></TR><TR CLASS="z"><TD CLASS="l">2238</TD><TD>                HashSet affectedProjects = new HashSet(5);</TD></TR><TR CLASS="z"><TD CLASS="l">2239</TD><TD>                validateClasspaths(delta, affectedProjects);</TD></TR><TR CLASS="z"><TD CLASS="l">2240</TD><TD>                boolean needCycleValidation = false;</TD></TR><TR><TD CLASS="l">2241</TD><TD> </TD></TR><TR><TD CLASS="l">2242</TD><TD>                // validate classpaths of affected projects (dependent projects</TD></TR><TR><TD CLASS="l">2243</TD><TD>                // or projects that reference a library in one of the projects that have changed)</TD></TR><TR CLASS="z"><TD CLASS="l">2244</TD><TD>                if (!affectedProjects.isEmpty()) {</TD></TR><TR CLASS="z"><TD CLASS="l">2245</TD><TD>                        IWorkspaceRoot workspaceRoot = ResourcesPlugin.getWorkspace().getRoot();</TD></TR><TR CLASS="z"><TD CLASS="l">2246</TD><TD>                        IProject[] projects = workspaceRoot.getProjects();</TD></TR><TR CLASS="z"><TD CLASS="l">2247</TD><TD>                        int length = projects.length;</TD></TR><TR CLASS="z"><TD CLASS="l">2248</TD><TD>                        for (int i = 0; i &lt; length; i++){</TD></TR><TR CLASS="z"><TD CLASS="l">2249</TD><TD>                                IProject project = projects[i];</TD></TR><TR CLASS="z"><TD CLASS="l">2250</TD><TD>                                JavaProject javaProject = (JavaProject)JavaScriptCore.create(project);</TD></TR><TR><TD CLASS="l">2251</TD><TD>                                try {</TD></TR><TR CLASS="z"><TD CLASS="l">2252</TD><TD>                                        IPath projectPath = project.getFullPath();</TD></TR><TR CLASS="z"><TD CLASS="l">2253</TD><TD>                                        IIncludePathEntry[] classpath = javaProject.getResolvedClasspath(); // allowed to reuse model cache</TD></TR><TR CLASS="z"><TD CLASS="l">2254</TD><TD>                                        for (int j = 0, cpLength = classpath.length; j &lt; cpLength; j++) {</TD></TR><TR CLASS="z"><TD CLASS="l">2255</TD><TD>                                                IIncludePathEntry entry = classpath[j];</TD></TR><TR CLASS="z"><TD CLASS="l">2256</TD><TD>                                                switch (entry.getEntryKind()) {</TD></TR><TR><TD CLASS="l">2257</TD><TD>                                                        case IIncludePathEntry.CPE_PROJECT:</TD></TR><TR CLASS="z"><TD CLASS="l">2258</TD><TD>                                                                if (affectedProjects.contains(entry.getPath())) {</TD></TR><TR CLASS="z"><TD CLASS="l">2259</TD><TD>                                                                        this.state.addClasspathValidation(javaProject);</TD></TR><TR CLASS="z"><TD CLASS="l">2260</TD><TD>                                                                        needCycleValidation = true;</TD></TR><TR><TD CLASS="l">2261</TD><TD>                                                                }</TD></TR><TR CLASS="z"><TD CLASS="l">2262</TD><TD>                                                                break;</TD></TR><TR><TD CLASS="l">2263</TD><TD>                                                        case IIncludePathEntry.CPE_LIBRARY:</TD></TR><TR CLASS="z"><TD CLASS="l">2264</TD><TD>                                                                IPath entryPath = entry.getPath();</TD></TR><TR CLASS="z"><TD CLASS="l">2265</TD><TD>                                                                IPath libProjectPath = entryPath.removeLastSegments(entryPath.segmentCount()-1);</TD></TR><TR CLASS="z"><TD CLASS="l">2266</TD><TD>                                                                if (!libProjectPath.equals(projectPath) // if library contained in another project</TD></TR><TR CLASS="z"><TD CLASS="l">2267</TD><TD>                                                                                &amp;&amp; affectedProjects.contains(libProjectPath)) {</TD></TR><TR CLASS="z"><TD CLASS="l">2268</TD><TD>                                                                        this.state.addClasspathValidation(javaProject);</TD></TR><TR><TD CLASS="l">2269</TD><TD>                                                                }</TD></TR><TR><TD CLASS="l">2270</TD><TD>                                                                break;</TD></TR><TR><TD CLASS="l">2271</TD><TD>                                                }</TD></TR><TR><TD CLASS="l">2272</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">2273</TD><TD>                                } catch(JavaScriptModelException e) {</TD></TR><TR><TD CLASS="l">2274</TD><TD>                                                // project no longer exists</TD></TR><TR><TD CLASS="l">2275</TD><TD>                                }</TD></TR><TR><TD CLASS="l">2276</TD><TD>                        }</TD></TR><TR><TD CLASS="l">2277</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">2278</TD><TD>                return needCycleValidation;</TD></TR><TR><TD CLASS="l">2279</TD><TD>        }</TD></TR><TR><TD CLASS="l">2280</TD><TD> </TD></TR><TR><TD CLASS="l">2281</TD><TD>        /*</TD></TR><TR><TD CLASS="l">2282</TD><TD>         * Update the current delta (ie. add/remove/change the given element) and update the correponding index.</TD></TR><TR><TD CLASS="l">2283</TD><TD>         * Returns whether the children of the given delta must be processed.</TD></TR><TR><TD CLASS="l"><A NAME="31">2284</A></TD><TD>         * @throws a JavaScriptModelException if the delta doesn't correspond to a java element of the given type.</TD></TR><TR><TD CLASS="l">2285</TD><TD>         */</TD></TR><TR><TD CLASS="l">2286</TD><TD>        public boolean updateCurrentDeltaAndIndex(IResourceDelta delta, int elementType, RootInfo rootInfo) {</TD></TR><TR><TD CLASS="l">2287</TD><TD>                Openable element;</TD></TR><TR CLASS="z"><TD CLASS="l">2288</TD><TD>                switch (delta.getKind()) {</TD></TR><TR><TD CLASS="l">2289</TD><TD>                        case IResourceDelta.ADDED :</TD></TR><TR CLASS="z"><TD CLASS="l">2290</TD><TD>                                IResource deltaRes = delta.getResource();</TD></TR><TR CLASS="z"><TD CLASS="l">2291</TD><TD>                                element = createElement(deltaRes, elementType, rootInfo);</TD></TR><TR CLASS="z"><TD CLASS="l">2292</TD><TD>                                if (element == null) {</TD></TR><TR><TD CLASS="l">2293</TD><TD>                                        // resource might be containing shared roots (see bug 19058)</TD></TR><TR CLASS="z"><TD CLASS="l">2294</TD><TD>                                        this.state.updateRoots(deltaRes.getFullPath(), delta, this);</TD></TR><TR CLASS="z"><TD CLASS="l">2295</TD><TD>                                        return rootInfo != null &amp;&amp; rootInfo.inclusionPatterns != null;</TD></TR><TR><TD CLASS="l">2296</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">2297</TD><TD>                                updateIndex(element, delta);</TD></TR><TR CLASS="z"><TD CLASS="l">2298</TD><TD>                                elementAdded(element, delta, rootInfo);</TD></TR><TR CLASS="z"><TD CLASS="l">2299</TD><TD>                                if (elementType == IJavaScriptElement.PACKAGE_FRAGMENT_ROOT)</TD></TR><TR CLASS="z"><TD CLASS="l">2300</TD><TD>                                        this.state.addClasspathValidation(rootInfo.project);</TD></TR><TR CLASS="z"><TD CLASS="l">2301</TD><TD>                                return elementType == IJavaScriptElement.PACKAGE_FRAGMENT;</TD></TR><TR><TD CLASS="l">2302</TD><TD>                        case IResourceDelta.REMOVED :</TD></TR><TR CLASS="z"><TD CLASS="l">2303</TD><TD>                                deltaRes = delta.getResource();</TD></TR><TR CLASS="z"><TD CLASS="l">2304</TD><TD>                                element = createElement(deltaRes, elementType, rootInfo);</TD></TR><TR CLASS="z"><TD CLASS="l">2305</TD><TD>                                if (element == null) {</TD></TR><TR><TD CLASS="l">2306</TD><TD>                                        // resource might be containing shared roots (see bug 19058)</TD></TR><TR CLASS="z"><TD CLASS="l">2307</TD><TD>                                        this.state.updateRoots(deltaRes.getFullPath(), delta, this);</TD></TR><TR CLASS="z"><TD CLASS="l">2308</TD><TD>                                        return rootInfo != null &amp;&amp; rootInfo.inclusionPatterns != null;</TD></TR><TR><TD CLASS="l">2309</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">2310</TD><TD>                                updateIndex(element, delta);</TD></TR><TR CLASS="z"><TD CLASS="l">2311</TD><TD>                                elementRemoved(element, delta, rootInfo);</TD></TR><TR CLASS="z"><TD CLASS="l">2312</TD><TD>                                if (elementType == IJavaScriptElement.PACKAGE_FRAGMENT_ROOT)</TD></TR><TR CLASS="z"><TD CLASS="l">2313</TD><TD>                                        this.state.addClasspathValidation(rootInfo.project);</TD></TR><TR><TD CLASS="l">2314</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">2315</TD><TD>                                if (deltaRes.getType() == IResource.PROJECT){</TD></TR><TR><TD CLASS="l">2316</TD><TD>                                        // reset the corresponding project built state, since cannot reuse if added back</TD></TR><TR CLASS="z"><TD CLASS="l">2317</TD><TD>                                        if (JavaBuilder.DEBUG)</TD></TR><TR CLASS="z"><TD CLASS="l">2318</TD><TD>                                                System.out.println(&#34;Clearing last state for removed project : &#34; + deltaRes); //$NON-NLS-1$</TD></TR><TR CLASS="z"><TD CLASS="l">2319</TD><TD>                                        this.manager.setLastBuiltState((IProject)deltaRes, null /*no state*/);</TD></TR><TR><TD CLASS="l">2320</TD><TD> </TD></TR><TR><TD CLASS="l">2321</TD><TD>                                        // clean up previous session containers (see https://bugs.eclipse.org/bugs/show_bug.cgi?id=89850)</TD></TR><TR CLASS="z"><TD CLASS="l">2322</TD><TD>                                        this.manager.previousSessionContainers.remove(element);</TD></TR><TR><TD CLASS="l">2323</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">2324</TD><TD>                                return elementType == IJavaScriptElement.PACKAGE_FRAGMENT;</TD></TR><TR><TD CLASS="l">2325</TD><TD>                        case IResourceDelta.CHANGED :</TD></TR><TR CLASS="z"><TD CLASS="l">2326</TD><TD>                                int flags = delta.getFlags();</TD></TR><TR CLASS="z"><TD CLASS="l">2327</TD><TD>                                if ((flags &amp; IResourceDelta.CONTENT) != 0 || (flags &amp; IResourceDelta.ENCODING) != 0) {</TD></TR><TR><TD CLASS="l">2328</TD><TD>                                        // content or encoding has changed</TD></TR><TR CLASS="z"><TD CLASS="l">2329</TD><TD>                                        element = createElement(delta.getResource(), elementType, rootInfo);</TD></TR><TR CLASS="z"><TD CLASS="l">2330</TD><TD>                                        if (element == null) return false;</TD></TR><TR CLASS="z"><TD CLASS="l">2331</TD><TD>                                        updateIndex(element, delta);</TD></TR><TR CLASS="z"><TD CLASS="l">2332</TD><TD>                                        contentChanged(element);</TD></TR><TR CLASS="z"><TD CLASS="l">2333</TD><TD>                                } else if (elementType == IJavaScriptElement.JAVASCRIPT_PROJECT) {</TD></TR><TR CLASS="z"><TD CLASS="l">2334</TD><TD>                                        if ((flags &amp; IResourceDelta.OPEN) != 0) {</TD></TR><TR><TD CLASS="l">2335</TD><TD>                                                // project has been opened or closed</TD></TR><TR CLASS="z"><TD CLASS="l">2336</TD><TD>                                                IProject res = (IProject)delta.getResource();</TD></TR><TR CLASS="z"><TD CLASS="l">2337</TD><TD>                                                element = createElement(res, elementType, rootInfo);</TD></TR><TR CLASS="z"><TD CLASS="l">2338</TD><TD>                                                if (element == null) {</TD></TR><TR><TD CLASS="l">2339</TD><TD>                                                        // resource might be containing shared roots (see bug 19058)</TD></TR><TR CLASS="z"><TD CLASS="l">2340</TD><TD>                                                        this.state.updateRoots(res.getFullPath(), delta, this);</TD></TR><TR CLASS="z"><TD CLASS="l">2341</TD><TD>                                                        return false;</TD></TR><TR><TD CLASS="l">2342</TD><TD>                                                }</TD></TR><TR CLASS="z"><TD CLASS="l">2343</TD><TD>                                                if (res.isOpen()) {</TD></TR><TR CLASS="z"><TD CLASS="l">2344</TD><TD>                                                        if (JavaProject.hasJavaNature(res)) {</TD></TR><TR CLASS="z"><TD CLASS="l">2345</TD><TD>                                                                addToParentInfo(element);</TD></TR><TR CLASS="z"><TD CLASS="l">2346</TD><TD>                                                                currentDelta().opened(element);</TD></TR><TR CLASS="z"><TD CLASS="l">2347</TD><TD>                                                                this.state.updateRoots(element.getPath(), delta, this);</TD></TR><TR><TD CLASS="l">2348</TD><TD> </TD></TR><TR><TD CLASS="l">2349</TD><TD>                                                                // refresh pkg fragment roots and caches of the project (and its dependents)</TD></TR><TR CLASS="z"><TD CLASS="l">2350</TD><TD>                                                                this.rootsToRefresh.add(element);</TD></TR><TR CLASS="z"><TD CLASS="l">2351</TD><TD>                                                                this.projectCachesToReset.add(element);</TD></TR><TR><TD CLASS="l">2352</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">2353</TD><TD>                                                                this.manager.indexManager.indexAll(res);</TD></TR><TR><TD CLASS="l">2354</TD><TD>                                                        }</TD></TR><TR><TD CLASS="l">2355</TD><TD>                                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">2356</TD><TD>                                                        boolean wasJavaProject = this.state.findJavaProject(res.getName()) != null;</TD></TR><TR CLASS="z"><TD CLASS="l">2357</TD><TD>                                                        if (wasJavaProject) {</TD></TR><TR CLASS="z"><TD CLASS="l">2358</TD><TD>                                                                close(element);</TD></TR><TR CLASS="z"><TD CLASS="l">2359</TD><TD>                                                                removeFromParentInfo(element);</TD></TR><TR CLASS="z"><TD CLASS="l">2360</TD><TD>                                                                currentDelta().closed(element);</TD></TR><TR CLASS="z"><TD CLASS="l">2361</TD><TD>                                                                this.manager.indexManager.discardJobs(element.getElementName());</TD></TR><TR CLASS="z"><TD CLASS="l">2362</TD><TD>                                                                this.manager.indexManager.removeIndexFamily(res.getFullPath());</TD></TR><TR><TD CLASS="l">2363</TD><TD>                                                        }</TD></TR><TR><TD CLASS="l">2364</TD><TD>                                                }</TD></TR><TR CLASS="z"><TD CLASS="l">2365</TD><TD>                                                return false; // when a project is open/closed don't process children</TD></TR><TR><TD CLASS="l">2366</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">2367</TD><TD>                                        if ((flags &amp; IResourceDelta.DESCRIPTION) != 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">2368</TD><TD>                                                IProject res = (IProject)delta.getResource();</TD></TR><TR CLASS="z"><TD CLASS="l">2369</TD><TD>                                                boolean wasJavaProject = this.state.findJavaProject(res.getName()) != null;</TD></TR><TR CLASS="z"><TD CLASS="l">2370</TD><TD>                                                boolean isJavaProject = JavaProject.hasJavaNature(res);</TD></TR><TR CLASS="z"><TD CLASS="l">2371</TD><TD>                                                if (wasJavaProject != isJavaProject) {</TD></TR><TR><TD CLASS="l">2372</TD><TD>                                                        // project's nature has been added or removed</TD></TR><TR CLASS="z"><TD CLASS="l">2373</TD><TD>                                                        element = this.createElement(res, elementType, rootInfo);</TD></TR><TR CLASS="z"><TD CLASS="l">2374</TD><TD>                                                        if (element == null) return false; // note its resources are still visible as roots to other projects</TD></TR><TR CLASS="z"><TD CLASS="l">2375</TD><TD>                                                        if (isJavaProject) {</TD></TR><TR CLASS="z"><TD CLASS="l">2376</TD><TD>                                                                elementAdded(element, delta, rootInfo);</TD></TR><TR CLASS="z"><TD CLASS="l">2377</TD><TD>                                                                this.manager.indexManager.indexAll(res);</TD></TR><TR><TD CLASS="l">2378</TD><TD>                                                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">2379</TD><TD>                                                                elementRemoved(element, delta, rootInfo);</TD></TR><TR CLASS="z"><TD CLASS="l">2380</TD><TD>                                                                this.manager.indexManager.discardJobs(element.getElementName());</TD></TR><TR CLASS="z"><TD CLASS="l">2381</TD><TD>                                                                this.manager.indexManager.removeIndexFamily(res.getFullPath());</TD></TR><TR><TD CLASS="l">2382</TD><TD>                                                                // reset the corresponding project built state, since cannot reuse if added back</TD></TR><TR CLASS="z"><TD CLASS="l">2383</TD><TD>                                                                if (JavaBuilder.DEBUG)</TD></TR><TR CLASS="z"><TD CLASS="l">2384</TD><TD>                                                                        System.out.println(&#34;Clearing last state for project loosing Java nature: &#34; + res); //$NON-NLS-1$</TD></TR><TR CLASS="z"><TD CLASS="l">2385</TD><TD>                                                                this.manager.setLastBuiltState(res, null /*no state*/);</TD></TR><TR><TD CLASS="l">2386</TD><TD>                                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">2387</TD><TD>                                                        return false; // when a project's nature is added/removed don't process children</TD></TR><TR><TD CLASS="l">2388</TD><TD>                                                }</TD></TR><TR><TD CLASS="l">2389</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">2390</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">2391</TD><TD>                                return true;</TD></TR><TR><TD CLASS="l">2392</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="32">2393</A></TD><TD>                return true;</TD></TR><TR><TD CLASS="l">2394</TD><TD>        }</TD></TR><TR><TD CLASS="l">2395</TD><TD>        private void updateIndex(Openable element, IResourceDelta delta) {</TD></TR><TR><TD CLASS="l">2396</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">2397</TD><TD>                IndexManager indexManager = this.manager.indexManager;</TD></TR><TR CLASS="z"><TD CLASS="l">2398</TD><TD>                if (indexManager == null)</TD></TR><TR CLASS="z"><TD CLASS="l">2399</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">2400</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">2401</TD><TD>                switch (element.getElementType()) {</TD></TR><TR><TD CLASS="l">2402</TD><TD>                        case IJavaScriptElement.JAVASCRIPT_PROJECT :</TD></TR><TR CLASS="z"><TD CLASS="l">2403</TD><TD>                                switch (delta.getKind()) {</TD></TR><TR><TD CLASS="l">2404</TD><TD>                                        case IResourceDelta.ADDED :</TD></TR><TR CLASS="z"><TD CLASS="l">2405</TD><TD>                                                indexManager.indexAll(element.getJavaScriptProject().getProject());</TD></TR><TR CLASS="z"><TD CLASS="l">2406</TD><TD>                                                break;</TD></TR><TR><TD CLASS="l">2407</TD><TD>                                        case IResourceDelta.REMOVED :</TD></TR><TR CLASS="z"><TD CLASS="l">2408</TD><TD>                                                indexManager.removeIndexFamily(element.getJavaScriptProject().getProject().getFullPath());</TD></TR><TR><TD CLASS="l">2409</TD><TD>                                                // NB: Discarding index jobs belonging to this project was done during PRE_DELETE</TD></TR><TR><TD CLASS="l">2410</TD><TD>                                                break;</TD></TR><TR><TD CLASS="l">2411</TD><TD>                                        // NB: Update of index if project is opened, closed, or its java nature is added or removed</TD></TR><TR><TD CLASS="l">2412</TD><TD>                                        //     is done in updateCurrentDeltaAndIndex</TD></TR><TR><TD CLASS="l">2413</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">2414</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">2415</TD><TD>                        case IJavaScriptElement.PACKAGE_FRAGMENT_ROOT :</TD></TR><TR CLASS="z"><TD CLASS="l">2416</TD><TD>                                if (element instanceof LibraryFragmentRoot) {</TD></TR><TR CLASS="z"><TD CLASS="l">2417</TD><TD>                                        LibraryFragmentRoot root = (LibraryFragmentRoot)element;</TD></TR><TR><TD CLASS="l">2418</TD><TD>                                        // index jar file only once (if the root is in its declaring project)</TD></TR><TR CLASS="z"><TD CLASS="l">2419</TD><TD>                                        IPath jarPath = root.getPath();</TD></TR><TR CLASS="z"><TD CLASS="l">2420</TD><TD>                                        switch (delta.getKind()) {</TD></TR><TR><TD CLASS="l">2421</TD><TD>                                                case IResourceDelta.ADDED:</TD></TR><TR><TD CLASS="l">2422</TD><TD>                                                        // index the new jar</TD></TR><TR CLASS="z"><TD CLASS="l">2423</TD><TD>                                                        indexManager.indexLibrary((LibraryFragmentRoot)element, root.getJavaScriptProject().getProject());</TD></TR><TR CLASS="z"><TD CLASS="l">2424</TD><TD>                                                        break;</TD></TR><TR><TD CLASS="l">2425</TD><TD>                                                case IResourceDelta.CHANGED:</TD></TR><TR><TD CLASS="l">2426</TD><TD>                                                        // first remove the index so that it is forced to be re-indexed</TD></TR><TR CLASS="z"><TD CLASS="l">2427</TD><TD>                                                        indexManager.removeIndex(jarPath);</TD></TR><TR><TD CLASS="l">2428</TD><TD>                                                        // then index the jar</TD></TR><TR CLASS="z"><TD CLASS="l">2429</TD><TD>                                                        indexManager.indexLibrary((LibraryFragmentRoot)element, root.getJavaScriptProject().getProject());</TD></TR><TR CLASS="z"><TD CLASS="l">2430</TD><TD>                                                        break;</TD></TR><TR><TD CLASS="l">2431</TD><TD>                                                case IResourceDelta.REMOVED:</TD></TR><TR><TD CLASS="l">2432</TD><TD>                                                        // the jar was physically removed: remove the index</TD></TR><TR CLASS="z"><TD CLASS="l">2433</TD><TD>                                                        indexManager.discardJobs(jarPath.toString());</TD></TR><TR CLASS="z"><TD CLASS="l">2434</TD><TD>                                                        indexManager.removeIndex(jarPath);</TD></TR><TR><TD CLASS="l">2435</TD><TD>                                                        break;</TD></TR><TR><TD CLASS="l">2436</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">2437</TD><TD>                                        break;</TD></TR><TR><TD CLASS="l">2438</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">2439</TD><TD>                                int kind = delta.getKind();</TD></TR><TR CLASS="z"><TD CLASS="l">2440</TD><TD>                                if (kind == IResourceDelta.ADDED || kind == IResourceDelta.REMOVED) {</TD></TR><TR CLASS="z"><TD CLASS="l">2441</TD><TD>                                        PackageFragmentRoot root = (PackageFragmentRoot)element;</TD></TR><TR CLASS="z"><TD CLASS="l">2442</TD><TD>                                        this.updateRootIndex(root, CharOperation.NO_STRINGS, delta);</TD></TR><TR CLASS="z"><TD CLASS="l">2443</TD><TD>                                        break;</TD></TR><TR><TD CLASS="l">2444</TD><TD>                                }</TD></TR><TR><TD CLASS="l">2445</TD><TD>                                // don't break as packages of the package fragment root can be indexed below</TD></TR><TR><TD CLASS="l">2446</TD><TD>                        case IJavaScriptElement.PACKAGE_FRAGMENT :</TD></TR><TR CLASS="z"><TD CLASS="l">2447</TD><TD>                                switch (delta.getKind()) {</TD></TR><TR><TD CLASS="l">2448</TD><TD>                                        case IResourceDelta.ADDED:</TD></TR><TR><TD CLASS="l">2449</TD><TD>                                        case IResourceDelta.REMOVED:</TD></TR><TR CLASS="z"><TD CLASS="l">2450</TD><TD>                                                IPackageFragment pkg = null;</TD></TR><TR CLASS="z"><TD CLASS="l">2451</TD><TD>                                                if (element instanceof IPackageFragmentRoot) {</TD></TR><TR CLASS="z"><TD CLASS="l">2452</TD><TD>                                                        PackageFragmentRoot root = (PackageFragmentRoot)element;</TD></TR><TR CLASS="z"><TD CLASS="l">2453</TD><TD>                                                        pkg = root.getPackageFragment(CharOperation.NO_STRINGS);</TD></TR><TR><TD CLASS="l">2454</TD><TD>                                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">2455</TD><TD>                                                        pkg = (IPackageFragment)element;</TD></TR><TR><TD CLASS="l">2456</TD><TD>                                                }</TD></TR><TR CLASS="z"><TD CLASS="l">2457</TD><TD>                                                RootInfo rootInfo = rootInfo(pkg.getParent().getPath(), delta.getKind());</TD></TR><TR CLASS="z"><TD CLASS="l">2458</TD><TD>                                                boolean isSource =</TD></TR><TR CLASS="z"><TD CLASS="l">2459</TD><TD>                                                        rootInfo == null // if null, defaults to source</TD></TR><TR CLASS="z"><TD CLASS="l">2460</TD><TD>                                                        || rootInfo.entryKind == IIncludePathEntry.CPE_SOURCE;</TD></TR><TR CLASS="z"><TD CLASS="l">2461</TD><TD>                                                IResourceDelta[] children = delta.getAffectedChildren();</TD></TR><TR CLASS="z"><TD CLASS="l">2462</TD><TD>                                                for (int i = 0, length = children.length; i &lt; length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">2463</TD><TD>                                                        IResourceDelta child = children[i];</TD></TR><TR CLASS="z"><TD CLASS="l">2464</TD><TD>                                                        IResource resource = child.getResource();</TD></TR><TR><TD CLASS="l">2465</TD><TD>                                                        // TODO (philippe) Why do this? Every child is added anyway as the delta is walked</TD></TR><TR CLASS="z"><TD CLASS="l">2466</TD><TD>                                                        if (resource instanceof IFile) {</TD></TR><TR CLASS="z"><TD CLASS="l">2467</TD><TD>                                                                String name = resource.getName();</TD></TR><TR CLASS="z"><TD CLASS="l">2468</TD><TD>                                                                if (isSource) {</TD></TR><TR CLASS="z"><TD CLASS="l">2469</TD><TD>                                                                        if (org.eclipse.wst.jsdt.internal.core.util.Util.isJavaLikeFileName(name)) {</TD></TR><TR CLASS="z"><TD CLASS="l">2470</TD><TD>                                                                                Openable cu = (Openable)pkg.getJavaScriptUnit(name);</TD></TR><TR CLASS="z"><TD CLASS="l">2471</TD><TD>                                                                                this.updateIndex(cu, child);</TD></TR><TR><TD CLASS="l">2472</TD><TD>                                                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">2473</TD><TD>                                                                } else if (org.eclipse.wst.jsdt.internal.compiler.util.Util.isClassFileName(name)) {</TD></TR><TR CLASS="z"><TD CLASS="l">2474</TD><TD>                                                                        Openable classFile = (Openable)pkg.getClassFile(name);</TD></TR><TR CLASS="z"><TD CLASS="l">2475</TD><TD>                                                                        this.updateIndex(classFile, child);</TD></TR><TR><TD CLASS="l">2476</TD><TD>                                                                }</TD></TR><TR><TD CLASS="l">2477</TD><TD>                                                        }</TD></TR><TR><TD CLASS="l">2478</TD><TD>                                                }</TD></TR><TR><TD CLASS="l">2479</TD><TD>                                                break;</TD></TR><TR><TD CLASS="l">2480</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">2481</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">2482</TD><TD>                        case IJavaScriptElement.CLASS_FILE :</TD></TR><TR CLASS="z"><TD CLASS="l">2483</TD><TD>                                IFile file = (IFile) delta.getResource();</TD></TR><TR CLASS="z"><TD CLASS="l">2484</TD><TD>                                IJavaScriptProject project = element.getJavaScriptProject();</TD></TR><TR CLASS="z"><TD CLASS="l">2485</TD><TD>                                IPath binaryFolderPath = element.getPackageFragmentRoot().getPath();</TD></TR><TR><TD CLASS="l">2486</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">2487</TD><TD>                                switch (delta.getKind()) {</TD></TR><TR><TD CLASS="l">2488</TD><TD>                                        case IResourceDelta.CHANGED :</TD></TR><TR><TD CLASS="l">2489</TD><TD>                                                // no need to index if the content has not changed</TD></TR><TR CLASS="z"><TD CLASS="l">2490</TD><TD>                                                int flags = delta.getFlags();</TD></TR><TR CLASS="z"><TD CLASS="l">2491</TD><TD>                                                if ((flags &amp; IResourceDelta.CONTENT) == 0 &amp;&amp; (flags &amp; IResourceDelta.ENCODING) == 0)</TD></TR><TR CLASS="z"><TD CLASS="l">2492</TD><TD>                                                        break;</TD></TR><TR><TD CLASS="l">2493</TD><TD>                                        case IResourceDelta.ADDED :</TD></TR><TR CLASS="z"><TD CLASS="l">2494</TD><TD>                                                indexManager.addBinary(file, binaryFolderPath);</TD></TR><TR CLASS="z"><TD CLASS="l">2495</TD><TD>                                                break;</TD></TR><TR><TD CLASS="l">2496</TD><TD>                                        case IResourceDelta.REMOVED :</TD></TR><TR CLASS="z"><TD CLASS="l">2497</TD><TD>                                                String containerRelativePath = Util.relativePath(file.getFullPath(), binaryFolderPath.segmentCount());</TD></TR><TR CLASS="z"><TD CLASS="l">2498</TD><TD>                                                indexManager.remove(containerRelativePath, binaryFolderPath);</TD></TR><TR><TD CLASS="l">2499</TD><TD>                                                break;</TD></TR><TR><TD CLASS="l">2500</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">2501</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">2502</TD><TD>                        case IJavaScriptElement.JAVASCRIPT_UNIT :</TD></TR><TR CLASS="z"><TD CLASS="l">2503</TD><TD>                                file = (IFile) delta.getResource();</TD></TR><TR CLASS="z"><TD CLASS="l">2504</TD><TD>                                switch (delta.getKind()) {</TD></TR><TR><TD CLASS="l">2505</TD><TD>                                        case IResourceDelta.CHANGED :</TD></TR><TR><TD CLASS="l">2506</TD><TD>                                                // no need to index if the content has not changed</TD></TR><TR CLASS="z"><TD CLASS="l">2507</TD><TD>                                                int flags = delta.getFlags();</TD></TR><TR CLASS="z"><TD CLASS="l">2508</TD><TD>                                                if ((flags &amp; IResourceDelta.CONTENT) == 0 &amp;&amp; (flags &amp; IResourceDelta.ENCODING) == 0)</TD></TR><TR CLASS="z"><TD CLASS="l">2509</TD><TD>                                                        break;</TD></TR><TR><TD CLASS="l">2510</TD><TD>                                        case IResourceDelta.ADDED :</TD></TR><TR CLASS="z"><TD CLASS="l">2511</TD><TD>                                                indexManager.addSource(file, file.getProject().getFullPath(), getSourceElementParser(element));</TD></TR><TR><TD CLASS="l">2512</TD><TD>                                                // Clean file from secondary types cache but do not update indexing secondary type cache as it will be updated through indexing itself</TD></TR><TR CLASS="z"><TD CLASS="l">2513</TD><TD>                                                this.manager.secondaryTypesRemoving(file, false);</TD></TR><TR CLASS="z"><TD CLASS="l">2514</TD><TD>                                                break;</TD></TR><TR><TD CLASS="l">2515</TD><TD>                                        case IResourceDelta.REMOVED :</TD></TR><TR CLASS="z"><TD CLASS="l">2516</TD><TD>                                                indexManager.remove(Util.relativePath(file.getFullPath(), 1/*remove project segment*/), file.getProject().getFullPath());</TD></TR><TR><TD CLASS="l">2517</TD><TD>                                                // Clean file from secondary types cache and update indexing secondary type cache as indexing cannot remove secondary types from cache</TD></TR><TR CLASS="z"><TD CLASS="l">2518</TD><TD>                                                this.manager.secondaryTypesRemoving(file, true);</TD></TR><TR><TD CLASS="l">2519</TD><TD>                                                break;</TD></TR><TR><TD CLASS="l">2520</TD><TD>                                }</TD></TR><TR><TD CLASS="l">2521</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">2522</TD><TD>        }</TD></TR><TR><TD CLASS="l">2523</TD><TD>        /*</TD></TR><TR><TD CLASS="l"><A NAME="33">2524</A></TD><TD>         * Update Java Model given some delta</TD></TR><TR><TD CLASS="l">2525</TD><TD>         */</TD></TR><TR><TD CLASS="l">2526</TD><TD>        public void updateJavaModel(IJavaScriptElementDelta customDelta) {</TD></TR><TR><TD CLASS="l">2527</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">2528</TD><TD>                if (customDelta == null){</TD></TR><TR CLASS="z"><TD CLASS="l">2529</TD><TD>                        for (int i = 0, length = this.javaModelDeltas.size(); i &lt; length; i++){</TD></TR><TR CLASS="z"><TD CLASS="l">2530</TD><TD>                                IJavaScriptElementDelta delta = (IJavaScriptElementDelta)this.javaModelDeltas.get(i);</TD></TR><TR CLASS="z"><TD CLASS="l">2531</TD><TD>                                this.modelUpdater.processJavaDelta(delta);</TD></TR><TR><TD CLASS="l">2532</TD><TD>                        }</TD></TR><TR><TD CLASS="l">2533</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">2534</TD><TD>                        this.modelUpdater.processJavaDelta(customDelta);</TD></TR><TR><TD CLASS="l">2535</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">2536</TD><TD>        }</TD></TR><TR><TD CLASS="l">2537</TD><TD>        /*</TD></TR><TR><TD CLASS="l"><A NAME="34">2538</A></TD><TD>         * Updates the index of the given root (assuming it's an addition or a removal).</TD></TR><TR><TD CLASS="l">2539</TD><TD>         * This is done recusively, pkg being the current package.</TD></TR><TR><TD CLASS="l">2540</TD><TD>         */</TD></TR><TR><TD CLASS="l">2541</TD><TD>        private void updateRootIndex(PackageFragmentRoot root, String[] pkgName, IResourceDelta delta) {</TD></TR><TR CLASS="z"><TD CLASS="l">2542</TD><TD>                Openable pkg = root.getPackageFragment(pkgName);</TD></TR><TR CLASS="z"><TD CLASS="l">2543</TD><TD>                this.updateIndex(pkg, delta);</TD></TR><TR CLASS="z"><TD CLASS="l">2544</TD><TD>                IResourceDelta[] children = delta.getAffectedChildren();</TD></TR><TR CLASS="z"><TD CLASS="l">2545</TD><TD>                for (int i = 0, length = children.length; i &lt; length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">2546</TD><TD>                        IResourceDelta child = children[i];</TD></TR><TR CLASS="z"><TD CLASS="l">2547</TD><TD>                        IResource resource = child.getResource();</TD></TR><TR CLASS="z"><TD CLASS="l">2548</TD><TD>                        if (resource instanceof IFolder) {</TD></TR><TR CLASS="z"><TD CLASS="l">2549</TD><TD>                                String[] subpkgName = Util.arrayConcat(pkgName, resource.getName());</TD></TR><TR CLASS="z"><TD CLASS="l">2550</TD><TD>                                this.updateRootIndex(root, subpkgName, child);</TD></TR><TR><TD CLASS="l">2551</TD><TD>                        }</TD></TR><TR><TD CLASS="l">2552</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">2553</TD><TD>        }</TD></TR><TR><TD CLASS="l">2554</TD><TD>}</TD></TR></TABLE><P></P><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TD CLASS="nv">[<A HREF="../xslUnitTestCoverage.html">all classes</A>][<A HREF="124.html">org.eclipse.wst.jsdt.internal.core</A>]</TD></TR><TR><TD CLASS="tl"><A HREF="http://www.eclemma.org/support.html">EMMA 2.0.5312 EclEmma Fix 1</A> (C) Vladimir Roubtsov</TD></TR></TABLE></BODY></HTML>