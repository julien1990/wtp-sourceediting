<HTML><HEAD><META CONTENT="text/html; charset=UTF-8" HTTP-EQUIV="Content-Type"/><TITLE>EMMA Coverage Report</TITLE><STYLE TYPE="text/css"> TABLE,TD,TH {border-style:solid; border-color:black;} TD,TH {background:white;margin:0;line-height:100%;padding-left:0.5em;padding-right:0.5em;} TD {border-width:0 1px 0 0;} TH {border-width:1px 1px 1px 0;} TR TD.h {color:red;} TABLE {border-spacing:0; border-collapse:collapse;border-width:0 0 1px 1px;} P,H1,H2,H3,TH {font-family:verdana,arial,sans-serif;font-size:10pt;} TD {font-family:courier,monospace;font-size:10pt;} TABLE.hdft {border-spacing:0;border-collapse:collapse;border-style:none;} TABLE.hdft TH,TABLE.hdft TD {border-style:none;line-height:normal;} TABLE.hdft TH.tl,TABLE.hdft TD.tl {background:#6699CC;color:white;} TABLE.hdft TD.nv {background:#6633DD;color:white;} .nv A:link {color:white;} .nv A:visited {color:white;} .nv A:active {color:yellow;} TABLE.hdft A:link {color:white;} TABLE.hdft A:visited {color:white;} TABLE.hdft A:active {color:yellow;} .in {color:#356085;} TABLE.s TD {padding-left:0.25em;padding-right:0.25em;} TABLE.s TD.l {padding-left:0.25em;padding-right:0.25em;text-align:right;background:#F0F0F0;} TABLE.s TR.z TD {background:#FF9999;} TABLE.s TR.p TD {background:#FFFF88;} TABLE.s TR.c TD {background:#CCFFCC;} A:link {color:#0000EE;text-decoration:none;} A:visited {color:#0000EE;text-decoration:none;} A:hover {color:#0000EE;text-decoration:underline;} TABLE.cn {border-width:0 0 1px 0;} TABLE.s {border-width:1px 0 1px 1px;} TD.h {color:red;border-width:0 1px 0 0;} TD.f {border-width:0 1px 0 1px;} TD.hf {color:red;border-width:0 1px 0 1px;} TH.f {border-width:1px 1px 1px 1px;} TR.cis TD {background:#F0F0F0;} TR.cis TD {border-width:1px 1px 1px 0;} TR.cis TD.h {color:red;border-width:1px 1px 1px 0;} TR.cis TD.f {border-width:1px 1px 1px 1px;} TR.cis TD.hf {color:red;border-width:1px 1px 1px 1px;} TD.b {border-style:none;background:transparent;line-height:50%;}  TD.bt {border-width:1px 0 0 0;background:transparent;line-height:50%;} TR.o TD {background:#F0F0F0;}TABLE.it {border-style:none;}TABLE.it TD,TABLE.it TH {border-style:none;}</STYLE></HEAD><BODY><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="tl"><A HREF="http://www.eclemma.org/">EMMA</A> Coverage Report (generated Tue Jun 09 19:59:05 GMT 2009)</TH></TR><TR><TD CLASS="nv">[<A HREF="../xslUnitTestCoverage.html">all classes</A>][<A HREF="177.html">org.eclipse.wst.jsdt.internal.ui.text.correction</A>]</TD></TR></TABLE><H2>COVERAGE SUMMARY FOR SOURCE FILE [<SPAN CLASS="in">SurroundWith.java</SPAN>]</H2><TABLE CELLSPACING="0" WIDTH="100%"><TR><TH>name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD>SurroundWith.java</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/33)</TD><TD CLASS="h">0%   (0/1076)</TD><TD CLASS="h">0%   (0/218)</TD></TR></TABLE><H3>COVERAGE BREAKDOWN BY CLASS AND METHOD</H3><TABLE CLASS="cn" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="f">name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#0">SurroundWith</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/22)</TD><TD CLASS="h">0%   (0/875)</TD><TD CLASS="h">0%   (0/168)</TD></TR><TR><TD CLASS="f"><A HREF="#0">SurroundWith (JavaScriptUnit, Statement []): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2">createSplitSelectedOperator (List, List, ASTRewrite, List, ListRewrite): Surr...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#3">createSplitUnselectedOperator (List, ASTRewrite, ListRewrite): SurroundWith$I...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/8)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#4">getAccesses (ASTNode [], int): IVariableBinding []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/26)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR><TD CLASS="f"><A HREF="#5">getAst (): AST</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#6">getBodyLength (): int</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/11)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#7">getBodyStart (): int</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#8">getListRewrite (ASTNode, ASTRewrite): ListRewrite</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/50)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR><TD CLASS="f"><A HREF="#9">getReads (ASTNode [], int): IVariableBinding []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/26)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#a">getRewrite (): ASTRewrite</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/185)</TD><TD CLASS="h">0%   (0/30)</TD></TR><TR><TD CLASS="f"><A HREF="#b">getRootNode (): JavaScriptUnit</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/14)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#c">getSelectedStatements (): Statement []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#d">getSelectedStatements (IInvocationContext): Statement []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/29)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#e">getVariableDeclarationReadsInside (Statement [], int): List</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/43)</TD><TD CLASS="h">0%   (0/11)</TD></TR><TR><TD CLASS="f"><A HREF="#f">getVariableDeclarationsAccessedAfter (ASTNode, int): List</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/105)</TD><TD CLASS="h">0%   (0/16)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#10">insertNodeAtEnd (ASTRewrite, List, ASTNode): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#11">isApplicable (IInvocationContext): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/40)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#12">makeFinal (VariableDeclarationStatement, ASTRewrite): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/19)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR><TD CLASS="f"><A HREF="#13">moveToBlock (Statement [], List, List, List, ASTRewrite): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/152)</TD><TD CLASS="h">0%   (0/29)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#14">qualifyThisExpressions (ASTNode, ASTRewrite, ImportRewrite): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/8)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#15">splitOffInitializer (List, VariableDeclarationFragment, ASTRewrite): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/31)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#16">splitVariableDeclarationStatement (VariableDeclarationStatement, SurroundWith...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/92)</TD><TD CLASS="h">0%   (0/22)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#14">SurroundWith$1</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/2)</TD><TD CLASS="h">0%   (0/43)</TD><TD CLASS="h">0%   (0/11)</TD></TR><TR><TD CLASS="f"><A HREF="#14">SurroundWith$1 (SurroundWith, ASTRewrite): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#19">visit (ThisExpression): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/34)</TD><TD CLASS="h">0%   (0/9)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#1a">SurroundWith$SplitSelectedOperator</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/110)</TD><TD CLASS="h">0%   (0/27)</TD></TR><TR><TD CLASS="f"><A HREF="#1a">SurroundWith$SplitSelectedOperator (List, List, ListRewrite, ASTRewrite, List...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/21)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1c">handleInitializer (VariableDeclarationFragment): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#1d">handleNewStatement (Statement): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/6)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1e">handleStatement (Statement): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#1f">initializeStatement (VariableDeclarationStatement, VariableDeclarationFragmen...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/45)</TD><TD CLASS="h">0%   (0/12)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#20">needsSplit (VariableDeclarationFragment, VariableDeclarationFragment): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/22)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#21">SurroundWith$SplitUnselectedOperator</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/48)</TD><TD CLASS="h">0%   (0/13)</TD></TR><TR><TD CLASS="f"><A HREF="#21">SurroundWith$SplitUnselectedOperator (List, ListRewrite, ASTRewrite): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/15)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#23">initializeStatement (VariableDeclarationStatement, VariableDeclarationFragmen...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/23)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR><TD CLASS="f"><A HREF="#24">needsSplit (VariableDeclarationFragment, VariableDeclarationFragment): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/10)</TD><TD CLASS="h">0%   (0/1)</TD></TR></TABLE><P></P><TABLE CLASS="s" CELLSPACING="0" WIDTH="100%"><TR CLASS="z"><TD CLASS="l">1</TD><TD>/*******************************************************************************</TD></TR><TR><TD CLASS="l">2</TD><TD> * Copyright (c) 2000, 2008 IBM Corporation and others.</TD></TR><TR><TD CLASS="l">3</TD><TD> * All rights reserved. This program and the accompanying materials</TD></TR><TR><TD CLASS="l">4</TD><TD> * are made available under the terms of the Eclipse Public License v1.0</TD></TR><TR><TD CLASS="l">5</TD><TD> * which accompanies this distribution, and is available at</TD></TR><TR><TD CLASS="l">6</TD><TD> * http://www.eclipse.org/legal/epl-v10.html</TD></TR><TR><TD CLASS="l">7</TD><TD> *</TD></TR><TR><TD CLASS="l">8</TD><TD> * Contributors:</TD></TR><TR><TD CLASS="l">9</TD><TD> *     IBM Corporation - initial API and implementation</TD></TR><TR><TD CLASS="l">10</TD><TD> *******************************************************************************/</TD></TR><TR><TD CLASS="l">11</TD><TD>package org.eclipse.wst.jsdt.internal.ui.text.correction;</TD></TR><TR><TD CLASS="l">12</TD><TD> </TD></TR><TR><TD CLASS="l">13</TD><TD>import java.util.ArrayList;</TD></TR><TR><TD CLASS="l">14</TD><TD>import java.util.Iterator;</TD></TR><TR><TD CLASS="l">15</TD><TD>import java.util.List;</TD></TR><TR><TD CLASS="l">16</TD><TD> </TD></TR><TR><TD CLASS="l">17</TD><TD>import org.eclipse.core.runtime.CoreException;</TD></TR><TR><TD CLASS="l">18</TD><TD>import org.eclipse.wst.jsdt.core.IJavaScriptUnit;</TD></TR><TR><TD CLASS="l">19</TD><TD>import org.eclipse.wst.jsdt.core.IJavaScriptElement;</TD></TR><TR><TD CLASS="l">20</TD><TD>import org.eclipse.wst.jsdt.core.IType;</TD></TR><TR><TD CLASS="l">21</TD><TD>import org.eclipse.wst.jsdt.core.JavaScriptModelException;</TD></TR><TR><TD CLASS="l">22</TD><TD>import org.eclipse.wst.jsdt.core.dom.AST;</TD></TR><TR><TD CLASS="l">23</TD><TD>import org.eclipse.wst.jsdt.core.dom.ASTNode;</TD></TR><TR><TD CLASS="l">24</TD><TD>import org.eclipse.wst.jsdt.core.dom.Assignment;</TD></TR><TR><TD CLASS="l">25</TD><TD>import org.eclipse.wst.jsdt.core.dom.Block;</TD></TR><TR><TD CLASS="l">26</TD><TD>import org.eclipse.wst.jsdt.core.dom.BodyDeclaration;</TD></TR><TR><TD CLASS="l">27</TD><TD>import org.eclipse.wst.jsdt.core.dom.JavaScriptUnit;</TD></TR><TR><TD CLASS="l">28</TD><TD>import org.eclipse.wst.jsdt.core.dom.Expression;</TD></TR><TR><TD CLASS="l">29</TD><TD>import org.eclipse.wst.jsdt.core.dom.ITypeBinding;</TD></TR><TR><TD CLASS="l">30</TD><TD>import org.eclipse.wst.jsdt.core.dom.IVariableBinding;</TD></TR><TR><TD CLASS="l">31</TD><TD>import org.eclipse.wst.jsdt.core.dom.Modifier;</TD></TR><TR><TD CLASS="l">32</TD><TD>import org.eclipse.wst.jsdt.core.dom.SimpleName;</TD></TR><TR><TD CLASS="l">33</TD><TD>import org.eclipse.wst.jsdt.core.dom.SingleVariableDeclaration;</TD></TR><TR><TD CLASS="l">34</TD><TD>import org.eclipse.wst.jsdt.core.dom.Statement;</TD></TR><TR><TD CLASS="l">35</TD><TD>import org.eclipse.wst.jsdt.core.dom.SwitchStatement;</TD></TR><TR><TD CLASS="l">36</TD><TD>import org.eclipse.wst.jsdt.core.dom.ThisExpression;</TD></TR><TR><TD CLASS="l">37</TD><TD>import org.eclipse.wst.jsdt.core.dom.Type;</TD></TR><TR><TD CLASS="l">38</TD><TD>import org.eclipse.wst.jsdt.core.dom.VariableDeclaration;</TD></TR><TR><TD CLASS="l">39</TD><TD>import org.eclipse.wst.jsdt.core.dom.VariableDeclarationExpression;</TD></TR><TR><TD CLASS="l">40</TD><TD>import org.eclipse.wst.jsdt.core.dom.VariableDeclarationFragment;</TD></TR><TR><TD CLASS="l">41</TD><TD>import org.eclipse.wst.jsdt.core.dom.VariableDeclarationStatement;</TD></TR><TR><TD CLASS="l">42</TD><TD>import org.eclipse.wst.jsdt.core.dom.rewrite.ASTRewrite;</TD></TR><TR><TD CLASS="l">43</TD><TD>import org.eclipse.wst.jsdt.core.dom.rewrite.ITrackedNodePosition;</TD></TR><TR><TD CLASS="l">44</TD><TD>import org.eclipse.wst.jsdt.core.dom.rewrite.ImportRewrite;</TD></TR><TR><TD CLASS="l">45</TD><TD>import org.eclipse.wst.jsdt.core.dom.rewrite.ListRewrite;</TD></TR><TR><TD CLASS="l">46</TD><TD>import org.eclipse.wst.jsdt.internal.corext.codemanipulation.StubUtility;</TD></TR><TR><TD CLASS="l">47</TD><TD>import org.eclipse.wst.jsdt.internal.corext.dom.ASTNodes;</TD></TR><TR><TD CLASS="l">48</TD><TD>import org.eclipse.wst.jsdt.internal.corext.dom.GenericVisitor;</TD></TR><TR><TD CLASS="l">49</TD><TD>import org.eclipse.wst.jsdt.internal.corext.dom.LocalVariableIndex;</TD></TR><TR><TD CLASS="l">50</TD><TD>import org.eclipse.wst.jsdt.internal.corext.dom.ModifierRewrite;</TD></TR><TR><TD CLASS="l">51</TD><TD>import org.eclipse.wst.jsdt.internal.corext.dom.Selection;</TD></TR><TR><TD CLASS="l">52</TD><TD>import org.eclipse.wst.jsdt.internal.corext.dom.VariableDeclarationRewrite;</TD></TR><TR><TD CLASS="l">53</TD><TD>import org.eclipse.wst.jsdt.internal.corext.refactoring.code.flow.FlowContext;</TD></TR><TR><TD CLASS="l">54</TD><TD>import org.eclipse.wst.jsdt.internal.corext.refactoring.code.flow.FlowInfo;</TD></TR><TR><TD CLASS="l">55</TD><TD>import org.eclipse.wst.jsdt.internal.corext.refactoring.code.flow.InOutFlowAnalyzer;</TD></TR><TR><TD CLASS="l">56</TD><TD>import org.eclipse.wst.jsdt.internal.corext.refactoring.surround.SurroundWithAnalyzer;</TD></TR><TR><TD CLASS="l">57</TD><TD>import org.eclipse.wst.jsdt.internal.ui.javaeditor.ASTProvider;</TD></TR><TR><TD CLASS="l">58</TD><TD>import org.eclipse.wst.jsdt.ui.text.java.IInvocationContext;</TD></TR><TR><TD CLASS="l">59</TD><TD> </TD></TR><TR><TD CLASS="l">60</TD><TD>public abstract class SurroundWith {</TD></TR><TR><TD CLASS="l">61</TD><TD> </TD></TR><TR><TD CLASS="l">62</TD><TD>        private static final class SplitSelectedOperator implements ISplitOperation {</TD></TR><TR><TD CLASS="l">63</TD><TD>                </TD></TR><TR><TD CLASS="l">64</TD><TD>                private List fAccessedInside;</TD></TR><TR><TD CLASS="l">65</TD><TD>                private List fStatements;</TD></TR><TR><TD CLASS="l">66</TD><TD>                private List fAccessedAfter;</TD></TR><TR><TD CLASS="l">67</TD><TD>                private ASTRewrite fRewrite;</TD></TR><TR><TD CLASS="l"><A NAME="1a">68</A></TD><TD>                private ListRewrite fBlockRewrite;</TD></TR><TR CLASS="z"><TD CLASS="l">69</TD><TD>                private VariableDeclarationStatement fLastStatement= null;</TD></TR><TR><TD CLASS="l">70</TD><TD> </TD></TR><TR><TD CLASS="l">71</TD><TD>                public SplitSelectedOperator(List inside, List after, ListRewrite blockRewrite, ASTRewrite rewrite, List statements) {</TD></TR><TR CLASS="z"><TD CLASS="l">72</TD><TD>                        super();</TD></TR><TR CLASS="z"><TD CLASS="l">73</TD><TD>                        fAccessedInside= inside;</TD></TR><TR CLASS="z"><TD CLASS="l">74</TD><TD>                        fStatements= statements;</TD></TR><TR CLASS="z"><TD CLASS="l">75</TD><TD>                        fAccessedAfter= after;</TD></TR><TR CLASS="z"><TD CLASS="l">76</TD><TD>                        fRewrite= rewrite;</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="20">77</A></TD><TD>                        fBlockRewrite= blockRewrite;</TD></TR><TR CLASS="z"><TD CLASS="l">78</TD><TD>                }</TD></TR><TR><TD CLASS="l">79</TD><TD> </TD></TR><TR><TD CLASS="l">80</TD><TD>                public boolean needsSplit(VariableDeclarationFragment last, VariableDeclarationFragment current) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1f">81</A></TD><TD>                        return fAccessedInside.contains(last) != fAccessedInside.contains(current) || fAccessedAfter.contains(last) != fAccessedAfter.contains(current);</TD></TR><TR><TD CLASS="l">82</TD><TD>                }</TD></TR><TR><TD CLASS="l">83</TD><TD> </TD></TR><TR><TD CLASS="l">84</TD><TD>                public void initializeStatement(VariableDeclarationStatement statement, VariableDeclarationFragment current) {</TD></TR><TR CLASS="z"><TD CLASS="l">85</TD><TD>                        if (fAccessedAfter.contains(current)) {</TD></TR><TR CLASS="z"><TD CLASS="l">86</TD><TD>                                if (fAccessedInside.contains(current))</TD></TR><TR CLASS="z"><TD CLASS="l">87</TD><TD>                                        makeFinal(statement, fRewrite);</TD></TR><TR CLASS="z"><TD CLASS="l">88</TD><TD>                                handleInitializer(current);</TD></TR><TR><TD CLASS="l">89</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">90</TD><TD>                                if (fLastStatement != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">91</TD><TD>                                        fBlockRewrite.insertAfter(statement, fLastStatement, null);</TD></TR><TR><TD CLASS="l">92</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">93</TD><TD>                                fLastStatement= statement;</TD></TR><TR><TD CLASS="l">94</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">95</TD><TD>                                if (fLastStatement != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">96</TD><TD>                                        handleNewStatement(statement);</TD></TR><TR><TD CLASS="l">97</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">98</TD><TD>                                        handleStatement(statement);</TD></TR><TR CLASS="z"><TD CLASS="l">99</TD><TD>                                        fLastStatement= statement;</TD></TR><TR><TD CLASS="l">100</TD><TD>                                }</TD></TR><TR><TD CLASS="l"><A NAME="1e">101</A></TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">102</TD><TD>                }</TD></TR><TR><TD CLASS="l">103</TD><TD> </TD></TR><TR><TD CLASS="l">104</TD><TD>                protected void handleStatement(Statement statement) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1d">105</A></TD><TD>                        fStatements.add(fRewrite.createMoveTarget(statement));</TD></TR><TR CLASS="z"><TD CLASS="l">106</TD><TD>                }</TD></TR><TR><TD CLASS="l">107</TD><TD> </TD></TR><TR><TD CLASS="l">108</TD><TD>                protected void handleNewStatement(Statement statement) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1c">109</A></TD><TD>                        fStatements.add(statement);</TD></TR><TR CLASS="z"><TD CLASS="l">110</TD><TD>                }</TD></TR><TR><TD CLASS="l">111</TD><TD> </TD></TR><TR><TD CLASS="l">112</TD><TD>                protected void handleInitializer(VariableDeclarationFragment fragment) {</TD></TR><TR CLASS="z"><TD CLASS="l">113</TD><TD>                        splitOffInitializer(fStatements, fragment, fRewrite);</TD></TR><TR CLASS="z"><TD CLASS="l">114</TD><TD>                }</TD></TR><TR><TD CLASS="l">115</TD><TD> </TD></TR><TR><TD CLASS="l">116</TD><TD>        }</TD></TR><TR><TD CLASS="l">117</TD><TD> </TD></TR><TR><TD CLASS="l">118</TD><TD>        private static final class SplitUnselectedOperator implements ISplitOperation {</TD></TR><TR><TD CLASS="l">119</TD><TD> </TD></TR><TR><TD CLASS="l">120</TD><TD>                private List fAccessedInside;</TD></TR><TR><TD CLASS="l">121</TD><TD>                private ListRewrite fBlockRewrite;</TD></TR><TR><TD CLASS="l"><A NAME="21">122</A></TD><TD>                private ASTRewrite fRewrite;</TD></TR><TR><TD CLASS="l">123</TD><TD>                private VariableDeclarationStatement fLastStatement;</TD></TR><TR><TD CLASS="l">124</TD><TD> </TD></TR><TR><TD CLASS="l">125</TD><TD>                private SplitUnselectedOperator(List accessedInside, ListRewrite blockRewrite, ASTRewrite rewrite) {</TD></TR><TR CLASS="z"><TD CLASS="l">126</TD><TD>                        super();</TD></TR><TR CLASS="z"><TD CLASS="l">127</TD><TD>                        fAccessedInside= accessedInside;</TD></TR><TR CLASS="z"><TD CLASS="l">128</TD><TD>                        fBlockRewrite= blockRewrite;</TD></TR><TR CLASS="z"><TD CLASS="l">129</TD><TD>                        fRewrite= rewrite;</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="24">130</A></TD><TD>                        fLastStatement= null;</TD></TR><TR CLASS="z"><TD CLASS="l">131</TD><TD>                }</TD></TR><TR><TD CLASS="l">132</TD><TD> </TD></TR><TR><TD CLASS="l">133</TD><TD>                public boolean needsSplit(VariableDeclarationFragment last, VariableDeclarationFragment current) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="23">134</A></TD><TD>                        return fAccessedInside.contains(last) != fAccessedInside.contains(current);</TD></TR><TR><TD CLASS="l">135</TD><TD>                }</TD></TR><TR><TD CLASS="l">136</TD><TD> </TD></TR><TR><TD CLASS="l">137</TD><TD>                public void initializeStatement(VariableDeclarationStatement statement, VariableDeclarationFragment current) {</TD></TR><TR CLASS="z"><TD CLASS="l">138</TD><TD>                        if (fAccessedInside.contains(current))</TD></TR><TR CLASS="z"><TD CLASS="l">139</TD><TD>                                makeFinal(statement, fRewrite);</TD></TR><TR><TD CLASS="l">140</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">141</TD><TD>                        if (fLastStatement != null)</TD></TR><TR CLASS="z"><TD CLASS="l">142</TD><TD>                                fBlockRewrite.insertAfter(statement, fLastStatement, null);</TD></TR><TR CLASS="z"><TD CLASS="l">143</TD><TD>                        fLastStatement= statement;</TD></TR><TR CLASS="z"><TD CLASS="l">144</TD><TD>                }</TD></TR><TR><TD CLASS="l">145</TD><TD>        }</TD></TR><TR><TD CLASS="l">146</TD><TD> </TD></TR><TR><TD CLASS="l">147</TD><TD>        protected interface ISplitOperation {</TD></TR><TR><TD CLASS="l">148</TD><TD>                boolean needsSplit(VariableDeclarationFragment last, VariableDeclarationFragment current);</TD></TR><TR><TD CLASS="l">149</TD><TD>                void initializeStatement(VariableDeclarationStatement statement, VariableDeclarationFragment current);</TD></TR><TR><TD CLASS="l">150</TD><TD>        }</TD></TR><TR><TD CLASS="l">151</TD><TD> </TD></TR><TR><TD CLASS="l">152</TD><TD>        private final JavaScriptUnit fRootNode;</TD></TR><TR><TD CLASS="l">153</TD><TD>        private final Statement[] fSelectedStatements;</TD></TR><TR><TD CLASS="l"><A NAME="0">154</A></TD><TD>        private boolean fIsNewContext;</TD></TR><TR><TD CLASS="l">155</TD><TD>        private ITrackedNodePosition fFirstInsertedPosition;</TD></TR><TR><TD CLASS="l">156</TD><TD>        private ITrackedNodePosition fLastInsertedPosition;</TD></TR><TR><TD CLASS="l">157</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">158</TD><TD>        public SurroundWith(JavaScriptUnit root, Statement[] selectedStatements) {</TD></TR><TR CLASS="z"><TD CLASS="l">159</TD><TD>                fRootNode= root;</TD></TR><TR CLASS="z"><TD CLASS="l">160</TD><TD>                fSelectedStatements= selectedStatements;</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="11">161</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">162</TD><TD>        </TD></TR><TR><TD CLASS="l">163</TD><TD> </TD></TR><TR><TD CLASS="l">164</TD><TD>        public static boolean isApplicable(IInvocationContext context) throws JavaScriptModelException {</TD></TR><TR CLASS="z"><TD CLASS="l">165</TD><TD>                IJavaScriptUnit unit= context.getCompilationUnit();</TD></TR><TR CLASS="z"><TD CLASS="l">166</TD><TD>                JavaScriptUnit ast= ASTProvider.getASTProvider().getAST(unit, ASTProvider.WAIT_NO, null);</TD></TR><TR CLASS="z"><TD CLASS="l">167</TD><TD>                if (ast == null)</TD></TR><TR CLASS="z"><TD CLASS="l">168</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">169</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">170</TD><TD>                Selection selection= Selection.createFromStartLength(context.getSelectionOffset(), context.getSelectionLength());</TD></TR><TR CLASS="z"><TD CLASS="l">171</TD><TD>                SurroundWithAnalyzer analyzer= new SurroundWithAnalyzer(unit, selection);</TD></TR><TR CLASS="z"><TD CLASS="l">172</TD><TD>                context.getASTRoot().accept(analyzer);</TD></TR><TR><TD CLASS="l">173</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">174</TD><TD>                return analyzer.getStatus().isOK() &amp;&amp; analyzer.hasSelectedNodes();</TD></TR><TR><TD CLASS="l">175</TD><TD>    }</TD></TR><TR><TD CLASS="l">176</TD><TD> </TD></TR><TR><TD CLASS="l">177</TD><TD>        /**</TD></TR><TR><TD CLASS="l">178</TD><TD>         * Selected nodes in &lt;code&gt;context&lt;/code&gt; under &lt;code&gt;selection&lt;/code&gt; or null if no valid selection.</TD></TR><TR><TD CLASS="l">179</TD><TD>         * @param context The context in which the proposal is applyed.</TD></TR><TR><TD CLASS="l"><A NAME="d">180</A></TD><TD>         * @return Selected nodes or null if no valid selection.</TD></TR><TR><TD CLASS="l">181</TD><TD>         * @throws JavaScriptModelException</TD></TR><TR><TD CLASS="l">182</TD><TD>         */</TD></TR><TR><TD CLASS="l">183</TD><TD>        public static Statement[] getSelectedStatements(IInvocationContext context) throws JavaScriptModelException {</TD></TR><TR CLASS="z"><TD CLASS="l">184</TD><TD>                Selection selection= Selection.createFromStartLength(context.getSelectionOffset(), context.getSelectionLength());</TD></TR><TR CLASS="z"><TD CLASS="l">185</TD><TD>                SurroundWithAnalyzer analyzer= new SurroundWithAnalyzer(context.getCompilationUnit(), selection);</TD></TR><TR CLASS="z"><TD CLASS="l">186</TD><TD>                context.getASTRoot().accept(analyzer);</TD></TR><TR><TD CLASS="l">187</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">188</TD><TD>                if (!analyzer.getStatus().isOK() || !analyzer.hasSelectedNodes()) {</TD></TR><TR CLASS="z"><TD CLASS="l">189</TD><TD>                        return null;</TD></TR><TR><TD CLASS="l">190</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">191</TD><TD>                        return analyzer.getSelectedStatements();</TD></TR><TR><TD CLASS="l"><A NAME="7">192</A></TD><TD>                }</TD></TR><TR><TD CLASS="l">193</TD><TD>        }</TD></TR><TR><TD CLASS="l">194</TD><TD>        </TD></TR><TR><TD CLASS="l">195</TD><TD>        public int getBodyStart() {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="6">196</A></TD><TD>                return fFirstInsertedPosition.getStartPosition();</TD></TR><TR><TD CLASS="l">197</TD><TD>        }</TD></TR><TR><TD CLASS="l">198</TD><TD> </TD></TR><TR><TD CLASS="l">199</TD><TD>        public int getBodyLength() {</TD></TR><TR CLASS="z"><TD CLASS="l">200</TD><TD>                return fLastInsertedPosition.getStartPosition() + fLastInsertedPosition.getLength() - getBodyStart();</TD></TR><TR><TD CLASS="l">201</TD><TD>        }</TD></TR><TR><TD CLASS="l">202</TD><TD> </TD></TR><TR><TD CLASS="l">203</TD><TD>        /**</TD></TR><TR><TD CLASS="l">204</TD><TD>         * Returns the rewriter to be used.</TD></TR><TR><TD CLASS="l"><A NAME="a">205</A></TD><TD>         * @return Returns the rewriter to be used.</TD></TR><TR><TD CLASS="l">206</TD><TD>         * @throws CoreException A core exception is thrown when the could not be created.</TD></TR><TR><TD CLASS="l">207</TD><TD>         */</TD></TR><TR><TD CLASS="l">208</TD><TD>        public ASTRewrite getRewrite() throws CoreException {</TD></TR><TR CLASS="z"><TD CLASS="l">209</TD><TD>                Statement[] selectedStatements= fSelectedStatements;</TD></TR><TR CLASS="z"><TD CLASS="l">210</TD><TD>                AST ast= getAst();</TD></TR><TR><TD CLASS="l">211</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">212</TD><TD>                ASTRewrite rewrite= ASTRewrite.create(ast);</TD></TR><TR><TD CLASS="l">213</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">214</TD><TD>                BodyDeclaration enclosingBodyDeclaration= (BodyDeclaration)ASTNodes.getParent(selectedStatements[0], BodyDeclaration.class);</TD></TR><TR CLASS="z"><TD CLASS="l">215</TD><TD>                int maxVariableId= LocalVariableIndex.perform(enclosingBodyDeclaration) + 1;</TD></TR><TR><TD CLASS="l">216</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">217</TD><TD>                fIsNewContext= isNewContext();</TD></TR><TR><TD CLASS="l">218</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">219</TD><TD>                List accessedAfter= getVariableDeclarationsAccessedAfter(selectedStatements[selectedStatements.length - 1], maxVariableId);</TD></TR><TR><TD CLASS="l">220</TD><TD>                List readInside;</TD></TR><TR CLASS="z"><TD CLASS="l">221</TD><TD>                readInside= getVariableDeclarationReadsInside(selectedStatements, maxVariableId);</TD></TR><TR><TD CLASS="l">222</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">223</TD><TD>                List inserted= new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">224</TD><TD>                moveToBlock(selectedStatements, inserted, accessedAfter, readInside, rewrite);</TD></TR><TR CLASS="z"><TD CLASS="l">225</TD><TD>                if (fIsNewContext) {</TD></TR><TR CLASS="z"><TD CLASS="l">226</TD><TD>                        ImportRewrite importRewrite= StubUtility.createImportRewrite((JavaScriptUnit)selectedStatements[0].getRoot(), false);</TD></TR><TR CLASS="z"><TD CLASS="l">227</TD><TD>                        for (int i= 0; i &lt; selectedStatements.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">228</TD><TD>                                qualifyThisExpressions(selectedStatements[i], rewrite, importRewrite);</TD></TR><TR><TD CLASS="l">229</TD><TD>                        }</TD></TR><TR><TD CLASS="l">230</TD><TD>                }</TD></TR><TR><TD CLASS="l">231</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">232</TD><TD>                if (selectedStatements.length == 1 &amp;&amp; ASTNodes.isControlStatementBody(selectedStatements[0].getLocationInParent())) {</TD></TR><TR CLASS="z"><TD CLASS="l">233</TD><TD>                        Block wrap= ast.newBlock();</TD></TR><TR CLASS="z"><TD CLASS="l">234</TD><TD>                        rewrite.replace(selectedStatements[0], wrap, null);</TD></TR><TR CLASS="z"><TD CLASS="l">235</TD><TD>                        ListRewrite listRewrite= rewrite.getListRewrite(wrap, Block.STATEMENTS_PROPERTY);</TD></TR><TR><TD CLASS="l">236</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">237</TD><TD>                        for (Iterator iterator= inserted.iterator(); iterator.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">238</TD><TD>                                ASTNode node= (ASTNode)iterator.next();</TD></TR><TR CLASS="z"><TD CLASS="l">239</TD><TD>                                listRewrite.insertLast(node, null);</TD></TR><TR><TD CLASS="l">240</TD><TD>                        }</TD></TR><TR><TD CLASS="l">241</TD><TD>                        </TD></TR><TR><TD CLASS="l">242</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">243</TD><TD>                        ListRewrite listRewrite= getListRewrite(selectedStatements[0], rewrite);</TD></TR><TR><TD CLASS="l">244</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">245</TD><TD>                        ASTNode current= selectedStatements[selectedStatements.length - 1];</TD></TR><TR CLASS="z"><TD CLASS="l">246</TD><TD>                        for (Iterator iterator= inserted.iterator(); iterator.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">247</TD><TD>                                ASTNode node= (ASTNode)iterator.next();</TD></TR><TR CLASS="z"><TD CLASS="l">248</TD><TD>                                listRewrite.insertAfter(node, current, null);</TD></TR><TR CLASS="z"><TD CLASS="l">249</TD><TD>                                current= node;</TD></TR><TR><TD CLASS="l">250</TD><TD>                        }</TD></TR><TR><TD CLASS="l">251</TD><TD>                }</TD></TR><TR><TD CLASS="l">252</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">253</TD><TD>                fFirstInsertedPosition= rewrite.track((ASTNode)inserted.get(0));</TD></TR><TR CLASS="z"><TD CLASS="l">254</TD><TD>                fLastInsertedPosition= rewrite.track((ASTNode)inserted.get(inserted.size() - 1));</TD></TR><TR><TD CLASS="l">255</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">256</TD><TD>                return rewrite;</TD></TR><TR><TD CLASS="l">257</TD><TD>        }</TD></TR><TR><TD CLASS="l">258</TD><TD>        </TD></TR><TR><TD CLASS="l">259</TD><TD>        </TD></TR><TR><TD CLASS="l">260</TD><TD>        /**</TD></TR><TR><TD CLASS="l">261</TD><TD>         * @return true if the code will be moved to a new context?</TD></TR><TR><TD CLASS="l">262</TD><TD>         */</TD></TR><TR><TD CLASS="l">263</TD><TD>        protected abstract boolean isNewContext();</TD></TR><TR><TD CLASS="l">264</TD><TD> </TD></TR><TR><TD CLASS="l">265</TD><TD>        /**</TD></TR><TR><TD CLASS="l">266</TD><TD>         * List of VariableDeclaration of variables which are read in &lt;code&gt;selectedNodes&lt;/code&gt;.</TD></TR><TR><TD CLASS="l">267</TD><TD>         * </TD></TR><TR><TD CLASS="l">268</TD><TD>         * @param maxVariableId Maximum number of variable declarations block</TD></TR><TR><TD CLASS="l"><A NAME="e">269</A></TD><TD>         * @param selectedNodes The selectedNodes</TD></TR><TR><TD CLASS="l">270</TD><TD>         * @return        List of VariableDeclaration</TD></TR><TR><TD CLASS="l">271</TD><TD>         */</TD></TR><TR><TD CLASS="l">272</TD><TD>        protected List getVariableDeclarationReadsInside(Statement[] selectedNodes, int maxVariableId) {</TD></TR><TR CLASS="z"><TD CLASS="l">273</TD><TD>                ArrayList result= new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">274</TD><TD>                if (!fIsNewContext)</TD></TR><TR CLASS="z"><TD CLASS="l">275</TD><TD>                        return result;</TD></TR><TR><TD CLASS="l">276</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">277</TD><TD>                IVariableBinding[] reads= getReads(selectedNodes, maxVariableId);</TD></TR><TR CLASS="z"><TD CLASS="l">278</TD><TD>                for (int i= 0; i &lt; reads.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">279</TD><TD>                        IVariableBinding read= reads[i];</TD></TR><TR CLASS="z"><TD CLASS="l">280</TD><TD>                        if (!read.isField()) {</TD></TR><TR CLASS="z"><TD CLASS="l">281</TD><TD>                                ASTNode readDecl= getRootNode().findDeclaringNode(read);</TD></TR><TR CLASS="z"><TD CLASS="l">282</TD><TD>                                if (readDecl instanceof VariableDeclaration) {</TD></TR><TR CLASS="z"><TD CLASS="l">283</TD><TD>                                        result.add(readDecl);</TD></TR><TR><TD CLASS="l">284</TD><TD>                                }</TD></TR><TR><TD CLASS="l">285</TD><TD>                        }</TD></TR><TR><TD CLASS="l">286</TD><TD>                }</TD></TR><TR><TD CLASS="l">287</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">288</TD><TD>                return result;</TD></TR><TR><TD CLASS="l">289</TD><TD>        }</TD></TR><TR><TD CLASS="l">290</TD><TD> </TD></TR><TR><TD CLASS="l">291</TD><TD>        /**</TD></TR><TR><TD CLASS="l">292</TD><TD>         * List of VariableDeclarationFragments which are accessed after &lt;code&gt;startNode&lt;/code&gt;.</TD></TR><TR><TD CLASS="l">293</TD><TD>         * </TD></TR><TR><TD CLASS="l">294</TD><TD>         * @param startNode The node after to inspect</TD></TR><TR><TD CLASS="l">295</TD><TD>         * @param maxVariableId The maximum number of variable declarations</TD></TR><TR><TD CLASS="l">296</TD><TD>         * @return List of VariableDeclarationFragments which can't be moved to the new block</TD></TR><TR><TD CLASS="l"><A NAME="f">297</A></TD><TD>         */</TD></TR><TR><TD CLASS="l">298</TD><TD>        protected List getVariableDeclarationsAccessedAfter(ASTNode startNode, int maxVariableId) {</TD></TR><TR><TD CLASS="l">299</TD><TD>        </TD></TR><TR><TD CLASS="l">300</TD><TD>                List statements;</TD></TR><TR CLASS="z"><TD CLASS="l">301</TD><TD>                if (startNode.getLocationInParent() == SwitchStatement.STATEMENTS_PROPERTY) {</TD></TR><TR CLASS="z"><TD CLASS="l">302</TD><TD>                        SwitchStatement block= (SwitchStatement)ASTNodes.getParent(startNode, SwitchStatement.class);</TD></TR><TR CLASS="z"><TD CLASS="l">303</TD><TD>                        statements= block.statements();</TD></TR><TR><TD CLASS="l">304</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">305</TD><TD>                        Block block= (Block)ASTNodes.getParent(startNode, Block.class);</TD></TR><TR CLASS="z"><TD CLASS="l">306</TD><TD>                        statements= block.statements();</TD></TR><TR><TD CLASS="l">307</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">308</TD><TD>                List bodyAfterSelection= statements.subList(statements.indexOf(startNode) + 1, statements.size());</TD></TR><TR><TD CLASS="l">309</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">310</TD><TD>                List result= new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">311</TD><TD>                if (!bodyAfterSelection.isEmpty()) {</TD></TR><TR><TD CLASS="l">312</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">313</TD><TD>                        IVariableBinding[] accesses= getAccesses((ASTNode[]) bodyAfterSelection.toArray(new ASTNode[bodyAfterSelection.size()]), maxVariableId);</TD></TR><TR><TD CLASS="l">314</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">315</TD><TD>                        for (int i= 0; i &lt; accesses.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">316</TD><TD>                                IVariableBinding curVar= accesses[i];</TD></TR><TR CLASS="z"><TD CLASS="l">317</TD><TD>                                if (!curVar.isField()) {</TD></TR><TR CLASS="z"><TD CLASS="l">318</TD><TD>                                        ASTNode readDecl= ASTNodes.findDeclaration(curVar, getRootNode());</TD></TR><TR CLASS="z"><TD CLASS="l">319</TD><TD>                                        if (readDecl instanceof VariableDeclarationFragment) {</TD></TR><TR CLASS="z"><TD CLASS="l">320</TD><TD>                                                result.add(readDecl);</TD></TR><TR><TD CLASS="l">321</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">322</TD><TD>                                }</TD></TR><TR><TD CLASS="l">323</TD><TD>                        }</TD></TR><TR><TD CLASS="l">324</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">325</TD><TD>                return result;</TD></TR><TR><TD CLASS="l">326</TD><TD>        }</TD></TR><TR><TD CLASS="l">327</TD><TD> </TD></TR><TR><TD CLASS="l">328</TD><TD>        /**</TD></TR><TR><TD CLASS="l">329</TD><TD>         * @param region The region to inspect</TD></TR><TR><TD CLASS="l"><A NAME="9">330</A></TD><TD>         * @param maxVariableId Max number of variables in region</TD></TR><TR><TD CLASS="l">331</TD><TD>         * @return All variables with read access in region</TD></TR><TR><TD CLASS="l">332</TD><TD>         */</TD></TR><TR><TD CLASS="l">333</TD><TD>        private IVariableBinding[] getReads(ASTNode[] region, int maxVariableId) {</TD></TR><TR CLASS="z"><TD CLASS="l">334</TD><TD>                FlowContext flowContext= new FlowContext(0, maxVariableId);</TD></TR><TR CLASS="z"><TD CLASS="l">335</TD><TD>                flowContext.setConsiderAccessMode(true);</TD></TR><TR CLASS="z"><TD CLASS="l">336</TD><TD>                flowContext.setComputeMode(FlowContext.ARGUMENTS);</TD></TR><TR CLASS="z"><TD CLASS="l">337</TD><TD>                FlowInfo argInfo= new InOutFlowAnalyzer(flowContext).perform(region);</TD></TR><TR CLASS="z"><TD CLASS="l">338</TD><TD>                IVariableBinding[] reads= argInfo.get(flowContext, FlowInfo.READ | FlowInfo.READ_POTENTIAL | FlowInfo.UNKNOWN);</TD></TR><TR CLASS="z"><TD CLASS="l">339</TD><TD>                return reads;</TD></TR><TR><TD CLASS="l">340</TD><TD>        }</TD></TR><TR><TD CLASS="l">341</TD><TD> </TD></TR><TR><TD CLASS="l">342</TD><TD>        /**</TD></TR><TR><TD CLASS="l">343</TD><TD>         * @param region The region to inspect</TD></TR><TR><TD CLASS="l"><A NAME="4">344</A></TD><TD>         * @param maxVariableId Max number of variables in region</TD></TR><TR><TD CLASS="l">345</TD><TD>         * @return All variables with read or write access in region</TD></TR><TR><TD CLASS="l">346</TD><TD>         */</TD></TR><TR><TD CLASS="l">347</TD><TD>        private IVariableBinding[] getAccesses(ASTNode[] region, int maxVariableId) {</TD></TR><TR CLASS="z"><TD CLASS="l">348</TD><TD>                FlowContext flowContext= new FlowContext(0, maxVariableId);</TD></TR><TR CLASS="z"><TD CLASS="l">349</TD><TD>                flowContext.setConsiderAccessMode(true);</TD></TR><TR CLASS="z"><TD CLASS="l">350</TD><TD>                flowContext.setComputeMode(FlowContext.ARGUMENTS);</TD></TR><TR CLASS="z"><TD CLASS="l">351</TD><TD>                FlowInfo argInfo= new InOutFlowAnalyzer(flowContext).perform(region);</TD></TR><TR CLASS="z"><TD CLASS="l">352</TD><TD>                IVariableBinding[] varsAccessedAfter= argInfo.get(flowContext, FlowInfo.READ | FlowInfo.READ_POTENTIAL  | FlowInfo.WRITE | FlowInfo.WRITE_POTENTIAL | FlowInfo.UNKNOWN);</TD></TR><TR CLASS="z"><TD CLASS="l">353</TD><TD>                return varsAccessedAfter;</TD></TR><TR><TD CLASS="l">354</TD><TD>        }</TD></TR><TR><TD CLASS="l">355</TD><TD> </TD></TR><TR><TD CLASS="l">356</TD><TD>        /**</TD></TR><TR><TD CLASS="l">357</TD><TD>         * Moves the nodes in toMove to &lt;code&gt;block&lt;/block&gt; except the VariableDeclarationFragments</TD></TR><TR><TD CLASS="l">358</TD><TD>         * in &lt;code&gt;accessedAfter&lt;/code&gt;. The initializers (if any) of variable declarations</TD></TR><TR><TD CLASS="l">359</TD><TD>         * in &lt;code&gt;accessedAfter&lt;/code&gt; are moved to the block if the variable declaration is</TD></TR><TR><TD CLASS="l">360</TD><TD>         * part of &lt;code&gt;toMove&lt;/code&gt;. VariableDeclarations in &lt;code&gt;accessedInside&lt;/code&gt; are </TD></TR><TR><TD CLASS="l">361</TD><TD>         * made final unless they are moved to &lt;code&gt;block&lt;/code&gt;.</TD></TR><TR><TD CLASS="l">362</TD><TD>         * </TD></TR><TR><TD CLASS="l">363</TD><TD>         * i.e. (if &lt;code&gt;i&lt;/code&gt; is element of &lt;code&gt;accessedAfter&lt;/code&gt;):</TD></TR><TR><TD CLASS="l">364</TD><TD>         * &lt;code&gt;int i= 10;&lt;/code&gt; ---&gt; &lt;code&gt;int i;&lt;/code&gt; and &lt;code&gt;{i= 10;}&lt;/code&gt;</TD></TR><TR><TD CLASS="l">365</TD><TD>         * </TD></TR><TR><TD CLASS="l">366</TD><TD>         * Declarations with more then one fragments are splited if required. i.e.:</TD></TR><TR><TD CLASS="l">367</TD><TD>         * &lt;code&gt;int i,j,k;&lt;/code&gt; ---&gt; &lt;code&gt;int i,j; final int k;&lt;/code&gt; </TD></TR><TR><TD CLASS="l">368</TD><TD>         * </TD></TR><TR><TD CLASS="l">369</TD><TD>         * @param toMove Nodes to be moved to block</TD></TR><TR><TD CLASS="l">370</TD><TD>         * @param statements List to move to.</TD></TR><TR><TD CLASS="l">371</TD><TD>         * @param accessedAfter VariableDeclarationFragments which can not be moved to block</TD></TR><TR><TD CLASS="l">372</TD><TD>         * @param accessedInside VariableDeclaration which can be made final</TD></TR><TR><TD CLASS="l"><A NAME="13">373</A></TD><TD>         * @param rewrite The rewrite to use.</TD></TR><TR><TD CLASS="l">374</TD><TD>         */</TD></TR><TR><TD CLASS="l">375</TD><TD>        private final void moveToBlock(Statement[] toMove, List statements, final List/*&lt;VariableDeclarationFragment&gt;*/ accessedAfter, final List/*&lt;VariableDeclaration&gt;*/ accessedInside, final ASTRewrite rewrite) {</TD></TR><TR><TD CLASS="l">376</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">377</TD><TD>                for (int i= 0; i &lt; toMove.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">378</TD><TD>                        ASTNode node= toMove[i];</TD></TR><TR CLASS="z"><TD CLASS="l">379</TD><TD>                        if (node instanceof VariableDeclarationStatement) {</TD></TR><TR CLASS="z"><TD CLASS="l">380</TD><TD>                                VariableDeclarationStatement statement= (VariableDeclarationStatement)node;</TD></TR><TR CLASS="z"><TD CLASS="l">381</TD><TD>                                final ListRewrite blockRewrite= getListRewrite(statement, rewrite);</TD></TR><TR><TD CLASS="l">382</TD><TD>                                </TD></TR><TR CLASS="z"><TD CLASS="l">383</TD><TD>                                splitVariableDeclarationStatement(statement, createSplitSelectedOperator(accessedAfter, accessedInside, rewrite, statements, blockRewrite), rewrite);</TD></TR><TR><TD CLASS="l">384</TD><TD>                                </TD></TR><TR CLASS="z"><TD CLASS="l">385</TD><TD>                                for (Iterator iter= statement.fragments().iterator(); iter.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">386</TD><TD>                                        accessedInside.remove(iter.next());</TD></TR><TR><TD CLASS="l">387</TD><TD>                                }</TD></TR><TR><TD CLASS="l">388</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">389</TD><TD>                                insertNodeAtEnd(rewrite, statements, node);</TD></TR><TR><TD CLASS="l">390</TD><TD>                        }</TD></TR><TR><TD CLASS="l">391</TD><TD>                }</TD></TR><TR><TD CLASS="l">392</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">393</TD><TD>                while (!accessedInside.isEmpty()) {</TD></TR><TR CLASS="z"><TD CLASS="l">394</TD><TD>                        VariableDeclaration variableDeclaration= (VariableDeclaration)accessedInside.get(0);</TD></TR><TR CLASS="z"><TD CLASS="l">395</TD><TD>                        if (variableDeclaration instanceof SingleVariableDeclaration) {</TD></TR><TR CLASS="z"><TD CLASS="l">396</TD><TD>                                if (ASTNodes.findModifierNode(Modifier.FINAL, ASTNodes.getModifiers(variableDeclaration)) == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">397</TD><TD>                                        ModifierRewrite.create(rewrite, variableDeclaration).setModifiers(Modifier.FINAL, Modifier.NONE, null);</TD></TR><TR><TD CLASS="l">398</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">399</TD><TD>                                accessedInside.remove(0);</TD></TR><TR CLASS="z"><TD CLASS="l">400</TD><TD>                        } else if (variableDeclaration.getParent() instanceof VariableDeclarationStatement) {</TD></TR><TR CLASS="z"><TD CLASS="l">401</TD><TD>                                VariableDeclarationStatement statement= (VariableDeclarationStatement)variableDeclaration.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">402</TD><TD>                                final ListRewrite blockRewrite= getListRewrite(statement, rewrite);</TD></TR><TR><TD CLASS="l">403</TD><TD>                                </TD></TR><TR CLASS="z"><TD CLASS="l">404</TD><TD>                                splitVariableDeclarationStatement(statement, createSplitUnselectedOperator(accessedInside, rewrite, blockRewrite), rewrite);</TD></TR><TR><TD CLASS="l">405</TD><TD>                                </TD></TR><TR CLASS="z"><TD CLASS="l">406</TD><TD>                                for (Iterator iter= statement.fragments().iterator(); iter.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">407</TD><TD>                                        VariableDeclarationFragment fragment= (VariableDeclarationFragment)iter.next();</TD></TR><TR CLASS="z"><TD CLASS="l">408</TD><TD>                                        accessedInside.remove(fragment);</TD></TR><TR><TD CLASS="l">409</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">410</TD><TD>                        } else if (variableDeclaration.getParent() instanceof VariableDeclarationExpression) {</TD></TR><TR CLASS="z"><TD CLASS="l">411</TD><TD>                                VariableDeclarationExpression expression= (VariableDeclarationExpression)variableDeclaration.getParent();</TD></TR><TR><TD CLASS="l">412</TD><TD>                                </TD></TR><TR CLASS="z"><TD CLASS="l">413</TD><TD>                                VariableDeclarationRewrite.rewriteModifiers(expression, Modifier.FINAL, 0, rewrite, null);</TD></TR><TR><TD CLASS="l">414</TD><TD>                                </TD></TR><TR CLASS="z"><TD CLASS="l">415</TD><TD>                                for (Iterator iter= expression.fragments().iterator(); iter.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">416</TD><TD>                                        VariableDeclarationFragment fragment= (VariableDeclarationFragment)iter.next();</TD></TR><TR CLASS="z"><TD CLASS="l">417</TD><TD>                                        accessedInside.remove(fragment);</TD></TR><TR><TD CLASS="l">418</TD><TD>                                }</TD></TR><TR><TD CLASS="l">419</TD><TD>                        }</TD></TR><TR><TD CLASS="l"><A NAME="10">420</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">421</TD><TD>        }</TD></TR><TR><TD CLASS="l">422</TD><TD> </TD></TR><TR><TD CLASS="l">423</TD><TD>        private void insertNodeAtEnd(final ASTRewrite rewrite, final List statements, ASTNode node) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="3">424</A></TD><TD>                statements.add(rewrite.createMoveTarget(node));</TD></TR><TR CLASS="z"><TD CLASS="l">425</TD><TD>        }</TD></TR><TR><TD CLASS="l">426</TD><TD> </TD></TR><TR><TD CLASS="l">427</TD><TD>        protected ISplitOperation createSplitUnselectedOperator(List accessedInside, ASTRewrite rewrite, ListRewrite blockRewrite) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="2">428</A></TD><TD>                return new SplitUnselectedOperator(accessedInside, blockRewrite, rewrite);</TD></TR><TR><TD CLASS="l">429</TD><TD>        }</TD></TR><TR><TD CLASS="l">430</TD><TD> </TD></TR><TR><TD CLASS="l">431</TD><TD>        protected ISplitOperation createSplitSelectedOperator(List accessedAfter, List accessedInside, ASTRewrite rewrite, List statements, ListRewrite blockRewrite) {</TD></TR><TR CLASS="z"><TD CLASS="l">432</TD><TD>                return new SplitSelectedOperator(accessedInside, accessedAfter, blockRewrite, rewrite, statements);</TD></TR><TR><TD CLASS="l">433</TD><TD>        }</TD></TR><TR><TD CLASS="l">434</TD><TD> </TD></TR><TR><TD CLASS="l">435</TD><TD>        /**</TD></TR><TR><TD CLASS="l">436</TD><TD>         * Split the fragments in &lt;code&gt;statement&lt;/code&gt; to multiple VariableDeclarationStatements whenever</TD></TR><TR><TD CLASS="l">437</TD><TD>         * &lt;code&gt;splitOperator.needsSplit&lt;/code&gt; returns &lt;code&gt;true&lt;/code&gt;.</TD></TR><TR><TD CLASS="l">438</TD><TD>         * i.e.:</TD></TR><TR><TD CLASS="l">439</TD><TD>         * int i, j; ---&gt; int i; int j; (if splitOperator.needsSplit(i, j) == true)</TD></TR><TR><TD CLASS="l">440</TD><TD>         * </TD></TR><TR><TD CLASS="l">441</TD><TD>         * @param statement The VariableDeclarationStatement to split</TD></TR><TR><TD CLASS="l">442</TD><TD>         * @param splitOperator The operator to use to split</TD></TR><TR><TD CLASS="l"><A NAME="16">443</A></TD><TD>         * @param rewrite The rewriter to use to generate new VariableDeclarationStatements.</TD></TR><TR><TD CLASS="l">444</TD><TD>         */</TD></TR><TR><TD CLASS="l">445</TD><TD>        private void splitVariableDeclarationStatement(VariableDeclarationStatement statement, ISplitOperation splitOperator, ASTRewrite rewrite) {</TD></TR><TR><TD CLASS="l">446</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">447</TD><TD>                List fragments= statement.fragments();</TD></TR><TR CLASS="z"><TD CLASS="l">448</TD><TD>                Iterator iter= fragments.iterator();</TD></TR><TR CLASS="z"><TD CLASS="l">449</TD><TD>                VariableDeclarationFragment lastFragment= (VariableDeclarationFragment)iter.next();</TD></TR><TR CLASS="z"><TD CLASS="l">450</TD><TD>                VariableDeclarationStatement lastStatement= statement;</TD></TR><TR><TD CLASS="l">451</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">452</TD><TD>                splitOperator.initializeStatement(lastStatement, lastFragment);</TD></TR><TR><TD CLASS="l">453</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">454</TD><TD>                ListRewrite fragmentsRewrite= null;</TD></TR><TR CLASS="z"><TD CLASS="l">455</TD><TD>                while (iter.hasNext()) {</TD></TR><TR CLASS="z"><TD CLASS="l">456</TD><TD>                        VariableDeclarationFragment currentFragment= (VariableDeclarationFragment)iter.next();</TD></TR><TR><TD CLASS="l">457</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">458</TD><TD>                        if (splitOperator.needsSplit(lastFragment, currentFragment)) {</TD></TR><TR><TD CLASS="l">459</TD><TD>                                        </TD></TR><TR CLASS="z"><TD CLASS="l">460</TD><TD>                                        VariableDeclarationStatement newStatement= getAst().newVariableDeclarationStatement((VariableDeclarationFragment)rewrite.createMoveTarget(currentFragment));</TD></TR><TR><TD CLASS="l">461</TD><TD>                                        </TD></TR><TR CLASS="z"><TD CLASS="l">462</TD><TD>                                        ListRewrite modifierRewrite= rewrite.getListRewrite(newStatement, VariableDeclarationStatement.MODIFIERS2_PROPERTY);</TD></TR><TR CLASS="z"><TD CLASS="l">463</TD><TD>                                        for (Iterator iterator= statement.modifiers().iterator(); iterator.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">464</TD><TD>                                                modifierRewrite.insertLast(rewrite.createCopyTarget((ASTNode)iterator.next()), null);</TD></TR><TR><TD CLASS="l">465</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">466</TD><TD>                                        </TD></TR><TR CLASS="z"><TD CLASS="l">467</TD><TD>                                        newStatement.setType((Type)rewrite.createCopyTarget(statement.getType()));</TD></TR><TR><TD CLASS="l">468</TD><TD>                                        </TD></TR><TR CLASS="z"><TD CLASS="l">469</TD><TD>                                        splitOperator.initializeStatement(newStatement, currentFragment);</TD></TR><TR><TD CLASS="l">470</TD><TD>                                        </TD></TR><TR CLASS="z"><TD CLASS="l">471</TD><TD>                                        fragmentsRewrite= rewrite.getListRewrite(newStatement, VariableDeclarationStatement.FRAGMENTS_PROPERTY);</TD></TR><TR><TD CLASS="l">472</TD><TD>                                        </TD></TR><TR CLASS="z"><TD CLASS="l">473</TD><TD>                                        lastStatement= newStatement;</TD></TR><TR CLASS="z"><TD CLASS="l">474</TD><TD>                        } else if (fragmentsRewrite != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">475</TD><TD>                                ASTNode fragment0= rewrite.createMoveTarget(currentFragment);</TD></TR><TR CLASS="z"><TD CLASS="l">476</TD><TD>                                fragmentsRewrite.insertLast(fragment0, null);</TD></TR><TR><TD CLASS="l">477</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">478</TD><TD>                        lastFragment= currentFragment;</TD></TR><TR><TD CLASS="l">479</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">480</TD><TD>        }</TD></TR><TR><TD CLASS="l">481</TD><TD> </TD></TR><TR><TD CLASS="l">482</TD><TD>        /**</TD></TR><TR><TD CLASS="l">483</TD><TD>         * Make statement final</TD></TR><TR><TD CLASS="l"><A NAME="12">484</A></TD><TD>         * @param statement</TD></TR><TR><TD CLASS="l">485</TD><TD>         * @param rewrite</TD></TR><TR><TD CLASS="l">486</TD><TD>         */</TD></TR><TR><TD CLASS="l">487</TD><TD>        protected static void makeFinal(VariableDeclarationStatement statement, ASTRewrite rewrite) {</TD></TR><TR CLASS="z"><TD CLASS="l">488</TD><TD>                VariableDeclaration fragment= (VariableDeclaration)statement.fragments().get(0);</TD></TR><TR CLASS="z"><TD CLASS="l">489</TD><TD>                if (ASTNodes.findModifierNode(Modifier.FINAL, ASTNodes.getModifiers(fragment)) == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">490</TD><TD>                        ModifierRewrite.create(rewrite, statement).setModifiers(Modifier.FINAL, Modifier.NONE, null);</TD></TR><TR><TD CLASS="l"><A NAME="14">491</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">492</TD><TD>        }</TD></TR><TR><TD CLASS="l">493</TD><TD>        </TD></TR><TR><TD CLASS="l">494</TD><TD>        private void qualifyThisExpressions(ASTNode node, final ASTRewrite rewrite, final ImportRewrite importRewrite) {</TD></TR><TR CLASS="z"><TD CLASS="l">495</TD><TD>                node.accept(new GenericVisitor() {</TD></TR><TR><TD CLASS="l"><A NAME="19">496</A></TD><TD>                        /**</TD></TR><TR><TD CLASS="l">497</TD><TD>                         * {@inheritDoc}</TD></TR><TR><TD CLASS="l">498</TD><TD>                         */</TD></TR><TR><TD CLASS="l">499</TD><TD>                        public boolean visit(ThisExpression thisExpr) {</TD></TR><TR CLASS="z"><TD CLASS="l">500</TD><TD>                                if (thisExpr.getQualifier() == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">501</TD><TD>                                        ITypeBinding typeBinding= thisExpr.resolveTypeBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">502</TD><TD>                                        if (typeBinding != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">503</TD><TD>                                                IJavaScriptElement javaElement= typeBinding.getJavaElement();</TD></TR><TR CLASS="z"><TD CLASS="l">504</TD><TD>                                                if (javaElement instanceof IType) {</TD></TR><TR CLASS="z"><TD CLASS="l">505</TD><TD>                                                        String typeName= ((IType)javaElement).getElementName();</TD></TR><TR CLASS="z"><TD CLASS="l">506</TD><TD>                                                        SimpleName simpleName= thisExpr.getAST().newSimpleName(typeName);</TD></TR><TR CLASS="z"><TD CLASS="l">507</TD><TD>                                                        rewrite.set(thisExpr, ThisExpression.QUALIFIER_PROPERTY, simpleName, null);        </TD></TR><TR><TD CLASS="l">508</TD><TD>                                                }</TD></TR><TR><TD CLASS="l">509</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">510</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">511</TD><TD>                                return super.visit(thisExpr);</TD></TR><TR><TD CLASS="l">512</TD><TD>                        }</TD></TR><TR><TD CLASS="l">513</TD><TD>                });</TD></TR><TR CLASS="z"><TD CLASS="l">514</TD><TD>        }</TD></TR><TR><TD CLASS="l">515</TD><TD>        </TD></TR><TR><TD CLASS="l">516</TD><TD>        /**</TD></TR><TR><TD CLASS="l">517</TD><TD>         * Split off initializer in &lt;code&gt;fragment&lt;/code&gt; (if any) and add it as a new expression at the end of &lt;code&gt;statements&lt;/code&gt;.</TD></TR><TR><TD CLASS="l">518</TD><TD>         * @param statements The home of the new expression.</TD></TR><TR><TD CLASS="l"><A NAME="15">519</A></TD><TD>         * @param fragment The fragment to split.</TD></TR><TR><TD CLASS="l">520</TD><TD>         * @param rewrite The rewrite to use.</TD></TR><TR><TD CLASS="l">521</TD><TD>         */</TD></TR><TR><TD CLASS="l">522</TD><TD>        protected static void splitOffInitializer(List statements, VariableDeclarationFragment fragment, ASTRewrite rewrite) {</TD></TR><TR CLASS="z"><TD CLASS="l">523</TD><TD>                Expression initializer= fragment.getInitializer();</TD></TR><TR CLASS="z"><TD CLASS="l">524</TD><TD>                if (initializer != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">525</TD><TD>                        AST ast= rewrite.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">526</TD><TD>                        Assignment assignment= ast.newAssignment();</TD></TR><TR CLASS="z"><TD CLASS="l">527</TD><TD>                        assignment.setLeftHandSide((Expression)rewrite.createCopyTarget(fragment.getName()));</TD></TR><TR CLASS="z"><TD CLASS="l">528</TD><TD>                        assignment.setRightHandSide((Expression)rewrite.createMoveTarget(initializer));</TD></TR><TR CLASS="z"><TD CLASS="l">529</TD><TD>                        statements.add(ast.newExpressionStatement(assignment));</TD></TR><TR><TD CLASS="l">530</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">531</TD><TD>        }</TD></TR><TR><TD CLASS="l">532</TD><TD> </TD></TR><TR><TD CLASS="l">533</TD><TD>        /**</TD></TR><TR><TD CLASS="l">534</TD><TD>         * Get a list rewrite for statement sequence node is element</TD></TR><TR><TD CLASS="l">535</TD><TD>         * @param node</TD></TR><TR><TD CLASS="l"><A NAME="8">536</A></TD><TD>         * @param rewrite</TD></TR><TR><TD CLASS="l">537</TD><TD>         * @return The list rewrite</TD></TR><TR><TD CLASS="l">538</TD><TD>         */</TD></TR><TR><TD CLASS="l">539</TD><TD>        private ListRewrite getListRewrite(ASTNode node, ASTRewrite rewrite) {</TD></TR><TR CLASS="z"><TD CLASS="l">540</TD><TD>                if (node.getLocationInParent() == SwitchStatement.STATEMENTS_PROPERTY) {</TD></TR><TR CLASS="z"><TD CLASS="l">541</TD><TD>                        ASTNode block= ASTNodes.getParent(node, SwitchStatement.class);</TD></TR><TR CLASS="z"><TD CLASS="l">542</TD><TD>                        return rewrite.getListRewrite(block, SwitchStatement.STATEMENTS_PROPERTY);</TD></TR><TR><TD CLASS="l">543</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">544</TD><TD>                        ASTNode block= ASTNodes.getParent(node, Block.class);</TD></TR><TR CLASS="z"><TD CLASS="l">545</TD><TD>                        return rewrite.getListRewrite(block, Block.STATEMENTS_PROPERTY);</TD></TR><TR><TD CLASS="l"><A NAME="5">546</A></TD><TD>                }</TD></TR><TR><TD CLASS="l">547</TD><TD>        }</TD></TR><TR><TD CLASS="l">548</TD><TD> </TD></TR><TR><TD CLASS="l">549</TD><TD>        protected final AST getAst() {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="c">550</A></TD><TD>                return getRootNode().getAST();</TD></TR><TR><TD CLASS="l">551</TD><TD>        }</TD></TR><TR><TD CLASS="l">552</TD><TD> </TD></TR><TR><TD CLASS="l">553</TD><TD>        protected final Statement[] getSelectedStatements() {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="b">554</A></TD><TD>                return fSelectedStatements;</TD></TR><TR><TD CLASS="l">555</TD><TD>        }</TD></TR><TR><TD CLASS="l">556</TD><TD> </TD></TR><TR><TD CLASS="l">557</TD><TD>        private JavaScriptUnit getRootNode() {</TD></TR><TR CLASS="z"><TD CLASS="l">558</TD><TD>                if (fSelectedStatements.length &gt; 0)</TD></TR><TR CLASS="z"><TD CLASS="l">559</TD><TD>                        return (JavaScriptUnit)fSelectedStatements[0].getRoot();</TD></TR><TR CLASS="z"><TD CLASS="l">560</TD><TD>                return fRootNode;</TD></TR><TR><TD CLASS="l">561</TD><TD>        }</TD></TR><TR><TD CLASS="l">562</TD><TD> </TD></TR><TR><TD CLASS="l">563</TD><TD>}</TD></TR></TABLE><P></P><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TD CLASS="nv">[<A HREF="../xslUnitTestCoverage.html">all classes</A>][<A HREF="177.html">org.eclipse.wst.jsdt.internal.ui.text.correction</A>]</TD></TR><TR><TD CLASS="tl"><A HREF="http://www.eclemma.org/support.html">EMMA 2.0.5312 EclEmma Fix 1</A> (C) Vladimir Roubtsov</TD></TR></TABLE></BODY></HTML>