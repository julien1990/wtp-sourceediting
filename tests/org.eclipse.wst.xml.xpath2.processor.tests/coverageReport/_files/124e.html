<HTML><HEAD><META CONTENT="text/html; charset=UTF-8" HTTP-EQUIV="Content-Type"/><TITLE>EMMA Coverage Report</TITLE><STYLE TYPE="text/css"> TABLE,TD,TH {border-style:solid; border-color:black;} TD,TH {background:white;margin:0;line-height:100%;padding-left:0.5em;padding-right:0.5em;} TD {border-width:0 1px 0 0;} TH {border-width:1px 1px 1px 0;} TR TD.h {color:red;} TABLE {border-spacing:0; border-collapse:collapse;border-width:0 0 1px 1px;} P,H1,H2,H3,TH {font-family:verdana,arial,sans-serif;font-size:10pt;} TD {font-family:courier,monospace;font-size:10pt;} TABLE.hdft {border-spacing:0;border-collapse:collapse;border-style:none;} TABLE.hdft TH,TABLE.hdft TD {border-style:none;line-height:normal;} TABLE.hdft TH.tl,TABLE.hdft TD.tl {background:#6699CC;color:white;} TABLE.hdft TD.nv {background:#6633DD;color:white;} .nv A:link {color:white;} .nv A:visited {color:white;} .nv A:active {color:yellow;} TABLE.hdft A:link {color:white;} TABLE.hdft A:visited {color:white;} TABLE.hdft A:active {color:yellow;} .in {color:#356085;} TABLE.s TD {padding-left:0.25em;padding-right:0.25em;} TABLE.s TD.l {padding-left:0.25em;padding-right:0.25em;text-align:right;background:#F0F0F0;} TABLE.s TR.z TD {background:#FF9999;} TABLE.s TR.p TD {background:#FFFF88;} TABLE.s TR.c TD {background:#CCFFCC;} A:link {color:#0000EE;text-decoration:none;} A:visited {color:#0000EE;text-decoration:none;} A:hover {color:#0000EE;text-decoration:underline;} TABLE.cn {border-width:0 0 1px 0;} TABLE.s {border-width:1px 0 1px 1px;} TD.h {color:red;border-width:0 1px 0 0;} TD.f {border-width:0 1px 0 1px;} TD.hf {color:red;border-width:0 1px 0 1px;} TH.f {border-width:1px 1px 1px 1px;} TR.cis TD {background:#F0F0F0;} TR.cis TD {border-width:1px 1px 1px 0;} TR.cis TD.h {color:red;border-width:1px 1px 1px 0;} TR.cis TD.f {border-width:1px 1px 1px 1px;} TR.cis TD.hf {color:red;border-width:1px 1px 1px 1px;} TD.b {border-style:none;background:transparent;line-height:50%;}  TD.bt {border-width:1px 0 0 0;background:transparent;line-height:50%;} TR.o TD {background:#F0F0F0;}TABLE.it {border-style:none;}TABLE.it TD,TABLE.it TH {border-style:none;}</STYLE></HEAD><BODY><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="tl"><A HREF="http://www.eclemma.org/">EMMA</A> Coverage Report (generated Tue Jun 09 19:59:05 GMT 2009)</TH></TR><TR><TD CLASS="nv">[<A HREF="../xslUnitTestCoverage.html">all classes</A>][<A HREF="177.html">org.eclipse.wst.jsdt.internal.ui.text.correction</A>]</TD></TR></TABLE><H2>COVERAGE SUMMARY FOR SOURCE FILE [<SPAN CLASS="in">UnresolvedElementsSubProcessor.java</SPAN>]</H2><TABLE CELLSPACING="0" WIDTH="100%"><TR><TH>name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD>UnresolvedElementsSubProcessor.java</TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/36)</TD><TD CLASS="h">0%   (0/4054)</TD><TD CLASS="h">0%   (0/903)</TD></TR></TABLE><H3>COVERAGE BREAKDOWN BY CLASS AND METHOD</H3><TABLE CLASS="cn" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="f">name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#0">UnresolvedElementsSubProcessor</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/36)</TD><TD CLASS="h">0%   (0/4054)</TD><TD CLASS="h">0%   (0/903)</TD></TR><TR><TD CLASS="f"><A HREF="#0">UnresolvedElementsSubProcessor (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2">addMissingCastParentsProposal (IJavaScriptUnit, FunctionInvocation, Collectio...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/124)</TD><TD CLASS="h">0%   (0/33)</TD></TR><TR><TD CLASS="f"><A HREF="#3">addNewFieldForType (IJavaScriptUnit, ITypeBinding, ITypeBinding, SimpleName, ...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/143)</TD><TD CLASS="h">0%   (0/22)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#4">addNewFieldProposals (IJavaScriptUnit, JavaScriptUnit, ITypeBinding, ITypeBin...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/61)</TD><TD CLASS="h">0%   (0/16)</TD></TR><TR><TD CLASS="f"><A HREF="#5">addNewMethodProposals (IJavaScriptUnit, JavaScriptUnit, Expression, List, boo...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/156)</TD><TD CLASS="h">0%   (0/31)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#6">addNewTypeProposals (IJavaScriptUnit, Name, int, int, Collection): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/229)</TD><TD CLASS="h">0%   (0/55)</TD></TR><TR><TD CLASS="f"><A HREF="#7">addNewVariableProposals (IJavaScriptUnit, Name, SimpleName, Collection): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/151)</TD><TD CLASS="h">0%   (0/27)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#8">addParameterMissmatchProposals (IInvocationContext, IProblemLocation, List, A...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/68)</TD><TD CLASS="h">0%   (0/16)</TD></TR><TR><TD CLASS="f"><A HREF="#9">addQualifierToOuterProposal (IInvocationContext, FunctionInvocation, IFunctio...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/101)</TD><TD CLASS="h">0%   (0/26)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#a">addSimilarTypeProposals (int, IJavaScriptUnit, Name, int, Collection): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/135)</TD><TD CLASS="h">0%   (0/27)</TD></TR><TR><TD CLASS="f"><A HREF="#b">addSimilarVariableProposals (IJavaScriptUnit, JavaScriptUnit, ITypeBinding, S...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/364)</TD><TD CLASS="h">0%   (0/86)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#c">canAssign (ITypeBinding, ITypeBinding): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#d">createSignatureChangeDescription (int [], int, ITypeBinding [], List, ITypeBi...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/56)</TD><TD CLASS="h">0%   (0/12)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#e">createTypeRefChangeFullProposal (IJavaScriptUnit, ITypeBinding, ASTNode, int)...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/43)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR><TD CLASS="f"><A HREF="#f">createTypeRefChangeProposal (IJavaScriptUnit, String, Name, int, int): CUCorr...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/132)</TD><TD CLASS="h">0%   (0/26)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#10">doEqualNumberOfParameters (IInvocationContext, ASTNode, IProblemLocation, Lis...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/471)</TD><TD CLASS="h">0%   (0/85)</TD></TR><TR><TD CLASS="f"><A HREF="#11">doMoreArguments (IInvocationContext, IProblemLocation, ASTNode, List, ITypeBi...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/275)</TD><TD CLASS="h">0%   (0/58)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#12">doMoreParameters (IInvocationContext, IProblemLocation, ASTNode, List, ITypeB...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/212)</TD><TD CLASS="h">0%   (0/44)</TD></TR><TR><TD CLASS="f"><A HREF="#13">evauateTypeKind (ASTNode, IJavaScriptProject): int</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#14">getAmbiguosTypeReferenceProposals (IInvocationContext, IProblemLocation, Coll...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/71)</TD><TD CLASS="h">0%   (0/16)</TD></TR><TR><TD CLASS="f"><A HREF="#15">getArgumentName (IJavaScriptUnit, List, int): String</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/52)</TD><TD CLASS="h">0%   (0/9)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#16">getArgumentTypes (List): ITypeBinding []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/43)</TD><TD CLASS="h">0%   (0/12)</TD></TR><TR><TD CLASS="f"><A HREF="#17">getArrayAccessProposals (IInvocationContext, IProblemLocation, Collection): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/93)</TD><TD CLASS="h">0%   (0/19)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#18">getConstructorProposals (IInvocationContext, IProblemLocation, Collection): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/169)</TD><TD CLASS="h">0%   (0/44)</TD></TR><TR><TD CLASS="f"><A HREF="#19">getMethodProposals (IInvocationContext, IProblemLocation, boolean, Collection...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/215)</TD><TD CLASS="h">0%   (0/46)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1a">getParameterTypes (List): ITypeBinding []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/45)</TD><TD CLASS="h">0%   (0/10)</TD></TR><TR><TD CLASS="f"><A HREF="#1b">getTypeNames (ITypeBinding []): String</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/28)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1c">getTypeProposals (IInvocationContext, IProblemLocation, Collection): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/96)</TD><TD CLASS="h">0%   (0/27)</TD></TR><TR><TD CLASS="f"><A HREF="#1d">getVariableProposals (IInvocationContext, IProblemLocation, IVariableBinding,...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/281)</TD><TD CLASS="h">0%   (0/83)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1e">hasFieldWithName (ITypeBinding, String): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/31)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR><TD CLASS="f"><A HREF="#1f">hasMethodWithName (ITypeBinding, String): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/31)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#20">isImplicitConstructor (IFunctionBinding, IJavaScriptUnit): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#21">isLikelyPackageName (String): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/27)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#22">isLikelyTypeName (String): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/12)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#23">isLikelyTypeParameterName (String): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/13)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#24">useExistingParentCastProposal (IJavaScriptUnit, CastExpression, Expression, S...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/109)</TD><TD CLASS="h">0%   (0/29)</TD></TR></TABLE><P></P><TABLE CLASS="s" CELLSPACING="0" WIDTH="100%"><TR><TD CLASS="l">1</TD><TD>/*******************************************************************************</TD></TR><TR><TD CLASS="l">2</TD><TD> * Copyright (c) 2000, 2008 IBM Corporation and others.</TD></TR><TR><TD CLASS="l">3</TD><TD> * All rights reserved. This program and the accompanying materials</TD></TR><TR><TD CLASS="l">4</TD><TD> * are made available under the terms of the Eclipse Public License v1.0</TD></TR><TR><TD CLASS="l">5</TD><TD> * which accompanies this distribution, and is available at</TD></TR><TR><TD CLASS="l">6</TD><TD> * http://www.eclipse.org/legal/epl-v10.html</TD></TR><TR><TD CLASS="l">7</TD><TD> *</TD></TR><TR><TD CLASS="l">8</TD><TD> * Contributors:</TD></TR><TR><TD CLASS="l">9</TD><TD> *     IBM Corporation - initial API and implementation</TD></TR><TR><TD CLASS="l">10</TD><TD> *     Renaud Waldura &amp;lt;renaud+eclipse@waldura.com&amp;gt; - New class/interface with wizard</TD></TR><TR><TD CLASS="l">11</TD><TD> *******************************************************************************/</TD></TR><TR><TD CLASS="l">12</TD><TD>package org.eclipse.wst.jsdt.internal.ui.text.correction;</TD></TR><TR><TD CLASS="l">13</TD><TD> </TD></TR><TR><TD CLASS="l">14</TD><TD>import java.util.ArrayList;</TD></TR><TR><TD CLASS="l">15</TD><TD>import java.util.Collection;</TD></TR><TR><TD CLASS="l">16</TD><TD>import java.util.HashSet;</TD></TR><TR><TD CLASS="l">17</TD><TD>import java.util.List;</TD></TR><TR><TD CLASS="l">18</TD><TD> </TD></TR><TR><TD CLASS="l">19</TD><TD>import org.eclipse.core.runtime.CoreException;</TD></TR><TR><TD CLASS="l">20</TD><TD>import org.eclipse.swt.graphics.Image;</TD></TR><TR><TD CLASS="l">21</TD><TD>import org.eclipse.ui.ISharedImages;</TD></TR><TR><TD CLASS="l">22</TD><TD>import org.eclipse.wst.jsdt.core.IJavaScriptElement;</TD></TR><TR><TD CLASS="l">23</TD><TD>import org.eclipse.wst.jsdt.core.IJavaScriptProject;</TD></TR><TR><TD CLASS="l">24</TD><TD>import org.eclipse.wst.jsdt.core.IJavaScriptUnit;</TD></TR><TR><TD CLASS="l">25</TD><TD>import org.eclipse.wst.jsdt.core.IPackageFragment;</TD></TR><TR><TD CLASS="l">26</TD><TD>import org.eclipse.wst.jsdt.core.IType;</TD></TR><TR><TD CLASS="l">27</TD><TD>import org.eclipse.wst.jsdt.core.JavaScriptModelException;</TD></TR><TR><TD CLASS="l">28</TD><TD>import org.eclipse.wst.jsdt.core.Signature;</TD></TR><TR><TD CLASS="l">29</TD><TD>import org.eclipse.wst.jsdt.core.dom.AST;</TD></TR><TR><TD CLASS="l">30</TD><TD>import org.eclipse.wst.jsdt.core.dom.ASTMatcher;</TD></TR><TR><TD CLASS="l">31</TD><TD>import org.eclipse.wst.jsdt.core.dom.ASTNode;</TD></TR><TR><TD CLASS="l">32</TD><TD>import org.eclipse.wst.jsdt.core.dom.ArrayType;</TD></TR><TR><TD CLASS="l">33</TD><TD>import org.eclipse.wst.jsdt.core.dom.Assignment;</TD></TR><TR><TD CLASS="l">34</TD><TD>import org.eclipse.wst.jsdt.core.dom.BodyDeclaration;</TD></TR><TR><TD CLASS="l">35</TD><TD>import org.eclipse.wst.jsdt.core.dom.CastExpression;</TD></TR><TR><TD CLASS="l">36</TD><TD>import org.eclipse.wst.jsdt.core.dom.ClassInstanceCreation;</TD></TR><TR><TD CLASS="l">37</TD><TD>import org.eclipse.wst.jsdt.core.dom.ConstructorInvocation;</TD></TR><TR><TD CLASS="l">38</TD><TD>import org.eclipse.wst.jsdt.core.dom.Expression;</TD></TR><TR><TD CLASS="l">39</TD><TD>import org.eclipse.wst.jsdt.core.dom.FieldAccess;</TD></TR><TR><TD CLASS="l">40</TD><TD>import org.eclipse.wst.jsdt.core.dom.FunctionDeclaration;</TD></TR><TR><TD CLASS="l">41</TD><TD>import org.eclipse.wst.jsdt.core.dom.FunctionInvocation;</TD></TR><TR><TD CLASS="l">42</TD><TD>import org.eclipse.wst.jsdt.core.dom.IBinding;</TD></TR><TR><TD CLASS="l">43</TD><TD>import org.eclipse.wst.jsdt.core.dom.IFunctionBinding;</TD></TR><TR><TD CLASS="l">44</TD><TD>import org.eclipse.wst.jsdt.core.dom.IPackageBinding;</TD></TR><TR><TD CLASS="l">45</TD><TD>import org.eclipse.wst.jsdt.core.dom.ITypeBinding;</TD></TR><TR><TD CLASS="l">46</TD><TD>import org.eclipse.wst.jsdt.core.dom.IVariableBinding;</TD></TR><TR><TD CLASS="l">47</TD><TD>import org.eclipse.wst.jsdt.core.dom.JavaScriptUnit;</TD></TR><TR><TD CLASS="l">48</TD><TD>import org.eclipse.wst.jsdt.core.dom.Modifier;</TD></TR><TR><TD CLASS="l">49</TD><TD>import org.eclipse.wst.jsdt.core.dom.Name;</TD></TR><TR><TD CLASS="l">50</TD><TD>import org.eclipse.wst.jsdt.core.dom.ParenthesizedExpression;</TD></TR><TR><TD CLASS="l">51</TD><TD>import org.eclipse.wst.jsdt.core.dom.QualifiedName;</TD></TR><TR><TD CLASS="l">52</TD><TD>import org.eclipse.wst.jsdt.core.dom.SimpleName;</TD></TR><TR><TD CLASS="l">53</TD><TD>import org.eclipse.wst.jsdt.core.dom.SimpleType;</TD></TR><TR><TD CLASS="l">54</TD><TD>import org.eclipse.wst.jsdt.core.dom.StructuralPropertyDescriptor;</TD></TR><TR><TD CLASS="l">55</TD><TD>import org.eclipse.wst.jsdt.core.dom.SuperConstructorInvocation;</TD></TR><TR><TD CLASS="l">56</TD><TD>import org.eclipse.wst.jsdt.core.dom.SuperFieldAccess;</TD></TR><TR><TD CLASS="l">57</TD><TD>import org.eclipse.wst.jsdt.core.dom.SuperMethodInvocation;</TD></TR><TR><TD CLASS="l">58</TD><TD>import org.eclipse.wst.jsdt.core.dom.SwitchCase;</TD></TR><TR><TD CLASS="l">59</TD><TD>import org.eclipse.wst.jsdt.core.dom.SwitchStatement;</TD></TR><TR><TD CLASS="l">60</TD><TD>import org.eclipse.wst.jsdt.core.dom.ThisExpression;</TD></TR><TR><TD CLASS="l">61</TD><TD>import org.eclipse.wst.jsdt.core.dom.ThrowStatement;</TD></TR><TR><TD CLASS="l">62</TD><TD>import org.eclipse.wst.jsdt.core.dom.Type;</TD></TR><TR><TD CLASS="l">63</TD><TD>import org.eclipse.wst.jsdt.core.dom.TypeDeclaration;</TD></TR><TR><TD CLASS="l">64</TD><TD>import org.eclipse.wst.jsdt.core.dom.VariableDeclarationFragment;</TD></TR><TR><TD CLASS="l">65</TD><TD>import org.eclipse.wst.jsdt.core.dom.rewrite.ASTRewrite;</TD></TR><TR><TD CLASS="l">66</TD><TD>import org.eclipse.wst.jsdt.core.dom.rewrite.ImportRewrite;</TD></TR><TR><TD CLASS="l">67</TD><TD>import org.eclipse.wst.jsdt.internal.corext.codemanipulation.StubUtility;</TD></TR><TR><TD CLASS="l">68</TD><TD>import org.eclipse.wst.jsdt.internal.corext.dom.ASTNodeFactory;</TD></TR><TR><TD CLASS="l">69</TD><TD>import org.eclipse.wst.jsdt.internal.corext.dom.ASTNodes;</TD></TR><TR><TD CLASS="l">70</TD><TD>import org.eclipse.wst.jsdt.internal.corext.dom.Bindings;</TD></TR><TR><TD CLASS="l">71</TD><TD>import org.eclipse.wst.jsdt.internal.corext.dom.ScopeAnalyzer;</TD></TR><TR><TD CLASS="l">72</TD><TD>import org.eclipse.wst.jsdt.internal.corext.util.JavaModelUtil;</TD></TR><TR><TD CLASS="l">73</TD><TD>import org.eclipse.wst.jsdt.internal.corext.util.Messages;</TD></TR><TR><TD CLASS="l">74</TD><TD>import org.eclipse.wst.jsdt.internal.corext.util.QualifiedTypeNameHistory;</TD></TR><TR><TD CLASS="l">75</TD><TD>import org.eclipse.wst.jsdt.internal.corext.util.TypeFilter;</TD></TR><TR><TD CLASS="l">76</TD><TD>import org.eclipse.wst.jsdt.internal.ui.JavaPluginImages;</TD></TR><TR><TD CLASS="l">77</TD><TD>import org.eclipse.wst.jsdt.internal.ui.JavaScriptPlugin;</TD></TR><TR><TD CLASS="l">78</TD><TD>import org.eclipse.wst.jsdt.internal.ui.text.correction.ChangeMethodSignatureProposal.ChangeDescription;</TD></TR><TR><TD CLASS="l">79</TD><TD>import org.eclipse.wst.jsdt.internal.ui.text.correction.ChangeMethodSignatureProposal.EditDescription;</TD></TR><TR><TD CLASS="l">80</TD><TD>import org.eclipse.wst.jsdt.internal.ui.text.correction.ChangeMethodSignatureProposal.InsertDescription;</TD></TR><TR><TD CLASS="l">81</TD><TD>import org.eclipse.wst.jsdt.internal.ui.text.correction.ChangeMethodSignatureProposal.RemoveDescription;</TD></TR><TR><TD CLASS="l">82</TD><TD>import org.eclipse.wst.jsdt.internal.ui.text.correction.ChangeMethodSignatureProposal.SwapDescription;</TD></TR><TR><TD CLASS="l">83</TD><TD>import org.eclipse.wst.jsdt.internal.ui.viewsupport.BindingLabelProvider;</TD></TR><TR><TD CLASS="l">84</TD><TD>import org.eclipse.wst.jsdt.internal.ui.viewsupport.JavaElementImageProvider;</TD></TR><TR><TD CLASS="l">85</TD><TD>import org.eclipse.wst.jsdt.ui.JavaScriptElementImageDescriptor;</TD></TR><TR><TD CLASS="l"><A NAME="0">86</A></TD><TD>import org.eclipse.wst.jsdt.ui.JavaScriptElementLabels;</TD></TR><TR><TD CLASS="l">87</TD><TD>import org.eclipse.wst.jsdt.ui.text.java.IInvocationContext;</TD></TR><TR><TD CLASS="l">88</TD><TD>import org.eclipse.wst.jsdt.ui.text.java.IProblemLocation;</TD></TR><TR><TD CLASS="l">89</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">90</TD><TD>public class UnresolvedElementsSubProcessor {</TD></TR><TR><TD CLASS="l">91</TD><TD>        </TD></TR><TR><TD CLASS="l"><A NAME="1d">92</A></TD><TD>        private static final String ADD_IMPORT_ID= &#34;org.eclipse.wst.jsdt.ui.correction.addImport&#34;; //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">93</TD><TD> </TD></TR><TR><TD CLASS="l">94</TD><TD>        public static void getVariableProposals(IInvocationContext context, IProblemLocation problem, IVariableBinding resolvedField, Collection proposals) throws CoreException {</TD></TR><TR><TD CLASS="l">95</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">96</TD><TD>                IJavaScriptUnit cu= context.getCompilationUnit();</TD></TR><TR><TD CLASS="l">97</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">98</TD><TD>                JavaScriptUnit astRoot= context.getASTRoot();</TD></TR><TR CLASS="z"><TD CLASS="l">99</TD><TD>                ASTNode selectedNode= problem.getCoveredNode(astRoot);</TD></TR><TR CLASS="z"><TD CLASS="l">100</TD><TD>                if (selectedNode == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">101</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">102</TD><TD>                }</TD></TR><TR><TD CLASS="l">103</TD><TD> </TD></TR><TR><TD CLASS="l">104</TD><TD>                // type that defines the variable</TD></TR><TR CLASS="z"><TD CLASS="l">105</TD><TD>                ITypeBinding binding= null;</TD></TR><TR><TD CLASS="l">106</TD><TD>                </TD></TR><TR><TD CLASS="l">107</TD><TD>                /* Commented out BC rev 1. quickfixing case 'var k = new &lt;undefinedType&gt;' */</TD></TR><TR CLASS="z"><TD CLASS="l">108</TD><TD>                ITypeBinding declaringTypeBinding= Bindings.getBindingOfParentTypeContext(selectedNode);</TD></TR><TR><TD CLASS="l">109</TD><TD>//                if (declaringTypeBinding == null) {</TD></TR><TR><TD CLASS="l">110</TD><TD>//                        return;</TD></TR><TR><TD CLASS="l">111</TD><TD>//                }</TD></TR><TR><TD CLASS="l">112</TD><TD> </TD></TR><TR><TD CLASS="l">113</TD><TD>                // possible type kind of the node</TD></TR><TR CLASS="z"><TD CLASS="l">114</TD><TD>                boolean suggestVariableProposals= true;</TD></TR><TR CLASS="z"><TD CLASS="l">115</TD><TD>                int typeKind= 0;</TD></TR><TR><TD CLASS="l">116</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">117</TD><TD>                while (selectedNode instanceof ParenthesizedExpression) {</TD></TR><TR CLASS="z"><TD CLASS="l">118</TD><TD>                        selectedNode= ((ParenthesizedExpression) selectedNode).getExpression();</TD></TR><TR><TD CLASS="l">119</TD><TD>                }</TD></TR><TR><TD CLASS="l">120</TD><TD> </TD></TR><TR><TD CLASS="l">121</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">122</TD><TD>                Name node= null;</TD></TR><TR><TD CLASS="l">123</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">124</TD><TD>                switch (selectedNode.getNodeType()) {</TD></TR><TR><TD CLASS="l">125</TD><TD>                        case ASTNode.SIMPLE_NAME:</TD></TR><TR CLASS="z"><TD CLASS="l">126</TD><TD>                                node= (SimpleName) selectedNode;</TD></TR><TR CLASS="z"><TD CLASS="l">127</TD><TD>                                ASTNode parent= node.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">128</TD><TD>                                StructuralPropertyDescriptor locationInParent= node.getLocationInParent();</TD></TR><TR CLASS="z"><TD CLASS="l">129</TD><TD>                                if (locationInParent == FunctionInvocation.EXPRESSION_PROPERTY) {</TD></TR><TR CLASS="z"><TD CLASS="l">130</TD><TD>                                        typeKind= SimilarElementsRequestor.CLASSES;</TD></TR><TR CLASS="z"><TD CLASS="l">131</TD><TD>                                } else if (locationInParent == FieldAccess.NAME_PROPERTY) {</TD></TR><TR CLASS="z"><TD CLASS="l">132</TD><TD>                                        Expression expression= ((FieldAccess) parent).getExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">133</TD><TD>                                        if (expression != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">134</TD><TD>                                                binding= expression.resolveTypeBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">135</TD><TD>                                                if (binding == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">136</TD><TD>                                                        node= null;</TD></TR><TR><TD CLASS="l">137</TD><TD>                                                }</TD></TR><TR><TD CLASS="l">138</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">139</TD><TD>                                } else if (parent instanceof SimpleType || parent instanceof ClassInstanceCreation) {</TD></TR><TR><TD CLASS="l">140</TD><TD>                                        </TD></TR><TR><TD CLASS="l">141</TD><TD>                                //        suggestVariableProposals= false;</TD></TR><TR><TD CLASS="l">142</TD><TD>                                //        typeKind= SimilarElementsRequestor.REF_TYPES_AND_VAR;</TD></TR><TR CLASS="z"><TD CLASS="l">143</TD><TD>                                } else if (parent instanceof QualifiedName) {</TD></TR><TR CLASS="z"><TD CLASS="l">144</TD><TD>                                        Name qualifier= ((QualifiedName) parent).getQualifier();</TD></TR><TR CLASS="z"><TD CLASS="l">145</TD><TD>                                        if (qualifier != node) {</TD></TR><TR CLASS="z"><TD CLASS="l">146</TD><TD>                                                binding= qualifier.resolveTypeBinding();</TD></TR><TR><TD CLASS="l">147</TD><TD>                                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">148</TD><TD>                                                typeKind= SimilarElementsRequestor.REF_TYPES;</TD></TR><TR><TD CLASS="l">149</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">150</TD><TD>                                        ASTNode outerParent= parent.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">151</TD><TD>                                        while (outerParent instanceof QualifiedName) {</TD></TR><TR CLASS="z"><TD CLASS="l">152</TD><TD>                                                outerParent= outerParent.getParent();</TD></TR><TR><TD CLASS="l">153</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">154</TD><TD>                                        if (outerParent instanceof SimpleType) {</TD></TR><TR CLASS="z"><TD CLASS="l">155</TD><TD>                                                typeKind= SimilarElementsRequestor.REF_TYPES;</TD></TR><TR CLASS="z"><TD CLASS="l">156</TD><TD>                                                suggestVariableProposals= false;</TD></TR><TR><TD CLASS="l">157</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">158</TD><TD>                                } else if (locationInParent == SwitchCase.EXPRESSION_PROPERTY) {</TD></TR><TR CLASS="z"><TD CLASS="l">159</TD><TD>                                        ITypeBinding switchExp= ((SwitchStatement) node.getParent().getParent()).getExpression().resolveTypeBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">160</TD><TD>                                        if (switchExp != null &amp;&amp; switchExp.isEnum()) {</TD></TR><TR CLASS="z"><TD CLASS="l">161</TD><TD>                                                binding= switchExp;</TD></TR><TR><TD CLASS="l">162</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">163</TD><TD>                                } else if (locationInParent == SuperFieldAccess.NAME_PROPERTY) {</TD></TR><TR CLASS="z"><TD CLASS="l">164</TD><TD>                                        binding= declaringTypeBinding.getSuperclass();</TD></TR><TR><TD CLASS="l">165</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">166</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">167</TD><TD>                        case ASTNode.QUALIFIED_NAME:</TD></TR><TR CLASS="z"><TD CLASS="l">168</TD><TD>                                QualifiedName qualifierName= (QualifiedName) selectedNode;</TD></TR><TR CLASS="z"><TD CLASS="l">169</TD><TD>                                ITypeBinding qualifierBinding= qualifierName.getQualifier().resolveTypeBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">170</TD><TD>                                if (qualifierBinding != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">171</TD><TD>                                        node= qualifierName.getName();</TD></TR><TR CLASS="z"><TD CLASS="l">172</TD><TD>                                        binding= qualifierBinding;</TD></TR><TR><TD CLASS="l">173</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">174</TD><TD>                                        node= qualifierName.getQualifier();</TD></TR><TR CLASS="z"><TD CLASS="l">175</TD><TD>                                        typeKind= SimilarElementsRequestor.REF_TYPES;</TD></TR><TR CLASS="z"><TD CLASS="l">176</TD><TD>                                        suggestVariableProposals= node.isSimpleName();</TD></TR><TR><TD CLASS="l">177</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">178</TD><TD>                                if (selectedNode.getParent() instanceof SimpleType) {</TD></TR><TR CLASS="z"><TD CLASS="l">179</TD><TD>                                        typeKind= SimilarElementsRequestor.REF_TYPES;</TD></TR><TR CLASS="z"><TD CLASS="l">180</TD><TD>                                        suggestVariableProposals= false;</TD></TR><TR><TD CLASS="l">181</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">182</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">183</TD><TD>                        case ASTNode.FIELD_ACCESS:</TD></TR><TR CLASS="z"><TD CLASS="l">184</TD><TD>                                FieldAccess access= (FieldAccess) selectedNode;</TD></TR><TR CLASS="z"><TD CLASS="l">185</TD><TD>                                Expression expression= access.getExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">186</TD><TD>                                if (expression != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">187</TD><TD>                                        binding= expression.resolveTypeBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">188</TD><TD>                                        if (binding != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">189</TD><TD>                                                node= access.getName();</TD></TR><TR><TD CLASS="l">190</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">191</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">192</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">193</TD><TD>                        case ASTNode.SUPER_FIELD_ACCESS:</TD></TR><TR CLASS="z"><TD CLASS="l">194</TD><TD>                                binding= declaringTypeBinding.getSuperclass();</TD></TR><TR CLASS="z"><TD CLASS="l">195</TD><TD>                                node= ((SuperFieldAccess) selectedNode).getName();</TD></TR><TR><TD CLASS="l">196</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">197</TD><TD>                        default:</TD></TR><TR><TD CLASS="l">198</TD><TD>                }</TD></TR><TR><TD CLASS="l">199</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">200</TD><TD>                if (node == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">201</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">202</TD><TD>                }</TD></TR><TR><TD CLASS="l">203</TD><TD> </TD></TR><TR><TD CLASS="l">204</TD><TD>                // add type proposals</TD></TR><TR CLASS="z"><TD CLASS="l">205</TD><TD>                if (typeKind != 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">206</TD><TD>                        if (!JavaModelUtil.is50OrHigher(cu.getJavaScriptProject())) {</TD></TR><TR CLASS="z"><TD CLASS="l">207</TD><TD>                                typeKind &amp;= ~(SimilarElementsRequestor.ANNOTATIONS | SimilarElementsRequestor.ENUMS | SimilarElementsRequestor.VARIABLES);</TD></TR><TR><TD CLASS="l">208</TD><TD>                        }</TD></TR><TR><TD CLASS="l">209</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">210</TD><TD>                        int relevance= Character.isUpperCase(ASTNodes.getSimpleNameIdentifier(node).charAt(0)) ? 5 : -2;</TD></TR><TR CLASS="z"><TD CLASS="l">211</TD><TD>                        addSimilarTypeProposals(typeKind, cu, node, relevance + 1, proposals);</TD></TR><TR><TD CLASS="l">212</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">213</TD><TD>                        typeKind &amp;= ~SimilarElementsRequestor.ANNOTATIONS;</TD></TR><TR CLASS="z"><TD CLASS="l">214</TD><TD>                        addNewTypeProposals(cu, node, typeKind, relevance, proposals);</TD></TR><TR><TD CLASS="l">215</TD><TD>                }</TD></TR><TR><TD CLASS="l">216</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">217</TD><TD>                if (!suggestVariableProposals) {</TD></TR><TR CLASS="z"><TD CLASS="l">218</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">219</TD><TD>                }</TD></TR><TR><TD CLASS="l">220</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">221</TD><TD>                SimpleName simpleName= node.isSimpleName() ? (SimpleName) node : ((QualifiedName) node).getName();</TD></TR><TR CLASS="z"><TD CLASS="l">222</TD><TD>                boolean isWriteAccess= ASTResolving.isWriteAccess(node);</TD></TR><TR><TD CLASS="l">223</TD><TD> </TD></TR><TR><TD CLASS="l">224</TD><TD>                // similar variables</TD></TR><TR CLASS="z"><TD CLASS="l">225</TD><TD>                addSimilarVariableProposals(cu, astRoot, binding, simpleName, isWriteAccess, proposals);</TD></TR><TR><TD CLASS="l">226</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">227</TD><TD>                if (resolvedField == null || binding == null || resolvedField.getDeclaringClass() != binding.getTypeDeclaration() &amp;&amp; Modifier.isPrivate(resolvedField.getModifiers())) {</TD></TR><TR><TD CLASS="l">228</TD><TD>                        </TD></TR><TR><TD CLASS="l">229</TD><TD>                        // new fields</TD></TR><TR CLASS="z"><TD CLASS="l">230</TD><TD>                        addNewFieldProposals(cu, astRoot, binding, declaringTypeBinding, simpleName, isWriteAccess, proposals);</TD></TR><TR><TD CLASS="l">231</TD><TD>                        </TD></TR><TR><TD CLASS="l">232</TD><TD>                        // new parameters and local variables</TD></TR><TR CLASS="z"><TD CLASS="l">233</TD><TD>                        if (binding == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">234</TD><TD>                                addNewVariableProposals(cu, node, simpleName, proposals);</TD></TR><TR><TD CLASS="l">235</TD><TD>                        }</TD></TR><TR><TD CLASS="l"><A NAME="7">236</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">237</TD><TD>        }</TD></TR><TR><TD CLASS="l">238</TD><TD> </TD></TR><TR><TD CLASS="l">239</TD><TD>        private static void addNewVariableProposals(IJavaScriptUnit cu, Name node, SimpleName simpleName, Collection proposals) {</TD></TR><TR CLASS="z"><TD CLASS="l">240</TD><TD>                String name= simpleName.getIdentifier();</TD></TR><TR CLASS="z"><TD CLASS="l">241</TD><TD>                ASTNode bodyDeclaration= ASTResolving.findParentBodyDeclaration(node, true);</TD></TR><TR CLASS="z"><TD CLASS="l">242</TD><TD>                int type= bodyDeclaration.getNodeType(); </TD></TR><TR CLASS="z"><TD CLASS="l">243</TD><TD>                if (type == ASTNode.FUNCTION_DECLARATION) {</TD></TR><TR CLASS="z"><TD CLASS="l">244</TD><TD>                        int relevance= StubUtility.hasParameterName(cu.getJavaScriptProject(), name) ? 8 : 5;</TD></TR><TR CLASS="z"><TD CLASS="l">245</TD><TD>                        String label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_createparameter_description, simpleName.getIdentifier());</TD></TR><TR CLASS="z"><TD CLASS="l">246</TD><TD>                        Image image= JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_LOCAL);</TD></TR><TR CLASS="z"><TD CLASS="l">247</TD><TD>                        proposals.add(new NewVariableCompletionProposal(label, cu, NewVariableCompletionProposal.PARAM, simpleName, null, relevance, image));</TD></TR><TR><TD CLASS="l">248</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">249</TD><TD>                if (type == ASTNode.INITIALIZER || type == ASTNode.JAVASCRIPT_UNIT ||</TD></TR><TR CLASS="z"><TD CLASS="l">250</TD><TD>                                (type == ASTNode.FUNCTION_DECLARATION &amp;&amp; !ASTResolving.isInsideConstructorInvocation((FunctionDeclaration) bodyDeclaration, node))) {</TD></TR><TR CLASS="z"><TD CLASS="l">251</TD><TD>                        int relevance= StubUtility.hasLocalVariableName(cu.getJavaScriptProject(), name) ? 10 : 7;</TD></TR><TR CLASS="z"><TD CLASS="l">252</TD><TD>                        String label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_createlocal_description, simpleName.getIdentifier());</TD></TR><TR CLASS="z"><TD CLASS="l">253</TD><TD>                        Image image= JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_LOCAL);</TD></TR><TR CLASS="z"><TD CLASS="l">254</TD><TD>                        proposals.add(new NewVariableCompletionProposal(label, cu, NewVariableCompletionProposal.LOCAL, simpleName, null, relevance, image));</TD></TR><TR><TD CLASS="l">255</TD><TD>                }</TD></TR><TR><TD CLASS="l">256</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">257</TD><TD>                if (node.getParent().getNodeType() == ASTNode.ASSIGNMENT) {</TD></TR><TR CLASS="z"><TD CLASS="l">258</TD><TD>                        Assignment assignment= (Assignment) node.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">259</TD><TD>                        if (assignment.getLeftHandSide() == node &amp;&amp; assignment.getParent().getNodeType() == ASTNode.EXPRESSION_STATEMENT) {</TD></TR><TR CLASS="z"><TD CLASS="l">260</TD><TD>                                ASTNode statement= assignment.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">261</TD><TD>                                ASTRewrite rewrite= ASTRewrite.create(statement.getAST());</TD></TR><TR CLASS="z"><TD CLASS="l">262</TD><TD>                                if (ASTNodes.isControlStatementBody(assignment.getParent().getLocationInParent())) {</TD></TR><TR CLASS="z"><TD CLASS="l">263</TD><TD>                                        rewrite.replace(statement, rewrite.getAST().newBlock(), null);</TD></TR><TR><TD CLASS="l">264</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">265</TD><TD>                                        rewrite.remove(statement, null);</TD></TR><TR><TD CLASS="l">266</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">267</TD><TD>                                String label= CorrectionMessages.UnresolvedElementsSubProcessor_removestatement_description;</TD></TR><TR CLASS="z"><TD CLASS="l">268</TD><TD>                                Image image= JavaScriptPlugin.getDefault().getWorkbench().getSharedImages().getImage(ISharedImages.IMG_TOOL_DELETE);</TD></TR><TR CLASS="z"><TD CLASS="l">269</TD><TD>                                ASTRewriteCorrectionProposal proposal= new ASTRewriteCorrectionProposal(label, cu, rewrite, 4, image);</TD></TR><TR CLASS="z"><TD CLASS="l">270</TD><TD>                                proposals.add(proposal);</TD></TR><TR><TD CLASS="l">271</TD><TD>                        }</TD></TR><TR><TD CLASS="l">272</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">273</TD><TD>        }</TD></TR><TR><TD CLASS="l">274</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="4">275</A></TD><TD>        private static void addNewFieldProposals(IJavaScriptUnit cu, JavaScriptUnit astRoot, ITypeBinding binding, ITypeBinding declaringTypeBinding, SimpleName simpleName, boolean isWriteAccess, Collection proposals) throws JavaScriptModelException {</TD></TR><TR><TD CLASS="l">276</TD><TD>                // new variables</TD></TR><TR><TD CLASS="l">277</TD><TD>                IJavaScriptUnit targetCU;</TD></TR><TR><TD CLASS="l">278</TD><TD>                ITypeBinding senderDeclBinding;</TD></TR><TR CLASS="z"><TD CLASS="l">279</TD><TD>                if (binding != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">280</TD><TD>                        senderDeclBinding= binding.getTypeDeclaration();</TD></TR><TR CLASS="z"><TD CLASS="l">281</TD><TD>                        targetCU= ASTResolving.findCompilationUnitForBinding(cu, astRoot, senderDeclBinding);</TD></TR><TR><TD CLASS="l">282</TD><TD>                } else { // binding is null for accesses without qualifier</TD></TR><TR CLASS="z"><TD CLASS="l">283</TD><TD>                        senderDeclBinding= declaringTypeBinding;</TD></TR><TR CLASS="z"><TD CLASS="l">284</TD><TD>                        targetCU= cu;</TD></TR><TR><TD CLASS="l">285</TD><TD>                }</TD></TR><TR><TD CLASS="l">286</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">287</TD><TD>                if (senderDeclBinding==null || !senderDeclBinding.isFromSource() || targetCU == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">288</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">289</TD><TD>                }</TD></TR><TR><TD CLASS="l">290</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">291</TD><TD>                boolean mustBeConst= ASTResolving.isInsideModifiers(simpleName);</TD></TR><TR><TD CLASS="l">292</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">293</TD><TD>                addNewFieldForType(targetCU, binding, senderDeclBinding, simpleName, isWriteAccess, mustBeConst, proposals);</TD></TR><TR><TD CLASS="l">294</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">295</TD><TD>                if (binding == null &amp;&amp; senderDeclBinding.isNested()) {</TD></TR><TR CLASS="z"><TD CLASS="l">296</TD><TD>                        ASTNode anonymDecl= astRoot.findDeclaringNode(senderDeclBinding);</TD></TR><TR CLASS="z"><TD CLASS="l">297</TD><TD>                        if (anonymDecl != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">298</TD><TD>                                ITypeBinding bind= Bindings.getBindingOfParentType(anonymDecl.getParent());</TD></TR><TR CLASS="z"><TD CLASS="l">299</TD><TD>                                if (!bind.isAnonymous()) {</TD></TR><TR CLASS="z"><TD CLASS="l">300</TD><TD>                                        addNewFieldForType(targetCU, bind, bind, simpleName, isWriteAccess, mustBeConst, proposals);</TD></TR><TR><TD CLASS="l">301</TD><TD>                                }</TD></TR><TR><TD CLASS="l">302</TD><TD>                        }</TD></TR><TR><TD CLASS="l"><A NAME="3">303</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">304</TD><TD>        }</TD></TR><TR><TD CLASS="l">305</TD><TD> </TD></TR><TR><TD CLASS="l">306</TD><TD>        private static void addNewFieldForType(IJavaScriptUnit targetCU, ITypeBinding binding, ITypeBinding senderDeclBinding, SimpleName simpleName, boolean isWriteAccess, boolean mustBeConst, Collection proposals) {</TD></TR><TR CLASS="z"><TD CLASS="l">307</TD><TD>                String name= simpleName.getIdentifier();</TD></TR><TR><TD CLASS="l">308</TD><TD>                String label;</TD></TR><TR><TD CLASS="l">309</TD><TD>                Image image;</TD></TR><TR CLASS="z"><TD CLASS="l">310</TD><TD>                if (senderDeclBinding.isEnum() &amp;&amp; !isWriteAccess) {</TD></TR><TR CLASS="z"><TD CLASS="l">311</TD><TD>                        label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_createenum_description, new Object[] { name, ASTResolving.getTypeSignature(senderDeclBinding) });</TD></TR><TR CLASS="z"><TD CLASS="l">312</TD><TD>                        image= JavaPluginImages.get(JavaPluginImages.IMG_FIELD_PUBLIC);</TD></TR><TR CLASS="z"><TD CLASS="l">313</TD><TD>                        proposals.add(new NewVariableCompletionProposal(label, targetCU, NewVariableCompletionProposal.ENUM_CONST, simpleName, senderDeclBinding, 10, image));</TD></TR><TR><TD CLASS="l">314</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">315</TD><TD>                        if (!mustBeConst) {</TD></TR><TR CLASS="z"><TD CLASS="l">316</TD><TD>                                if (binding == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">317</TD><TD>                                        label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_createfield_description, name);</TD></TR><TR CLASS="z"><TD CLASS="l">318</TD><TD>                                        image= JavaPluginImages.get(JavaPluginImages.IMG_FIELD_PRIVATE);</TD></TR><TR><TD CLASS="l">319</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">320</TD><TD>                                        label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_createfield_other_description, new Object[] { name, ASTResolving.getTypeSignature(senderDeclBinding) } );</TD></TR><TR CLASS="z"><TD CLASS="l">321</TD><TD>                                        image= JavaPluginImages.get(JavaPluginImages.IMG_FIELD_PUBLIC);</TD></TR><TR><TD CLASS="l">322</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">323</TD><TD>                                int fieldRelevance= StubUtility.hasFieldName(targetCU.getJavaScriptProject(), name) ? 9 : 6;</TD></TR><TR CLASS="z"><TD CLASS="l">324</TD><TD>                                proposals.add(new NewVariableCompletionProposal(label, targetCU, NewVariableCompletionProposal.FIELD, simpleName, senderDeclBinding, fieldRelevance, image));</TD></TR><TR><TD CLASS="l">325</TD><TD>                        }</TD></TR><TR><TD CLASS="l">326</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">327</TD><TD>                        if (!isWriteAccess &amp;&amp; !senderDeclBinding.isAnonymous()) {</TD></TR><TR CLASS="z"><TD CLASS="l">328</TD><TD>                                if (binding == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">329</TD><TD>                                        label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_createconst_description, name);</TD></TR><TR CLASS="z"><TD CLASS="l">330</TD><TD>                                        image= JavaPluginImages.get(JavaPluginImages.IMG_FIELD_PRIVATE);</TD></TR><TR><TD CLASS="l">331</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">332</TD><TD>                                        label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_createconst_other_description, new Object[] { name, ASTResolving.getTypeSignature(senderDeclBinding) } );</TD></TR><TR CLASS="z"><TD CLASS="l">333</TD><TD>                                        image= JavaPluginImages.get(JavaPluginImages.IMG_FIELD_PUBLIC);</TD></TR><TR><TD CLASS="l">334</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">335</TD><TD>                                int constRelevance= StubUtility.hasConstantName(name) ? 9 : 4;</TD></TR><TR CLASS="z"><TD CLASS="l">336</TD><TD>                                proposals.add(new NewVariableCompletionProposal(label, targetCU, NewVariableCompletionProposal.CONST_FIELD, simpleName, senderDeclBinding, constRelevance, image));</TD></TR><TR><TD CLASS="l">337</TD><TD>                        }</TD></TR><TR><TD CLASS="l"><A NAME="b">338</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">339</TD><TD>        }</TD></TR><TR><TD CLASS="l">340</TD><TD> </TD></TR><TR><TD CLASS="l">341</TD><TD>        private static void addSimilarVariableProposals(IJavaScriptUnit cu, JavaScriptUnit astRoot, ITypeBinding binding, SimpleName node, boolean isWriteAccess, Collection proposals) {</TD></TR><TR CLASS="z"><TD CLASS="l">342</TD><TD>                int kind= ScopeAnalyzer.VARIABLES | ScopeAnalyzer.CHECK_VISIBILITY;</TD></TR><TR CLASS="z"><TD CLASS="l">343</TD><TD>                if (!isWriteAccess) {</TD></TR><TR CLASS="z"><TD CLASS="l">344</TD><TD>                        kind |= ScopeAnalyzer.METHODS; // also try to find similar methods</TD></TR><TR><TD CLASS="l">345</TD><TD>                }</TD></TR><TR><TD CLASS="l">346</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">347</TD><TD>                IBinding[] varsAndMethodsInScope= (new ScopeAnalyzer(astRoot)).getDeclarationsInScope(node, kind);</TD></TR><TR CLASS="z"><TD CLASS="l">348</TD><TD>                if (varsAndMethodsInScope.length &gt; 0) {</TD></TR><TR><TD CLASS="l">349</TD><TD>                        // avoid corrections like int i= i;</TD></TR><TR CLASS="z"><TD CLASS="l">350</TD><TD>                        String otherNameInAssign= null;</TD></TR><TR><TD CLASS="l">351</TD><TD> </TD></TR><TR><TD CLASS="l">352</TD><TD>                        // help with x.getString() -&gt; y.getString()</TD></TR><TR CLASS="z"><TD CLASS="l">353</TD><TD>                        String methodSenderName= null;</TD></TR><TR CLASS="z"><TD CLASS="l">354</TD><TD>                        String fieldSenderName= null;</TD></TR><TR><TD CLASS="l">355</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">356</TD><TD>                        ASTNode parent= node.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">357</TD><TD>                        switch (parent.getNodeType()) {</TD></TR><TR><TD CLASS="l">358</TD><TD>                        case ASTNode.VARIABLE_DECLARATION_FRAGMENT:</TD></TR><TR><TD CLASS="l">359</TD><TD>                                // node must be initializer</TD></TR><TR CLASS="z"><TD CLASS="l">360</TD><TD>                                otherNameInAssign= ((VariableDeclarationFragment) parent).getName().getIdentifier();</TD></TR><TR CLASS="z"><TD CLASS="l">361</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">362</TD><TD>                        case ASTNode.ASSIGNMENT:</TD></TR><TR CLASS="z"><TD CLASS="l">363</TD><TD>                                Assignment assignment= (Assignment) parent;</TD></TR><TR CLASS="z"><TD CLASS="l">364</TD><TD>                                if (isWriteAccess &amp;&amp; assignment.getRightHandSide() instanceof SimpleName) {</TD></TR><TR CLASS="z"><TD CLASS="l">365</TD><TD>                                        otherNameInAssign= ((SimpleName) assignment.getRightHandSide()).getIdentifier();</TD></TR><TR CLASS="z"><TD CLASS="l">366</TD><TD>                                } else if (!isWriteAccess &amp;&amp; assignment.getLeftHandSide() instanceof SimpleName) {</TD></TR><TR CLASS="z"><TD CLASS="l">367</TD><TD>                                        otherNameInAssign= ((SimpleName) assignment.getLeftHandSide()).getIdentifier();</TD></TR><TR><TD CLASS="l">368</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">369</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">370</TD><TD>                        case ASTNode.FUNCTION_INVOCATION:</TD></TR><TR CLASS="z"><TD CLASS="l">371</TD><TD>                                FunctionInvocation inv= (FunctionInvocation) parent;</TD></TR><TR CLASS="z"><TD CLASS="l">372</TD><TD>                                if (inv.getExpression() == node) {</TD></TR><TR CLASS="z"><TD CLASS="l">373</TD><TD>                                        methodSenderName= inv.getName().getIdentifier();</TD></TR><TR><TD CLASS="l">374</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">375</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">376</TD><TD>                        case ASTNode.QUALIFIED_NAME:</TD></TR><TR CLASS="z"><TD CLASS="l">377</TD><TD>                                QualifiedName qualName= (QualifiedName) parent;</TD></TR><TR CLASS="z"><TD CLASS="l">378</TD><TD>                                if (qualName.getQualifier() == node) {</TD></TR><TR CLASS="z"><TD CLASS="l">379</TD><TD>                                        fieldSenderName= qualName.getName().getIdentifier();</TD></TR><TR><TD CLASS="l">380</TD><TD>                                }</TD></TR><TR><TD CLASS="l">381</TD><TD>                                break;</TD></TR><TR><TD CLASS="l">382</TD><TD>                        }</TD></TR><TR><TD CLASS="l">383</TD><TD> </TD></TR><TR><TD CLASS="l">384</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">385</TD><TD>                        ITypeBinding guessedType= ASTResolving.guessBindingForReference(node);</TD></TR><TR><TD CLASS="l">386</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">387</TD><TD>                        ITypeBinding objectBinding= astRoot.getAST().resolveWellKnownType(&#34;java.lang.Object&#34;); //$NON-NLS-1$</TD></TR><TR CLASS="z"><TD CLASS="l">388</TD><TD>                        String identifier= node.getIdentifier();</TD></TR><TR CLASS="z"><TD CLASS="l">389</TD><TD>                        boolean isInStaticContext= ASTResolving.isInStaticContext(node);</TD></TR><TR><TD CLASS="l">390</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">391</TD><TD>                        loop: for (int i= 0; i &lt; varsAndMethodsInScope.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">392</TD><TD>                                IBinding varOrMeth= varsAndMethodsInScope[i];</TD></TR><TR CLASS="z"><TD CLASS="l">393</TD><TD>                                if (varOrMeth instanceof IVariableBinding) {</TD></TR><TR CLASS="z"><TD CLASS="l">394</TD><TD>                                        IVariableBinding curr= (IVariableBinding) varOrMeth;</TD></TR><TR CLASS="z"><TD CLASS="l">395</TD><TD>                                        String currName= curr.getName();</TD></TR><TR CLASS="z"><TD CLASS="l">396</TD><TD>                                        if (currName.equals(otherNameInAssign)) {</TD></TR><TR CLASS="z"><TD CLASS="l">397</TD><TD>                                                continue loop;</TD></TR><TR><TD CLASS="l">398</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">399</TD><TD>                                        boolean isFinal= Modifier.isFinal(curr.getModifiers());</TD></TR><TR CLASS="z"><TD CLASS="l">400</TD><TD>                                        if (isFinal &amp;&amp; curr.isField() &amp;&amp; isWriteAccess) {</TD></TR><TR CLASS="z"><TD CLASS="l">401</TD><TD>                                                continue loop;</TD></TR><TR><TD CLASS="l">402</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">403</TD><TD>                                        if (isInStaticContext &amp;&amp; !Modifier.isStatic(curr.getModifiers()) &amp;&amp; curr.isField()) {</TD></TR><TR CLASS="z"><TD CLASS="l">404</TD><TD>                                                continue loop;</TD></TR><TR><TD CLASS="l">405</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">406</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">407</TD><TD>                                        int relevance= 0;</TD></TR><TR CLASS="z"><TD CLASS="l">408</TD><TD>                                        if (NameMatcher.isSimilarName(currName, identifier)) {</TD></TR><TR CLASS="z"><TD CLASS="l">409</TD><TD>                                                relevance += 3; // variable with a similar name than the unresolved variable</TD></TR><TR><TD CLASS="l">410</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">411</TD><TD>                                        if (currName.equalsIgnoreCase(identifier)) {</TD></TR><TR CLASS="z"><TD CLASS="l">412</TD><TD>                                                relevance+= 5;</TD></TR><TR><TD CLASS="l">413</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">414</TD><TD>                                        ITypeBinding varType= curr.getType();</TD></TR><TR CLASS="z"><TD CLASS="l">415</TD><TD>                                        if (varType != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">416</TD><TD>                                                if (guessedType != null &amp;&amp; guessedType != objectBinding) { // too many result with object</TD></TR><TR><TD CLASS="l">417</TD><TD>                                                        // variable type is compatible with the guessed type</TD></TR><TR CLASS="z"><TD CLASS="l">418</TD><TD>                                                        if (!isWriteAccess &amp;&amp; canAssign(varType, guessedType)</TD></TR><TR CLASS="z"><TD CLASS="l">419</TD><TD>                                                                        || isWriteAccess &amp;&amp; canAssign(guessedType, varType)) {</TD></TR><TR CLASS="z"><TD CLASS="l">420</TD><TD>                                                                relevance += 2; // unresolved variable can be assign to this variable</TD></TR><TR><TD CLASS="l">421</TD><TD>                                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">422</TD><TD>                                                }else if (guessedType==null &amp;&amp; relevance==0) {</TD></TR><TR><TD CLASS="l">423</TD><TD>                                                        /* type any? */</TD></TR><TR CLASS="z"><TD CLASS="l">424</TD><TD>                                                        relevance+=1;</TD></TR><TR><TD CLASS="l">425</TD><TD>                                                }</TD></TR><TR CLASS="z"><TD CLASS="l">426</TD><TD>                                                if (methodSenderName != null &amp;&amp; hasMethodWithName(varType, methodSenderName)) {</TD></TR><TR CLASS="z"><TD CLASS="l">427</TD><TD>                                                        relevance += 2;</TD></TR><TR><TD CLASS="l">428</TD><TD>                                                }</TD></TR><TR CLASS="z"><TD CLASS="l">429</TD><TD>                                                if (fieldSenderName != null &amp;&amp; hasFieldWithName(varType, fieldSenderName)) {</TD></TR><TR CLASS="z"><TD CLASS="l">430</TD><TD>                                                        relevance += 2;</TD></TR><TR><TD CLASS="l">431</TD><TD>                                                }</TD></TR><TR><TD CLASS="l">432</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">433</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">434</TD><TD>                                        if (relevance &gt; 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">435</TD><TD>                                                String label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_changevariable_description, currName);</TD></TR><TR CLASS="z"><TD CLASS="l">436</TD><TD>                                                if(node.getParent() instanceof ClassInstanceCreation) {</TD></TR><TR CLASS="z"><TD CLASS="l">437</TD><TD>                                                        proposals.add(new RenameNodeCompletionProposal(label, cu, node.getParent().getStartPosition(), node.getParent().getLength(), currName, relevance));</TD></TR><TR><TD CLASS="l">438</TD><TD>                                                }else {</TD></TR><TR CLASS="z"><TD CLASS="l">439</TD><TD>                                                        proposals.add(new RenameNodeCompletionProposal(label, cu, node.getStartPosition(), node.getLength(), currName, relevance));</TD></TR><TR><TD CLASS="l">440</TD><TD>                                                }</TD></TR><TR><TD CLASS="l">441</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">442</TD><TD>                                } else if (varOrMeth instanceof IFunctionBinding) {</TD></TR><TR CLASS="z"><TD CLASS="l">443</TD><TD>                                        IFunctionBinding curr= (IFunctionBinding) varOrMeth;</TD></TR><TR CLASS="z"><TD CLASS="l">444</TD><TD>                                        if (!curr.isConstructor() &amp;&amp; guessedType != null &amp;&amp; canAssign(curr.getReturnType(), guessedType)) {</TD></TR><TR CLASS="z"><TD CLASS="l">445</TD><TD>                                                if (NameMatcher.isSimilarName(curr.getName(), identifier)) {</TD></TR><TR CLASS="z"><TD CLASS="l">446</TD><TD>                                                        AST ast= astRoot.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">447</TD><TD>                                                        ASTRewrite rewrite= ASTRewrite.create(ast);</TD></TR><TR CLASS="z"><TD CLASS="l">448</TD><TD>                                                        String label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_changetomethod_description, ASTResolving.getMethodSignature(curr, false));</TD></TR><TR CLASS="z"><TD CLASS="l">449</TD><TD>                                                        Image image= JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">450</TD><TD>                                                        LinkedCorrectionProposal proposal= new LinkedCorrectionProposal(label, cu, rewrite, 8, image);</TD></TR><TR CLASS="z"><TD CLASS="l">451</TD><TD>                                                        proposals.add(proposal);</TD></TR><TR><TD CLASS="l">452</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">453</TD><TD>                                                        FunctionInvocation newInv= ast.newFunctionInvocation();</TD></TR><TR CLASS="z"><TD CLASS="l">454</TD><TD>                                                        newInv.setName(ast.newSimpleName(curr.getName()));</TD></TR><TR CLASS="z"><TD CLASS="l">455</TD><TD>                                                        ITypeBinding[] parameterTypes= curr.getParameterTypes();</TD></TR><TR CLASS="z"><TD CLASS="l">456</TD><TD>                                                        for (int k= 0; k &lt; parameterTypes.length; k++) {</TD></TR><TR CLASS="z"><TD CLASS="l">457</TD><TD>                                                                ASTNode arg= ASTNodeFactory.newDefaultExpression(ast, parameterTypes[k]);</TD></TR><TR CLASS="z"><TD CLASS="l">458</TD><TD>                                                                newInv.arguments().add(arg);</TD></TR><TR CLASS="z"><TD CLASS="l">459</TD><TD>                                                                proposal.addLinkedPosition(rewrite.track(arg), false, null);</TD></TR><TR><TD CLASS="l">460</TD><TD>                                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">461</TD><TD>                                                        rewrite.replace(node, newInv, null);</TD></TR><TR><TD CLASS="l">462</TD><TD>                                                }</TD></TR><TR><TD CLASS="l">463</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">464</TD><TD>                                }</TD></TR><TR><TD CLASS="l">465</TD><TD>                        }</TD></TR><TR><TD CLASS="l">466</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">467</TD><TD>                if (binding != null &amp;&amp; binding.isArray()) {</TD></TR><TR CLASS="z"><TD CLASS="l">468</TD><TD>                        String idLength= &#34;length&#34;; //$NON-NLS-1$</TD></TR><TR CLASS="z"><TD CLASS="l">469</TD><TD>                        String label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_changevariable_description, idLength);</TD></TR><TR CLASS="z"><TD CLASS="l">470</TD><TD>                        proposals.add(new RenameNodeCompletionProposal(label, cu, node.getStartPosition(), node.getLength(), idLength, 8)); </TD></TR><TR><TD CLASS="l"><A NAME="c">471</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">472</TD><TD>        }</TD></TR><TR><TD CLASS="l">473</TD><TD> </TD></TR><TR><TD CLASS="l">474</TD><TD>        private static boolean canAssign(ITypeBinding returnType, ITypeBinding guessedType) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1f">475</A></TD><TD>                return returnType.isAssignmentCompatible(guessedType);</TD></TR><TR><TD CLASS="l">476</TD><TD>        }</TD></TR><TR><TD CLASS="l">477</TD><TD> </TD></TR><TR><TD CLASS="l">478</TD><TD>        private static boolean hasMethodWithName(ITypeBinding typeBinding, String name) {</TD></TR><TR CLASS="z"><TD CLASS="l">479</TD><TD>                IVariableBinding[] fields= typeBinding.getDeclaredFields();</TD></TR><TR CLASS="z"><TD CLASS="l">480</TD><TD>                for (int i= 0; i &lt; fields.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">481</TD><TD>                        if (fields[i].getName().equals(name)) {</TD></TR><TR CLASS="z"><TD CLASS="l">482</TD><TD>                                return true;</TD></TR><TR><TD CLASS="l">483</TD><TD>                        }</TD></TR><TR><TD CLASS="l">484</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">485</TD><TD>                ITypeBinding superclass= typeBinding.getSuperclass();</TD></TR><TR CLASS="z"><TD CLASS="l">486</TD><TD>                if (superclass != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">487</TD><TD>                        return hasMethodWithName(superclass, name);</TD></TR><TR><TD CLASS="l">488</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1e">489</A></TD><TD>                return false;</TD></TR><TR><TD CLASS="l">490</TD><TD>        }</TD></TR><TR><TD CLASS="l">491</TD><TD> </TD></TR><TR><TD CLASS="l">492</TD><TD>        private static boolean hasFieldWithName(ITypeBinding typeBinding, String name) {</TD></TR><TR CLASS="z"><TD CLASS="l">493</TD><TD>                IFunctionBinding[] methods= typeBinding.getDeclaredMethods();</TD></TR><TR CLASS="z"><TD CLASS="l">494</TD><TD>                for (int i= 0; i &lt; methods.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">495</TD><TD>                        if (methods[i].getName().equals(name)) {</TD></TR><TR CLASS="z"><TD CLASS="l">496</TD><TD>                                return true;</TD></TR><TR><TD CLASS="l">497</TD><TD>                        }</TD></TR><TR><TD CLASS="l">498</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">499</TD><TD>                ITypeBinding superclass= typeBinding.getSuperclass();</TD></TR><TR CLASS="z"><TD CLASS="l">500</TD><TD>                if (superclass != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">501</TD><TD>                        return hasMethodWithName(superclass, name);</TD></TR><TR><TD CLASS="l">502</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="13">503</A></TD><TD>                return false;</TD></TR><TR><TD CLASS="l">504</TD><TD>        }</TD></TR><TR><TD CLASS="l">505</TD><TD> </TD></TR><TR><TD CLASS="l">506</TD><TD>        private static int evauateTypeKind(ASTNode node, IJavaScriptProject project) {</TD></TR><TR CLASS="z"><TD CLASS="l">507</TD><TD>                int kind= ASTResolving.getPossibleTypeKinds(node, JavaModelUtil.is50OrHigher(project));</TD></TR><TR CLASS="z"><TD CLASS="l">508</TD><TD>                return kind;</TD></TR><TR><TD CLASS="l"><A NAME="1c">509</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">510</TD><TD> </TD></TR><TR><TD CLASS="l">511</TD><TD> </TD></TR><TR><TD CLASS="l">512</TD><TD>        public static void getTypeProposals(IInvocationContext context, IProblemLocation problem, Collection proposals) throws CoreException {</TD></TR><TR CLASS="z"><TD CLASS="l">513</TD><TD>                IJavaScriptUnit cu= context.getCompilationUnit();</TD></TR><TR><TD CLASS="l">514</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">515</TD><TD>                ASTNode selectedNode= problem.getCoveringNode(context.getASTRoot());</TD></TR><TR CLASS="z"><TD CLASS="l">516</TD><TD>                if (selectedNode == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">517</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">518</TD><TD>                }</TD></TR><TR><TD CLASS="l">519</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">520</TD><TD>                int kind= evauateTypeKind(selectedNode, cu.getJavaScriptProject());</TD></TR><TR><TD CLASS="l">521</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">522</TD><TD>                while (selectedNode.getLocationInParent() == QualifiedName.NAME_PROPERTY) {</TD></TR><TR CLASS="z"><TD CLASS="l">523</TD><TD>                        selectedNode= selectedNode.getParent();</TD></TR><TR><TD CLASS="l">524</TD><TD>                }</TD></TR><TR><TD CLASS="l">525</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">526</TD><TD>                Name node= null;</TD></TR><TR CLASS="z"><TD CLASS="l">527</TD><TD>                if (selectedNode instanceof SimpleType) {</TD></TR><TR CLASS="z"><TD CLASS="l">528</TD><TD>                        node= ((SimpleType) selectedNode).getName();</TD></TR><TR CLASS="z"><TD CLASS="l">529</TD><TD>                } else if (selectedNode instanceof ArrayType) {</TD></TR><TR CLASS="z"><TD CLASS="l">530</TD><TD>                        Type elementType= ((ArrayType) selectedNode).getElementType();</TD></TR><TR CLASS="z"><TD CLASS="l">531</TD><TD>                        if (elementType.isSimpleType()) {</TD></TR><TR CLASS="z"><TD CLASS="l">532</TD><TD>                                node= ((SimpleType) elementType).getName();</TD></TR><TR><TD CLASS="l">533</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">534</TD><TD>                                return;</TD></TR><TR><TD CLASS="l">535</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">536</TD><TD>                } else if (selectedNode instanceof Name) {</TD></TR><TR CLASS="z"><TD CLASS="l">537</TD><TD>                        node= (Name) selectedNode;</TD></TR><TR><TD CLASS="l">538</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">539</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">540</TD><TD>                }</TD></TR><TR><TD CLASS="l">541</TD><TD> </TD></TR><TR><TD CLASS="l">542</TD><TD>                // change to similar type proposals</TD></TR><TR CLASS="z"><TD CLASS="l">543</TD><TD>                addSimilarTypeProposals(kind, cu, node, 3, proposals);</TD></TR><TR><TD CLASS="l">544</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">545</TD><TD>                while (node.getParent() instanceof QualifiedName) {</TD></TR><TR CLASS="z"><TD CLASS="l">546</TD><TD>                        node= (Name) node.getParent();</TD></TR><TR><TD CLASS="l">547</TD><TD>                }</TD></TR><TR><TD CLASS="l">548</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">549</TD><TD>                if (selectedNode != node) {</TD></TR><TR CLASS="z"><TD CLASS="l">550</TD><TD>                        kind= evauateTypeKind(node, cu.getJavaScriptProject());</TD></TR><TR><TD CLASS="l">551</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">552</TD><TD>                if ((kind &amp; (SimilarElementsRequestor.CLASSES | SimilarElementsRequestor.INTERFACES)) != 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">553</TD><TD>                        kind &amp;= ~SimilarElementsRequestor.ANNOTATIONS; // only propose annotations when there are no other suggestions</TD></TR><TR><TD CLASS="l">554</TD><TD>                }                </TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="a">555</A></TD><TD>                addNewTypeProposals(cu, node, kind, 0, proposals);</TD></TR><TR CLASS="z"><TD CLASS="l">556</TD><TD>        }</TD></TR><TR><TD CLASS="l">557</TD><TD> </TD></TR><TR><TD CLASS="l">558</TD><TD>        private static void addSimilarTypeProposals(int kind, IJavaScriptUnit cu, Name node, int relevance, Collection proposals) throws CoreException {</TD></TR><TR CLASS="z"><TD CLASS="l">559</TD><TD>                SimilarElement[] elements= SimilarElementsRequestor.findSimilarElement(cu, node, kind);</TD></TR><TR><TD CLASS="l">560</TD><TD> </TD></TR><TR><TD CLASS="l">561</TD><TD>                // try to resolve type in context -&gt; highest severity</TD></TR><TR CLASS="z"><TD CLASS="l">562</TD><TD>                String resolvedTypeName= null;</TD></TR><TR CLASS="z"><TD CLASS="l">563</TD><TD>                ITypeBinding binding= ASTResolving.guessBindingForTypeReference(node);</TD></TR><TR CLASS="z"><TD CLASS="l">564</TD><TD>                if (binding != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">565</TD><TD>                        ITypeBinding simpleBinding= binding;</TD></TR><TR CLASS="z"><TD CLASS="l">566</TD><TD>                        if (simpleBinding.isArray()) {</TD></TR><TR CLASS="z"><TD CLASS="l">567</TD><TD>                                simpleBinding= simpleBinding.getElementType();</TD></TR><TR><TD CLASS="l">568</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">569</TD><TD>                        simpleBinding= simpleBinding.getTypeDeclaration();</TD></TR><TR><TD CLASS="l">570</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">571</TD><TD>                        resolvedTypeName= simpleBinding.getQualifiedName();</TD></TR><TR CLASS="z"><TD CLASS="l">572</TD><TD>                        CUCorrectionProposal proposal= createTypeRefChangeProposal(cu, resolvedTypeName, node, relevance + 2, elements.length);</TD></TR><TR CLASS="z"><TD CLASS="l">573</TD><TD>                        proposals.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l">574</TD><TD>                        if (proposal instanceof AddImportCorrectionProposal)</TD></TR><TR CLASS="z"><TD CLASS="l">575</TD><TD>                                proposal.setRelevance(relevance + elements.length + 2);</TD></TR><TR><TD CLASS="l">576</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">577</TD><TD>                        if (binding.isParameterizedType() &amp;&amp; node.getParent() instanceof SimpleType &amp;&amp; !(node.getParent().getParent() instanceof Type)) {</TD></TR><TR CLASS="z"><TD CLASS="l">578</TD><TD>                                proposals.add(createTypeRefChangeFullProposal(cu, binding, node, relevance + 2));</TD></TR><TR><TD CLASS="l">579</TD><TD>                        }</TD></TR><TR><TD CLASS="l">580</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">581</TD><TD>                        ASTNode normalizedNode= ASTNodes.getNormalizedNode(node);</TD></TR><TR CLASS="z"><TD CLASS="l">582</TD><TD>                        if (!(normalizedNode.getParent() instanceof Type) &amp;&amp; node.getParent() != normalizedNode) {</TD></TR><TR CLASS="z"><TD CLASS="l">583</TD><TD>                                ITypeBinding normBinding= ASTResolving.guessBindingForTypeReference(normalizedNode);</TD></TR><TR CLASS="z"><TD CLASS="l">584</TD><TD>                                if (normBinding != null) { </TD></TR><TR CLASS="z"><TD CLASS="l">585</TD><TD>                                        proposals.add(createTypeRefChangeFullProposal(cu, normBinding, normalizedNode, relevance + 2));</TD></TR><TR><TD CLASS="l">586</TD><TD>                                }</TD></TR><TR><TD CLASS="l">587</TD><TD>                        }</TD></TR><TR><TD CLASS="l">588</TD><TD>                }</TD></TR><TR><TD CLASS="l">589</TD><TD> </TD></TR><TR><TD CLASS="l">590</TD><TD>                // add all similar elements</TD></TR><TR CLASS="z"><TD CLASS="l">591</TD><TD>                for (int i= 0; i &lt; elements.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">592</TD><TD>                        SimilarElement elem= elements[i];</TD></TR><TR CLASS="z"><TD CLASS="l">593</TD><TD>                        if ((elem.getKind() &amp; SimilarElementsRequestor.ALL_TYPES) != 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">594</TD><TD>                                String fullName= elem.getName();</TD></TR><TR CLASS="z"><TD CLASS="l">595</TD><TD>                                if (!fullName.equals(resolvedTypeName)) {</TD></TR><TR CLASS="z"><TD CLASS="l">596</TD><TD>                                        proposals.add(createTypeRefChangeProposal(cu, fullName, node, relevance, elements.length));</TD></TR><TR><TD CLASS="l">597</TD><TD>                                }</TD></TR><TR><TD CLASS="l">598</TD><TD>                        }</TD></TR><TR><TD CLASS="l"><A NAME="f">599</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">600</TD><TD>        }</TD></TR><TR><TD CLASS="l">601</TD><TD>                </TD></TR><TR><TD CLASS="l">602</TD><TD>        private static CUCorrectionProposal createTypeRefChangeProposal(IJavaScriptUnit cu, String fullName, Name node, int relevance, int maxProposals) throws CoreException {</TD></TR><TR CLASS="z"><TD CLASS="l">603</TD><TD>                ImportRewrite importRewrite= null;</TD></TR><TR CLASS="z"><TD CLASS="l">604</TD><TD>                String simpleName= fullName;</TD></TR><TR CLASS="z"><TD CLASS="l">605</TD><TD>                String packName= Signature.getQualifier(fullName);</TD></TR><TR CLASS="z"><TD CLASS="l">606</TD><TD>                if (packName.length() &gt; 0) { // no imports for primitive types, type variables</TD></TR><TR CLASS="z"><TD CLASS="l">607</TD><TD>                        importRewrite= StubUtility.createImportRewrite((JavaScriptUnit) node.getRoot(), true);</TD></TR><TR CLASS="z"><TD CLASS="l">608</TD><TD>                        simpleName= importRewrite.addImport(fullName);</TD></TR><TR><TD CLASS="l">609</TD><TD>                }</TD></TR><TR><TD CLASS="l">610</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">611</TD><TD>                if (!isLikelyTypeName(simpleName)) {</TD></TR><TR CLASS="z"><TD CLASS="l">612</TD><TD>                        relevance -= 2;</TD></TR><TR><TD CLASS="l">613</TD><TD>                }</TD></TR><TR><TD CLASS="l">614</TD><TD> </TD></TR><TR><TD CLASS="l">615</TD><TD>                ASTRewriteCorrectionProposal proposal;</TD></TR><TR CLASS="z"><TD CLASS="l">616</TD><TD>                if (importRewrite != null &amp;&amp; node.isSimpleName() &amp;&amp; simpleName.equals(((SimpleName) node).getIdentifier())) { // import only</TD></TR><TR><TD CLASS="l">617</TD><TD>                        // import only</TD></TR><TR CLASS="z"><TD CLASS="l">618</TD><TD>                        String[] arg= { simpleName, packName };</TD></TR><TR CLASS="z"><TD CLASS="l">619</TD><TD>                        String label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_importtype_description, arg);</TD></TR><TR CLASS="z"><TD CLASS="l">620</TD><TD>                        Image image= JavaPluginImages.get(JavaPluginImages.IMG_OBJS_IMPDECL);</TD></TR><TR CLASS="z"><TD CLASS="l">621</TD><TD>                        int boost= QualifiedTypeNameHistory.getBoost(fullName, 0, maxProposals);</TD></TR><TR CLASS="z"><TD CLASS="l">622</TD><TD>                        proposal= new AddImportCorrectionProposal(label, cu, relevance + 100 + boost, image, packName, simpleName, (SimpleName)node);</TD></TR><TR CLASS="z"><TD CLASS="l">623</TD><TD>                        proposal.setCommandId(ADD_IMPORT_ID);</TD></TR><TR><TD CLASS="l">624</TD><TD>                } else {</TD></TR><TR><TD CLASS="l">625</TD><TD>                        String label;</TD></TR><TR CLASS="z"><TD CLASS="l">626</TD><TD>                        if (packName.length() == 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">627</TD><TD>                                label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_changetype_nopack_description, simpleName);</TD></TR><TR><TD CLASS="l">628</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">629</TD><TD>                                String[] arg= { simpleName, packName };</TD></TR><TR CLASS="z"><TD CLASS="l">630</TD><TD>                                label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_changetype_description, arg);</TD></TR><TR><TD CLASS="l">631</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">632</TD><TD>                        ASTRewrite rewrite= ASTRewrite.create(node.getAST());</TD></TR><TR CLASS="z"><TD CLASS="l">633</TD><TD>                        rewrite.replace(node, rewrite.createStringPlaceholder(simpleName, ASTNode.SIMPLE_TYPE), null);</TD></TR><TR CLASS="z"><TD CLASS="l">634</TD><TD>                        Image image= JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">635</TD><TD>                        proposal= new ASTRewriteCorrectionProposal(label, cu, rewrite, relevance, image);</TD></TR><TR><TD CLASS="l">636</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">637</TD><TD>                if (importRewrite != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">638</TD><TD>                        proposal.setImportRewrite(importRewrite);</TD></TR><TR><TD CLASS="l">639</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="e">640</A></TD><TD>                return proposal;</TD></TR><TR><TD CLASS="l">641</TD><TD>        }</TD></TR><TR><TD CLASS="l">642</TD><TD>        </TD></TR><TR><TD CLASS="l">643</TD><TD>        private static CUCorrectionProposal createTypeRefChangeFullProposal(IJavaScriptUnit cu, ITypeBinding binding, ASTNode node, int relevance) throws CoreException {</TD></TR><TR CLASS="z"><TD CLASS="l">644</TD><TD>                ASTRewrite rewrite= ASTRewrite.create(node.getAST());</TD></TR><TR CLASS="z"><TD CLASS="l">645</TD><TD>                String label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_change_full_type_description, BindingLabelProvider.getBindingLabel(binding, JavaScriptElementLabels.ALL_DEFAULT));</TD></TR><TR CLASS="z"><TD CLASS="l">646</TD><TD>                Image image= JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR><TD CLASS="l">647</TD><TD>                </TD></TR><TR><TD CLASS="l">648</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">649</TD><TD>                ASTRewriteCorrectionProposal proposal= new ASTRewriteCorrectionProposal(label, cu, rewrite, relevance + 3, image);</TD></TR><TR><TD CLASS="l">650</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">651</TD><TD>                ImportRewrite imports= proposal.createImportRewrite((JavaScriptUnit) node.getRoot());</TD></TR><TR CLASS="z"><TD CLASS="l">652</TD><TD>                Type type= imports.addImport(binding, node.getAST());</TD></TR><TR><TD CLASS="l">653</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">654</TD><TD>                rewrite.replace(node, type, null);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="22">655</A></TD><TD>                return proposal;</TD></TR><TR><TD CLASS="l">656</TD><TD>        }</TD></TR><TR><TD CLASS="l">657</TD><TD> </TD></TR><TR><TD CLASS="l">658</TD><TD>        private static boolean isLikelyTypeName(String name) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="21">659</A></TD><TD>                return name.length() &gt; 0 &amp;&amp; Character.isUpperCase(name.charAt(0));</TD></TR><TR><TD CLASS="l">660</TD><TD>        }</TD></TR><TR><TD CLASS="l">661</TD><TD> </TD></TR><TR><TD CLASS="l">662</TD><TD>        private static boolean isLikelyPackageName(String name) {</TD></TR><TR CLASS="z"><TD CLASS="l">663</TD><TD>                if (name.length() != 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">664</TD><TD>                        int i= 0;</TD></TR><TR><TD CLASS="l">665</TD><TD>                        do {</TD></TR><TR CLASS="z"><TD CLASS="l">666</TD><TD>                                if (Character.isUpperCase(name.charAt(i))) {</TD></TR><TR CLASS="z"><TD CLASS="l">667</TD><TD>                                        return false;</TD></TR><TR><TD CLASS="l">668</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">669</TD><TD>                                i= name.indexOf('.', i) + 1;</TD></TR><TR CLASS="z"><TD CLASS="l">670</TD><TD>                        } while (i != 0 &amp;&amp; i &lt; name.length());</TD></TR><TR><TD CLASS="l">671</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="23">672</A></TD><TD>                return true;</TD></TR><TR><TD CLASS="l">673</TD><TD>        }</TD></TR><TR><TD CLASS="l">674</TD><TD> </TD></TR><TR><TD CLASS="l">675</TD><TD>        private static boolean isLikelyTypeParameterName(String name) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="6">676</A></TD><TD>                return name.length() == 1 &amp;&amp; Character.isUpperCase(name.charAt(0));</TD></TR><TR><TD CLASS="l">677</TD><TD>        }</TD></TR><TR><TD CLASS="l">678</TD><TD> </TD></TR><TR><TD CLASS="l">679</TD><TD>        public static void addNewTypeProposals(IJavaScriptUnit cu, Name refNode, int kind, int relevance, Collection proposals) throws JavaScriptModelException {</TD></TR><TR CLASS="z"><TD CLASS="l">680</TD><TD>                Name node= refNode;</TD></TR><TR><TD CLASS="l">681</TD><TD>                do {</TD></TR><TR CLASS="z"><TD CLASS="l">682</TD><TD>                        String typeName= ASTNodes.getSimpleNameIdentifier(node);</TD></TR><TR CLASS="z"><TD CLASS="l">683</TD><TD>                        Name qualifier= null;</TD></TR><TR><TD CLASS="l">684</TD><TD>                        // only propose to create types for qualifiers when the name starts with upper case</TD></TR><TR CLASS="z"><TD CLASS="l">685</TD><TD>                        boolean isPossibleName= isLikelyTypeName(typeName) || (node == refNode);</TD></TR><TR CLASS="z"><TD CLASS="l">686</TD><TD>                        if (isPossibleName) {</TD></TR><TR CLASS="z"><TD CLASS="l">687</TD><TD>                                IPackageFragment enclosingPackage= null;</TD></TR><TR CLASS="z"><TD CLASS="l">688</TD><TD>                                IType enclosingType= null;</TD></TR><TR CLASS="z"><TD CLASS="l">689</TD><TD>                                if (node.isSimpleName()) {</TD></TR><TR CLASS="z"><TD CLASS="l">690</TD><TD>                                        enclosingPackage= (IPackageFragment) cu.getParent();</TD></TR><TR><TD CLASS="l">691</TD><TD>                                        // don't suggest member type, user can select it in wizard</TD></TR><TR><TD CLASS="l">692</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">693</TD><TD>                                        Name qualifierName= ((QualifiedName) node).getQualifier();</TD></TR><TR CLASS="z"><TD CLASS="l">694</TD><TD>                                         IBinding binding= qualifierName.resolveBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">695</TD><TD>                                         if (binding != null &amp;&amp; binding.isRecovered()) {</TD></TR><TR CLASS="z"><TD CLASS="l">696</TD><TD>                                                 binding= null;</TD></TR><TR><TD CLASS="l">697</TD><TD>                                         }</TD></TR><TR CLASS="z"><TD CLASS="l">698</TD><TD>                                         if (binding instanceof ITypeBinding) {</TD></TR><TR CLASS="z"><TD CLASS="l">699</TD><TD>                                                enclosingType=(IType) binding.getJavaElement();</TD></TR><TR CLASS="z"><TD CLASS="l">700</TD><TD>                                         } else if (binding instanceof IPackageBinding) {</TD></TR><TR CLASS="z"><TD CLASS="l">701</TD><TD>                                                qualifier= qualifierName;</TD></TR><TR CLASS="z"><TD CLASS="l">702</TD><TD>                                                 enclosingPackage= (IPackageFragment) binding.getJavaElement();</TD></TR><TR><TD CLASS="l">703</TD><TD>                                         } else {</TD></TR><TR CLASS="z"><TD CLASS="l">704</TD><TD>                                                 IJavaScriptElement[] res= cu.codeSelect(qualifierName.getStartPosition(), qualifierName.getLength());</TD></TR><TR CLASS="z"><TD CLASS="l">705</TD><TD>                                                if (res!= null &amp;&amp; res.length &gt; 0 &amp;&amp; res[0] instanceof IType) {</TD></TR><TR CLASS="z"><TD CLASS="l">706</TD><TD>                                                        enclosingType= (IType) res[0];</TD></TR><TR><TD CLASS="l">707</TD><TD>                                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">708</TD><TD>                                                        qualifier= qualifierName;</TD></TR><TR CLASS="z"><TD CLASS="l">709</TD><TD>                                                        enclosingPackage= JavaModelUtil.getPackageFragmentRoot(cu).getPackageFragment(ASTResolving.getFullName(qualifierName));</TD></TR><TR><TD CLASS="l">710</TD><TD>                                                }</TD></TR><TR><TD CLASS="l">711</TD><TD>                                         }</TD></TR><TR><TD CLASS="l">712</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">713</TD><TD>                                int rel= relevance;</TD></TR><TR CLASS="z"><TD CLASS="l">714</TD><TD>                                if (enclosingPackage != null &amp;&amp; isLikelyPackageName(enclosingPackage.getElementName())) {</TD></TR><TR CLASS="z"><TD CLASS="l">715</TD><TD>                                        rel += 3;</TD></TR><TR><TD CLASS="l">716</TD><TD>                                }</TD></TR><TR><TD CLASS="l">717</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">718</TD><TD>                                if ((enclosingPackage != null &amp;&amp; !enclosingPackage.getJavaScriptUnit(typeName + JavaModelUtil.DEFAULT_CU_SUFFIX).exists()) // new top level type</TD></TR><TR CLASS="z"><TD CLASS="l">719</TD><TD>                                                || (enclosingType != null &amp;&amp; !enclosingType.isReadOnly() &amp;&amp; !enclosingType.getType(typeName).exists())) { // new member type</TD></TR><TR CLASS="z"><TD CLASS="l">720</TD><TD>                                        IJavaScriptElement enclosing= enclosingPackage != null ? (IJavaScriptElement) enclosingPackage : enclosingType;</TD></TR><TR><TD CLASS="l">721</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">722</TD><TD>                                        if ((kind &amp; SimilarElementsRequestor.CLASSES) != 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">723</TD><TD>                                    proposals.add(new NewCUCompletionUsingWizardProposal(cu, node, NewCUCompletionUsingWizardProposal.K_CLASS, enclosing, rel+3));</TD></TR><TR><TD CLASS="l">724</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">725</TD><TD>//                                        if ((kind &amp; SimilarElementsRequestor.INTERFACES) != 0) {</TD></TR><TR><TD CLASS="l">726</TD><TD>//                                    proposals.add(new NewCUCompletionUsingWizardProposal(cu, node, NewCUCompletionUsingWizardProposal.K_INTERFACE, enclosing, rel+2));</TD></TR><TR><TD CLASS="l">727</TD><TD>//                                        }</TD></TR><TR><TD CLASS="l">728</TD><TD>//                                        if ((kind &amp; SimilarElementsRequestor.ENUMS) != 0) {</TD></TR><TR><TD CLASS="l">729</TD><TD>//                                    proposals.add(new NewCUCompletionUsingWizardProposal(cu, node, NewCUCompletionUsingWizardProposal.K_ENUM, enclosing, rel));</TD></TR><TR><TD CLASS="l">730</TD><TD>//                                        }</TD></TR><TR><TD CLASS="l">731</TD><TD>//                                        if ((kind &amp; SimilarElementsRequestor.ANNOTATIONS) != 0) {</TD></TR><TR><TD CLASS="l">732</TD><TD>//                                                proposals.add(new NewCUCompletionUsingWizardProposal(cu, node, NewCUCompletionUsingWizardProposal.K_ANNOTATION, enclosing, rel + 1));</TD></TR><TR><TD CLASS="l">733</TD><TD>//                                        }</TD></TR><TR><TD CLASS="l">734</TD><TD>                                }</TD></TR><TR><TD CLASS="l">735</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">736</TD><TD>                        node= qualifier;</TD></TR><TR CLASS="z"><TD CLASS="l">737</TD><TD>                } while (node != null);</TD></TR><TR><TD CLASS="l">738</TD><TD> </TD></TR><TR><TD CLASS="l">739</TD><TD>                // type parameter proposals</TD></TR><TR CLASS="z"><TD CLASS="l">740</TD><TD>                if (refNode.isSimpleName() &amp;&amp; ((kind &amp; SimilarElementsRequestor.VARIABLES)  != 0)) {</TD></TR><TR CLASS="z"><TD CLASS="l">741</TD><TD>                        JavaScriptUnit root= (JavaScriptUnit) refNode.getRoot();</TD></TR><TR CLASS="z"><TD CLASS="l">742</TD><TD>                        String name= ((SimpleName) refNode).getIdentifier();</TD></TR><TR CLASS="z"><TD CLASS="l">743</TD><TD>                        BodyDeclaration declaration= ASTResolving.findParentBodyDeclaration(refNode);</TD></TR><TR CLASS="z"><TD CLASS="l">744</TD><TD>                        int baseRel= relevance;</TD></TR><TR CLASS="z"><TD CLASS="l">745</TD><TD>                        if (isLikelyTypeParameterName(name)) {</TD></TR><TR CLASS="z"><TD CLASS="l">746</TD><TD>                                baseRel += 4;</TD></TR><TR><TD CLASS="l">747</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">748</TD><TD>                        while (declaration != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">749</TD><TD>                                IBinding binding= null;</TD></TR><TR CLASS="z"><TD CLASS="l">750</TD><TD>                                int rel= baseRel;</TD></TR><TR CLASS="z"><TD CLASS="l">751</TD><TD>                                if (declaration instanceof FunctionDeclaration) {</TD></TR><TR CLASS="z"><TD CLASS="l">752</TD><TD>                                        binding= ((FunctionDeclaration) declaration).resolveBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">753</TD><TD>                                } else if (declaration instanceof TypeDeclaration) {</TD></TR><TR CLASS="z"><TD CLASS="l">754</TD><TD>                                        binding= ((TypeDeclaration) declaration).resolveBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">755</TD><TD>                                        rel++;</TD></TR><TR><TD CLASS="l">756</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">757</TD><TD>                                if (binding != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">758</TD><TD>                                        AddTypeParameterProposal proposal= new AddTypeParameterProposal(cu, binding, root, name, null, rel);</TD></TR><TR CLASS="z"><TD CLASS="l">759</TD><TD>                                        proposals.add(proposal);</TD></TR><TR><TD CLASS="l">760</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">761</TD><TD>                                if (!Modifier.isStatic(declaration.getModifiers())) {</TD></TR><TR CLASS="z"><TD CLASS="l">762</TD><TD>                                        declaration= ASTResolving.findParentBodyDeclaration(declaration.getParent());</TD></TR><TR><TD CLASS="l">763</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">764</TD><TD>                                        declaration= null;</TD></TR><TR><TD CLASS="l">765</TD><TD>                                }</TD></TR><TR><TD CLASS="l">766</TD><TD>                        }</TD></TR><TR><TD CLASS="l">767</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="19">768</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">769</TD><TD> </TD></TR><TR><TD CLASS="l">770</TD><TD>        public static void getMethodProposals(IInvocationContext context, IProblemLocation problem, boolean isOnlyParameterMismatch, Collection proposals) throws CoreException {</TD></TR><TR><TD CLASS="l">771</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">772</TD><TD>                IJavaScriptUnit cu= context.getCompilationUnit();</TD></TR><TR><TD CLASS="l">773</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">774</TD><TD>                JavaScriptUnit astRoot= context.getASTRoot();</TD></TR><TR CLASS="z"><TD CLASS="l">775</TD><TD>                ASTNode selectedNode= problem.getCoveringNode(astRoot);</TD></TR><TR><TD CLASS="l">776</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">777</TD><TD>                if (!(selectedNode instanceof SimpleName)) {</TD></TR><TR CLASS="z"><TD CLASS="l">778</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">779</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">780</TD><TD>                SimpleName nameNode= (SimpleName) selectedNode;</TD></TR><TR><TD CLASS="l">781</TD><TD> </TD></TR><TR><TD CLASS="l">782</TD><TD>                List arguments;</TD></TR><TR><TD CLASS="l">783</TD><TD>                Expression sender;</TD></TR><TR><TD CLASS="l">784</TD><TD>                boolean isSuperInvocation;</TD></TR><TR><TD CLASS="l">785</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">786</TD><TD>                ASTNode invocationNode= nameNode.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">787</TD><TD>                if (invocationNode instanceof FunctionInvocation) {</TD></TR><TR CLASS="z"><TD CLASS="l">788</TD><TD>                        FunctionInvocation methodImpl= (FunctionInvocation) invocationNode;</TD></TR><TR CLASS="z"><TD CLASS="l">789</TD><TD>                        arguments= methodImpl.arguments();</TD></TR><TR CLASS="z"><TD CLASS="l">790</TD><TD>                        sender= methodImpl.getExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">791</TD><TD>                        isSuperInvocation= false;</TD></TR><TR CLASS="z"><TD CLASS="l">792</TD><TD>                } else if (invocationNode instanceof SuperMethodInvocation) {</TD></TR><TR CLASS="z"><TD CLASS="l">793</TD><TD>                        SuperMethodInvocation methodImpl= (SuperMethodInvocation) invocationNode;</TD></TR><TR CLASS="z"><TD CLASS="l">794</TD><TD>                        arguments= methodImpl.arguments();</TD></TR><TR CLASS="z"><TD CLASS="l">795</TD><TD>                        sender= methodImpl.getQualifier();</TD></TR><TR CLASS="z"><TD CLASS="l">796</TD><TD>                        isSuperInvocation= true;</TD></TR><TR><TD CLASS="l">797</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">798</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">799</TD><TD>                }</TD></TR><TR><TD CLASS="l">800</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">801</TD><TD>                String methodName= nameNode.getIdentifier();</TD></TR><TR CLASS="z"><TD CLASS="l">802</TD><TD>                int nArguments= arguments.size();</TD></TR><TR><TD CLASS="l">803</TD><TD> </TD></TR><TR><TD CLASS="l">804</TD><TD>                // corrections</TD></TR><TR CLASS="z"><TD CLASS="l">805</TD><TD>                IBinding[] bindings= (new ScopeAnalyzer(astRoot)).getDeclarationsInScope(nameNode, ScopeAnalyzer.METHODS);</TD></TR><TR><TD CLASS="l">806</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">807</TD><TD>                HashSet suggestedRenames= new HashSet();</TD></TR><TR CLASS="z"><TD CLASS="l">808</TD><TD>                for (int i= 0; i &lt; bindings.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">809</TD><TD>                        IFunctionBinding binding= (IFunctionBinding) bindings[i];</TD></TR><TR CLASS="z"><TD CLASS="l">810</TD><TD>                        String curr= binding.getName();</TD></TR><TR CLASS="z"><TD CLASS="l">811</TD><TD>                        if (!curr.equals(methodName) &amp;&amp; binding.getParameterTypes().length == nArguments &amp;&amp; NameMatcher.isSimilarName(methodName, curr) &amp;&amp; suggestedRenames.add(curr)) {</TD></TR><TR CLASS="z"><TD CLASS="l">812</TD><TD>                                String label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_changemethod_description, curr);</TD></TR><TR CLASS="z"><TD CLASS="l">813</TD><TD>                                proposals.add(new RenameNodeCompletionProposal(label, context.getCompilationUnit(), problem.getOffset(), problem.getLength(), curr, 6));</TD></TR><TR><TD CLASS="l">814</TD><TD>                        }</TD></TR><TR><TD CLASS="l">815</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">816</TD><TD>                suggestedRenames= null;</TD></TR><TR><TD CLASS="l">817</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">818</TD><TD>                if (isOnlyParameterMismatch) {</TD></TR><TR CLASS="z"><TD CLASS="l">819</TD><TD>                        ArrayList parameterMismatchs= new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">820</TD><TD>                        for (int i= 0; i &lt; bindings.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">821</TD><TD>                                IFunctionBinding binding= (IFunctionBinding) bindings[i];</TD></TR><TR CLASS="z"><TD CLASS="l">822</TD><TD>                                if (binding.getName().equals(methodName)) {</TD></TR><TR CLASS="z"><TD CLASS="l">823</TD><TD>                                        parameterMismatchs.add(binding);</TD></TR><TR><TD CLASS="l">824</TD><TD>                                }</TD></TR><TR><TD CLASS="l">825</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">826</TD><TD>                        addParameterMissmatchProposals(context, problem, parameterMismatchs, invocationNode, arguments, proposals);</TD></TR><TR><TD CLASS="l">827</TD><TD>                }</TD></TR><TR><TD CLASS="l">828</TD><TD> </TD></TR><TR><TD CLASS="l">829</TD><TD>                // new method</TD></TR><TR CLASS="z"><TD CLASS="l">830</TD><TD>                addNewMethodProposals(cu, astRoot, sender, arguments, isSuperInvocation, invocationNode, methodName, proposals);</TD></TR><TR><TD CLASS="l">831</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">832</TD><TD>                if (!isOnlyParameterMismatch &amp;&amp; !isSuperInvocation &amp;&amp; sender != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">833</TD><TD>                        addMissingCastParentsProposal(cu, (FunctionInvocation) invocationNode, proposals);</TD></TR><TR><TD CLASS="l">834</TD><TD>                }</TD></TR><TR><TD CLASS="l">835</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">836</TD><TD>                if (!isSuperInvocation &amp;&amp; sender == null &amp;&amp; invocationNode.getParent() instanceof ThrowStatement) {</TD></TR><TR CLASS="z"><TD CLASS="l">837</TD><TD>                        String str= &#34;new &#34;;   //$NON-NLS-1$ // do it the manual way, copting all the arguments is nasty</TD></TR><TR CLASS="z"><TD CLASS="l">838</TD><TD>                        String label= CorrectionMessages.UnresolvedElementsSubProcessor_addnewkeyword_description;</TD></TR><TR CLASS="z"><TD CLASS="l">839</TD><TD>                        int relevance= Character.isUpperCase(methodName.charAt(0)) ? 7 : 4;</TD></TR><TR CLASS="z"><TD CLASS="l">840</TD><TD>                        ReplaceCorrectionProposal proposal= new ReplaceCorrectionProposal(label, cu, invocationNode.getStartPosition(), 0, str, relevance);</TD></TR><TR CLASS="z"><TD CLASS="l">841</TD><TD>                        proposals.add(proposal);</TD></TR><TR><TD CLASS="l">842</TD><TD>                }</TD></TR><TR><TD CLASS="l"><A NAME="5">843</A></TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">844</TD><TD>        }</TD></TR><TR><TD CLASS="l">845</TD><TD> </TD></TR><TR><TD CLASS="l">846</TD><TD>        private static void addNewMethodProposals(IJavaScriptUnit cu, JavaScriptUnit astRoot, Expression sender, List arguments, boolean isSuperInvocation, ASTNode invocationNode, String methodName, Collection proposals) throws JavaScriptModelException {</TD></TR><TR CLASS="z"><TD CLASS="l">847</TD><TD>                ITypeBinding nodeParentType= Bindings.getBindingOfParentType(invocationNode);</TD></TR><TR CLASS="z"><TD CLASS="l">848</TD><TD>                ITypeBinding binding= null;</TD></TR><TR CLASS="z"><TD CLASS="l">849</TD><TD>                if (sender != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">850</TD><TD>                        binding= sender.resolveTypeBinding();</TD></TR><TR><TD CLASS="l">851</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">852</TD><TD>                        binding= nodeParentType;</TD></TR><TR CLASS="z"><TD CLASS="l">853</TD><TD>                        if (isSuperInvocation &amp;&amp; binding != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">854</TD><TD>                                binding= binding.getSuperclass();</TD></TR><TR><TD CLASS="l">855</TD><TD>                        }</TD></TR><TR><TD CLASS="l">856</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">857</TD><TD>                if (binding != null &amp;&amp; binding.isFromSource()) {</TD></TR><TR CLASS="z"><TD CLASS="l">858</TD><TD>                        ITypeBinding senderDeclBinding= binding.getTypeDeclaration();</TD></TR><TR><TD CLASS="l">859</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">860</TD><TD>                        IJavaScriptUnit targetCU= ASTResolving.findCompilationUnitForBinding(cu, astRoot, senderDeclBinding);</TD></TR><TR CLASS="z"><TD CLASS="l">861</TD><TD>                        if (targetCU != null) {</TD></TR><TR><TD CLASS="l">862</TD><TD>                                String label;</TD></TR><TR><TD CLASS="l">863</TD><TD>                                Image image;</TD></TR><TR CLASS="z"><TD CLASS="l">864</TD><TD>                                ITypeBinding[] parameterTypes= getParameterTypes(arguments);</TD></TR><TR CLASS="z"><TD CLASS="l">865</TD><TD>                                if (parameterTypes != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">866</TD><TD>                                        String sig= ASTResolving.getMethodSignature(methodName, parameterTypes, false);</TD></TR><TR><TD CLASS="l">867</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">868</TD><TD>                                        if (ASTResolving.isUseableTypeInContext(parameterTypes, senderDeclBinding, false)) {</TD></TR><TR CLASS="z"><TD CLASS="l">869</TD><TD>                                                if (nodeParentType == senderDeclBinding) {</TD></TR><TR CLASS="z"><TD CLASS="l">870</TD><TD>                                                        label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_createmethod_description, sig);</TD></TR><TR CLASS="z"><TD CLASS="l">871</TD><TD>                                                        image= JavaPluginImages.get(JavaPluginImages.IMG_MISC_PRIVATE);</TD></TR><TR><TD CLASS="l">872</TD><TD>                                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">873</TD><TD>                                                        label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_createmethod_other_description, new Object[] { sig, senderDeclBinding.getName() } );</TD></TR><TR CLASS="z"><TD CLASS="l">874</TD><TD>                                                        image= JavaPluginImages.get(JavaPluginImages.IMG_MISC_PUBLIC);</TD></TR><TR><TD CLASS="l">875</TD><TD>                                                }</TD></TR><TR CLASS="z"><TD CLASS="l">876</TD><TD>                                                proposals.add(new NewMethodCompletionProposal(label, targetCU, invocationNode, arguments, senderDeclBinding, 5, image));</TD></TR><TR><TD CLASS="l">877</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">878</TD><TD>                                        if (senderDeclBinding.isNested() &amp;&amp; cu.equals(targetCU) &amp;&amp; sender == null &amp;&amp; Bindings.findMethodInHierarchy(senderDeclBinding, methodName, (ITypeBinding[]) null) == null) { // no covering method</TD></TR><TR CLASS="z"><TD CLASS="l">879</TD><TD>                                                ASTNode anonymDecl= astRoot.findDeclaringNode(senderDeclBinding);</TD></TR><TR CLASS="z"><TD CLASS="l">880</TD><TD>                                                if (anonymDecl != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">881</TD><TD>                                                        senderDeclBinding= Bindings.getBindingOfParentType(anonymDecl.getParent());</TD></TR><TR CLASS="z"><TD CLASS="l">882</TD><TD>                                                        if (!senderDeclBinding.isAnonymous() &amp;&amp; ASTResolving.isUseableTypeInContext(parameterTypes, senderDeclBinding, false)) {</TD></TR><TR CLASS="z"><TD CLASS="l">883</TD><TD>                                                                String[] args= new String[] { sig, ASTResolving.getTypeSignature(senderDeclBinding) };</TD></TR><TR CLASS="z"><TD CLASS="l">884</TD><TD>                                                                label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_createmethod_other_description, args);</TD></TR><TR CLASS="z"><TD CLASS="l">885</TD><TD>                                                                image= JavaPluginImages.get(JavaPluginImages.IMG_MISC_PROTECTED);</TD></TR><TR CLASS="z"><TD CLASS="l">886</TD><TD>                                                                proposals.add(new NewMethodCompletionProposal(label, targetCU, invocationNode, arguments, senderDeclBinding, 5, image));</TD></TR><TR><TD CLASS="l">887</TD><TD>                                                        }</TD></TR><TR><TD CLASS="l">888</TD><TD>                                                }</TD></TR><TR><TD CLASS="l">889</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">890</TD><TD>                                }</TD></TR><TR><TD CLASS="l">891</TD><TD>                        }</TD></TR><TR><TD CLASS="l"><A NAME="2">892</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">893</TD><TD>        }</TD></TR><TR><TD CLASS="l">894</TD><TD> </TD></TR><TR><TD CLASS="l">895</TD><TD>        private static void addMissingCastParentsProposal(IJavaScriptUnit cu, FunctionInvocation invocationNode, Collection proposals) {</TD></TR><TR CLASS="z"><TD CLASS="l">896</TD><TD>                Expression sender= invocationNode.getExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">897</TD><TD>                if (sender instanceof ThisExpression) {</TD></TR><TR CLASS="z"><TD CLASS="l">898</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">899</TD><TD>                }</TD></TR><TR><TD CLASS="l">900</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">901</TD><TD>                ITypeBinding senderBinding= sender.resolveTypeBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">902</TD><TD>                if (senderBinding == null || Modifier.isFinal(senderBinding.getModifiers())) {</TD></TR><TR CLASS="z"><TD CLASS="l">903</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">904</TD><TD>                }</TD></TR><TR><TD CLASS="l">905</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">906</TD><TD>                if (sender instanceof Name &amp;&amp; ((Name) sender).resolveBinding() instanceof ITypeBinding) {</TD></TR><TR CLASS="z"><TD CLASS="l">907</TD><TD>                        return; // static access</TD></TR><TR><TD CLASS="l">908</TD><TD>                }</TD></TR><TR><TD CLASS="l">909</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">910</TD><TD>                ASTNode parent= invocationNode.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">911</TD><TD>                while (parent instanceof Expression &amp;&amp; parent.getNodeType() != ASTNode.CAST_EXPRESSION) {</TD></TR><TR CLASS="z"><TD CLASS="l">912</TD><TD>                        parent= parent.getParent();</TD></TR><TR><TD CLASS="l">913</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">914</TD><TD>                boolean hasCastProposal= false;</TD></TR><TR CLASS="z"><TD CLASS="l">915</TD><TD>                if (parent instanceof CastExpression) {</TD></TR><TR><TD CLASS="l">916</TD><TD>                        //        (TestCase) x.getName() -&gt; ((TestCase) x).getName</TD></TR><TR CLASS="z"><TD CLASS="l">917</TD><TD>                        hasCastProposal= useExistingParentCastProposal(cu, (CastExpression) parent, sender, invocationNode.getName(), getArgumentTypes(invocationNode.arguments()), proposals);</TD></TR><TR><TD CLASS="l">918</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">919</TD><TD>                if (!hasCastProposal) {</TD></TR><TR><TD CLASS="l">920</TD><TD>                        // x.getName() -&gt; ((TestCase) x).getName</TD></TR><TR><TD CLASS="l">921</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">922</TD><TD>                        Expression target= sender;</TD></TR><TR CLASS="z"><TD CLASS="l">923</TD><TD>                        while (target instanceof ParenthesizedExpression) {</TD></TR><TR CLASS="z"><TD CLASS="l">924</TD><TD>                                target= ((ParenthesizedExpression) target).getExpression();</TD></TR><TR><TD CLASS="l">925</TD><TD>                        }</TD></TR><TR><TD CLASS="l">926</TD><TD> </TD></TR><TR><TD CLASS="l">927</TD><TD>                        String label;</TD></TR><TR CLASS="z"><TD CLASS="l">928</TD><TD>                        if (target.getNodeType() != ASTNode.CAST_EXPRESSION) {</TD></TR><TR CLASS="z"><TD CLASS="l">929</TD><TD>                                String targetName= null;</TD></TR><TR CLASS="z"><TD CLASS="l">930</TD><TD>                                if (target.getLength() &lt;= 18) {</TD></TR><TR CLASS="z"><TD CLASS="l">931</TD><TD>                                        targetName= ASTNodes.asString(target);</TD></TR><TR><TD CLASS="l">932</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">933</TD><TD>                                if (targetName == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">934</TD><TD>                                        label= CorrectionMessages.UnresolvedElementsSubProcessor_methodtargetcast_description;</TD></TR><TR><TD CLASS="l">935</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">936</TD><TD>                                        label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_methodtargetcast2_description, targetName);</TD></TR><TR><TD CLASS="l">937</TD><TD>                                }</TD></TR><TR><TD CLASS="l">938</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">939</TD><TD>                                String targetName= null;</TD></TR><TR CLASS="z"><TD CLASS="l">940</TD><TD>                                if (target.getLength() &lt;= 18) {</TD></TR><TR CLASS="z"><TD CLASS="l">941</TD><TD>                                        targetName= ASTNodes.asString(((CastExpression)target).getExpression());</TD></TR><TR><TD CLASS="l">942</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">943</TD><TD>                                if (targetName == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">944</TD><TD>                                        label= CorrectionMessages.UnresolvedElementsSubProcessor_changemethodtargetcast_description;</TD></TR><TR><TD CLASS="l">945</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">946</TD><TD>                                        label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_changemethodtargetcast2_description, targetName);</TD></TR><TR><TD CLASS="l">947</TD><TD>                                }</TD></TR><TR><TD CLASS="l">948</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">949</TD><TD>                        proposals.add(new CastCompletionProposal(label, cu, target, (ITypeBinding) null, 3));</TD></TR><TR><TD CLASS="l"><A NAME="24">950</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">951</TD><TD>        }</TD></TR><TR><TD CLASS="l">952</TD><TD> </TD></TR><TR><TD CLASS="l">953</TD><TD>        private static boolean useExistingParentCastProposal(IJavaScriptUnit cu, CastExpression expression, Expression accessExpression, SimpleName accessSelector, ITypeBinding[] paramTypes, Collection proposals) {</TD></TR><TR CLASS="z"><TD CLASS="l">954</TD><TD>                ITypeBinding castType= expression.getType().resolveBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">955</TD><TD>                if (castType == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">956</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">957</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">958</TD><TD>                if (paramTypes != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">959</TD><TD>                        if (Bindings.findMethodInHierarchy(castType, accessSelector.getIdentifier(), paramTypes) == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">960</TD><TD>                                return false;</TD></TR><TR><TD CLASS="l">961</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">962</TD><TD>                } else if (Bindings.findFieldInHierarchy(castType, accessSelector.getIdentifier()) == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">963</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">964</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">965</TD><TD>                ITypeBinding bindingToCast= accessExpression.resolveTypeBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">966</TD><TD>                if (bindingToCast != null &amp;&amp; !bindingToCast.isCastCompatible(castType)) {</TD></TR><TR CLASS="z"><TD CLASS="l">967</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">968</TD><TD>                }</TD></TR><TR><TD CLASS="l">969</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">970</TD><TD>                IFunctionBinding res= Bindings.findMethodInHierarchy(castType, accessSelector.getIdentifier(), paramTypes);</TD></TR><TR CLASS="z"><TD CLASS="l">971</TD><TD>                if (res != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">972</TD><TD>                        AST ast= expression.getAST();</TD></TR><TR CLASS="z"><TD CLASS="l">973</TD><TD>                        ASTRewrite rewrite= ASTRewrite.create(ast);</TD></TR><TR CLASS="z"><TD CLASS="l">974</TD><TD>                        CastExpression newCast= ast.newCastExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">975</TD><TD>                        newCast.setType((Type) ASTNode.copySubtree(ast, expression.getType()));</TD></TR><TR CLASS="z"><TD CLASS="l">976</TD><TD>                        newCast.setExpression((Expression) rewrite.createCopyTarget(accessExpression));</TD></TR><TR CLASS="z"><TD CLASS="l">977</TD><TD>                        ParenthesizedExpression parents= ast.newParenthesizedExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">978</TD><TD>                        parents.setExpression(newCast);</TD></TR><TR><TD CLASS="l">979</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">980</TD><TD>                        ASTNode node= rewrite.createCopyTarget(expression.getExpression());</TD></TR><TR CLASS="z"><TD CLASS="l">981</TD><TD>                        rewrite.replace(expression, node, null);</TD></TR><TR CLASS="z"><TD CLASS="l">982</TD><TD>                        rewrite.replace(accessExpression, parents, null);</TD></TR><TR><TD CLASS="l">983</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">984</TD><TD>                        String label= CorrectionMessages.UnresolvedElementsSubProcessor_missingcastbrackets_description;</TD></TR><TR CLASS="z"><TD CLASS="l">985</TD><TD>                        Image image= JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CAST);</TD></TR><TR CLASS="z"><TD CLASS="l">986</TD><TD>                        ASTRewriteCorrectionProposal proposal= new ASTRewriteCorrectionProposal(label, cu, rewrite, 8, image);</TD></TR><TR CLASS="z"><TD CLASS="l">987</TD><TD>                        proposals.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l">988</TD><TD>                        return true;</TD></TR><TR><TD CLASS="l">989</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="8">990</A></TD><TD>                return false;</TD></TR><TR><TD CLASS="l">991</TD><TD>        }</TD></TR><TR><TD CLASS="l">992</TD><TD> </TD></TR><TR><TD CLASS="l">993</TD><TD>        private static void addParameterMissmatchProposals(IInvocationContext context, IProblemLocation problem, List similarElements, ASTNode invocationNode, List arguments, Collection proposals) throws CoreException {</TD></TR><TR CLASS="z"><TD CLASS="l">994</TD><TD>                int nSimilarElements= similarElements.size();</TD></TR><TR CLASS="z"><TD CLASS="l">995</TD><TD>                ITypeBinding[] argTypes= getArgumentTypes(arguments);</TD></TR><TR CLASS="z"><TD CLASS="l">996</TD><TD>                if (argTypes == null || nSimilarElements == 0)  {</TD></TR><TR CLASS="z"><TD CLASS="l">997</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">998</TD><TD>                }</TD></TR><TR><TD CLASS="l">999</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1000</TD><TD>                for (int i= 0; i &lt; nSimilarElements; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1001</TD><TD>                        IFunctionBinding elem = (IFunctionBinding) similarElements.get(i);</TD></TR><TR CLASS="z"><TD CLASS="l">1002</TD><TD>                        int diff= elem.getParameterTypes().length - argTypes.length;</TD></TR><TR CLASS="z"><TD CLASS="l">1003</TD><TD>                        if (diff == 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1004</TD><TD>                                int nProposals= proposals.size();</TD></TR><TR CLASS="z"><TD CLASS="l">1005</TD><TD>                                doEqualNumberOfParameters(context, invocationNode, problem, arguments, argTypes, elem, proposals);</TD></TR><TR CLASS="z"><TD CLASS="l">1006</TD><TD>                                if (nProposals != proposals.size()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1007</TD><TD>                                        return; // only suggest for one method (avoid duplicated proposals)</TD></TR><TR><TD CLASS="l">1008</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1009</TD><TD>                        } else if (diff &gt; 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1010</TD><TD>                                doMoreParameters(context, problem, invocationNode, arguments, argTypes, elem, proposals);</TD></TR><TR><TD CLASS="l">1011</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1012</TD><TD>                                doMoreArguments(context, problem, invocationNode, arguments, argTypes, elem, proposals);</TD></TR><TR><TD CLASS="l">1013</TD><TD>                        }</TD></TR><TR><TD CLASS="l"><A NAME="12">1014</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1015</TD><TD>        }</TD></TR><TR><TD CLASS="l">1016</TD><TD> </TD></TR><TR><TD CLASS="l">1017</TD><TD>        private static void doMoreParameters(IInvocationContext context, IProblemLocation problem, ASTNode invocationNode, List arguments, ITypeBinding[] argTypes, IFunctionBinding methodBinding, Collection proposals) throws CoreException {</TD></TR><TR CLASS="z"><TD CLASS="l">1018</TD><TD>                ITypeBinding[] paramTypes= methodBinding.getParameterTypes();</TD></TR><TR CLASS="z"><TD CLASS="l">1019</TD><TD>                int k= 0, nSkipped= 0;</TD></TR><TR CLASS="z"><TD CLASS="l">1020</TD><TD>                int diff= paramTypes.length - argTypes.length;</TD></TR><TR CLASS="z"><TD CLASS="l">1021</TD><TD>                int[] indexSkipped= new int[diff];</TD></TR><TR CLASS="z"><TD CLASS="l">1022</TD><TD>                for (int i= 0; i &lt; paramTypes.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1023</TD><TD>                        if (k &lt; argTypes.length &amp;&amp; canAssign(argTypes[k], paramTypes[i])) {</TD></TR><TR CLASS="z"><TD CLASS="l">1024</TD><TD>                                k++; // match</TD></TR><TR><TD CLASS="l">1025</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1026</TD><TD>                                if (nSkipped &gt;= diff) {</TD></TR><TR CLASS="z"><TD CLASS="l">1027</TD><TD>                                        return; // too different</TD></TR><TR><TD CLASS="l">1028</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1029</TD><TD>                                indexSkipped[nSkipped++]= i;</TD></TR><TR><TD CLASS="l">1030</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1031</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1032</TD><TD>                ITypeBinding declaringType= methodBinding.getDeclaringClass();</TD></TR><TR CLASS="z"><TD CLASS="l">1033</TD><TD>                IJavaScriptUnit cu= context.getCompilationUnit();</TD></TR><TR CLASS="z"><TD CLASS="l">1034</TD><TD>                JavaScriptUnit astRoot= context.getASTRoot();</TD></TR><TR><TD CLASS="l">1035</TD><TD> </TD></TR><TR><TD CLASS="l">1036</TD><TD>                // add arguments</TD></TR><TR><TD CLASS="l">1037</TD><TD>                {</TD></TR><TR CLASS="z"><TD CLASS="l">1038</TD><TD>                        String[] arg= new String[] { ASTResolving.getMethodSignature(methodBinding, false) };</TD></TR><TR><TD CLASS="l">1039</TD><TD>                        String label;</TD></TR><TR CLASS="z"><TD CLASS="l">1040</TD><TD>                        if (diff == 1) {</TD></TR><TR CLASS="z"><TD CLASS="l">1041</TD><TD>                                label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_addargument_description, arg);</TD></TR><TR><TD CLASS="l">1042</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1043</TD><TD>                                label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_addarguments_description, arg);</TD></TR><TR><TD CLASS="l">1044</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1045</TD><TD>                        AddArgumentCorrectionProposal proposal= new AddArgumentCorrectionProposal(label, context.getCompilationUnit(), invocationNode, indexSkipped, paramTypes, 8);</TD></TR><TR CLASS="z"><TD CLASS="l">1046</TD><TD>                        proposal.setImage(JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_ADD));</TD></TR><TR CLASS="z"><TD CLASS="l">1047</TD><TD>                        proposals.add(proposal);</TD></TR><TR><TD CLASS="l">1048</TD><TD>                }</TD></TR><TR><TD CLASS="l">1049</TD><TD> </TD></TR><TR><TD CLASS="l">1050</TD><TD>                // remove parameters</TD></TR><TR CLASS="z"><TD CLASS="l">1051</TD><TD>                if (!declaringType.isFromSource()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1052</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">1053</TD><TD>                }</TD></TR><TR><TD CLASS="l">1054</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1055</TD><TD>                IJavaScriptUnit targetCU= ASTResolving.findCompilationUnitForBinding(cu, astRoot, declaringType);</TD></TR><TR CLASS="z"><TD CLASS="l">1056</TD><TD>                if (targetCU != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1057</TD><TD>                        IFunctionBinding methodDecl= methodBinding.getMethodDeclaration();</TD></TR><TR CLASS="z"><TD CLASS="l">1058</TD><TD>                        ITypeBinding[] declParameterTypes= methodDecl.getParameterTypes();</TD></TR><TR><TD CLASS="l">1059</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1060</TD><TD>                        ChangeDescription[] changeDesc= new ChangeDescription[declParameterTypes.length];</TD></TR><TR CLASS="z"><TD CLASS="l">1061</TD><TD>                        ITypeBinding[] changedTypes= new ITypeBinding[diff];</TD></TR><TR CLASS="z"><TD CLASS="l">1062</TD><TD>                        for (int i= diff - 1; i &gt;= 0; i--) {</TD></TR><TR CLASS="z"><TD CLASS="l">1063</TD><TD>                                int idx= indexSkipped[i];</TD></TR><TR CLASS="z"><TD CLASS="l">1064</TD><TD>                                changeDesc[idx]= new RemoveDescription();</TD></TR><TR CLASS="z"><TD CLASS="l">1065</TD><TD>                                changedTypes[i]= declParameterTypes[idx];</TD></TR><TR><TD CLASS="l">1066</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1067</TD><TD>                        String[] arg= new String[] { ASTResolving.getMethodSignature(methodDecl, !cu.equals(targetCU)), getTypeNames(changedTypes) };</TD></TR><TR><TD CLASS="l">1068</TD><TD>                        String label;</TD></TR><TR CLASS="z"><TD CLASS="l">1069</TD><TD>                        if (methodDecl.isConstructor()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1070</TD><TD>                                if (diff == 1) {</TD></TR><TR CLASS="z"><TD CLASS="l">1071</TD><TD>                                        label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_removeparam_constr_description, arg);</TD></TR><TR><TD CLASS="l">1072</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1073</TD><TD>                                        label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_removeparams_constr_description, arg);</TD></TR><TR><TD CLASS="l">1074</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1075</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1076</TD><TD>                                if (diff == 1) {</TD></TR><TR CLASS="z"><TD CLASS="l">1077</TD><TD>                                        label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_removeparam_description, arg);</TD></TR><TR><TD CLASS="l">1078</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1079</TD><TD>                                        label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_removeparams_description, arg);</TD></TR><TR><TD CLASS="l">1080</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1081</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1082</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1083</TD><TD>                        Image image= JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_REMOVE);</TD></TR><TR CLASS="z"><TD CLASS="l">1084</TD><TD>                        ChangeMethodSignatureProposal proposal= new ChangeMethodSignatureProposal(label, targetCU, invocationNode, methodDecl, changeDesc, null, 5, image);</TD></TR><TR CLASS="z"><TD CLASS="l">1085</TD><TD>                        proposals.add(proposal);</TD></TR><TR><TD CLASS="l"><A NAME="1b">1086</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1087</TD><TD>        }</TD></TR><TR><TD CLASS="l">1088</TD><TD> </TD></TR><TR><TD CLASS="l">1089</TD><TD>        private static String getTypeNames(ITypeBinding[] types) {</TD></TR><TR CLASS="z"><TD CLASS="l">1090</TD><TD>                StringBuffer buf= new StringBuffer();</TD></TR><TR CLASS="z"><TD CLASS="l">1091</TD><TD>                for (int i= 0; i &lt; types.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1092</TD><TD>                        if (i &gt; 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1093</TD><TD>                                buf.append(&#34;, &#34;); //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">1094</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1095</TD><TD>                        buf.append(ASTResolving.getTypeSignature(types[i]));</TD></TR><TR><TD CLASS="l">1096</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="15">1097</A></TD><TD>                return buf.toString();</TD></TR><TR><TD CLASS="l">1098</TD><TD>        }</TD></TR><TR><TD CLASS="l">1099</TD><TD> </TD></TR><TR><TD CLASS="l">1100</TD><TD>        private static String getArgumentName(IJavaScriptUnit cu, List arguments, int index) {</TD></TR><TR CLASS="z"><TD CLASS="l">1101</TD><TD>                String def= String.valueOf(index + 1);</TD></TR><TR><TD CLASS="l">1102</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1103</TD><TD>                ASTNode expr= (ASTNode) arguments.get(index);</TD></TR><TR CLASS="z"><TD CLASS="l">1104</TD><TD>                if (expr.getLength() &gt; 18) {</TD></TR><TR CLASS="z"><TD CLASS="l">1105</TD><TD>                        return def;</TD></TR><TR><TD CLASS="l">1106</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1107</TD><TD>                ASTMatcher matcher= new ASTMatcher();</TD></TR><TR CLASS="z"><TD CLASS="l">1108</TD><TD>                for (int i= 0; i &lt; arguments.size(); i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1109</TD><TD>                        if (i != index &amp;&amp; matcher.safeSubtreeMatch(expr, arguments.get(i))) {</TD></TR><TR CLASS="z"><TD CLASS="l">1110</TD><TD>                                return def;</TD></TR><TR><TD CLASS="l">1111</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1112</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="11">1113</A></TD><TD>                return '\'' + ASTNodes.asString(expr) + '\'';</TD></TR><TR><TD CLASS="l">1114</TD><TD>        }</TD></TR><TR><TD CLASS="l">1115</TD><TD> </TD></TR><TR><TD CLASS="l">1116</TD><TD>        private static void doMoreArguments(IInvocationContext context, IProblemLocation problem, ASTNode invocationNode, List arguments, ITypeBinding[] argTypes, IFunctionBinding methodRef, Collection proposals) throws CoreException {</TD></TR><TR CLASS="z"><TD CLASS="l">1117</TD><TD>                ITypeBinding[] paramTypes= methodRef.getParameterTypes();</TD></TR><TR CLASS="z"><TD CLASS="l">1118</TD><TD>                int k= 0, nSkipped= 0;</TD></TR><TR CLASS="z"><TD CLASS="l">1119</TD><TD>                int diff= argTypes.length - paramTypes.length;</TD></TR><TR CLASS="z"><TD CLASS="l">1120</TD><TD>                int[] indexSkipped= new int[diff];</TD></TR><TR CLASS="z"><TD CLASS="l">1121</TD><TD>                for (int i= 0; i &lt; argTypes.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1122</TD><TD>                        if (k &lt; paramTypes.length &amp;&amp; canAssign(argTypes[i], paramTypes[k])) {</TD></TR><TR CLASS="z"><TD CLASS="l">1123</TD><TD>                                k++; // match</TD></TR><TR><TD CLASS="l">1124</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1125</TD><TD>                                if (nSkipped &gt;= diff) {</TD></TR><TR CLASS="z"><TD CLASS="l">1126</TD><TD>                                        return; // too different</TD></TR><TR><TD CLASS="l">1127</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1128</TD><TD>                                indexSkipped[nSkipped++]= i;</TD></TR><TR><TD CLASS="l">1129</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1130</TD><TD>                }</TD></TR><TR><TD CLASS="l">1131</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1132</TD><TD>                IJavaScriptUnit cu= context.getCompilationUnit();</TD></TR><TR CLASS="z"><TD CLASS="l">1133</TD><TD>                JavaScriptUnit astRoot= context.getASTRoot();</TD></TR><TR><TD CLASS="l">1134</TD><TD> </TD></TR><TR><TD CLASS="l">1135</TD><TD>                // remove arguments</TD></TR><TR><TD CLASS="l">1136</TD><TD>                {</TD></TR><TR CLASS="z"><TD CLASS="l">1137</TD><TD>                        ASTRewrite rewrite= ASTRewrite.create(astRoot.getAST());</TD></TR><TR><TD CLASS="l">1138</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1139</TD><TD>                        for (int i= diff - 1; i &gt;= 0; i--) {</TD></TR><TR CLASS="z"><TD CLASS="l">1140</TD><TD>                                rewrite.remove((Expression) arguments.get(indexSkipped[i]), null);</TD></TR><TR><TD CLASS="l">1141</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1142</TD><TD>                        String[] arg= new String[] { ASTResolving.getMethodSignature(methodRef, false) };</TD></TR><TR><TD CLASS="l">1143</TD><TD>                        String label;</TD></TR><TR CLASS="z"><TD CLASS="l">1144</TD><TD>                        if (diff == 1) {</TD></TR><TR CLASS="z"><TD CLASS="l">1145</TD><TD>                                label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_removeargument_description, arg);</TD></TR><TR><TD CLASS="l">1146</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1147</TD><TD>                                label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_removearguments_description, arg);</TD></TR><TR><TD CLASS="l">1148</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1149</TD><TD>                        Image image= JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_REMOVE);</TD></TR><TR CLASS="z"><TD CLASS="l">1150</TD><TD>                        ASTRewriteCorrectionProposal proposal= new ASTRewriteCorrectionProposal(label, cu, rewrite, 8, image);</TD></TR><TR CLASS="z"><TD CLASS="l">1151</TD><TD>                        proposals.add(proposal);</TD></TR><TR><TD CLASS="l">1152</TD><TD>                }</TD></TR><TR><TD CLASS="l">1153</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1154</TD><TD>                IFunctionBinding methodDecl= methodRef.getMethodDeclaration();</TD></TR><TR CLASS="z"><TD CLASS="l">1155</TD><TD>                ITypeBinding declaringType= methodDecl.getDeclaringClass();</TD></TR><TR><TD CLASS="l">1156</TD><TD> </TD></TR><TR><TD CLASS="l">1157</TD><TD>                // add parameters</TD></TR><TR CLASS="z"><TD CLASS="l">1158</TD><TD>                if (!declaringType.isFromSource()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1159</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">1160</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1161</TD><TD>                IJavaScriptUnit targetCU= ASTResolving.findCompilationUnitForBinding(cu, astRoot, declaringType);</TD></TR><TR CLASS="z"><TD CLASS="l">1162</TD><TD>                if (targetCU != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1163</TD><TD>                        boolean isDifferentCU= !cu.equals(targetCU);</TD></TR><TR><TD CLASS="l">1164</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1165</TD><TD>                        if (isImplicitConstructor(methodDecl, targetCU)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1166</TD><TD>                                return;</TD></TR><TR><TD CLASS="l">1167</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1168</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1169</TD><TD>                        ChangeDescription[] changeDesc= new ChangeDescription[argTypes.length];</TD></TR><TR CLASS="z"><TD CLASS="l">1170</TD><TD>                        ITypeBinding[] changeTypes= new ITypeBinding[diff];</TD></TR><TR CLASS="z"><TD CLASS="l">1171</TD><TD>                        for (int i= diff - 1; i &gt;= 0; i--) {</TD></TR><TR CLASS="z"><TD CLASS="l">1172</TD><TD>                                int idx= indexSkipped[i];</TD></TR><TR CLASS="z"><TD CLASS="l">1173</TD><TD>                                Expression arg= (Expression) arguments.get(idx);</TD></TR><TR CLASS="z"><TD CLASS="l">1174</TD><TD>                                String name= arg instanceof SimpleName ? ((SimpleName) arg).getIdentifier() : null;</TD></TR><TR CLASS="z"><TD CLASS="l">1175</TD><TD>                                ITypeBinding newType= Bindings.normalizeTypeBinding(argTypes[idx]);</TD></TR><TR CLASS="z"><TD CLASS="l">1176</TD><TD>                                if (newType == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1177</TD><TD>                                        newType= astRoot.getAST().resolveWellKnownType(&#34;java.lang.Object&#34;); //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">1178</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1179</TD><TD>                                if (newType.isWildcardType()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1180</TD><TD>                                        newType= ASTResolving.normalizeWildcardType(newType, true, astRoot.getAST());</TD></TR><TR><TD CLASS="l">1181</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1182</TD><TD>                                if (!ASTResolving.isUseableTypeInContext(newType, methodDecl, false)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1183</TD><TD>                                        return;</TD></TR><TR><TD CLASS="l">1184</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1185</TD><TD>                                changeDesc[idx]= new InsertDescription(newType, name);</TD></TR><TR CLASS="z"><TD CLASS="l">1186</TD><TD>                                changeTypes[i]= newType;</TD></TR><TR><TD CLASS="l">1187</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1188</TD><TD>                        String[] arg= new String[] { ASTResolving.getMethodSignature(methodDecl, isDifferentCU), getTypeNames(changeTypes) };</TD></TR><TR><TD CLASS="l">1189</TD><TD>                        String label;</TD></TR><TR CLASS="z"><TD CLASS="l">1190</TD><TD>                        if (methodDecl.isConstructor()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1191</TD><TD>                                if (diff == 1) {</TD></TR><TR CLASS="z"><TD CLASS="l">1192</TD><TD>                                        label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_addparam_constr_description, arg);</TD></TR><TR><TD CLASS="l">1193</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1194</TD><TD>                                        label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_addparams_constr_description, arg);</TD></TR><TR><TD CLASS="l">1195</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1196</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1197</TD><TD>                                if (diff == 1) {</TD></TR><TR CLASS="z"><TD CLASS="l">1198</TD><TD>                                        label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_addparam_description, arg);</TD></TR><TR><TD CLASS="l">1199</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1200</TD><TD>                                        label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_addparams_description, arg);</TD></TR><TR><TD CLASS="l">1201</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1202</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1203</TD><TD>                        Image image= JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_ADD);</TD></TR><TR CLASS="z"><TD CLASS="l">1204</TD><TD>                        ChangeMethodSignatureProposal proposal= new ChangeMethodSignatureProposal(label, targetCU, invocationNode, methodDecl, changeDesc, null, 5, image);</TD></TR><TR CLASS="z"><TD CLASS="l">1205</TD><TD>                        proposals.add(proposal);</TD></TR><TR><TD CLASS="l"><A NAME="20">1206</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1207</TD><TD>        }</TD></TR><TR><TD CLASS="l">1208</TD><TD> </TD></TR><TR><TD CLASS="l">1209</TD><TD>        private static boolean isImplicitConstructor(IFunctionBinding meth, IJavaScriptUnit targetCU) {</TD></TR><TR CLASS="z"><TD CLASS="l">1210</TD><TD>                return meth.isDefaultConstructor();</TD></TR><TR><TD CLASS="l">1211</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="1a">1212</A></TD><TD> </TD></TR><TR><TD CLASS="l">1213</TD><TD> </TD></TR><TR><TD CLASS="l">1214</TD><TD> </TD></TR><TR><TD CLASS="l">1215</TD><TD>        private static ITypeBinding[] getParameterTypes(List args) {</TD></TR><TR CLASS="z"><TD CLASS="l">1216</TD><TD>                ITypeBinding[] params= new ITypeBinding[args.size()];</TD></TR><TR CLASS="z"><TD CLASS="l">1217</TD><TD>                for (int i= 0; i &lt; args.size(); i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1218</TD><TD>                        Expression expr= (Expression) args.get(i);</TD></TR><TR CLASS="z"><TD CLASS="l">1219</TD><TD>                        ITypeBinding curr= Bindings.normalizeTypeBinding(expr.resolveTypeBinding());</TD></TR><TR CLASS="z"><TD CLASS="l">1220</TD><TD>                        if (curr != null &amp;&amp; curr.isWildcardType()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1221</TD><TD>                                curr= ASTResolving.normalizeWildcardType(curr, true, expr.getAST());</TD></TR><TR><TD CLASS="l">1222</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1223</TD><TD>                        if (curr == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1224</TD><TD>                                curr= expr.getAST().resolveWellKnownType(&#34;java.lang.Object&#34;); //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">1225</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1226</TD><TD>                        params[i]= curr;</TD></TR><TR><TD CLASS="l">1227</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1228</TD><TD>                return params;</TD></TR><TR><TD CLASS="l">1229</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="10">1230</A></TD><TD> </TD></TR><TR><TD CLASS="l">1231</TD><TD> </TD></TR><TR><TD CLASS="l">1232</TD><TD> </TD></TR><TR><TD CLASS="l">1233</TD><TD>        private static void doEqualNumberOfParameters(IInvocationContext context, ASTNode invocationNode, IProblemLocation problem, List arguments, ITypeBinding[] argTypes, IFunctionBinding methodBinding, Collection proposals) throws CoreException {</TD></TR><TR CLASS="z"><TD CLASS="l">1234</TD><TD>                ITypeBinding[] paramTypes= methodBinding.getParameterTypes();</TD></TR><TR CLASS="z"><TD CLASS="l">1235</TD><TD>                int[] indexOfDiff= new int[paramTypes.length];</TD></TR><TR CLASS="z"><TD CLASS="l">1236</TD><TD>                int nDiffs= 0;</TD></TR><TR CLASS="z"><TD CLASS="l">1237</TD><TD>                for (int n= 0; n &lt; argTypes.length; n++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1238</TD><TD>                        if (!canAssign(argTypes[n], paramTypes[n])) {</TD></TR><TR CLASS="z"><TD CLASS="l">1239</TD><TD>                                indexOfDiff[nDiffs++]= n;</TD></TR><TR><TD CLASS="l">1240</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1241</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1242</TD><TD>                ITypeBinding declaringTypeDecl= methodBinding.getDeclaringClass().getTypeDeclaration();</TD></TR><TR><TD CLASS="l">1243</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1244</TD><TD>                IJavaScriptUnit cu= context.getCompilationUnit();</TD></TR><TR CLASS="z"><TD CLASS="l">1245</TD><TD>                JavaScriptUnit astRoot= context.getASTRoot();</TD></TR><TR><TD CLASS="l">1246</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1247</TD><TD>                ASTNode nameNode= problem.getCoveringNode(astRoot);</TD></TR><TR CLASS="z"><TD CLASS="l">1248</TD><TD>                if (nameNode == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1249</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">1250</TD><TD>                }</TD></TR><TR><TD CLASS="l">1251</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1252</TD><TD>                if (nDiffs == 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1253</TD><TD>                        if (nameNode.getParent() instanceof FunctionInvocation) {</TD></TR><TR CLASS="z"><TD CLASS="l">1254</TD><TD>                                FunctionInvocation inv= (FunctionInvocation) nameNode.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">1255</TD><TD>                                if (inv.getExpression() == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1256</TD><TD>                                        addQualifierToOuterProposal(context, inv, methodBinding, proposals);</TD></TR><TR><TD CLASS="l">1257</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1258</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1259</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">1260</TD><TD>                }</TD></TR><TR><TD CLASS="l">1261</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1262</TD><TD>                if (nDiffs == 1) { // one argument mismatching: try to fix</TD></TR><TR CLASS="z"><TD CLASS="l">1263</TD><TD>                        int idx= indexOfDiff[0];</TD></TR><TR CLASS="z"><TD CLASS="l">1264</TD><TD>                        Expression nodeToCast= (Expression) arguments.get(idx);</TD></TR><TR CLASS="z"><TD CLASS="l">1265</TD><TD>                        ITypeBinding castType= paramTypes[idx];</TD></TR><TR CLASS="z"><TD CLASS="l">1266</TD><TD>                        castType= Bindings.normalizeTypeBinding(castType);</TD></TR><TR CLASS="z"><TD CLASS="l">1267</TD><TD>                        if (castType.isWildcardType()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1268</TD><TD>                                castType= ASTResolving.normalizeWildcardType(castType, false, nodeToCast.getAST());</TD></TR><TR><TD CLASS="l">1269</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1270</TD><TD>                        if (castType != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1271</TD><TD>                                ITypeBinding binding= nodeToCast.resolveTypeBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">1272</TD><TD>                                if (binding == null || binding.isCastCompatible(castType)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1273</TD><TD>                                        ASTRewriteCorrectionProposal proposal= TypeMismatchSubProcessor.createCastProposal(context, castType, nodeToCast, 6);</TD></TR><TR CLASS="z"><TD CLASS="l">1274</TD><TD>                                        String castTypeName= BindingLabelProvider.getBindingLabel(castType, JavaScriptElementLabels.ALL_DEFAULT);</TD></TR><TR CLASS="z"><TD CLASS="l">1275</TD><TD>                                        String[] arg= new String[] { getArgumentName(cu, arguments, idx), castTypeName};</TD></TR><TR CLASS="z"><TD CLASS="l">1276</TD><TD>                                        proposal.setDisplayName(Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_addargumentcast_description, arg));</TD></TR><TR CLASS="z"><TD CLASS="l">1277</TD><TD>                                        proposals.add(proposal);</TD></TR><TR><TD CLASS="l">1278</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1279</TD><TD>                                TypeMismatchSubProcessor.addChangeSenderTypeProposals(context, nodeToCast, castType, false, 5, proposals);</TD></TR><TR><TD CLASS="l">1280</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1281</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1282</TD><TD>                if (nDiffs == 2) { // try to swap</TD></TR><TR CLASS="z"><TD CLASS="l">1283</TD><TD>                        int idx1= indexOfDiff[0];</TD></TR><TR CLASS="z"><TD CLASS="l">1284</TD><TD>                        int idx2= indexOfDiff[1];</TD></TR><TR CLASS="z"><TD CLASS="l">1285</TD><TD>                        boolean canSwap= canAssign(argTypes[idx1], paramTypes[idx2]) &amp;&amp; canAssign(argTypes[idx2], paramTypes[idx1]);</TD></TR><TR CLASS="z"><TD CLASS="l">1286</TD><TD>                         if (canSwap) {</TD></TR><TR CLASS="z"><TD CLASS="l">1287</TD><TD>                                Expression arg1= (Expression) arguments.get(idx1);</TD></TR><TR CLASS="z"><TD CLASS="l">1288</TD><TD>                                Expression arg2= (Expression) arguments.get(idx2);</TD></TR><TR><TD CLASS="l">1289</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1290</TD><TD>                                ASTRewrite rewrite= ASTRewrite.create(astRoot.getAST());</TD></TR><TR CLASS="z"><TD CLASS="l">1291</TD><TD>                                rewrite.replace(arg1, rewrite.createCopyTarget(arg2), null);</TD></TR><TR CLASS="z"><TD CLASS="l">1292</TD><TD>                                rewrite.replace(arg2, rewrite.createCopyTarget(arg1), null);</TD></TR><TR><TD CLASS="l">1293</TD><TD>                                {</TD></TR><TR CLASS="z"><TD CLASS="l">1294</TD><TD>                                        String[] arg= new String[] { getArgumentName(cu, arguments, idx1), getArgumentName(cu, arguments, idx2) };</TD></TR><TR CLASS="z"><TD CLASS="l">1295</TD><TD>                                        String label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_swaparguments_description, arg);</TD></TR><TR CLASS="z"><TD CLASS="l">1296</TD><TD>                                        Image image= JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">1297</TD><TD>                                        ASTRewriteCorrectionProposal proposal= new ASTRewriteCorrectionProposal(label, context.getCompilationUnit(), rewrite, 8, image);</TD></TR><TR CLASS="z"><TD CLASS="l">1298</TD><TD>                                        proposals.add(proposal);</TD></TR><TR><TD CLASS="l">1299</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1300</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1301</TD><TD>                                if (declaringTypeDecl.isFromSource()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1302</TD><TD>                                        IJavaScriptUnit targetCU= ASTResolving.findCompilationUnitForBinding(cu, astRoot, declaringTypeDecl);</TD></TR><TR CLASS="z"><TD CLASS="l">1303</TD><TD>                                        if (targetCU != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1304</TD><TD>                                                ChangeDescription[] changeDesc= new ChangeDescription[paramTypes.length];</TD></TR><TR CLASS="z"><TD CLASS="l">1305</TD><TD>                                                for (int i= 0; i &lt; nDiffs; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1306</TD><TD>                                                        changeDesc[idx1]= new SwapDescription(idx2);</TD></TR><TR><TD CLASS="l">1307</TD><TD>                                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1308</TD><TD>                                                IFunctionBinding methodDecl= methodBinding.getMethodDeclaration();</TD></TR><TR CLASS="z"><TD CLASS="l">1309</TD><TD>                                                ITypeBinding[] declParamTypes= methodDecl.getParameterTypes();</TD></TR><TR><TD CLASS="l">1310</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1311</TD><TD>                                                ITypeBinding[] swappedTypes= new ITypeBinding[] { declParamTypes[idx1], declParamTypes[idx2] };</TD></TR><TR CLASS="z"><TD CLASS="l">1312</TD><TD>                                                String[] args=  new String[] { ASTResolving.getMethodSignature(methodDecl, !targetCU.equals(cu)), getTypeNames(swappedTypes) };</TD></TR><TR><TD CLASS="l">1313</TD><TD>                                                String label;</TD></TR><TR CLASS="z"><TD CLASS="l">1314</TD><TD>                                                if (methodDecl.isConstructor()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1315</TD><TD>                                                        label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_swapparams_constr_description, args);</TD></TR><TR><TD CLASS="l">1316</TD><TD>                                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1317</TD><TD>                                                        label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_swapparams_description, args);</TD></TR><TR><TD CLASS="l">1318</TD><TD>                                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1319</TD><TD>                                                Image image= JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">1320</TD><TD>                                                ChangeMethodSignatureProposal proposal= new ChangeMethodSignatureProposal(label, targetCU, invocationNode, methodDecl, changeDesc, null, 5, image);</TD></TR><TR CLASS="z"><TD CLASS="l">1321</TD><TD>                                                proposals.add(proposal);</TD></TR><TR><TD CLASS="l">1322</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">1323</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1324</TD><TD>                                return;</TD></TR><TR><TD CLASS="l">1325</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1326</TD><TD>                }</TD></TR><TR><TD CLASS="l">1327</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1328</TD><TD>                if (declaringTypeDecl.isFromSource()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1329</TD><TD>                        IJavaScriptUnit targetCU= ASTResolving.findCompilationUnitForBinding(cu, astRoot, declaringTypeDecl);</TD></TR><TR CLASS="z"><TD CLASS="l">1330</TD><TD>                        if (targetCU != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1331</TD><TD>                                ChangeDescription[] changeDesc= createSignatureChangeDescription(indexOfDiff, nDiffs, paramTypes, arguments, argTypes);</TD></TR><TR CLASS="z"><TD CLASS="l">1332</TD><TD>                                if (changeDesc != null) {</TD></TR><TR><TD CLASS="l">1333</TD><TD>                                </TD></TR><TR CLASS="z"><TD CLASS="l">1334</TD><TD>                                        IFunctionBinding methodDecl= methodBinding.getMethodDeclaration();</TD></TR><TR CLASS="z"><TD CLASS="l">1335</TD><TD>                                        ITypeBinding[] declParamTypes= methodDecl.getParameterTypes();</TD></TR><TR><TD CLASS="l">1336</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">1337</TD><TD>                                        ITypeBinding[] newParamTypes= new ITypeBinding[changeDesc.length];</TD></TR><TR CLASS="z"><TD CLASS="l">1338</TD><TD>                                        for (int i= 0; i &lt; newParamTypes.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1339</TD><TD>                                                newParamTypes[i]= changeDesc[i] == null ? declParamTypes[i] : ((EditDescription) changeDesc[i]).type;</TD></TR><TR><TD CLASS="l">1340</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1341</TD><TD>                                        boolean isVarArgs= methodDecl.isVarargs() &amp;&amp; newParamTypes.length &gt; 0 &amp;&amp; newParamTypes[newParamTypes.length - 1].isArray();</TD></TR><TR CLASS="z"><TD CLASS="l">1342</TD><TD>                                        String[] args=  new String[] { ASTResolving.getMethodSignature(methodDecl, !targetCU.equals(cu)), ASTResolving.getMethodSignature(methodDecl.getName(), newParamTypes, isVarArgs) };</TD></TR><TR><TD CLASS="l">1343</TD><TD>                                        String label;</TD></TR><TR CLASS="z"><TD CLASS="l">1344</TD><TD>                                        if (methodDecl.isConstructor()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1345</TD><TD>                                                label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_changeparamsignature_constr_description, args);</TD></TR><TR><TD CLASS="l">1346</TD><TD>                                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1347</TD><TD>                                                label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_changeparamsignature_description, args);</TD></TR><TR><TD CLASS="l">1348</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1349</TD><TD>                                        Image image= JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">1350</TD><TD>                                        ChangeMethodSignatureProposal proposal= new ChangeMethodSignatureProposal(label, targetCU, invocationNode, methodDecl, changeDesc, null, 7, image);</TD></TR><TR CLASS="z"><TD CLASS="l">1351</TD><TD>                                        proposals.add(proposal);</TD></TR><TR><TD CLASS="l">1352</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1353</TD><TD>                        }</TD></TR><TR><TD CLASS="l"><A NAME="d">1354</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1355</TD><TD>        }</TD></TR><TR><TD CLASS="l">1356</TD><TD> </TD></TR><TR><TD CLASS="l">1357</TD><TD>        private static ChangeDescription[] createSignatureChangeDescription(int[] indexOfDiff, int nDiffs, ITypeBinding[] paramTypes, List arguments, ITypeBinding[] argTypes) {</TD></TR><TR CLASS="z"><TD CLASS="l">1358</TD><TD>                ChangeDescription[] changeDesc= new ChangeDescription[paramTypes.length];</TD></TR><TR CLASS="z"><TD CLASS="l">1359</TD><TD>                for (int i= 0; i &lt; nDiffs; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1360</TD><TD>                        int diffIndex= indexOfDiff[i];</TD></TR><TR CLASS="z"><TD CLASS="l">1361</TD><TD>                        Expression arg= (Expression) arguments.get(diffIndex);</TD></TR><TR CLASS="z"><TD CLASS="l">1362</TD><TD>                        String name= arg instanceof SimpleName ? ((SimpleName) arg).getIdentifier() : null;</TD></TR><TR CLASS="z"><TD CLASS="l">1363</TD><TD>                        ITypeBinding argType= argTypes[diffIndex];</TD></TR><TR CLASS="z"><TD CLASS="l">1364</TD><TD>                        if (argType.isWildcardType()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1365</TD><TD>                                argType= ASTResolving.normalizeWildcardType(argType, true, arg.getAST());</TD></TR><TR CLASS="z"><TD CLASS="l">1366</TD><TD>                                if (argType== null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1367</TD><TD>                                        return null;</TD></TR><TR><TD CLASS="l">1368</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1369</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1370</TD><TD>                        changeDesc[diffIndex]= new EditDescription(argType, name);</TD></TR><TR><TD CLASS="l">1371</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="16">1372</A></TD><TD>                return changeDesc;</TD></TR><TR><TD CLASS="l">1373</TD><TD>        }</TD></TR><TR><TD CLASS="l">1374</TD><TD> </TD></TR><TR><TD CLASS="l">1375</TD><TD>        private static ITypeBinding[] getArgumentTypes(List arguments) {</TD></TR><TR CLASS="z"><TD CLASS="l">1376</TD><TD>                ITypeBinding[] res= new ITypeBinding[arguments.size()];</TD></TR><TR CLASS="z"><TD CLASS="l">1377</TD><TD>                for (int i= 0; i &lt; res.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1378</TD><TD>                        Expression expression= (Expression) arguments.get(i);</TD></TR><TR CLASS="z"><TD CLASS="l">1379</TD><TD>                         ITypeBinding curr= expression.resolveTypeBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">1380</TD><TD>                        if (curr == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1381</TD><TD>                                return null;</TD></TR><TR><TD CLASS="l">1382</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1383</TD><TD>                        if (!curr.isNullType()) {        // don't normalize null type</TD></TR><TR CLASS="z"><TD CLASS="l">1384</TD><TD>                                curr= Bindings.normalizeTypeBinding(curr);</TD></TR><TR CLASS="z"><TD CLASS="l">1385</TD><TD>                                if (curr == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1386</TD><TD>                                        curr= expression.getAST().resolveWellKnownType(&#34;java.lang.Object&#34;); //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">1387</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1388</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1389</TD><TD>                        res[i]= curr;</TD></TR><TR><TD CLASS="l">1390</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="9">1391</A></TD><TD>                return res;</TD></TR><TR><TD CLASS="l">1392</TD><TD>        }</TD></TR><TR><TD CLASS="l">1393</TD><TD> </TD></TR><TR><TD CLASS="l">1394</TD><TD>        private static void addQualifierToOuterProposal(IInvocationContext context, FunctionInvocation invocationNode, IFunctionBinding binding, Collection proposals) throws CoreException {</TD></TR><TR CLASS="z"><TD CLASS="l">1395</TD><TD>                ITypeBinding declaringType= binding.getDeclaringClass();</TD></TR><TR CLASS="z"><TD CLASS="l">1396</TD><TD>                ITypeBinding parentType= Bindings.getBindingOfParentType(invocationNode);</TD></TR><TR CLASS="z"><TD CLASS="l">1397</TD><TD>                ITypeBinding currType= parentType;</TD></TR><TR><TD CLASS="l">1398</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1399</TD><TD>                boolean isInstanceMethod= !Modifier.isStatic(binding.getModifiers());</TD></TR><TR><TD CLASS="l">1400</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1401</TD><TD>                while (currType != null &amp;&amp; !Bindings.isSuperType(declaringType, currType)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1402</TD><TD>                        if (isInstanceMethod &amp;&amp; Modifier.isStatic(currType.getModifiers())) {</TD></TR><TR CLASS="z"><TD CLASS="l">1403</TD><TD>                                return;</TD></TR><TR><TD CLASS="l">1404</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1405</TD><TD>                        currType= currType.getDeclaringClass();</TD></TR><TR><TD CLASS="l">1406</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1407</TD><TD>                if (currType == null || currType == parentType) {</TD></TR><TR CLASS="z"><TD CLASS="l">1408</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">1409</TD><TD>                }</TD></TR><TR><TD CLASS="l">1410</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1411</TD><TD>                ASTRewrite rewrite= ASTRewrite.create(invocationNode.getAST());</TD></TR><TR><TD CLASS="l">1412</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">1413</TD><TD>                String label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_changetoouter_description, ASTResolving.getTypeSignature(currType));</TD></TR><TR CLASS="z"><TD CLASS="l">1414</TD><TD>                Image image= JavaPluginImages.get(JavaPluginImages.IMG_CORRECTION_CHANGE);</TD></TR><TR CLASS="z"><TD CLASS="l">1415</TD><TD>                ASTRewriteCorrectionProposal proposal= new ASTRewriteCorrectionProposal(label, context.getCompilationUnit(), rewrite, 8, image);</TD></TR><TR><TD CLASS="l">1416</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">1417</TD><TD>                ImportRewrite imports= proposal.createImportRewrite(context.getASTRoot());</TD></TR><TR CLASS="z"><TD CLASS="l">1418</TD><TD>                AST ast= invocationNode.getAST();</TD></TR><TR><TD CLASS="l">1419</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1420</TD><TD>                String qualifier= imports.addImport(currType);</TD></TR><TR CLASS="z"><TD CLASS="l">1421</TD><TD>                Name name= ASTNodeFactory.newName(ast, qualifier);</TD></TR><TR><TD CLASS="l">1422</TD><TD> </TD></TR><TR><TD CLASS="l">1423</TD><TD>                Expression newExpression;</TD></TR><TR CLASS="z"><TD CLASS="l">1424</TD><TD>                if (isInstanceMethod) {</TD></TR><TR CLASS="z"><TD CLASS="l">1425</TD><TD>                        ThisExpression expr= ast.newThisExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">1426</TD><TD>                        expr.setQualifier(name);</TD></TR><TR CLASS="z"><TD CLASS="l">1427</TD><TD>                        newExpression= expr;</TD></TR><TR><TD CLASS="l">1428</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1429</TD><TD>                        newExpression= name;</TD></TR><TR><TD CLASS="l">1430</TD><TD>                }</TD></TR><TR><TD CLASS="l">1431</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1432</TD><TD>                rewrite.set(invocationNode, FunctionInvocation.EXPRESSION_PROPERTY, newExpression, null);</TD></TR><TR><TD CLASS="l">1433</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1434</TD><TD>                proposals.add(proposal);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="18">1435</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">1436</TD><TD> </TD></TR><TR><TD CLASS="l">1437</TD><TD> </TD></TR><TR><TD CLASS="l">1438</TD><TD>        public static void getConstructorProposals(IInvocationContext context, IProblemLocation problem, Collection proposals) throws CoreException {</TD></TR><TR CLASS="z"><TD CLASS="l">1439</TD><TD>                IJavaScriptUnit cu= context.getCompilationUnit();</TD></TR><TR><TD CLASS="l">1440</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1441</TD><TD>                JavaScriptUnit astRoot= context.getASTRoot();</TD></TR><TR CLASS="z"><TD CLASS="l">1442</TD><TD>                ASTNode selectedNode= problem.getCoveringNode(astRoot);</TD></TR><TR CLASS="z"><TD CLASS="l">1443</TD><TD>                if (selectedNode == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1444</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">1445</TD><TD>                }</TD></TR><TR><TD CLASS="l">1446</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1447</TD><TD>                ITypeBinding targetBinding= null;</TD></TR><TR CLASS="z"><TD CLASS="l">1448</TD><TD>                List arguments= null;</TD></TR><TR CLASS="z"><TD CLASS="l">1449</TD><TD>                IFunctionBinding recursiveConstructor= null;</TD></TR><TR><TD CLASS="l">1450</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1451</TD><TD>                int type= selectedNode.getNodeType();</TD></TR><TR CLASS="z"><TD CLASS="l">1452</TD><TD>                if (type == ASTNode.CLASS_INSTANCE_CREATION) {</TD></TR><TR CLASS="z"><TD CLASS="l">1453</TD><TD>                        ClassInstanceCreation creation= (ClassInstanceCreation) selectedNode;</TD></TR><TR><TD CLASS="l">1454</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1455</TD><TD>                        IBinding binding= creation.getType().resolveBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">1456</TD><TD>                        if (binding instanceof ITypeBinding) {</TD></TR><TR CLASS="z"><TD CLASS="l">1457</TD><TD>                                targetBinding= (ITypeBinding) binding;</TD></TR><TR CLASS="z"><TD CLASS="l">1458</TD><TD>                                arguments= creation.arguments();</TD></TR><TR><TD CLASS="l">1459</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1460</TD><TD>                } else if (type == ASTNode.SUPER_CONSTRUCTOR_INVOCATION) {</TD></TR><TR CLASS="z"><TD CLASS="l">1461</TD><TD>                        ITypeBinding typeBinding= Bindings.getBindingOfParentType(selectedNode);</TD></TR><TR CLASS="z"><TD CLASS="l">1462</TD><TD>                        if (typeBinding != null &amp;&amp; !typeBinding.isAnonymous()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1463</TD><TD>                                targetBinding= typeBinding.getSuperclass();</TD></TR><TR CLASS="z"><TD CLASS="l">1464</TD><TD>                                arguments= ((SuperConstructorInvocation) selectedNode).arguments();</TD></TR><TR><TD CLASS="l">1465</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">1466</TD><TD>                } else if (type == ASTNode.CONSTRUCTOR_INVOCATION) {</TD></TR><TR CLASS="z"><TD CLASS="l">1467</TD><TD>                        ITypeBinding typeBinding= Bindings.getBindingOfParentType(selectedNode);</TD></TR><TR CLASS="z"><TD CLASS="l">1468</TD><TD>                        if (typeBinding != null &amp;&amp; !typeBinding.isAnonymous()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1469</TD><TD>                                targetBinding= typeBinding;</TD></TR><TR CLASS="z"><TD CLASS="l">1470</TD><TD>                                arguments= ((ConstructorInvocation) selectedNode).arguments();</TD></TR><TR CLASS="z"><TD CLASS="l">1471</TD><TD>                                recursiveConstructor= ASTResolving.findParentMethodDeclaration(selectedNode).resolveBinding();</TD></TR><TR><TD CLASS="l">1472</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1473</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1474</TD><TD>                if (targetBinding == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1475</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">1476</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1477</TD><TD>                IFunctionBinding[] methods= targetBinding.getDeclaredMethods();</TD></TR><TR CLASS="z"><TD CLASS="l">1478</TD><TD>                ArrayList similarElements= new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">1479</TD><TD>                for (int i= 0; i &lt; methods.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1480</TD><TD>                        IFunctionBinding curr= methods[i];</TD></TR><TR CLASS="z"><TD CLASS="l">1481</TD><TD>                        if (curr.isConstructor() &amp;&amp; recursiveConstructor != curr) {</TD></TR><TR CLASS="z"><TD CLASS="l">1482</TD><TD>                                similarElements.add(curr); // similar elements can contain a implicit default constructor</TD></TR><TR><TD CLASS="l">1483</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1484</TD><TD>                }</TD></TR><TR><TD CLASS="l">1485</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1486</TD><TD>                addParameterMissmatchProposals(context, problem, similarElements, selectedNode, arguments, proposals);</TD></TR><TR><TD CLASS="l">1487</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1488</TD><TD>                if (targetBinding.isFromSource()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1489</TD><TD>                        ITypeBinding targetDecl= targetBinding.getTypeDeclaration();</TD></TR><TR><TD CLASS="l">1490</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1491</TD><TD>                        IJavaScriptUnit targetCU= ASTResolving.findCompilationUnitForBinding(cu, astRoot, targetDecl);</TD></TR><TR CLASS="z"><TD CLASS="l">1492</TD><TD>                        if (targetCU != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1493</TD><TD>                                String[] args= new String[] { ASTResolving.getMethodSignature( ASTResolving.getTypeSignature(targetDecl), getParameterTypes(arguments), false) };</TD></TR><TR CLASS="z"><TD CLASS="l">1494</TD><TD>                                String label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_createconstructor_description, args);</TD></TR><TR CLASS="z"><TD CLASS="l">1495</TD><TD>                                Image image= JavaElementImageProvider.getDecoratedImage(JavaPluginImages.DESC_MISC_PUBLIC, JavaScriptElementImageDescriptor.CONSTRUCTOR, JavaElementImageProvider.SMALL_SIZE);</TD></TR><TR CLASS="z"><TD CLASS="l">1496</TD><TD>                                proposals.add(new NewMethodCompletionProposal(label, targetCU, selectedNode, arguments, targetDecl, 5, image));</TD></TR><TR><TD CLASS="l">1497</TD><TD>                        }</TD></TR><TR><TD CLASS="l"><A NAME="14">1498</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1499</TD><TD>        }</TD></TR><TR><TD CLASS="l">1500</TD><TD> </TD></TR><TR><TD CLASS="l">1501</TD><TD>        public static void getAmbiguosTypeReferenceProposals(IInvocationContext context, IProblemLocation problem, Collection proposals) throws CoreException {</TD></TR><TR CLASS="z"><TD CLASS="l">1502</TD><TD>                final IJavaScriptUnit cu= context.getCompilationUnit();</TD></TR><TR CLASS="z"><TD CLASS="l">1503</TD><TD>                int offset= problem.getOffset();</TD></TR><TR CLASS="z"><TD CLASS="l">1504</TD><TD>                int len= problem.getLength();</TD></TR><TR><TD CLASS="l">1505</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1506</TD><TD>                IJavaScriptElement[] elements= cu.codeSelect(offset, len);</TD></TR><TR CLASS="z"><TD CLASS="l">1507</TD><TD>                for (int i= 0; i &lt; elements.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1508</TD><TD>                        IJavaScriptElement curr= elements[i];</TD></TR><TR CLASS="z"><TD CLASS="l">1509</TD><TD>                        if (curr instanceof IType &amp;&amp; !TypeFilter.isFiltered((IType) curr)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1510</TD><TD>                                String qualifiedTypeName= JavaModelUtil.getFullyQualifiedName((IType) curr);</TD></TR><TR><TD CLASS="l">1511</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1512</TD><TD>                                JavaScriptUnit root= context.getASTRoot();</TD></TR><TR><TD CLASS="l">1513</TD><TD>                                </TD></TR><TR CLASS="z"><TD CLASS="l">1514</TD><TD>                                String label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_importexplicit_description, qualifiedTypeName);</TD></TR><TR CLASS="z"><TD CLASS="l">1515</TD><TD>                                Image image= JavaPluginImages.get(JavaPluginImages.IMG_OBJS_IMPDECL);</TD></TR><TR CLASS="z"><TD CLASS="l">1516</TD><TD>                                ASTRewriteCorrectionProposal proposal= new ASTRewriteCorrectionProposal(label, cu, ASTRewrite.create(root.getAST()), 5, image);</TD></TR><TR><TD CLASS="l">1517</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1518</TD><TD>                                ImportRewrite imports= proposal.createImportRewrite(root);</TD></TR><TR CLASS="z"><TD CLASS="l">1519</TD><TD>                                imports.addImport(qualifiedTypeName);</TD></TR><TR><TD CLASS="l">1520</TD><TD>                                </TD></TR><TR CLASS="z"><TD CLASS="l">1521</TD><TD>                                proposals.add(proposal);</TD></TR><TR><TD CLASS="l">1522</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1523</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="17">1524</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">1525</TD><TD> </TD></TR><TR><TD CLASS="l">1526</TD><TD>        public static void getArrayAccessProposals(IInvocationContext context, IProblemLocation problem, Collection proposals) {</TD></TR><TR><TD CLASS="l">1527</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1528</TD><TD>                JavaScriptUnit root= context.getASTRoot();</TD></TR><TR CLASS="z"><TD CLASS="l">1529</TD><TD>                ASTNode selectedNode= problem.getCoveringNode(root);</TD></TR><TR CLASS="z"><TD CLASS="l">1530</TD><TD>                if (!(selectedNode instanceof FunctionInvocation)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1531</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">1532</TD><TD>                }</TD></TR><TR><TD CLASS="l">1533</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1534</TD><TD>                FunctionInvocation decl= (FunctionInvocation) selectedNode;</TD></TR><TR CLASS="z"><TD CLASS="l">1535</TD><TD>                SimpleName nameNode= decl.getName();</TD></TR><TR CLASS="z"><TD CLASS="l">1536</TD><TD>                String methodName= nameNode.getIdentifier();</TD></TR><TR><TD CLASS="l">1537</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">1538</TD><TD>                IBinding[] bindings= (new ScopeAnalyzer(root)).getDeclarationsInScope(nameNode, ScopeAnalyzer.METHODS);</TD></TR><TR CLASS="z"><TD CLASS="l">1539</TD><TD>                for (int i= 0; i &lt; bindings.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1540</TD><TD>                        String currName= bindings[i].getName();</TD></TR><TR CLASS="z"><TD CLASS="l">1541</TD><TD>                        if (NameMatcher.isSimilarName(methodName, currName)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1542</TD><TD>                                String label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_arraychangetomethod_description, currName);</TD></TR><TR CLASS="z"><TD CLASS="l">1543</TD><TD>                                proposals.add(new RenameNodeCompletionProposal(label, context.getCompilationUnit(), nameNode.getStartPosition(), nameNode.getLength(), currName, 6));</TD></TR><TR><TD CLASS="l">1544</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1545</TD><TD>                }</TD></TR><TR><TD CLASS="l">1546</TD><TD>                // always suggest 'length'</TD></TR><TR CLASS="z"><TD CLASS="l">1547</TD><TD>                String lengthId= &#34;length&#34;; //$NON-NLS-1$</TD></TR><TR CLASS="z"><TD CLASS="l">1548</TD><TD>                String label= CorrectionMessages.UnresolvedElementsSubProcessor_arraychangetolength_description;</TD></TR><TR CLASS="z"><TD CLASS="l">1549</TD><TD>                int offset= nameNode.getStartPosition();</TD></TR><TR CLASS="z"><TD CLASS="l">1550</TD><TD>                int length= decl.getStartPosition() + decl.getLength() - offset;</TD></TR><TR CLASS="z"><TD CLASS="l">1551</TD><TD>                proposals.add(new RenameNodeCompletionProposal(label, context.getCompilationUnit(), offset, length, lengthId, 7));</TD></TR><TR CLASS="z"><TD CLASS="l">1552</TD><TD>        }</TD></TR><TR><TD CLASS="l">1553</TD><TD> </TD></TR><TR><TD CLASS="l">1554</TD><TD>//        public static void getAnnotationMemberProposals(IInvocationContext context, IProblemLocation problem, Collection proposals) throws CoreException {</TD></TR><TR><TD CLASS="l">1555</TD><TD>//                JavaScriptUnit astRoot= context.getASTRoot();</TD></TR><TR><TD CLASS="l">1556</TD><TD>//                IJavaScriptUnit cu= context.getCompilationUnit();</TD></TR><TR><TD CLASS="l">1557</TD><TD>//                ASTNode selectedNode= problem.getCoveringNode(astRoot);</TD></TR><TR><TD CLASS="l">1558</TD><TD>//</TD></TR><TR><TD CLASS="l">1559</TD><TD>//                Annotation annotation;</TD></TR><TR><TD CLASS="l">1560</TD><TD>//                String memberName;</TD></TR><TR><TD CLASS="l">1561</TD><TD>//                if (selectedNode.getLocationInParent() == MemberValuePair.NAME_PROPERTY) {</TD></TR><TR><TD CLASS="l">1562</TD><TD>//                        if (selectedNode.getParent().getLocationInParent() != NormalAnnotation.VALUES_PROPERTY) {</TD></TR><TR><TD CLASS="l">1563</TD><TD>//                                return;</TD></TR><TR><TD CLASS="l">1564</TD><TD>//                        }</TD></TR><TR><TD CLASS="l">1565</TD><TD>//                        annotation= (Annotation) selectedNode.getParent().getParent();</TD></TR><TR><TD CLASS="l">1566</TD><TD>//                        memberName= ((SimpleName) selectedNode).getIdentifier();</TD></TR><TR><TD CLASS="l">1567</TD><TD>//                } else if (selectedNode.getLocationInParent() == SingleMemberAnnotation.VALUE_PROPERTY) {</TD></TR><TR><TD CLASS="l">1568</TD><TD>//                        annotation= (Annotation) selectedNode.getParent();</TD></TR><TR><TD CLASS="l">1569</TD><TD>//                        memberName= &#34;value&#34;; //$NON-NLS-1$</TD></TR><TR><TD CLASS="l">1570</TD><TD>//                } else {</TD></TR><TR><TD CLASS="l">1571</TD><TD>//                        return;</TD></TR><TR><TD CLASS="l">1572</TD><TD>//                }</TD></TR><TR><TD CLASS="l">1573</TD><TD>//                </TD></TR><TR><TD CLASS="l">1574</TD><TD>//                ITypeBinding annotBinding= annotation.resolveTypeBinding();</TD></TR><TR><TD CLASS="l">1575</TD><TD>//                if (annotBinding == null) {</TD></TR><TR><TD CLASS="l">1576</TD><TD>//                        return;</TD></TR><TR><TD CLASS="l">1577</TD><TD>//                }</TD></TR><TR><TD CLASS="l">1578</TD><TD>//</TD></TR><TR><TD CLASS="l">1579</TD><TD>//                </TD></TR><TR><TD CLASS="l">1580</TD><TD>//                if (annotation instanceof NormalAnnotation) {</TD></TR><TR><TD CLASS="l">1581</TD><TD>//                        // similar names</TD></TR><TR><TD CLASS="l">1582</TD><TD>//                        IFunctionBinding[] otherMembers= annotBinding.getDeclaredMethods();</TD></TR><TR><TD CLASS="l">1583</TD><TD>//                        for (int i= 0; i &lt; otherMembers.length; i++) {</TD></TR><TR><TD CLASS="l">1584</TD><TD>//                                IFunctionBinding binding= otherMembers[i];</TD></TR><TR><TD CLASS="l">1585</TD><TD>//                                String curr= binding.getName();</TD></TR><TR><TD CLASS="l">1586</TD><TD>//                                int relevance= NameMatcher.isSimilarName(memberName, curr) ? 6 : 3;</TD></TR><TR><TD CLASS="l">1587</TD><TD>//                                String label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_UnresolvedElementsSubProcessor_changetoattribute_description, curr);</TD></TR><TR><TD CLASS="l">1588</TD><TD>//                                proposals.add(new RenameNodeCompletionProposal(label, cu, problem.getOffset(), problem.getLength(), curr, relevance));</TD></TR><TR><TD CLASS="l">1589</TD><TD>//                        }</TD></TR><TR><TD CLASS="l">1590</TD><TD>//                }</TD></TR><TR><TD CLASS="l">1591</TD><TD>//                </TD></TR><TR><TD CLASS="l">1592</TD><TD>//                if (annotBinding.isFromSource()) {</TD></TR><TR><TD CLASS="l">1593</TD><TD>//                        IJavaScriptUnit targetCU= ASTResolving.findCompilationUnitForBinding(cu, astRoot, annotBinding);</TD></TR><TR><TD CLASS="l">1594</TD><TD>//                        if (targetCU != null) {</TD></TR><TR><TD CLASS="l">1595</TD><TD>//                                String label= Messages.format(CorrectionMessages.UnresolvedElementsSubProcessor_UnresolvedElementsSubProcessor_createattribute_description, memberName);</TD></TR><TR><TD CLASS="l">1596</TD><TD>//                                Image image= JavaPluginImages.get(JavaPluginImages.IMG_MISC_PUBLIC);</TD></TR><TR><TD CLASS="l">1597</TD><TD>//                                proposals.add(new NewAnnotationMemberProposal(label, targetCU, selectedNode, annotBinding, 5, image));</TD></TR><TR><TD CLASS="l">1598</TD><TD>//                        }</TD></TR><TR><TD CLASS="l">1599</TD><TD>//                }</TD></TR><TR><TD CLASS="l">1600</TD><TD>//        }</TD></TR><TR><TD CLASS="l">1601</TD><TD> </TD></TR><TR><TD CLASS="l">1602</TD><TD> </TD></TR><TR><TD CLASS="l">1603</TD><TD>}</TD></TR></TABLE><P></P><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TD CLASS="nv">[<A HREF="../xslUnitTestCoverage.html">all classes</A>][<A HREF="177.html">org.eclipse.wst.jsdt.internal.ui.text.correction</A>]</TD></TR><TR><TD CLASS="tl"><A HREF="http://www.eclemma.org/support.html">EMMA 2.0.5312 EclEmma Fix 1</A> (C) Vladimir Roubtsov</TD></TR></TABLE></BODY></HTML>