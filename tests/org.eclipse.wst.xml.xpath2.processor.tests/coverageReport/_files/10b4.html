<HTML><HEAD><META CONTENT="text/html; charset=UTF-8" HTTP-EQUIV="Content-Type"/><TITLE>EMMA Coverage Report</TITLE><STYLE TYPE="text/css"> TABLE,TD,TH {border-style:solid; border-color:black;} TD,TH {background:white;margin:0;line-height:100%;padding-left:0.5em;padding-right:0.5em;} TD {border-width:0 1px 0 0;} TH {border-width:1px 1px 1px 0;} TR TD.h {color:red;} TABLE {border-spacing:0; border-collapse:collapse;border-width:0 0 1px 1px;} P,H1,H2,H3,TH {font-family:verdana,arial,sans-serif;font-size:10pt;} TD {font-family:courier,monospace;font-size:10pt;} TABLE.hdft {border-spacing:0;border-collapse:collapse;border-style:none;} TABLE.hdft TH,TABLE.hdft TD {border-style:none;line-height:normal;} TABLE.hdft TH.tl,TABLE.hdft TD.tl {background:#6699CC;color:white;} TABLE.hdft TD.nv {background:#6633DD;color:white;} .nv A:link {color:white;} .nv A:visited {color:white;} .nv A:active {color:yellow;} TABLE.hdft A:link {color:white;} TABLE.hdft A:visited {color:white;} TABLE.hdft A:active {color:yellow;} .in {color:#356085;} TABLE.s TD {padding-left:0.25em;padding-right:0.25em;} TABLE.s TD.l {padding-left:0.25em;padding-right:0.25em;text-align:right;background:#F0F0F0;} TABLE.s TR.z TD {background:#FF9999;} TABLE.s TR.p TD {background:#FFFF88;} TABLE.s TR.c TD {background:#CCFFCC;} A:link {color:#0000EE;text-decoration:none;} A:visited {color:#0000EE;text-decoration:none;} A:hover {color:#0000EE;text-decoration:underline;} TABLE.cn {border-width:0 0 1px 0;} TABLE.s {border-width:1px 0 1px 1px;} TD.h {color:red;border-width:0 1px 0 0;} TD.f {border-width:0 1px 0 1px;} TD.hf {color:red;border-width:0 1px 0 1px;} TH.f {border-width:1px 1px 1px 1px;} TR.cis TD {background:#F0F0F0;} TR.cis TD {border-width:1px 1px 1px 0;} TR.cis TD.h {color:red;border-width:1px 1px 1px 0;} TR.cis TD.f {border-width:1px 1px 1px 1px;} TR.cis TD.hf {color:red;border-width:1px 1px 1px 1px;} TD.b {border-style:none;background:transparent;line-height:50%;}  TD.bt {border-width:1px 0 0 0;background:transparent;line-height:50%;} TR.o TD {background:#F0F0F0;}TABLE.it {border-style:none;}TABLE.it TD,TABLE.it TH {border-style:none;}</STYLE></HEAD><BODY><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="tl"><A HREF="http://www.eclemma.org/">EMMA</A> Coverage Report (generated Tue Jun 09 19:59:05 GMT 2009)</TH></TR><TR><TD CLASS="nv">[<A HREF="../xslUnitTestCoverage.html">all classes</A>][<A HREF="167.html">org.eclipse.wst.jsdt.internal.ui.packageview</A>]</TD></TR></TABLE><H2>COVERAGE SUMMARY FOR SOURCE FILE [<SPAN CLASS="in">PackageExplorerContentProvider.java</SPAN>]</H2><TABLE CELLSPACING="0" WIDTH="100%"><TR><TH>name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD>PackageExplorerContentProvider.java</TD><TD CLASS="h">0%   (0/8)</TD><TD CLASS="h">0%   (0/61)</TD><TD CLASS="h">0%   (0/2509)</TD><TD CLASS="h">0%   (0/574)</TD></TR></TABLE><H3>COVERAGE BREAKDOWN BY CLASS AND METHOD</H3><TABLE CLASS="cn" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="f">name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#0">PackageExplorerContentProvider</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/47)</TD><TD CLASS="h">0%   (0/2303)</TD><TD CLASS="h">0%   (0/546)</TD></TR><TR><TD CLASS="f"><A HREF="#0">PackageExplorerContentProvider (boolean): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/24)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2">arePackagesFoldedInHierarchicalLayout (): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#3">augmentElementToRefresh (List, int, Object): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#4">dispose (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR><TD CLASS="f"><A HREF="#5">elementChanged (ElementChangedEvent): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/32)</TD><TD CLASS="h">0%   (0/10)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#6">executeRunnables (Collection): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/49)</TD><TD CLASS="h">0%   (0/10)</TD></TR><TR><TD CLASS="f"><A HREF="#7">findAddedElement (IJavaScriptElementDelta): IJavaScriptElement</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/24)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#8">findSinglePackageChild (IPackageFragment, IJavaScriptElement []): IPackageFra...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/54)</TD><TD CLASS="h">0%   (0/11)</TD></TR><TR><TD CLASS="f"><A HREF="#9">getChildren (Object): Object []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/72)</TD><TD CLASS="h">0%   (0/18)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#a">getContainerPackageFragmentRoots (PackageFragmentRootContainer): Object []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/5)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#b">getContainerPackageFragmentRoots (PackageFragmentRootContainer, boolean): Obj...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/113)</TD><TD CLASS="h">0%   (0/26)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#c">getContainerPackageFragmentRootsDeprc (PackageFragmentRootContainer, boolean)...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/204)</TD><TD CLASS="h">0%   (0/40)</TD></TR><TR><TD CLASS="f"><A HREF="#d">getFolded (IJavaScriptElement [], IPackageFragment): IPackageFragment</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/16)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#e">getFolderContent (IFolder): Object []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/41)</TD><TD CLASS="h">0%   (0/10)</TD></TR><TR><TD CLASS="f"><A HREF="#f">getHierarchicalPackageChildren (IPackageFragmentRoot, IPackageFragment, Colle...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/78)</TD><TD CLASS="h">0%   (0/16)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#10">getHierarchicalPackageParent (IPackageFragment): Object</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/60)</TD><TD CLASS="h">0%   (0/17)</TD></TR><TR><TD CLASS="f"><A HREF="#11">getHierarchicalPackagesInFolder (IFolder, Collection): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/50)</TD><TD CLASS="h">0%   (0/14)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#12">getLibraryChildren (IPackageFragmentRoot): Object []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/158)</TD><TD CLASS="h">0%   (0/31)</TD></TR><TR><TD CLASS="f"><A HREF="#13">getNonJavaProjects (IJavaScriptModel): Object []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#14">getPackageContent (IPackageFragment): Object []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/44)</TD><TD CLASS="h">0%   (0/10)</TD></TR><TR><TD CLASS="f"><A HREF="#15">getPackageFragmentRootContent (IPackageFragmentRoot): Object []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/40)</TD><TD CLASS="h">0%   (0/9)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#16">getPackageFragmentRoots (IJavaScriptProject): Object []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/170)</TD><TD CLASS="h">0%   (0/37)</TD></TR><TR><TD CLASS="f"><A HREF="#17">getViewerInput (): Object</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#18">handleAffectedChildren (IJavaScriptElementDelta, IJavaScriptElement, Collecti...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/137)</TD><TD CLASS="h">0%   (0/31)</TD></TR><TR><TD CLASS="f"><A HREF="#19">inputChanged (Viewer, Object, Object): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/26)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1a">inputDeleted (Collection): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/49)</TD><TD CLASS="h">0%   (0/12)</TD></TR><TR><TD CLASS="f"><A HREF="#1b">internalGetParent (Object): Object</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/61)</TD><TD CLASS="h">0%   (0/14)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1c">isEmpty (IPackageFragment): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/11)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#1d">isOnClassPath (IJavaScriptUnit): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/14)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1e">isParent (Object, Object): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/19)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR><TD CLASS="f"><A HREF="#1f">isStructuralCUChange (int): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/13)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#20">postAdd (Object, Object, Collection): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/10)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#21">postAsyncUpdate (Display): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/19)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#22">postProjectStateChanged (Object, Collection): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#23">postRefresh (List, boolean, Collection): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/10)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#24">postRefresh (Object, int, Object, Collection): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/29)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR><TD CLASS="f"><A HREF="#25">postRemove (Object, Collection): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#26">postUpdateIcon (IJavaScriptElement, Collection): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#27">processAffectedChildren (IJavaScriptElementDelta [], Collection): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/16)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#28">processDelta (IJavaScriptElementDelta, Collection): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/350)</TD><TD CLASS="h">0%   (0/89)</TD></TR><TR><TD CLASS="f"><A HREF="#29">processResourceDelta (IResourceDelta, Object, Collection): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/144)</TD><TD CLASS="h">0%   (0/37)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2a">propertyChange (PropertyChangeEvent): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/39)</TD><TD CLASS="h">0%   (0/9)</TD></TR><TR><TD CLASS="f"><A HREF="#2b">runPendingUpdates (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/34)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2c">runUpdates (Collection): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/12)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR><TD CLASS="f"><A HREF="#2d">setIsFlatLayout (boolean): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2e">setShowLibrariesNode (boolean): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="f"><A HREF="#2f">updateSelection (IJavaScriptElementDelta, Collection): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/21)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#30">PackageExplorerContentProvider$1</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/2)</TD><TD CLASS="h">0%   (0/26)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR><TD CLASS="f"><A HREF="#30">PackageExplorerContentProvider$1 (PackageExplorerContentProvider, Display, St...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/8)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#32">runInUIThread (IProgressMonitor): IStatus</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/18)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#33">PackageExplorerContentProvider$2</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/2)</TD><TD CLASS="h">0%   (0/26)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR><TD CLASS="f"><A HREF="#33">PackageExplorerContentProvider$2 (PackageExplorerContentProvider, IJavaScript...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/12)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#35">run (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/14)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#26">PackageExplorerContentProvider$3</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/2)</TD><TD CLASS="h">0%   (0/22)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR><TD CLASS="f"><A HREF="#26">PackageExplorerContentProvider$3 (PackageExplorerContentProvider, IJavaScript...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#38">run (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/13)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#23">PackageExplorerContentProvider$4</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/2)</TD><TD CLASS="h">0%   (0/29)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR><TD CLASS="f"><A HREF="#23">PackageExplorerContentProvider$4 (PackageExplorerContentProvider, List, boole...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/12)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#3b">run (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/17)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#20">PackageExplorerContentProvider$5</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/2)</TD><TD CLASS="h">0%   (0/62)</TD><TD CLASS="h">0%   (0/11)</TD></TR><TR><TD CLASS="f"><A HREF="#20">PackageExplorerContentProvider$5 (PackageExplorerContentProvider, Object, Obj...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/12)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#3e">run (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/50)</TD><TD CLASS="h">0%   (0/9)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#25">PackageExplorerContentProvider$6</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/2)</TD><TD CLASS="h">0%   (0/16)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR><TD CLASS="f"><A HREF="#25">PackageExplorerContentProvider$6 (PackageExplorerContentProvider, Object): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#41">run (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD><TD CLASS="bt"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#22">PackageExplorerContentProvider$7</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/2)</TD><TD CLASS="h">0%   (0/25)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR><TD CLASS="f"><A HREF="#22">PackageExplorerContentProvider$7 (PackageExplorerContentProvider, Object): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#44">run (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/16)</TD><TD CLASS="h">0%   (0/3)</TD></TR></TABLE><P></P><TABLE CLASS="s" CELLSPACING="0" WIDTH="100%"><TR CLASS="z"><TD CLASS="l">1</TD><TD>/*******************************************************************************</TD></TR><TR><TD CLASS="l">2</TD><TD> * Copyright (c) 2000, 2009 IBM Corporation and others.</TD></TR><TR><TD CLASS="l">3</TD><TD> * All rights reserved. This program and the accompanying materials</TD></TR><TR><TD CLASS="l">4</TD><TD> * are made available under the terms of the Eclipse Public License v1.0</TD></TR><TR><TD CLASS="l">5</TD><TD> * which accompanies this distribution, and is available at</TD></TR><TR><TD CLASS="l">6</TD><TD> * http://www.eclipse.org/legal/epl-v10.html</TD></TR><TR><TD CLASS="l">7</TD><TD> *</TD></TR><TR><TD CLASS="l">8</TD><TD> * Contributors:</TD></TR><TR><TD CLASS="l">9</TD><TD> *     IBM Corporation - initial API and implementation</TD></TR><TR><TD CLASS="l">10</TD><TD> *******************************************************************************/</TD></TR><TR><TD CLASS="l">11</TD><TD>package org.eclipse.wst.jsdt.internal.ui.packageview;</TD></TR><TR><TD CLASS="l">12</TD><TD> </TD></TR><TR><TD CLASS="l">13</TD><TD>import java.util.ArrayList;</TD></TR><TR><TD CLASS="l">14</TD><TD>import java.util.Arrays;</TD></TR><TR><TD CLASS="l">15</TD><TD>import java.util.Collection;</TD></TR><TR><TD CLASS="l">16</TD><TD>import java.util.Iterator;</TD></TR><TR><TD CLASS="l">17</TD><TD>import java.util.List;</TD></TR><TR><TD CLASS="l">18</TD><TD> </TD></TR><TR><TD CLASS="l">19</TD><TD>import org.eclipse.core.resources.IFolder;</TD></TR><TR><TD CLASS="l">20</TD><TD>import org.eclipse.core.resources.IProject;</TD></TR><TR><TD CLASS="l">21</TD><TD>import org.eclipse.core.resources.IResource;</TD></TR><TR><TD CLASS="l">22</TD><TD>import org.eclipse.core.resources.IResourceDelta;</TD></TR><TR><TD CLASS="l">23</TD><TD>import org.eclipse.core.runtime.CoreException;</TD></TR><TR><TD CLASS="l">24</TD><TD>import org.eclipse.core.runtime.IProgressMonitor;</TD></TR><TR><TD CLASS="l">25</TD><TD>import org.eclipse.core.runtime.IStatus;</TD></TR><TR><TD CLASS="l">26</TD><TD>import org.eclipse.core.runtime.Status;</TD></TR><TR><TD CLASS="l">27</TD><TD>import org.eclipse.jface.util.IPropertyChangeListener;</TD></TR><TR><TD CLASS="l">28</TD><TD>import org.eclipse.jface.util.PropertyChangeEvent;</TD></TR><TR><TD CLASS="l">29</TD><TD>import org.eclipse.jface.viewers.IBasicPropertyConstants;</TD></TR><TR><TD CLASS="l">30</TD><TD>import org.eclipse.jface.viewers.ITreeContentProvider;</TD></TR><TR><TD CLASS="l">31</TD><TD>import org.eclipse.jface.viewers.StructuredSelection;</TD></TR><TR><TD CLASS="l">32</TD><TD>import org.eclipse.jface.viewers.TreeViewer;</TD></TR><TR><TD CLASS="l">33</TD><TD>import org.eclipse.jface.viewers.Viewer;</TD></TR><TR><TD CLASS="l">34</TD><TD>import org.eclipse.swt.widgets.Control;</TD></TR><TR><TD CLASS="l">35</TD><TD>import org.eclipse.swt.widgets.Display;</TD></TR><TR><TD CLASS="l">36</TD><TD>import org.eclipse.swt.widgets.TreeItem;</TD></TR><TR><TD CLASS="l">37</TD><TD>import org.eclipse.swt.widgets.Widget;</TD></TR><TR><TD CLASS="l">38</TD><TD>import org.eclipse.ui.IWorkingSet;</TD></TR><TR><TD CLASS="l">39</TD><TD>import org.eclipse.ui.progress.UIJob;</TD></TR><TR><TD CLASS="l">40</TD><TD>import org.eclipse.wst.jsdt.core.ElementChangedEvent;</TD></TR><TR><TD CLASS="l">41</TD><TD>import org.eclipse.wst.jsdt.core.IClassFile;</TD></TR><TR><TD CLASS="l">42</TD><TD>import org.eclipse.wst.jsdt.core.IElementChangedListener;</TD></TR><TR><TD CLASS="l">43</TD><TD>import org.eclipse.wst.jsdt.core.IIncludePathAttribute;</TD></TR><TR><TD CLASS="l">44</TD><TD>import org.eclipse.wst.jsdt.core.IIncludePathEntry;</TD></TR><TR><TD CLASS="l">45</TD><TD>import org.eclipse.wst.jsdt.core.IJavaScriptElement;</TD></TR><TR><TD CLASS="l">46</TD><TD>import org.eclipse.wst.jsdt.core.IJavaScriptElementDelta;</TD></TR><TR><TD CLASS="l">47</TD><TD>import org.eclipse.wst.jsdt.core.IJavaScriptModel;</TD></TR><TR><TD CLASS="l">48</TD><TD>import org.eclipse.wst.jsdt.core.IJavaScriptProject;</TD></TR><TR><TD CLASS="l">49</TD><TD>import org.eclipse.wst.jsdt.core.IJavaScriptUnit;</TD></TR><TR><TD CLASS="l">50</TD><TD>import org.eclipse.wst.jsdt.core.IPackageFragment;</TD></TR><TR><TD CLASS="l">51</TD><TD>import org.eclipse.wst.jsdt.core.IPackageFragmentRoot;</TD></TR><TR><TD CLASS="l">52</TD><TD>import org.eclipse.wst.jsdt.core.JavaScriptCore;</TD></TR><TR><TD CLASS="l">53</TD><TD>import org.eclipse.wst.jsdt.core.JavaScriptModelException;</TD></TR><TR><TD CLASS="l">54</TD><TD>import org.eclipse.wst.jsdt.internal.corext.util.JavaModelUtil;</TD></TR><TR><TD CLASS="l">55</TD><TD>import org.eclipse.wst.jsdt.internal.ui.JavaScriptPlugin;</TD></TR><TR><TD CLASS="l">56</TD><TD>import org.eclipse.wst.jsdt.internal.ui.navigator.ContainerFolder;</TD></TR><TR><TD CLASS="l">57</TD><TD>import org.eclipse.wst.jsdt.internal.ui.workingsets.WorkingSetModel;</TD></TR><TR><TD CLASS="l">58</TD><TD>import org.eclipse.wst.jsdt.ui.PreferenceConstants;</TD></TR><TR><TD CLASS="l">59</TD><TD>import org.eclipse.wst.jsdt.ui.ProjectLibraryRoot;</TD></TR><TR><TD CLASS="l">60</TD><TD>import org.eclipse.wst.jsdt.ui.StandardJavaScriptElementContentProvider;</TD></TR><TR><TD CLASS="l">61</TD><TD> </TD></TR><TR><TD CLASS="l">62</TD><TD>/**</TD></TR><TR><TD CLASS="l">63</TD><TD> * Content provider for the PackageExplorer.</TD></TR><TR><TD CLASS="l">64</TD><TD> * </TD></TR><TR><TD CLASS="l">65</TD><TD> * &lt;p&gt;</TD></TR><TR><TD CLASS="l">66</TD><TD> * Since 2.1 this content provider can provide the children for flat or hierarchical</TD></TR><TR><TD CLASS="l">67</TD><TD> * layout.</TD></TR><TR><TD CLASS="l">68</TD><TD> * &lt;/p&gt;</TD></TR><TR><TD CLASS="l">69</TD><TD> * </TD></TR><TR><TD CLASS="l">70</TD><TD> * @see org.eclipse.wst.jsdt.ui.StandardJavaScriptElementContentProvider</TD></TR><TR><TD CLASS="l">71</TD><TD> */</TD></TR><TR><TD CLASS="l">72</TD><TD>public class PackageExplorerContentProvider extends StandardJavaScriptElementContentProvider implements ITreeContentProvider, IElementChangedListener, IPropertyChangeListener {</TD></TR><TR><TD CLASS="l">73</TD><TD>        </TD></TR><TR><TD CLASS="l">74</TD><TD>        protected static final int ORIGINAL= 0;</TD></TR><TR><TD CLASS="l">75</TD><TD>        protected static final int PARENT= 1 &lt;&lt; 0;</TD></TR><TR><TD CLASS="l">76</TD><TD>        protected static final int GRANT_PARENT= 1 &lt;&lt; 1;</TD></TR><TR><TD CLASS="l">77</TD><TD>        protected static final int PROJECT= 1 &lt;&lt; 2;</TD></TR><TR><TD CLASS="l">78</TD><TD>        </TD></TR><TR><TD CLASS="l">79</TD><TD>        private TreeViewer fViewer;</TD></TR><TR><TD CLASS="l">80</TD><TD>        private Object fInput;</TD></TR><TR><TD CLASS="l">81</TD><TD>        private boolean fIsFlatLayout;</TD></TR><TR><TD CLASS="l">82</TD><TD>        private boolean fShowLibrariesNode;</TD></TR><TR><TD CLASS="l">83</TD><TD>        private boolean fFoldPackages;</TD></TR><TR><TD CLASS="l">84</TD><TD>        </TD></TR><TR><TD CLASS="l">85</TD><TD>        private Collection fPendingUpdates;</TD></TR><TR><TD CLASS="l">86</TD><TD>                </TD></TR><TR><TD CLASS="l">87</TD><TD>        private UIJob fUpdateJob;</TD></TR><TR><TD CLASS="l">88</TD><TD> </TD></TR><TR><TD CLASS="l">89</TD><TD>        /**</TD></TR><TR><TD CLASS="l"><A NAME="0">90</A></TD><TD>         * Creates a new content provider for Java elements.</TD></TR><TR><TD CLASS="l">91</TD><TD>         * @param provideMembers if set, members of compilation units and class files are shown</TD></TR><TR><TD CLASS="l">92</TD><TD>         */</TD></TR><TR><TD CLASS="l">93</TD><TD>        public PackageExplorerContentProvider(boolean provideMembers) {</TD></TR><TR CLASS="z"><TD CLASS="l">94</TD><TD>                super(provideMembers);</TD></TR><TR CLASS="z"><TD CLASS="l">95</TD><TD>                fShowLibrariesNode= false;</TD></TR><TR CLASS="z"><TD CLASS="l">96</TD><TD>                fIsFlatLayout= false;</TD></TR><TR CLASS="z"><TD CLASS="l">97</TD><TD>                fFoldPackages= arePackagesFoldedInHierarchicalLayout();</TD></TR><TR CLASS="z"><TD CLASS="l">98</TD><TD>                fPendingUpdates= null;</TD></TR><TR CLASS="z"><TD CLASS="l">99</TD><TD>                JavaScriptPlugin.getDefault().getPreferenceStore().addPropertyChangeListener(this);</TD></TR><TR><TD CLASS="l">100</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="2">101</A></TD><TD>                fUpdateJob= null;</TD></TR><TR CLASS="z"><TD CLASS="l">102</TD><TD>        }</TD></TR><TR><TD CLASS="l">103</TD><TD>        </TD></TR><TR><TD CLASS="l">104</TD><TD>        private boolean arePackagesFoldedInHierarchicalLayout(){</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="17">105</A></TD><TD>                return PreferenceConstants.getPreferenceStore().getBoolean(PreferenceConstants.APPEARANCE_FOLD_PACKAGES_IN_PACKAGE_EXPLORER);</TD></TR><TR><TD CLASS="l">106</TD><TD>        }</TD></TR><TR><TD CLASS="l">107</TD><TD>                        </TD></TR><TR><TD CLASS="l">108</TD><TD>        protected Object getViewerInput() {</TD></TR><TR CLASS="z"><TD CLASS="l">109</TD><TD>                return fInput;</TD></TR><TR><TD CLASS="l">110</TD><TD>        }</TD></TR><TR><TD CLASS="l">111</TD><TD>        </TD></TR><TR><TD CLASS="l"><A NAME="5">112</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">113</TD><TD>         * Method declared on IElementChangedListener.</TD></TR><TR><TD CLASS="l">114</TD><TD>         */</TD></TR><TR><TD CLASS="l">115</TD><TD>        public void elementChanged(final ElementChangedEvent event) {</TD></TR><TR CLASS="z"><TD CLASS="l">116</TD><TD>                final ArrayList runnables= new ArrayList();</TD></TR><TR><TD CLASS="l">117</TD><TD>                try {</TD></TR><TR><TD CLASS="l">118</TD><TD>                        // 58952 delete project does not update Package Explorer [package explorer] </TD></TR><TR><TD CLASS="l">119</TD><TD>                        // if the input to the viewer is deleted then refresh to avoid the display of stale elements</TD></TR><TR CLASS="z"><TD CLASS="l">120</TD><TD>                        if (inputDeleted(runnables))</TD></TR><TR CLASS="z"><TD CLASS="l">121</TD><TD>                                return;</TD></TR><TR><TD CLASS="l">122</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">123</TD><TD>                        processDelta(event.getDelta(), runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">124</TD><TD>                } catch (JavaScriptModelException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">125</TD><TD>                        JavaScriptPlugin.log(e);</TD></TR><TR CLASS="z"><TD CLASS="l">126</TD><TD>                } finally {        </TD></TR><TR CLASS="z"><TD CLASS="l">127</TD><TD>                        executeRunnables(runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">128</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">129</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="6">130</A></TD><TD> </TD></TR><TR><TD CLASS="l">131</TD><TD>        protected final void executeRunnables(final Collection runnables) {</TD></TR><TR><TD CLASS="l">132</TD><TD> </TD></TR><TR><TD CLASS="l">133</TD><TD>                // now post all collected runnables</TD></TR><TR CLASS="z"><TD CLASS="l">134</TD><TD>                final Control ctrl= fViewer.getControl();</TD></TR><TR CLASS="z"><TD CLASS="l">135</TD><TD>                if (ctrl != null &amp;&amp; !ctrl.isDisposed()) {</TD></TR><TR><TD CLASS="l">136</TD><TD>                        //Are we in the UIThread? If so spin it until we are done</TD></TR><TR CLASS="z"><TD CLASS="l">137</TD><TD>                        if ((ctrl.getDisplay().getThread() == Thread.currentThread()) &amp;&amp; !fViewer.isBusy()) {</TD></TR><TR CLASS="z"><TD CLASS="l">138</TD><TD>                                runUpdates(runnables);</TD></TR><TR><TD CLASS="l">139</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">140</TD><TD>                                synchronized (this) {</TD></TR><TR CLASS="z"><TD CLASS="l">141</TD><TD>                                        if (fPendingUpdates == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">142</TD><TD>                                                fPendingUpdates= runnables;</TD></TR><TR><TD CLASS="l">143</TD><TD>                                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">144</TD><TD>                                                fPendingUpdates.addAll(runnables);</TD></TR><TR><TD CLASS="l">145</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">146</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">147</TD><TD>                                postAsyncUpdate(ctrl.getDisplay());</TD></TR><TR><TD CLASS="l">148</TD><TD>                        }</TD></TR><TR><TD CLASS="l"><A NAME="21">149</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="30">150</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">151</TD><TD>        </TD></TR><TR><TD CLASS="l"><A NAME="32">152</A></TD><TD>        private void postAsyncUpdate(final Display display) {</TD></TR><TR CLASS="z"><TD CLASS="l">153</TD><TD>                if (fUpdateJob == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">154</TD><TD>                        fUpdateJob= new UIJob(display, PackagesMessages.PackageExplorerContentProvider_update_job_description) {</TD></TR><TR><TD CLASS="l">155</TD><TD>                                public IStatus runInUIThread(IProgressMonitor monitor) {</TD></TR><TR CLASS="z"><TD CLASS="l">156</TD><TD>                                        TreeViewer viewer= fViewer;</TD></TR><TR CLASS="z"><TD CLASS="l">157</TD><TD>                                        if (viewer != null &amp;&amp; viewer.isBusy()) {</TD></TR><TR CLASS="z"><TD CLASS="l">158</TD><TD>                                                schedule(100); // reschedule when viewer is busy: bug 184991</TD></TR><TR><TD CLASS="l">159</TD><TD>                                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">160</TD><TD>                                                runPendingUpdates();</TD></TR><TR><TD CLASS="l">161</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">162</TD><TD>                                        return Status.OK_STATUS;</TD></TR><TR><TD CLASS="l">163</TD><TD>                                }</TD></TR><TR><TD CLASS="l">164</TD><TD>                        };</TD></TR><TR CLASS="z"><TD CLASS="l">165</TD><TD>                        fUpdateJob.setSystem(true);</TD></TR><TR><TD CLASS="l">166</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">167</TD><TD>                fUpdateJob.schedule();</TD></TR><TR CLASS="z"><TD CLASS="l">168</TD><TD>        }         </TD></TR><TR><TD CLASS="l">169</TD><TD>        </TD></TR><TR><TD CLASS="l">170</TD><TD>        /**</TD></TR><TR><TD CLASS="l"><A NAME="2b">171</A></TD><TD>         * Run all of the runnables that are the widget updates. Must be called in the display thread.</TD></TR><TR><TD CLASS="l">172</TD><TD>         */</TD></TR><TR><TD CLASS="l">173</TD><TD>        public void runPendingUpdates() {</TD></TR><TR><TD CLASS="l">174</TD><TD>                Collection pendingUpdates;</TD></TR><TR CLASS="z"><TD CLASS="l">175</TD><TD>                synchronized (this) {</TD></TR><TR CLASS="z"><TD CLASS="l">176</TD><TD>                        pendingUpdates= fPendingUpdates;</TD></TR><TR CLASS="z"><TD CLASS="l">177</TD><TD>                        fPendingUpdates= null;</TD></TR><TR><TD CLASS="l">178</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">179</TD><TD>                if (pendingUpdates != null &amp;&amp; fViewer != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">180</TD><TD>                        Control control = fViewer.getControl();</TD></TR><TR CLASS="z"><TD CLASS="l">181</TD><TD>                        if (control != null &amp;&amp; !control.isDisposed()) {</TD></TR><TR CLASS="z"><TD CLASS="l">182</TD><TD>                                runUpdates(pendingUpdates);</TD></TR><TR><TD CLASS="l">183</TD><TD>                        }</TD></TR><TR><TD CLASS="l"><A NAME="2c">184</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">185</TD><TD>        }</TD></TR><TR><TD CLASS="l">186</TD><TD>        </TD></TR><TR><TD CLASS="l">187</TD><TD>        private void runUpdates(Collection runnables) {</TD></TR><TR CLASS="z"><TD CLASS="l">188</TD><TD>                Iterator runnableIterator = runnables.iterator();</TD></TR><TR CLASS="z"><TD CLASS="l">189</TD><TD>                while (runnableIterator.hasNext()){</TD></TR><TR CLASS="z"><TD CLASS="l">190</TD><TD>                        ((Runnable) runnableIterator.next()).run();</TD></TR><TR><TD CLASS="l">191</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1a">192</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">193</TD><TD>        </TD></TR><TR><TD CLASS="l">194</TD><TD> </TD></TR><TR><TD CLASS="l">195</TD><TD>        private boolean inputDeleted(Collection runnables) {</TD></TR><TR CLASS="z"><TD CLASS="l">196</TD><TD>                if (fInput == null)</TD></TR><TR CLASS="z"><TD CLASS="l">197</TD><TD>                        return false;</TD></TR><TR CLASS="z"><TD CLASS="l">198</TD><TD>                if ((fInput instanceof IJavaScriptElement) &amp;&amp; ((IJavaScriptElement) fInput).exists())</TD></TR><TR CLASS="z"><TD CLASS="l">199</TD><TD>                        return false;</TD></TR><TR CLASS="z"><TD CLASS="l">200</TD><TD>                if ((fInput instanceof IResource) &amp;&amp; ((IResource) fInput).exists())</TD></TR><TR CLASS="z"><TD CLASS="l">201</TD><TD>                        return false;</TD></TR><TR CLASS="z"><TD CLASS="l">202</TD><TD>                if (fInput instanceof WorkingSetModel)</TD></TR><TR CLASS="z"><TD CLASS="l">203</TD><TD>                        return false;</TD></TR><TR CLASS="z"><TD CLASS="l">204</TD><TD>                if (fInput instanceof IWorkingSet) // see https://bugs.eclipse.org/bugs/show_bug.cgi?id=156239</TD></TR><TR CLASS="z"><TD CLASS="l">205</TD><TD>                        return false;</TD></TR><TR CLASS="z"><TD CLASS="l">206</TD><TD>                postRefresh(fInput, ORIGINAL, fInput, runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">207</TD><TD>                return true;</TD></TR><TR><TD CLASS="l">208</TD><TD>        }</TD></TR><TR><TD CLASS="l">209</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="4">210</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">211</TD><TD>         * Method declared on IContentProvider.</TD></TR><TR><TD CLASS="l">212</TD><TD>         */</TD></TR><TR><TD CLASS="l">213</TD><TD>        public void dispose() {</TD></TR><TR CLASS="z"><TD CLASS="l">214</TD><TD>                super.dispose();</TD></TR><TR CLASS="z"><TD CLASS="l">215</TD><TD>                JavaScriptCore.removeElementChangedListener(this);</TD></TR><TR CLASS="z"><TD CLASS="l">216</TD><TD>                JavaScriptPlugin.getDefault().getPreferenceStore().removePropertyChangeListener(this);</TD></TR><TR CLASS="z"><TD CLASS="l">217</TD><TD>        }</TD></TR><TR><TD CLASS="l">218</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="15">219</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">220</TD><TD>         * @see org.eclipse.wst.jsdt.ui.StandardJavaScriptElementContentProvider#getPackageFragmentRootContent(org.eclipse.wst.jsdt.core.IPackageFragmentRoot)</TD></TR><TR><TD CLASS="l">221</TD><TD>         */</TD></TR><TR><TD CLASS="l">222</TD><TD>        protected Object[] getPackageFragmentRootContent(IPackageFragmentRoot root) throws JavaScriptModelException {</TD></TR><TR CLASS="z"><TD CLASS="l">223</TD><TD>                if (fIsFlatLayout) {</TD></TR><TR CLASS="z"><TD CLASS="l">224</TD><TD>                        return super.getPackageFragmentRootContent(root);</TD></TR><TR><TD CLASS="l">225</TD><TD>                }</TD></TR><TR><TD CLASS="l">226</TD><TD>                </TD></TR><TR><TD CLASS="l">227</TD><TD>                // hierarchical package mode</TD></TR><TR CLASS="z"><TD CLASS="l">228</TD><TD>                ArrayList result= new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">229</TD><TD>                getHierarchicalPackageChildren(root, null, result);</TD></TR><TR CLASS="z"><TD CLASS="l">230</TD><TD>                if (!isProjectPackageFragmentRoot(root)) {</TD></TR><TR CLASS="z"><TD CLASS="l">231</TD><TD>                        Object[] nonJavaResources= root.getNonJavaScriptResources();</TD></TR><TR CLASS="z"><TD CLASS="l">232</TD><TD>                        for (int i= 0; i &lt; nonJavaResources.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">233</TD><TD>                                result.add(nonJavaResources[i]);</TD></TR><TR><TD CLASS="l">234</TD><TD>                        }</TD></TR><TR><TD CLASS="l">235</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">236</TD><TD>                return result.toArray();</TD></TR><TR><TD CLASS="l">237</TD><TD>        }</TD></TR><TR><TD CLASS="l">238</TD><TD>        </TD></TR><TR><TD CLASS="l"><A NAME="14">239</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">240</TD><TD>         * @see org.eclipse.wst.jsdt.ui.StandardJavaScriptElementContentProvider#getPackageContent(org.eclipse.wst.jsdt.core.IPackageFragment)</TD></TR><TR><TD CLASS="l">241</TD><TD>         */</TD></TR><TR><TD CLASS="l">242</TD><TD>        protected Object[] getPackageContent(IPackageFragment fragment) throws JavaScriptModelException {</TD></TR><TR CLASS="z"><TD CLASS="l">243</TD><TD>                if (fIsFlatLayout) {</TD></TR><TR CLASS="z"><TD CLASS="l">244</TD><TD>                        return super.getPackageContent(fragment);</TD></TR><TR><TD CLASS="l">245</TD><TD>                }</TD></TR><TR><TD CLASS="l">246</TD><TD>                </TD></TR><TR><TD CLASS="l">247</TD><TD>                // hierarchical package mode</TD></TR><TR CLASS="z"><TD CLASS="l">248</TD><TD>                ArrayList result= new ArrayList();</TD></TR><TR><TD CLASS="l">249</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">250</TD><TD>                getHierarchicalPackageChildren((IPackageFragmentRoot) fragment.getParent(), fragment, result);</TD></TR><TR CLASS="z"><TD CLASS="l">251</TD><TD>                Object[] nonPackages= super.getPackageContent(fragment);</TD></TR><TR CLASS="z"><TD CLASS="l">252</TD><TD>                if (result.isEmpty())</TD></TR><TR CLASS="z"><TD CLASS="l">253</TD><TD>                        return nonPackages;</TD></TR><TR CLASS="z"><TD CLASS="l">254</TD><TD>                for (int i= 0; i &lt; nonPackages.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">255</TD><TD>                        result.add(nonPackages[i]);</TD></TR><TR><TD CLASS="l">256</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">257</TD><TD>                return result.toArray();</TD></TR><TR><TD CLASS="l">258</TD><TD>        }</TD></TR><TR><TD CLASS="l">259</TD><TD>        </TD></TR><TR><TD CLASS="l"><A NAME="e">260</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">261</TD><TD>         * @see org.eclipse.wst.jsdt.ui.StandardJavaScriptElementContentProvider#getFolderContent(org.eclipse.core.resources.IFolder)</TD></TR><TR><TD CLASS="l">262</TD><TD>         */</TD></TR><TR><TD CLASS="l">263</TD><TD>        protected Object[] getFolderContent(IFolder folder) throws CoreException {</TD></TR><TR CLASS="z"><TD CLASS="l">264</TD><TD>                if (fIsFlatLayout) {</TD></TR><TR CLASS="z"><TD CLASS="l">265</TD><TD>                        return super.getFolderContent(folder);</TD></TR><TR><TD CLASS="l">266</TD><TD>                }</TD></TR><TR><TD CLASS="l">267</TD><TD>                </TD></TR><TR><TD CLASS="l">268</TD><TD>                // hierarchical package mode</TD></TR><TR CLASS="z"><TD CLASS="l">269</TD><TD>                ArrayList result= new ArrayList();</TD></TR><TR><TD CLASS="l">270</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">271</TD><TD>                getHierarchicalPackagesInFolder(folder, result);</TD></TR><TR CLASS="z"><TD CLASS="l">272</TD><TD>                Object[] others= super.getFolderContent(folder);</TD></TR><TR CLASS="z"><TD CLASS="l">273</TD><TD>                if (result.isEmpty())</TD></TR><TR CLASS="z"><TD CLASS="l">274</TD><TD>                        return others;</TD></TR><TR CLASS="z"><TD CLASS="l">275</TD><TD>                for (int i= 0; i &lt; others.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">276</TD><TD>                        result.add(others[i]);</TD></TR><TR><TD CLASS="l">277</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">278</TD><TD>                return result.toArray();</TD></TR><TR><TD CLASS="l">279</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="9">280</A></TD><TD>        </TD></TR><TR><TD CLASS="l">281</TD><TD>        </TD></TR><TR><TD CLASS="l">282</TD><TD>        public Object[] getChildren(Object parentElement) {</TD></TR><TR><TD CLASS="l">283</TD><TD>                try {</TD></TR><TR CLASS="z"><TD CLASS="l">284</TD><TD>                        if (parentElement instanceof IJavaScriptModel) </TD></TR><TR CLASS="z"><TD CLASS="l">285</TD><TD>                                return concatenate(getJavaProjects((IJavaScriptModel)parentElement), getNonJavaProjects((IJavaScriptModel)parentElement));</TD></TR><TR><TD CLASS="l">286</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">287</TD><TD>                        if(parentElement instanceof ContainerFolder) {</TD></TR><TR CLASS="z"><TD CLASS="l">288</TD><TD>                                return getContainerPackageFragmentRoots((PackageFragmentRootContainer)((ContainerFolder)parentElement).getParentObject());</TD></TR><TR><TD CLASS="l">289</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">290</TD><TD>                        if (parentElement instanceof PackageFragmentRootContainer)</TD></TR><TR CLASS="z"><TD CLASS="l">291</TD><TD>                                return getContainerPackageFragmentRoots((PackageFragmentRootContainer)parentElement, true);</TD></TR><TR><TD CLASS="l">292</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">293</TD><TD>                        if(parentElement instanceof ProjectLibraryRoot) {</TD></TR><TR CLASS="z"><TD CLASS="l">294</TD><TD>                                return ((ProjectLibraryRoot)parentElement).getChildren();</TD></TR><TR><TD CLASS="l">295</TD><TD>                        }</TD></TR><TR><TD CLASS="l">296</TD><TD>//                        if (parentElement instanceof IPackageFragmentRoot) {</TD></TR><TR><TD CLASS="l">297</TD><TD>//                                Object[] children = super.getChildren(parentElement);</TD></TR><TR><TD CLASS="l">298</TD><TD>//                                for (int i = 0; i &lt; children.length; i++) {</TD></TR><TR><TD CLASS="l">299</TD><TD>//                                        // replace the &#34;default package&#34; with its contents</TD></TR><TR><TD CLASS="l">300</TD><TD>//                                        if (children[i] instanceof IPackageFragment &amp;&amp; ((IPackageFragment) children[i]).isDefaultPackage()) {</TD></TR><TR><TD CLASS="l">301</TD><TD>//                                                List combined = new ArrayList(children.length);</TD></TR><TR><TD CLASS="l">302</TD><TD>//                                                for (int j = 0; j &lt; children.length; j++) {</TD></TR><TR><TD CLASS="l">303</TD><TD>//                                                        if (j != i) {</TD></TR><TR><TD CLASS="l">304</TD><TD>//                                                                combined.add(children[j]);</TD></TR><TR><TD CLASS="l">305</TD><TD>//                                                        }</TD></TR><TR><TD CLASS="l">306</TD><TD>//                                                        else {</TD></TR><TR><TD CLASS="l">307</TD><TD>//                                                                Object[] defaultChildren = super.getChildren(children[j]);</TD></TR><TR><TD CLASS="l">308</TD><TD>//                                                                for (int k = 0; k &lt; defaultChildren.length; k++) {</TD></TR><TR><TD CLASS="l">309</TD><TD>//                                                                        combined.add(defaultChildren[k]);</TD></TR><TR><TD CLASS="l">310</TD><TD>//                                                                }</TD></TR><TR><TD CLASS="l">311</TD><TD>//                                                        }</TD></TR><TR><TD CLASS="l">312</TD><TD>//                                                }</TD></TR><TR><TD CLASS="l">313</TD><TD>//                                                return combined.toArray();</TD></TR><TR><TD CLASS="l">314</TD><TD>//                                        }</TD></TR><TR><TD CLASS="l">315</TD><TD>//                                }</TD></TR><TR><TD CLASS="l">316</TD><TD>//                                return children;</TD></TR><TR><TD CLASS="l">317</TD><TD>//                        }</TD></TR><TR CLASS="z"><TD CLASS="l">318</TD><TD>                        if (parentElement instanceof IProject) {</TD></TR><TR CLASS="z"><TD CLASS="l">319</TD><TD>                                IProject project= (IProject) parentElement;</TD></TR><TR CLASS="z"><TD CLASS="l">320</TD><TD>                                if (project.isAccessible())</TD></TR><TR CLASS="z"><TD CLASS="l">321</TD><TD>                                        return project.members();</TD></TR><TR CLASS="z"><TD CLASS="l">322</TD><TD>                                return NO_CHILDREN;</TD></TR><TR><TD CLASS="l">323</TD><TD>                        }                        </TD></TR><TR CLASS="z"><TD CLASS="l">324</TD><TD>                        if(parentElement instanceof IPackageFragmentRoot &amp;&amp; ((IPackageFragmentRoot)parentElement).isVirtual()) {</TD></TR><TR CLASS="z"><TD CLASS="l">325</TD><TD>                                return getLibraryChildren((IPackageFragmentRoot)parentElement);</TD></TR><TR><TD CLASS="l">326</TD><TD>                        }</TD></TR><TR><TD CLASS="l">327</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">328</TD><TD>                        return super.getChildren(parentElement);</TD></TR><TR CLASS="z"><TD CLASS="l">329</TD><TD>                } catch (CoreException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">330</TD><TD>                        return NO_CHILDREN;</TD></TR><TR><TD CLASS="l">331</TD><TD>                }</TD></TR><TR><TD CLASS="l">332</TD><TD>        }</TD></TR><TR><TD CLASS="l">333</TD><TD>        </TD></TR><TR><TD CLASS="l"><A NAME="12">334</A></TD><TD> </TD></TR><TR><TD CLASS="l">335</TD><TD>private Object[] getLibraryChildren(IPackageFragmentRoot container) {</TD></TR><TR><TD CLASS="l">336</TD><TD>                </TD></TR><TR><TD CLASS="l">337</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">338</TD><TD>                Object[] children=null;</TD></TR><TR><TD CLASS="l">339</TD><TD>                try {</TD></TR><TR CLASS="z"><TD CLASS="l">340</TD><TD>                        children = container.getChildren();</TD></TR><TR CLASS="z"><TD CLASS="l">341</TD><TD>                } catch (JavaScriptModelException ex1) {</TD></TR><TR><TD CLASS="l">342</TD><TD>                        // TODO Auto-generated catch block</TD></TR><TR CLASS="z"><TD CLASS="l">343</TD><TD>                        ex1.printStackTrace();</TD></TR><TR><TD CLASS="l">344</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">345</TD><TD>                if(children==null) return null;</TD></TR><TR CLASS="z"><TD CLASS="l">346</TD><TD>                ArrayList allChildren = new ArrayList();</TD></TR><TR><TD CLASS="l">347</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">348</TD><TD>                boolean unique = false;</TD></TR><TR><TD CLASS="l">349</TD><TD>                try {</TD></TR><TR CLASS="z"><TD CLASS="l">350</TD><TD>                        while(!unique &amp;&amp; children!=null &amp;&amp; children.length&gt;0) {</TD></TR><TR CLASS="z"><TD CLASS="l">351</TD><TD>                                for(int i = 0;i&lt;children.length;i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">352</TD><TD>                                        String display1 = ((IJavaScriptElement)children[0]).getDisplayName();</TD></TR><TR CLASS="z"><TD CLASS="l">353</TD><TD>                                        String display2 = ((IJavaScriptElement)children[i]).getDisplayName();</TD></TR><TR CLASS="z"><TD CLASS="l">354</TD><TD>                                        if(!(   (display1==display2) || (display1!=null &amp;&amp; display1.compareTo(display2)==0))){</TD></TR><TR CLASS="z"><TD CLASS="l">355</TD><TD>                                                allChildren.addAll(Arrays.asList(children));</TD></TR><TR CLASS="z"><TD CLASS="l">356</TD><TD>                                                unique=true;</TD></TR><TR CLASS="z"><TD CLASS="l">357</TD><TD>                                                break;</TD></TR><TR><TD CLASS="l">358</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">359</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">360</TD><TD>                                ArrayList more = new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">361</TD><TD>                                for(int i = 0;!unique &amp;&amp; i&lt;children.length;i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">362</TD><TD>                                        if(children[i] instanceof IPackageFragment) {</TD></TR><TR CLASS="z"><TD CLASS="l">363</TD><TD>                                                more.addAll(Arrays.asList(((IPackageFragment)children[i]).getChildren()));</TD></TR><TR CLASS="z"><TD CLASS="l">364</TD><TD>                                        }else if(children[i] instanceof IPackageFragmentRoot) {</TD></TR><TR CLASS="z"><TD CLASS="l">365</TD><TD>                                                more.addAll(Arrays.asList(((IPackageFragmentRoot)children[i]).getChildren()));</TD></TR><TR CLASS="z"><TD CLASS="l">366</TD><TD>                                        }else if(children[i] instanceof IClassFile) {</TD></TR><TR CLASS="z"><TD CLASS="l">367</TD><TD>                                                more.addAll(Arrays.asList( filter(((IClassFile)children[i]).getChildren())) );</TD></TR><TR CLASS="z"><TD CLASS="l">368</TD><TD>                                        }else if(children[i] instanceof IJavaScriptUnit) {</TD></TR><TR CLASS="z"><TD CLASS="l">369</TD><TD>                                                more.addAll(Arrays.asList( filter(((IJavaScriptUnit)children[i]).getChildren())) );</TD></TR><TR><TD CLASS="l">370</TD><TD>                                        }else {</TD></TR><TR><TD CLASS="l">371</TD><TD>                                                /* bottomed out, now at javaElement level */</TD></TR><TR CLASS="z"><TD CLASS="l">372</TD><TD>                                                unique=true;</TD></TR><TR CLASS="z"><TD CLASS="l">373</TD><TD>                                                break;</TD></TR><TR><TD CLASS="l">374</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">375</TD><TD>                                        </TD></TR><TR><TD CLASS="l">376</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">377</TD><TD>                                if(!unique) children = more.toArray();</TD></TR><TR><TD CLASS="l">378</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">379</TD><TD>                } catch (JavaScriptModelException ex) {</TD></TR><TR><TD CLASS="l">380</TD><TD>                        // TODO Auto-generated catch block</TD></TR><TR CLASS="z"><TD CLASS="l">381</TD><TD>                        ex.printStackTrace();</TD></TR><TR><TD CLASS="l">382</TD><TD>                }</TD></TR><TR><TD CLASS="l">383</TD><TD>                </TD></TR><TR><TD CLASS="l">384</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">385</TD><TD>                return allChildren.toArray();</TD></TR><TR><TD CLASS="l">386</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="16">387</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">388</TD><TD>         * @see org.eclipse.wst.jsdt.ui.StandardJavaScriptElementContentProvider#getPackageFragmentRoots(org.eclipse.wst.jsdt.core.IJavaScriptProject)</TD></TR><TR><TD CLASS="l">389</TD><TD>         */</TD></TR><TR><TD CLASS="l">390</TD><TD>        protected Object[] getPackageFragmentRoots(IJavaScriptProject project) throws JavaScriptModelException {</TD></TR><TR CLASS="z"><TD CLASS="l">391</TD><TD>                if (!project.getProject().isOpen())</TD></TR><TR CLASS="z"><TD CLASS="l">392</TD><TD>                        return NO_CHILDREN;</TD></TR><TR><TD CLASS="l">393</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">394</TD><TD>                List result= new ArrayList();</TD></TR><TR><TD CLASS="l">395</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">396</TD><TD>                boolean addJARContainer= false;</TD></TR><TR CLASS="z"><TD CLASS="l">397</TD><TD>                ArrayList projectPackageFragmentRoots  = new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">398</TD><TD>                IPackageFragmentRoot[] roots= project.getPackageFragmentRoots();</TD></TR><TR CLASS="z"><TD CLASS="l">399</TD><TD>                for (int i= 0; i &lt; roots.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">400</TD><TD>                        IPackageFragmentRoot root= roots[i];</TD></TR><TR CLASS="z"><TD CLASS="l">401</TD><TD>                        IIncludePathEntry classpathEntry= root.getRawIncludepathEntry();</TD></TR><TR><TD CLASS="l">402</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">403</TD><TD>                        IIncludePathAttribute[] attribs = classpathEntry.getExtraAttributes();</TD></TR><TR CLASS="z"><TD CLASS="l">404</TD><TD>                        boolean shouldHide = false;</TD></TR><TR CLASS="z"><TD CLASS="l">405</TD><TD>                        for(int p = 0;p&lt;attribs.length;p++){</TD></TR><TR CLASS="z"><TD CLASS="l">406</TD><TD>                                if(attribs[p]==IIncludePathAttribute.HIDE) shouldHide = true;</TD></TR><TR><TD CLASS="l">407</TD><TD>                        }</TD></TR><TR><TD CLASS="l">408</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">409</TD><TD>                        int entryKind= classpathEntry.getEntryKind();</TD></TR><TR CLASS="z"><TD CLASS="l">410</TD><TD>                        if (entryKind == IIncludePathEntry.CPE_CONTAINER) {</TD></TR><TR><TD CLASS="l">411</TD><TD>                                // all JsGlobalScopeContainers are added later </TD></TR><TR CLASS="z"><TD CLASS="l">412</TD><TD>                        } else if (fShowLibrariesNode &amp;&amp; (entryKind != IIncludePathEntry.CPE_SOURCE) &amp;&amp; entryKind!=IIncludePathEntry.CPE_CONTAINER) {</TD></TR><TR CLASS="z"><TD CLASS="l">413</TD><TD>                                addJARContainer= true;</TD></TR><TR CLASS="z"><TD CLASS="l">414</TD><TD>                                projectPackageFragmentRoots.add(root);</TD></TR><TR><TD CLASS="l">415</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">416</TD><TD>                                if (isProjectPackageFragmentRoot(root)) {</TD></TR><TR><TD CLASS="l">417</TD><TD>                                        // filter out package fragments that correspond to projects and</TD></TR><TR><TD CLASS="l">418</TD><TD>                                        // replace them with the package fragments directly</TD></TR><TR CLASS="z"><TD CLASS="l">419</TD><TD>                                        Object[] fragments= getPackageFragmentRootContent(root);</TD></TR><TR CLASS="z"><TD CLASS="l">420</TD><TD>                                        for (int j= 0; j &lt; fragments.length; j++) {</TD></TR><TR CLASS="z"><TD CLASS="l">421</TD><TD>                                                result.add(fragments[j]);</TD></TR><TR><TD CLASS="l">422</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">423</TD><TD>                                } else if(!shouldHide){</TD></TR><TR CLASS="z"><TD CLASS="l">424</TD><TD>                                        result.add(root);</TD></TR><TR><TD CLASS="l">425</TD><TD>                                }</TD></TR><TR><TD CLASS="l">426</TD><TD>                        }</TD></TR><TR><TD CLASS="l">427</TD><TD>                }</TD></TR><TR><TD CLASS="l">428</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">429</TD><TD>                if (addJARContainer) {</TD></TR><TR CLASS="z"><TD CLASS="l">430</TD><TD>                        projectPackageFragmentRoots.add(new LibraryContainer(project));</TD></TR><TR><TD CLASS="l">431</TD><TD>                }</TD></TR><TR><TD CLASS="l">432</TD><TD>                </TD></TR><TR><TD CLASS="l">433</TD><TD>                // separate loop to make sure all containers are on the classpath</TD></TR><TR CLASS="z"><TD CLASS="l">434</TD><TD>                IIncludePathEntry[] rawClasspath= project.getRawIncludepath();</TD></TR><TR CLASS="z"><TD CLASS="l">435</TD><TD>                for (int i= 0; i &lt; rawClasspath.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">436</TD><TD>                        IIncludePathEntry classpathEntry= rawClasspath[i];</TD></TR><TR CLASS="z"><TD CLASS="l">437</TD><TD>                        if (classpathEntry.getEntryKind() == IIncludePathEntry.CPE_CONTAINER) {</TD></TR><TR CLASS="z"><TD CLASS="l">438</TD><TD>                                projectPackageFragmentRoots.add(new JsGlobalScopeContainer(project, classpathEntry));</TD></TR><TR><TD CLASS="l">439</TD><TD>                        }        </TD></TR><TR><TD CLASS="l">440</TD><TD>                }        </TD></TR><TR CLASS="z"><TD CLASS="l">441</TD><TD>                Object[] resources= project.getNonJavaScriptResources();</TD></TR><TR CLASS="z"><TD CLASS="l">442</TD><TD>                for (int i= 0; i &lt; resources.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">443</TD><TD>                        result.add(resources[i]);</TD></TR><TR><TD CLASS="l">444</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">445</TD><TD>                ProjectLibraryRoot projectLibs = new ProjectLibraryRoot(project);</TD></TR><TR CLASS="z"><TD CLASS="l">446</TD><TD>                result.add(0,projectLibs);</TD></TR><TR CLASS="z"><TD CLASS="l">447</TD><TD>                return result.toArray();</TD></TR><TR><TD CLASS="l">448</TD><TD>        }</TD></TR><TR><TD CLASS="l">449</TD><TD>//        private Object[] getContainerPackageFragmentRoots3(PackageFragmentRootContainer container) {</TD></TR><TR><TD CLASS="l">450</TD><TD>//                Object[] children = container.getChildren();</TD></TR><TR><TD CLASS="l">451</TD><TD>//                if(children==null) return null;</TD></TR><TR><TD CLASS="l">452</TD><TD>//                ArrayList allChildren = new ArrayList();</TD></TR><TR><TD CLASS="l">453</TD><TD>//                for(int i=0;i&lt;children.length;i++) {</TD></TR><TR><TD CLASS="l">454</TD><TD>//                        try {</TD></TR><TR><TD CLASS="l">455</TD><TD>//                                allChildren.addAll(Arrays.asList(((IPackageFragmentRoot)children[i]).getChildren()));</TD></TR><TR><TD CLASS="l">456</TD><TD>//                        } catch (JavaScriptModelException ex) {</TD></TR><TR><TD CLASS="l">457</TD><TD>//                                </TD></TR><TR><TD CLASS="l">458</TD><TD>//                        }</TD></TR><TR><TD CLASS="l">459</TD><TD>//                }</TD></TR><TR><TD CLASS="l"><A NAME="a">460</A></TD><TD>//                return allChildren.toArray();</TD></TR><TR><TD CLASS="l">461</TD><TD>//        }</TD></TR><TR><TD CLASS="l">462</TD><TD>//        </TD></TR><TR><TD CLASS="l">463</TD><TD>        private Object[] getContainerPackageFragmentRoots(PackageFragmentRootContainer container) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="b">464</A></TD><TD>                return getContainerPackageFragmentRoots(container, false);</TD></TR><TR><TD CLASS="l">465</TD><TD>        }</TD></TR><TR><TD CLASS="l">466</TD><TD>        private Object[] getContainerPackageFragmentRoots(PackageFragmentRootContainer container, boolean createFolder) {</TD></TR><TR><TD CLASS="l">467</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">468</TD><TD>                        Object[] children = container.getChildren();</TD></TR><TR CLASS="z"><TD CLASS="l">469</TD><TD>                        if(children==null) return new Object[0];</TD></TR><TR><TD CLASS="l">470</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">471</TD><TD>                        ArrayList allChildren = new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">472</TD><TD>                        ArrayList expanded = new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">473</TD><TD>                        expanded.addAll(Arrays.asList(children));</TD></TR><TR><TD CLASS="l">474</TD><TD>                        </TD></TR><TR><TD CLASS="l">475</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">476</TD><TD>                        if(expanded==null || expanded.size() &lt; 1) return new Object[0];</TD></TR><TR><TD CLASS="l">477</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">478</TD><TD>                        Object next = expanded.remove(0);</TD></TR><TR><TD CLASS="l">479</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">480</TD><TD>                        while(next!=null) {</TD></TR><TR><TD CLASS="l">481</TD><TD>                                try {</TD></TR><TR CLASS="z"><TD CLASS="l">482</TD><TD>                                        if(next instanceof IPackageFragment) {</TD></TR><TR CLASS="z"><TD CLASS="l">483</TD><TD>                                                expanded.addAll(Arrays.asList(((IPackageFragment)next).getChildren()));</TD></TR><TR CLASS="z"><TD CLASS="l">484</TD><TD>                                        }else if(next instanceof IPackageFragmentRoot) {</TD></TR><TR CLASS="z"><TD CLASS="l">485</TD><TD>                                                expanded.addAll(Arrays.asList(((IPackageFragmentRoot)next).getChildren()));</TD></TR><TR CLASS="z"><TD CLASS="l">486</TD><TD>                                        }else if(next instanceof IClassFile) {</TD></TR><TR CLASS="z"><TD CLASS="l">487</TD><TD>                                                List newChildren = Arrays.asList( filter(((IClassFile)next).getChildren() ));</TD></TR><TR CLASS="z"><TD CLASS="l">488</TD><TD>                                                allChildren.removeAll(newChildren);</TD></TR><TR CLASS="z"><TD CLASS="l">489</TD><TD>                                                allChildren.addAll(newChildren);</TD></TR><TR CLASS="z"><TD CLASS="l">490</TD><TD>                                        }else if(next instanceof IJavaScriptUnit) {</TD></TR><TR CLASS="z"><TD CLASS="l">491</TD><TD>                                                List newChildren = Arrays.asList( filter(((IJavaScriptUnit)next).getChildren()));</TD></TR><TR CLASS="z"><TD CLASS="l">492</TD><TD>                                                allChildren.removeAll(newChildren);</TD></TR><TR CLASS="z"><TD CLASS="l">493</TD><TD>                                                allChildren.addAll(newChildren);</TD></TR><TR><TD CLASS="l">494</TD><TD>                                        </TD></TR><TR><TD CLASS="l">495</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">496</TD><TD>                                } catch (JavaScriptModelException ex) {</TD></TR><TR><TD CLASS="l">497</TD><TD>                                        // TODO Auto-generated catch block</TD></TR><TR CLASS="z"><TD CLASS="l">498</TD><TD>                                        ex.printStackTrace();</TD></TR><TR><TD CLASS="l">499</TD><TD>                                }</TD></TR><TR><TD CLASS="l">500</TD><TD>                                </TD></TR><TR CLASS="z"><TD CLASS="l">501</TD><TD>                                if(expanded.size()&gt;0) </TD></TR><TR CLASS="z"><TD CLASS="l">502</TD><TD>                                        next = expanded.remove(0);</TD></TR><TR><TD CLASS="l">503</TD><TD>                                else</TD></TR><TR CLASS="z"><TD CLASS="l">504</TD><TD>                                        next = null;</TD></TR><TR><TD CLASS="l">505</TD><TD>                                </TD></TR><TR><TD CLASS="l">506</TD><TD>                        }</TD></TR><TR><TD CLASS="l">507</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">508</TD><TD>                        return allChildren.toArray();</TD></TR><TR><TD CLASS="l">509</TD><TD>                </TD></TR><TR><TD CLASS="l">510</TD><TD>                </TD></TR><TR><TD CLASS="l">511</TD><TD>                </TD></TR><TR><TD CLASS="l"><A NAME="c">512</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">513</TD><TD>        private Object[] getContainerPackageFragmentRootsDeprc(PackageFragmentRootContainer container, boolean createFolder) {</TD></TR><TR><TD CLASS="l">514</TD><TD>                </TD></TR><TR><TD CLASS="l">515</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">516</TD><TD>                if(container!=null) {        </TD></TR><TR><TD CLASS="l">517</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">518</TD><TD>                        Object[] children = container.getChildren();</TD></TR><TR CLASS="z"><TD CLASS="l">519</TD><TD>                        if(children==null) return null;</TD></TR><TR CLASS="z"><TD CLASS="l">520</TD><TD>                        ArrayList allChildren = new ArrayList();</TD></TR><TR><TD CLASS="l">521</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">522</TD><TD>                        boolean unique = false;</TD></TR><TR><TD CLASS="l">523</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">524</TD><TD>                                while(!unique &amp;&amp; children!=null &amp;&amp; children.length&gt;0) {</TD></TR><TR CLASS="z"><TD CLASS="l">525</TD><TD>                                        String display1=null;</TD></TR><TR CLASS="z"><TD CLASS="l">526</TD><TD>                                        for(int i = 0;i&lt;children.length;i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">527</TD><TD>                                                display1 = ((IJavaScriptElement)children[0]).getDisplayName();</TD></TR><TR CLASS="z"><TD CLASS="l">528</TD><TD>                                                String display2 = ((IJavaScriptElement)children[i]).getDisplayName();</TD></TR><TR CLASS="z"><TD CLASS="l">529</TD><TD>                                                if(!(   (display1==display2) || (display1!=null &amp;&amp; display1.compareTo(display2)==0))){</TD></TR><TR CLASS="z"><TD CLASS="l">530</TD><TD>                                                        allChildren.addAll(Arrays.asList(children));</TD></TR><TR CLASS="z"><TD CLASS="l">531</TD><TD>                                                        unique=true;</TD></TR><TR CLASS="z"><TD CLASS="l">532</TD><TD>                                                        break;</TD></TR><TR><TD CLASS="l">533</TD><TD>                                                }</TD></TR><TR><TD CLASS="l">534</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">535</TD><TD>                                        if(!unique &amp;&amp; createFolder) {</TD></TR><TR CLASS="z"><TD CLASS="l">536</TD><TD>                                                ContainerFolder folder = new ContainerFolder(display1, container);</TD></TR><TR CLASS="z"><TD CLASS="l">537</TD><TD>                                                return new Object[] {folder};</TD></TR><TR><TD CLASS="l">538</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">539</TD><TD>                                        ArrayList more = new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">540</TD><TD>                                        for(int i = 0;!unique &amp;&amp; i&lt;children.length;i++) {</TD></TR><TR><TD CLASS="l">541</TD><TD>                                        </TD></TR><TR><TD CLASS="l">542</TD><TD>                                                try {</TD></TR><TR CLASS="z"><TD CLASS="l">543</TD><TD>                                                        if(children[i] instanceof IPackageFragment) {</TD></TR><TR CLASS="z"><TD CLASS="l">544</TD><TD>                                                                more.addAll(Arrays.asList(((IPackageFragment)children[i]).getChildren()));</TD></TR><TR CLASS="z"><TD CLASS="l">545</TD><TD>                                                        }else if(children[i] instanceof IPackageFragmentRoot) {</TD></TR><TR CLASS="z"><TD CLASS="l">546</TD><TD>                                                                more.addAll(Arrays.asList(((IPackageFragmentRoot)children[i]).getChildren()));</TD></TR><TR CLASS="z"><TD CLASS="l">547</TD><TD>                                                        }else if(children[i] instanceof IClassFile) {</TD></TR><TR CLASS="z"><TD CLASS="l">548</TD><TD>                                                                more.addAll(Arrays.asList( filter(((IClassFile)children[i]).getChildren())) );</TD></TR><TR CLASS="z"><TD CLASS="l">549</TD><TD>                                                        }else if(children[i] instanceof IJavaScriptUnit) {</TD></TR><TR CLASS="z"><TD CLASS="l">550</TD><TD>                                                                more.addAll(Arrays.asList( filter(((IJavaScriptUnit)children[i]).getChildren())) );</TD></TR><TR><TD CLASS="l">551</TD><TD>                                                        }else {</TD></TR><TR><TD CLASS="l">552</TD><TD>                                                                /* bottomed out, now at javaElement level */</TD></TR><TR CLASS="z"><TD CLASS="l">553</TD><TD>                                                                unique=true;</TD></TR><TR CLASS="z"><TD CLASS="l">554</TD><TD>                                                                break;</TD></TR><TR><TD CLASS="l">555</TD><TD>                                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">556</TD><TD>                                                } catch (JavaScriptModelException ex) {</TD></TR><TR><TD CLASS="l">557</TD><TD>                                                        // TODO Auto-generated catch block</TD></TR><TR CLASS="z"><TD CLASS="l">558</TD><TD>                                                        ex.printStackTrace();</TD></TR><TR><TD CLASS="l">559</TD><TD>                                                }</TD></TR><TR><TD CLASS="l">560</TD><TD>                                                </TD></TR><TR><TD CLASS="l">561</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">562</TD><TD>                                        if(!unique) children = more.toArray();</TD></TR><TR><TD CLASS="l">563</TD><TD>                                }</TD></TR><TR><TD CLASS="l">564</TD><TD>                </TD></TR><TR><TD CLASS="l">565</TD><TD>                        </TD></TR><TR><TD CLASS="l">566</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">567</TD><TD>                        return allChildren.toArray();</TD></TR><TR><TD CLASS="l">568</TD><TD>                }else {</TD></TR><TR><TD CLASS="l">569</TD><TD>                </TD></TR><TR><TD CLASS="l">570</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">571</TD><TD>                        Object[] children = container.getChildren();</TD></TR><TR CLASS="z"><TD CLASS="l">572</TD><TD>                        if(children==null) return null;</TD></TR><TR CLASS="z"><TD CLASS="l">573</TD><TD>                        ArrayList allChildren = new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">574</TD><TD>                        for(int i=0;i&lt;children.length;i++) {</TD></TR><TR><TD CLASS="l">575</TD><TD>                                try {</TD></TR><TR CLASS="z"><TD CLASS="l">576</TD><TD>                                        allChildren.addAll(Arrays.asList(((IPackageFragmentRoot)children[i]).getChildren()));</TD></TR><TR CLASS="z"><TD CLASS="l">577</TD><TD>                                } catch (JavaScriptModelException ex) {</TD></TR><TR><TD CLASS="l">578</TD><TD>                                        </TD></TR><TR><TD CLASS="l">579</TD><TD>                                }</TD></TR><TR><TD CLASS="l">580</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">581</TD><TD>                        return allChildren.toArray();</TD></TR><TR><TD CLASS="l"><A NAME="13">582</A></TD><TD>                }</TD></TR><TR><TD CLASS="l">583</TD><TD>        }</TD></TR><TR><TD CLASS="l">584</TD><TD> </TD></TR><TR><TD CLASS="l">585</TD><TD>        private Object[] getNonJavaProjects(IJavaScriptModel model) throws JavaScriptModelException {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1b">586</A></TD><TD>                return model.getNonJavaScriptResources();</TD></TR><TR><TD CLASS="l">587</TD><TD>        }</TD></TR><TR><TD CLASS="l">588</TD><TD> </TD></TR><TR><TD CLASS="l">589</TD><TD>        protected Object internalGetParent(Object element) {</TD></TR><TR CLASS="z"><TD CLASS="l">590</TD><TD>                if (!fIsFlatLayout &amp;&amp; element instanceof IPackageFragment) {</TD></TR><TR CLASS="z"><TD CLASS="l">591</TD><TD>                        return getHierarchicalPackageParent((IPackageFragment) element);</TD></TR><TR CLASS="z"><TD CLASS="l">592</TD><TD>                } else if (element instanceof IPackageFragmentRoot) {</TD></TR><TR><TD CLASS="l">593</TD><TD>                        // since we insert logical package containers we have to fix</TD></TR><TR><TD CLASS="l">594</TD><TD>                        // up the parent for package fragment roots so that they refer</TD></TR><TR><TD CLASS="l">595</TD><TD>                        // to the container and containers refer to the project</TD></TR><TR CLASS="z"><TD CLASS="l">596</TD><TD>                        IPackageFragmentRoot root= (IPackageFragmentRoot)element;</TD></TR><TR><TD CLASS="l">597</TD><TD>                        </TD></TR><TR><TD CLASS="l">598</TD><TD>                        try {</TD></TR><TR CLASS="z"><TD CLASS="l">599</TD><TD>                                IIncludePathEntry entry= root.getRawIncludepathEntry();</TD></TR><TR CLASS="z"><TD CLASS="l">600</TD><TD>                                int entryKind= entry.getEntryKind();</TD></TR><TR CLASS="z"><TD CLASS="l">601</TD><TD>                                if (entryKind == IIncludePathEntry.CPE_CONTAINER) {</TD></TR><TR CLASS="z"><TD CLASS="l">602</TD><TD>                                        return new JsGlobalScopeContainer(root.getJavaScriptProject(), entry);</TD></TR><TR CLASS="z"><TD CLASS="l">603</TD><TD>                                } else if (fShowLibrariesNode &amp;&amp; (entryKind == IIncludePathEntry.CPE_LIBRARY || entryKind == IIncludePathEntry.CPE_VARIABLE)) {</TD></TR><TR CLASS="z"><TD CLASS="l">604</TD><TD>                                        return new LibraryContainer(root.getJavaScriptProject());</TD></TR><TR><TD CLASS="l">605</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">606</TD><TD>                        } catch (JavaScriptModelException e) {</TD></TR><TR><TD CLASS="l">607</TD><TD>                                // fall through</TD></TR><TR><TD CLASS="l">608</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">609</TD><TD>                } else if (element instanceof PackageFragmentRootContainer) {</TD></TR><TR CLASS="z"><TD CLASS="l">610</TD><TD>                        return ((PackageFragmentRootContainer)element).getJavaProject();</TD></TR><TR><TD CLASS="l">611</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">612</TD><TD>                return super.internalGetParent(element);</TD></TR><TR><TD CLASS="l">613</TD><TD>        }</TD></TR><TR><TD CLASS="l">614</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="19">615</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">616</TD><TD>         * Method declared on IContentProvider.</TD></TR><TR><TD CLASS="l">617</TD><TD>         */</TD></TR><TR><TD CLASS="l">618</TD><TD>        public void inputChanged(Viewer viewer, Object oldInput, Object newInput) {</TD></TR><TR CLASS="z"><TD CLASS="l">619</TD><TD>                super.inputChanged(viewer, oldInput, newInput);</TD></TR><TR CLASS="z"><TD CLASS="l">620</TD><TD>                fViewer= (TreeViewer)viewer;</TD></TR><TR CLASS="z"><TD CLASS="l">621</TD><TD>                if (oldInput == null &amp;&amp; newInput != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">622</TD><TD>                        JavaScriptCore.addElementChangedListener(this); </TD></TR><TR CLASS="z"><TD CLASS="l">623</TD><TD>                } else if (oldInput != null &amp;&amp; newInput == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">624</TD><TD>                        JavaScriptCore.removeElementChangedListener(this); </TD></TR><TR><TD CLASS="l">625</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">626</TD><TD>                fInput= newInput;</TD></TR><TR CLASS="z"><TD CLASS="l">627</TD><TD>        }</TD></TR><TR><TD CLASS="l">628</TD><TD> </TD></TR><TR><TD CLASS="l">629</TD><TD>        // hierarchical packages</TD></TR><TR><TD CLASS="l">630</TD><TD>        /**</TD></TR><TR><TD CLASS="l">631</TD><TD>         * Returns the hierarchical packages inside a given fragment or root.</TD></TR><TR><TD CLASS="l">632</TD><TD>         * @param parent The parent package fragment root</TD></TR><TR><TD CLASS="l">633</TD><TD>         * @param fragment The package to get the children for or 'null' to get the children of the root.</TD></TR><TR><TD CLASS="l"><A NAME="f">634</A></TD><TD>         * @param result Collection where the resulting elements are added</TD></TR><TR><TD CLASS="l">635</TD><TD>         * @throws JavaScriptModelException</TD></TR><TR><TD CLASS="l">636</TD><TD>         */</TD></TR><TR><TD CLASS="l">637</TD><TD>        private void getHierarchicalPackageChildren(IPackageFragmentRoot parent, IPackageFragment fragment, Collection result) throws JavaScriptModelException {</TD></TR><TR CLASS="z"><TD CLASS="l">638</TD><TD>                IJavaScriptElement[] children= parent.getChildren();</TD></TR><TR CLASS="z"><TD CLASS="l">639</TD><TD>                String prefix= fragment != null ? fragment.getElementName() + '/' : &#34;&#34;; //$NON-NLS-1$</TD></TR><TR CLASS="z"><TD CLASS="l">640</TD><TD>                if (prefix.length()==1)</TD></TR><TR CLASS="z"><TD CLASS="l">641</TD><TD>                        prefix=&#34;&#34;; //$NON-NLS-1$</TD></TR><TR CLASS="z"><TD CLASS="l">642</TD><TD>                int prefixLen= prefix.length();</TD></TR><TR CLASS="z"><TD CLASS="l">643</TD><TD>                for (int i= 0; i &lt; children.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">644</TD><TD>                        IPackageFragment curr= (IPackageFragment) children[i];</TD></TR><TR CLASS="z"><TD CLASS="l">645</TD><TD>                        if (fragment==null)</TD></TR><TR><TD CLASS="l">646</TD><TD>                        {</TD></TR><TR CLASS="z"><TD CLASS="l">647</TD><TD>                                if (curr.isDefaultPackage()) </TD></TR><TR CLASS="z"><TD CLASS="l">648</TD><TD>                                        result.add(curr);</TD></TR><TR><TD CLASS="l">649</TD><TD>                        }</TD></TR><TR><TD CLASS="l">650</TD><TD>                        else</TD></TR><TR><TD CLASS="l">651</TD><TD>                        {</TD></TR><TR CLASS="z"><TD CLASS="l">652</TD><TD>                                String name= curr.getElementName();</TD></TR><TR CLASS="z"><TD CLASS="l">653</TD><TD>                                if (name.startsWith(prefix) &amp;&amp; name.length() &gt; prefixLen &amp;&amp; name.indexOf('/', prefixLen) == -1) {</TD></TR><TR CLASS="z"><TD CLASS="l">654</TD><TD>                                        if (fFoldPackages) {</TD></TR><TR CLASS="z"><TD CLASS="l">655</TD><TD>                                                curr= getFolded(children, curr);</TD></TR><TR><TD CLASS="l">656</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">657</TD><TD>                                        result.add(curr);</TD></TR><TR><TD CLASS="l">658</TD><TD>                                }</TD></TR><TR><TD CLASS="l">659</TD><TD>                        }</TD></TR><TR><TD CLASS="l">660</TD><TD> </TD></TR><TR><TD CLASS="l">661</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">662</TD><TD>        }</TD></TR><TR><TD CLASS="l">663</TD><TD>        </TD></TR><TR><TD CLASS="l">664</TD><TD>        /**</TD></TR><TR><TD CLASS="l">665</TD><TD>         * Returns the hierarchical packages inside a given folder.</TD></TR><TR><TD CLASS="l">666</TD><TD>         * @param folder The parent folder</TD></TR><TR><TD CLASS="l"><A NAME="11">667</A></TD><TD>         * @param result Collection where the resulting elements are added</TD></TR><TR><TD CLASS="l">668</TD><TD>         * @throws CoreException thrown when elements could not be accessed</TD></TR><TR><TD CLASS="l">669</TD><TD>         */</TD></TR><TR><TD CLASS="l">670</TD><TD>        private void getHierarchicalPackagesInFolder(IFolder folder, Collection result) throws CoreException {</TD></TR><TR CLASS="z"><TD CLASS="l">671</TD><TD>                IResource[] resources= folder.members();</TD></TR><TR CLASS="z"><TD CLASS="l">672</TD><TD>                for (int i= 0; i &lt; resources.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">673</TD><TD>                        IResource resource= resources[i];</TD></TR><TR CLASS="z"><TD CLASS="l">674</TD><TD>                        if (resource instanceof IFolder) {</TD></TR><TR CLASS="z"><TD CLASS="l">675</TD><TD>                                IFolder curr= (IFolder) resource;</TD></TR><TR CLASS="z"><TD CLASS="l">676</TD><TD>                                IJavaScriptElement element= JavaScriptCore.create(curr);</TD></TR><TR CLASS="z"><TD CLASS="l">677</TD><TD>                                if (element instanceof IPackageFragment) {</TD></TR><TR CLASS="z"><TD CLASS="l">678</TD><TD>                                        if (element.exists()) {</TD></TR><TR CLASS="z"><TD CLASS="l">679</TD><TD>                                        if (fFoldPackages) {</TD></TR><TR CLASS="z"><TD CLASS="l">680</TD><TD>                                                IPackageFragment fragment= (IPackageFragment) element;</TD></TR><TR CLASS="z"><TD CLASS="l">681</TD><TD>                                                IPackageFragmentRoot root= (IPackageFragmentRoot) fragment.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">682</TD><TD>                                                element= getFolded(root.getChildren(), fragment);</TD></TR><TR><TD CLASS="l">683</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">684</TD><TD>                                        result.add(element);        </TD></TR><TR><TD CLASS="l">685</TD><TD>                                } </TD></TR><TR><TD CLASS="l">686</TD><TD>                        }        </TD></TR><TR><TD CLASS="l">687</TD><TD>                }</TD></TR><TR><TD CLASS="l"><A NAME="10">688</A></TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">689</TD><TD>        }</TD></TR><TR><TD CLASS="l">690</TD><TD> </TD></TR><TR><TD CLASS="l">691</TD><TD>        public Object getHierarchicalPackageParent(IPackageFragment child) {</TD></TR><TR CLASS="z"><TD CLASS="l">692</TD><TD>                String name= child.getElementName();</TD></TR><TR CLASS="z"><TD CLASS="l">693</TD><TD>                IPackageFragmentRoot parent= (IPackageFragmentRoot) child.getParent();</TD></TR><TR CLASS="z"><TD CLASS="l">694</TD><TD>                int index= name.lastIndexOf('/');</TD></TR><TR CLASS="z"><TD CLASS="l">695</TD><TD>                if (index != -1) {</TD></TR><TR CLASS="z"><TD CLASS="l">696</TD><TD>                        String realParentName= name.substring(0, index);</TD></TR><TR CLASS="z"><TD CLASS="l">697</TD><TD>                        IPackageFragment element= parent.getPackageFragment(realParentName);</TD></TR><TR CLASS="z"><TD CLASS="l">698</TD><TD>                        if (element.exists()) {</TD></TR><TR><TD CLASS="l">699</TD><TD>                                try {</TD></TR><TR CLASS="z"><TD CLASS="l">700</TD><TD>                                        if (fFoldPackages &amp;&amp; isEmpty(element) &amp;&amp; findSinglePackageChild(element, parent.getChildren()) != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">701</TD><TD>                                                return getHierarchicalPackageParent(element);</TD></TR><TR><TD CLASS="l">702</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">703</TD><TD>                                } catch (JavaScriptModelException e) {</TD></TR><TR><TD CLASS="l">704</TD><TD>                                        // ignore</TD></TR><TR><TD CLASS="l">705</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">706</TD><TD>                                return element;</TD></TR><TR><TD CLASS="l">707</TD><TD>                        } else { // bug 65240</TD></TR><TR CLASS="z"><TD CLASS="l">708</TD><TD>                                IResource resource= element.getResource();</TD></TR><TR CLASS="z"><TD CLASS="l">709</TD><TD>                                if (resource != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">710</TD><TD>                                        return resource;</TD></TR><TR><TD CLASS="l">711</TD><TD>                                }</TD></TR><TR><TD CLASS="l">712</TD><TD>                        }</TD></TR><TR><TD CLASS="l">713</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">714</TD><TD>                if (parent.getResource() instanceof IProject) {</TD></TR><TR CLASS="z"><TD CLASS="l">715</TD><TD>                        return parent.getJavaScriptProject();</TD></TR><TR><TD CLASS="l">716</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="d">717</A></TD><TD>                return parent;</TD></TR><TR><TD CLASS="l">718</TD><TD>        }</TD></TR><TR><TD CLASS="l">719</TD><TD>        </TD></TR><TR><TD CLASS="l">720</TD><TD>        private static IPackageFragment getFolded(IJavaScriptElement[] children, IPackageFragment pack) throws JavaScriptModelException {</TD></TR><TR CLASS="z"><TD CLASS="l">721</TD><TD>                while (isEmpty(pack)) {</TD></TR><TR CLASS="z"><TD CLASS="l">722</TD><TD>                        IPackageFragment collapsed= findSinglePackageChild(pack, children);</TD></TR><TR CLASS="z"><TD CLASS="l">723</TD><TD>                        if (collapsed == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">724</TD><TD>                                return pack;</TD></TR><TR><TD CLASS="l">725</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">726</TD><TD>                        pack= collapsed;</TD></TR><TR><TD CLASS="l">727</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1c">728</A></TD><TD>                return pack;</TD></TR><TR><TD CLASS="l">729</TD><TD>        }</TD></TR><TR><TD CLASS="l">730</TD><TD>                </TD></TR><TR><TD CLASS="l">731</TD><TD>        private static boolean isEmpty(IPackageFragment fragment) throws JavaScriptModelException {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="8">732</A></TD><TD>                return !fragment.containsJavaResources() &amp;&amp; fragment.getNonJavaScriptResources().length == 0;</TD></TR><TR><TD CLASS="l">733</TD><TD>        }</TD></TR><TR><TD CLASS="l">734</TD><TD>        </TD></TR><TR><TD CLASS="l">735</TD><TD>        private static IPackageFragment findSinglePackageChild(IPackageFragment fragment, IJavaScriptElement[] children) {</TD></TR><TR CLASS="z"><TD CLASS="l">736</TD><TD>                String prefix= fragment.getElementName() + '/';</TD></TR><TR CLASS="z"><TD CLASS="l">737</TD><TD>                int prefixLen= prefix.length();</TD></TR><TR CLASS="z"><TD CLASS="l">738</TD><TD>                IPackageFragment found= null;</TD></TR><TR CLASS="z"><TD CLASS="l">739</TD><TD>                for (int i= 0; i &lt; children.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">740</TD><TD>                        IJavaScriptElement element= children[i];</TD></TR><TR CLASS="z"><TD CLASS="l">741</TD><TD>                        String name= element.getElementName();</TD></TR><TR CLASS="z"><TD CLASS="l">742</TD><TD>                        if (name.startsWith(prefix) &amp;&amp; name.length() &gt; prefixLen &amp;&amp; name.indexOf('/', prefixLen) == -1) {</TD></TR><TR CLASS="z"><TD CLASS="l">743</TD><TD>                                if (found == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">744</TD><TD>                                        found= (IPackageFragment) element;</TD></TR><TR><TD CLASS="l">745</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">746</TD><TD>                                        return null;</TD></TR><TR><TD CLASS="l">747</TD><TD>                                }</TD></TR><TR><TD CLASS="l">748</TD><TD>                        }</TD></TR><TR><TD CLASS="l">749</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">750</TD><TD>                return found;</TD></TR><TR><TD CLASS="l">751</TD><TD>        }</TD></TR><TR><TD CLASS="l">752</TD><TD>        </TD></TR><TR><TD CLASS="l">753</TD><TD>        // ------ delta processing ------</TD></TR><TR><TD CLASS="l">754</TD><TD> </TD></TR><TR><TD CLASS="l">755</TD><TD>        /**</TD></TR><TR><TD CLASS="l">756</TD><TD>         * Processes a delta recursively. When more than two children are affected the</TD></TR><TR><TD CLASS="l">757</TD><TD>         * tree is fully refreshed starting at this node.</TD></TR><TR><TD CLASS="l">758</TD><TD>         * </TD></TR><TR><TD CLASS="l">759</TD><TD>         * @param delta the delta to process</TD></TR><TR><TD CLASS="l">760</TD><TD>         * @param runnables the resulting view changes as runnables (type {@link Runnable})</TD></TR><TR><TD CLASS="l">761</TD><TD>         * @return true is returned if the conclusion is to refresh a parent of an element. In that case no siblings need</TD></TR><TR><TD CLASS="l">762</TD><TD>         * to be processed</TD></TR><TR><TD CLASS="l"><A NAME="28">763</A></TD><TD>         * @throws JavaScriptModelException thrown when the access to an element failed</TD></TR><TR><TD CLASS="l">764</TD><TD>         */</TD></TR><TR><TD CLASS="l">765</TD><TD>        private boolean processDelta(IJavaScriptElementDelta delta, Collection runnables) throws JavaScriptModelException {</TD></TR><TR><TD CLASS="l">766</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">767</TD><TD>                int kind= delta.getKind();</TD></TR><TR CLASS="z"><TD CLASS="l">768</TD><TD>                int flags= delta.getFlags();</TD></TR><TR CLASS="z"><TD CLASS="l">769</TD><TD>                IJavaScriptElement element= delta.getElement();</TD></TR><TR CLASS="z"><TD CLASS="l">770</TD><TD>                int elementType= element.getElementType();</TD></TR><TR><TD CLASS="l">771</TD><TD>                </TD></TR><TR><TD CLASS="l">772</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">773</TD><TD>                if (elementType != IJavaScriptElement.JAVASCRIPT_MODEL &amp;&amp; elementType != IJavaScriptElement.JAVASCRIPT_PROJECT) {</TD></TR><TR CLASS="z"><TD CLASS="l">774</TD><TD>                        IJavaScriptProject proj= element.getJavaScriptProject();</TD></TR><TR CLASS="z"><TD CLASS="l">775</TD><TD>                        if (proj == null || !proj.getProject().isOpen()) // TODO: Not needed if parent already did the 'open' check!</TD></TR><TR CLASS="z"><TD CLASS="l">776</TD><TD>                                return false;        </TD></TR><TR><TD CLASS="l">777</TD><TD>                }</TD></TR><TR><TD CLASS="l">778</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">779</TD><TD>                if (!fIsFlatLayout &amp;&amp; elementType == IJavaScriptElement.PACKAGE_FRAGMENT) {</TD></TR><TR CLASS="z"><TD CLASS="l">780</TD><TD>                        if (kind == IJavaScriptElementDelta.REMOVED) {</TD></TR><TR CLASS="z"><TD CLASS="l">781</TD><TD>                                final Object parent = getHierarchicalPackageParent((IPackageFragment) element);</TD></TR><TR CLASS="z"><TD CLASS="l">782</TD><TD>                                if (parent instanceof IPackageFragmentRoot) {</TD></TR><TR CLASS="z"><TD CLASS="l">783</TD><TD>                                        postRemove(element,  runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">784</TD><TD>                                        return false;</TD></TR><TR><TD CLASS="l">785</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">786</TD><TD>                                        postRefresh(internalGetParent(parent), GRANT_PARENT, element, runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">787</TD><TD>                                        return true;</TD></TR><TR><TD CLASS="l">788</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">789</TD><TD>                        } else if (kind == IJavaScriptElementDelta.ADDED) {</TD></TR><TR CLASS="z"><TD CLASS="l">790</TD><TD>                                final Object parent = getHierarchicalPackageParent((IPackageFragment) element);</TD></TR><TR CLASS="z"><TD CLASS="l">791</TD><TD>                                if (parent instanceof IPackageFragmentRoot) {</TD></TR><TR CLASS="z"><TD CLASS="l">792</TD><TD>                                        postAdd(parent, element,  runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">793</TD><TD>                                        return false;</TD></TR><TR><TD CLASS="l">794</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">795</TD><TD>                                        postRefresh(internalGetParent(parent), GRANT_PARENT, element, runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">796</TD><TD>                                        return true;</TD></TR><TR><TD CLASS="l">797</TD><TD>                                }</TD></TR><TR><TD CLASS="l">798</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">799</TD><TD>                        handleAffectedChildren(delta, element, runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">800</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">801</TD><TD>                }</TD></TR><TR><TD CLASS="l">802</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">803</TD><TD>                if (elementType == IJavaScriptElement.JAVASCRIPT_UNIT) {</TD></TR><TR CLASS="z"><TD CLASS="l">804</TD><TD>                        IJavaScriptUnit cu= (IJavaScriptUnit) element;</TD></TR><TR CLASS="z"><TD CLASS="l">805</TD><TD>                        if (!JavaModelUtil.isPrimary(cu)) {</TD></TR><TR CLASS="z"><TD CLASS="l">806</TD><TD>                                return false;</TD></TR><TR><TD CLASS="l">807</TD><TD>                        }</TD></TR><TR><TD CLASS="l">808</TD><TD>                                                </TD></TR><TR CLASS="z"><TD CLASS="l">809</TD><TD>                        if (!getProvideMembers() &amp;&amp; cu.isWorkingCopy() &amp;&amp; kind == IJavaScriptElementDelta.CHANGED) {</TD></TR><TR CLASS="z"><TD CLASS="l">810</TD><TD>                                return false;</TD></TR><TR><TD CLASS="l">811</TD><TD>                        }</TD></TR><TR><TD CLASS="l">812</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">813</TD><TD>                        if ((kind == IJavaScriptElementDelta.CHANGED) &amp;&amp; !isStructuralCUChange(flags)) {</TD></TR><TR CLASS="z"><TD CLASS="l">814</TD><TD>                                return false; // test moved ahead</TD></TR><TR><TD CLASS="l">815</TD><TD>                        }</TD></TR><TR><TD CLASS="l">816</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">817</TD><TD>                        if (!isOnClassPath(cu)) { // TODO: isOnClassPath expensive! Should be put after all cheap tests</TD></TR><TR CLASS="z"><TD CLASS="l">818</TD><TD>                                return false;</TD></TR><TR><TD CLASS="l">819</TD><TD>                        }</TD></TR><TR><TD CLASS="l">820</TD><TD>                        </TD></TR><TR><TD CLASS="l">821</TD><TD>                }</TD></TR><TR><TD CLASS="l">822</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">823</TD><TD>                if (elementType == IJavaScriptElement.JAVASCRIPT_PROJECT) {</TD></TR><TR><TD CLASS="l">824</TD><TD>                        // handle open and closing of a project</TD></TR><TR CLASS="z"><TD CLASS="l">825</TD><TD>                        if ((flags &amp; (IJavaScriptElementDelta.F_CLOSED | IJavaScriptElementDelta.F_OPENED)) != 0) {                        </TD></TR><TR CLASS="z"><TD CLASS="l">826</TD><TD>                                postRefresh(element, ORIGINAL, element, runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">827</TD><TD>                                return false;</TD></TR><TR><TD CLASS="l">828</TD><TD>                        }</TD></TR><TR><TD CLASS="l">829</TD><TD>                        // if the raw class path has changed we refresh the entire project</TD></TR><TR CLASS="z"><TD CLASS="l">830</TD><TD>                        if ((flags &amp; IJavaScriptElementDelta.F_INCLUDEPATH_CHANGED) != 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">831</TD><TD>                                postRefresh(element, ORIGINAL, element, runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">832</TD><TD>                                return false;                                </TD></TR><TR><TD CLASS="l">833</TD><TD>                        }</TD></TR><TR><TD CLASS="l">834</TD><TD>                        // if added it could be that the corresponding IProject is already shown. Remove it first.</TD></TR><TR><TD CLASS="l">835</TD><TD>                        // bug 184296</TD></TR><TR CLASS="z"><TD CLASS="l">836</TD><TD>                        if (kind == IJavaScriptElementDelta.ADDED) { </TD></TR><TR CLASS="z"><TD CLASS="l">837</TD><TD>                                postRemove(element.getResource(), runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">838</TD><TD>                                postAdd(element.getParent(), element, runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">839</TD><TD>                                return false;</TD></TR><TR><TD CLASS="l">840</TD><TD>                        }</TD></TR><TR><TD CLASS="l">841</TD><TD>                }</TD></TR><TR><TD CLASS="l">842</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">843</TD><TD>                if (kind == IJavaScriptElementDelta.REMOVED) {</TD></TR><TR CLASS="z"><TD CLASS="l">844</TD><TD>                        Object parent= internalGetParent(element);                        </TD></TR><TR CLASS="z"><TD CLASS="l">845</TD><TD>                        if (element instanceof IPackageFragment) {</TD></TR><TR><TD CLASS="l">846</TD><TD>                                // refresh package fragment root to allow filtering empty (parent) packages: bug 72923</TD></TR><TR CLASS="z"><TD CLASS="l">847</TD><TD>                                if (fViewer.testFindItem(parent) != null)</TD></TR><TR CLASS="z"><TD CLASS="l">848</TD><TD>                                        postRefresh(parent, PARENT, element, runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">849</TD><TD>                                return true;</TD></TR><TR><TD CLASS="l">850</TD><TD>                        }</TD></TR><TR><TD CLASS="l">851</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">852</TD><TD>                        postRemove(element, runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">853</TD><TD>                        if (parent instanceof IPackageFragment) </TD></TR><TR CLASS="z"><TD CLASS="l">854</TD><TD>                                postUpdateIcon((IPackageFragment)parent, runnables);</TD></TR><TR><TD CLASS="l">855</TD><TD>                        // we are filtering out empty subpackages, so we</TD></TR><TR><TD CLASS="l">856</TD><TD>                        // a package becomes empty we remove it from the viewer. </TD></TR><TR CLASS="z"><TD CLASS="l">857</TD><TD>                        if (isPackageFragmentEmpty(element.getParent())) {</TD></TR><TR CLASS="z"><TD CLASS="l">858</TD><TD>                                if (fViewer.testFindItem(parent) != null)</TD></TR><TR CLASS="z"><TD CLASS="l">859</TD><TD>                                        postRefresh(internalGetParent(parent), GRANT_PARENT, element, runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">860</TD><TD>                                return true;</TD></TR><TR><TD CLASS="l">861</TD><TD>                        }  </TD></TR><TR CLASS="z"><TD CLASS="l">862</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">863</TD><TD>                }</TD></TR><TR><TD CLASS="l">864</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">865</TD><TD>                if (kind == IJavaScriptElementDelta.ADDED) { </TD></TR><TR CLASS="z"><TD CLASS="l">866</TD><TD>                        Object parent= internalGetParent(element);</TD></TR><TR><TD CLASS="l">867</TD><TD>                        // we are filtering out empty subpackages, so we</TD></TR><TR><TD CLASS="l">868</TD><TD>                        // have to handle additions to them specially. </TD></TR><TR CLASS="z"><TD CLASS="l">869</TD><TD>                        if (parent instanceof IPackageFragment) {</TD></TR><TR CLASS="z"><TD CLASS="l">870</TD><TD>                                Object grandparent= internalGetParent(parent);</TD></TR><TR><TD CLASS="l">871</TD><TD>                                // 1GE8SI6: ITPJUI:WIN98 - Rename is not shown in Packages View</TD></TR><TR><TD CLASS="l">872</TD><TD>                                // avoid posting a refresh to an invisible parent</TD></TR><TR CLASS="z"><TD CLASS="l">873</TD><TD>                                if (parent.equals(fInput)) {</TD></TR><TR CLASS="z"><TD CLASS="l">874</TD><TD>                                        postRefresh(parent, PARENT, element, runnables);</TD></TR><TR><TD CLASS="l">875</TD><TD>                                } else {</TD></TR><TR><TD CLASS="l">876</TD><TD>                                        // refresh from grandparent if parent isn't visible yet</TD></TR><TR CLASS="z"><TD CLASS="l">877</TD><TD>                                        if (fViewer.testFindItem(parent) == null)</TD></TR><TR CLASS="z"><TD CLASS="l">878</TD><TD>                                                postRefresh(grandparent, GRANT_PARENT, element, runnables);</TD></TR><TR><TD CLASS="l">879</TD><TD>                                        else {</TD></TR><TR CLASS="z"><TD CLASS="l">880</TD><TD>                                                postRefresh(parent, PARENT, element, runnables);</TD></TR><TR><TD CLASS="l">881</TD><TD>                                        }        </TD></TR><TR><TD CLASS="l">882</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">883</TD><TD>                                return true;                </TD></TR><TR><TD CLASS="l">884</TD><TD>                        } else {  </TD></TR><TR CLASS="z"><TD CLASS="l">885</TD><TD>                                postAdd(parent, element, runnables);</TD></TR><TR><TD CLASS="l">886</TD><TD>                        }</TD></TR><TR><TD CLASS="l">887</TD><TD>                }</TD></TR><TR><TD CLASS="l">888</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">889</TD><TD>                if (elementType == IJavaScriptElement.JAVASCRIPT_UNIT) {</TD></TR><TR CLASS="z"><TD CLASS="l">890</TD><TD>                        if (kind == IJavaScriptElementDelta.CHANGED) {</TD></TR><TR><TD CLASS="l">891</TD><TD>                                // isStructuralCUChange already performed above</TD></TR><TR CLASS="z"><TD CLASS="l">892</TD><TD>                                postRefresh(element, ORIGINAL, element, runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">893</TD><TD>                                updateSelection(delta, runnables);</TD></TR><TR><TD CLASS="l">894</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">895</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">896</TD><TD>                }</TD></TR><TR><TD CLASS="l">897</TD><TD>                // no changes possible in class files</TD></TR><TR CLASS="z"><TD CLASS="l">898</TD><TD>                if (elementType == IJavaScriptElement.CLASS_FILE)</TD></TR><TR CLASS="z"><TD CLASS="l">899</TD><TD>                        return false;</TD></TR><TR><TD CLASS="l">900</TD><TD>                </TD></TR><TR><TD CLASS="l">901</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">902</TD><TD>                if (elementType == IJavaScriptElement.PACKAGE_FRAGMENT_ROOT) {</TD></TR><TR><TD CLASS="l">903</TD><TD>                        // the contents of an external JAR has changed</TD></TR><TR CLASS="z"><TD CLASS="l">904</TD><TD>                        if ((flags &amp; IJavaScriptElementDelta.F_ARCHIVE_CONTENT_CHANGED) != 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">905</TD><TD>                                postRefresh(element, ORIGINAL, element, runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">906</TD><TD>                                return false;</TD></TR><TR><TD CLASS="l">907</TD><TD>                        }</TD></TR><TR><TD CLASS="l">908</TD><TD>                        // the source attachment of a JAR has changed</TD></TR><TR CLASS="z"><TD CLASS="l">909</TD><TD>                        if ((flags &amp; (IJavaScriptElementDelta.F_SOURCEATTACHED | IJavaScriptElementDelta.F_SOURCEDETACHED)) != 0)</TD></TR><TR CLASS="z"><TD CLASS="l">910</TD><TD>                                postUpdateIcon(element, runnables);</TD></TR><TR><TD CLASS="l">911</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">912</TD><TD>                        if (isClassPathChange(delta)) {</TD></TR><TR><TD CLASS="l">913</TD><TD>                                 // throw the towel and do a full refresh of the affected java project. </TD></TR><TR CLASS="z"><TD CLASS="l">914</TD><TD>                                postRefresh(element.getJavaScriptProject(), PROJECT, element, runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">915</TD><TD>                                return true;</TD></TR><TR><TD CLASS="l">916</TD><TD>                        }</TD></TR><TR><TD CLASS="l">917</TD><TD>                }        </TD></TR><TR CLASS="z"><TD CLASS="l">918</TD><TD>                handleAffectedChildren(delta, element, runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">919</TD><TD>                return false;</TD></TR><TR><TD CLASS="l"><A NAME="1f">920</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">921</TD><TD>        </TD></TR><TR><TD CLASS="l">922</TD><TD>        private static boolean isStructuralCUChange(int flags) {</TD></TR><TR><TD CLASS="l">923</TD><TD>                // No refresh on working copy creation (F_PRIMARY_WORKING_COPY)</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="18">924</A></TD><TD>                return ((flags &amp; IJavaScriptElementDelta.F_CHILDREN) != 0) || ((flags &amp; (IJavaScriptElementDelta.F_CONTENT | IJavaScriptElementDelta.F_FINE_GRAINED)) == IJavaScriptElementDelta.F_CONTENT);</TD></TR><TR><TD CLASS="l">925</TD><TD>        }</TD></TR><TR><TD CLASS="l">926</TD><TD>        </TD></TR><TR><TD CLASS="l">927</TD><TD>        /* package */ void handleAffectedChildren(IJavaScriptElementDelta delta, IJavaScriptElement element, Collection runnables) throws JavaScriptModelException {</TD></TR><TR CLASS="z"><TD CLASS="l">928</TD><TD>                int count= 0;</TD></TR><TR><TD CLASS="l">929</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">930</TD><TD>                IResourceDelta[] resourceDeltas= delta.getResourceDeltas();</TD></TR><TR CLASS="z"><TD CLASS="l">931</TD><TD>                if (resourceDeltas != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">932</TD><TD>                        for (int i= 0; i &lt; resourceDeltas.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">933</TD><TD>                                int kind= resourceDeltas[i].getKind();</TD></TR><TR CLASS="z"><TD CLASS="l">934</TD><TD>                                if (kind == IResourceDelta.ADDED || kind == IResourceDelta.REMOVED) {</TD></TR><TR CLASS="z"><TD CLASS="l">935</TD><TD>                                        count++;</TD></TR><TR><TD CLASS="l">936</TD><TD>                                }</TD></TR><TR><TD CLASS="l">937</TD><TD>                        }</TD></TR><TR><TD CLASS="l">938</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">939</TD><TD>                IJavaScriptElementDelta[] affectedChildren= delta.getAffectedChildren();</TD></TR><TR CLASS="z"><TD CLASS="l">940</TD><TD>                for (int i= 0; i &lt; affectedChildren.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">941</TD><TD>                        int kind= affectedChildren[i].getKind();</TD></TR><TR CLASS="z"><TD CLASS="l">942</TD><TD>                        if (kind == IJavaScriptElementDelta.ADDED || kind == IJavaScriptElementDelta.REMOVED) {</TD></TR><TR CLASS="z"><TD CLASS="l">943</TD><TD>                                count++;</TD></TR><TR><TD CLASS="l">944</TD><TD>                        }</TD></TR><TR><TD CLASS="l">945</TD><TD>                }</TD></TR><TR><TD CLASS="l">946</TD><TD> </TD></TR><TR CLASS="z"><TD CLASS="l">947</TD><TD>                if (count &gt; 1) {</TD></TR><TR><TD CLASS="l">948</TD><TD>                        // more than one child changed, refresh from here downwards</TD></TR><TR CLASS="z"><TD CLASS="l">949</TD><TD>                        if (element instanceof IPackageFragment) {</TD></TR><TR><TD CLASS="l">950</TD><TD>                                // a package fragment might become non empty refresh from the parent</TD></TR><TR CLASS="z"><TD CLASS="l">951</TD><TD>                                IJavaScriptElement parent= (IJavaScriptElement) internalGetParent(element);</TD></TR><TR><TD CLASS="l">952</TD><TD>                                // 1GE8SI6: ITPJUI:WIN98 - Rename is not shown in Packages View</TD></TR><TR><TD CLASS="l">953</TD><TD>                                // avoid posting a refresh to an invisible parent</TD></TR><TR CLASS="z"><TD CLASS="l">954</TD><TD>                                if (element.equals(fInput)) {</TD></TR><TR CLASS="z"><TD CLASS="l">955</TD><TD>                                        postRefresh(element, ORIGINAL, element, runnables);</TD></TR><TR><TD CLASS="l">956</TD><TD>                                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">957</TD><TD>                                        postRefresh(parent, PARENT, element, runnables);</TD></TR><TR><TD CLASS="l">958</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">959</TD><TD>                        } else if (element instanceof IPackageFragmentRoot) {</TD></TR><TR CLASS="z"><TD CLASS="l">960</TD><TD>                                Object toRefresh= internalGetParent(element);</TD></TR><TR CLASS="z"><TD CLASS="l">961</TD><TD>                                postRefresh(toRefresh, ORIGINAL, toRefresh, runnables);</TD></TR><TR><TD CLASS="l">962</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">963</TD><TD>                                postRefresh(element, ORIGINAL, element, runnables);</TD></TR><TR><TD CLASS="l">964</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">965</TD><TD>                        return;</TD></TR><TR><TD CLASS="l">966</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">967</TD><TD>                if (resourceDeltas != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">968</TD><TD>                        for (int i= 0; i &lt; resourceDeltas.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">969</TD><TD>                                if (processResourceDelta(resourceDeltas[i], element, runnables)) {</TD></TR><TR CLASS="z"><TD CLASS="l">970</TD><TD>                                        return; // early return, element got refreshed</TD></TR><TR><TD CLASS="l">971</TD><TD>                                }</TD></TR><TR><TD CLASS="l">972</TD><TD>                        }</TD></TR><TR><TD CLASS="l">973</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">974</TD><TD>                for (int i= 0; i &lt; affectedChildren.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">975</TD><TD>                        if (processDelta(affectedChildren[i], runnables)) {</TD></TR><TR CLASS="z"><TD CLASS="l">976</TD><TD>                                return; // early return, element got refreshed</TD></TR><TR><TD CLASS="l">977</TD><TD>                        }</TD></TR><TR><TD CLASS="l"><A NAME="27">978</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">979</TD><TD>        }</TD></TR><TR><TD CLASS="l">980</TD><TD>        </TD></TR><TR><TD CLASS="l">981</TD><TD>        protected void processAffectedChildren(IJavaScriptElementDelta[] affectedChildren, Collection runnables) throws JavaScriptModelException {</TD></TR><TR CLASS="z"><TD CLASS="l">982</TD><TD>                for (int i= 0; i &lt; affectedChildren.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">983</TD><TD>                        processDelta(affectedChildren[i], runnables);</TD></TR><TR><TD CLASS="l"><A NAME="1d">984</A></TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">985</TD><TD>        }</TD></TR><TR><TD CLASS="l">986</TD><TD> </TD></TR><TR><TD CLASS="l">987</TD><TD>        private boolean isOnClassPath(IJavaScriptUnit element) {</TD></TR><TR CLASS="z"><TD CLASS="l">988</TD><TD>                IJavaScriptProject project= element.getJavaScriptProject();</TD></TR><TR CLASS="z"><TD CLASS="l">989</TD><TD>                if (project == null || !project.exists())</TD></TR><TR CLASS="z"><TD CLASS="l">990</TD><TD>                        return false;</TD></TR><TR CLASS="z"><TD CLASS="l">991</TD><TD>                return project.isOnIncludepath(element);</TD></TR><TR><TD CLASS="l">992</TD><TD>        }</TD></TR><TR><TD CLASS="l">993</TD><TD> </TD></TR><TR><TD CLASS="l">994</TD><TD>        /**</TD></TR><TR><TD CLASS="l">995</TD><TD>         * Updates the selection. It finds newly added elements</TD></TR><TR><TD CLASS="l">996</TD><TD>         * and selects them.</TD></TR><TR><TD CLASS="l"><A NAME="2f">997</A></TD><TD>         * @param delta the delta to process</TD></TR><TR><TD CLASS="l">998</TD><TD>         * @param runnables the resulting view changes as runnables (type {@link Runnable})</TD></TR><TR><TD CLASS="l">999</TD><TD>         */</TD></TR><TR><TD CLASS="l"><A NAME="33">1000</A></TD><TD>        private void updateSelection(IJavaScriptElementDelta delta, Collection runnables) {</TD></TR><TR CLASS="z"><TD CLASS="l">1001</TD><TD>                final IJavaScriptElement addedElement= findAddedElement(delta);</TD></TR><TR CLASS="z"><TD CLASS="l">1002</TD><TD>                if (addedElement != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1003</TD><TD>                        final StructuredSelection selection= new StructuredSelection(addedElement);</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="35">1004</A></TD><TD>                        runnables.add(new Runnable() {</TD></TR><TR><TD CLASS="l">1005</TD><TD>                                public void run() {</TD></TR><TR><TD CLASS="l">1006</TD><TD>                                        // 19431</TD></TR><TR><TD CLASS="l">1007</TD><TD>                                        // if the item is already visible then select it</TD></TR><TR CLASS="z"><TD CLASS="l">1008</TD><TD>                                        if (fViewer.testFindItem(addedElement) != null)</TD></TR><TR CLASS="z"><TD CLASS="l">1009</TD><TD>                                                fViewer.setSelection(selection);</TD></TR><TR CLASS="z"><TD CLASS="l">1010</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1011</TD><TD>                        });        </TD></TR><TR><TD CLASS="l"><A NAME="7">1012</A></TD><TD>                }        </TD></TR><TR CLASS="z"><TD CLASS="l">1013</TD><TD>        }</TD></TR><TR><TD CLASS="l">1014</TD><TD> </TD></TR><TR><TD CLASS="l">1015</TD><TD>        private IJavaScriptElement findAddedElement(IJavaScriptElementDelta delta) {</TD></TR><TR CLASS="z"><TD CLASS="l">1016</TD><TD>                if (delta.getKind() == IJavaScriptElementDelta.ADDED)  </TD></TR><TR CLASS="z"><TD CLASS="l">1017</TD><TD>                        return delta.getElement();</TD></TR><TR><TD CLASS="l">1018</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">1019</TD><TD>                IJavaScriptElementDelta[] affectedChildren= delta.getAffectedChildren();</TD></TR><TR CLASS="z"><TD CLASS="l">1020</TD><TD>                for (int i= 0; i &lt; affectedChildren.length; i++) </TD></TR><TR CLASS="z"><TD CLASS="l">1021</TD><TD>                        return findAddedElement(affectedChildren[i]);</TD></TR><TR><TD CLASS="l">1022</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">1023</TD><TD>                return null;</TD></TR><TR><TD CLASS="l">1024</TD><TD>        }</TD></TR><TR><TD CLASS="l">1025</TD><TD> </TD></TR><TR><TD CLASS="l">1026</TD><TD>        /**</TD></TR><TR><TD CLASS="l">1027</TD><TD>         * Updates the package icon</TD></TR><TR><TD CLASS="l"><A NAME="26">1028</A></TD><TD>         * @param element the element to update</TD></TR><TR><TD CLASS="l">1029</TD><TD>         * @param runnables the resulting view changes as runnables (type {@link Runnable})</TD></TR><TR><TD CLASS="l">1030</TD><TD>         */</TD></TR><TR><TD CLASS="l"><A NAME="38">1031</A></TD><TD>         private void postUpdateIcon(final IJavaScriptElement element, Collection runnables) {</TD></TR><TR CLASS="z"><TD CLASS="l">1032</TD><TD>                 runnables.add(new Runnable() {</TD></TR><TR><TD CLASS="l">1033</TD><TD>                        public void run() {</TD></TR><TR><TD CLASS="l">1034</TD><TD>                                // 1GF87WR: ITPUI:ALL - SWTEx + NPE closing a workbench window.</TD></TR><TR CLASS="z"><TD CLASS="l">1035</TD><TD>                                fViewer.update(element, new String[]{IBasicPropertyConstants.P_IMAGE});</TD></TR><TR CLASS="z"><TD CLASS="l">1036</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1037</TD><TD>                });</TD></TR><TR CLASS="z"><TD CLASS="l">1038</TD><TD>         }</TD></TR><TR><TD CLASS="l">1039</TD><TD> </TD></TR><TR><TD CLASS="l">1040</TD><TD>        /**</TD></TR><TR><TD CLASS="l">1041</TD><TD>         * Process a resource delta.</TD></TR><TR><TD CLASS="l">1042</TD><TD>         * </TD></TR><TR><TD CLASS="l">1043</TD><TD>         * @param delta the delta to process</TD></TR><TR><TD CLASS="l">1044</TD><TD>         * @param parent the parent</TD></TR><TR><TD CLASS="l"><A NAME="29">1045</A></TD><TD>         * @param runnables the resulting view changes as runnables (type {@link Runnable})</TD></TR><TR><TD CLASS="l">1046</TD><TD>         * @return true if the parent got refreshed</TD></TR><TR><TD CLASS="l">1047</TD><TD>         */</TD></TR><TR><TD CLASS="l">1048</TD><TD>        private boolean processResourceDelta(IResourceDelta delta, Object parent, Collection runnables) {</TD></TR><TR CLASS="z"><TD CLASS="l">1049</TD><TD>                int status= delta.getKind();</TD></TR><TR CLASS="z"><TD CLASS="l">1050</TD><TD>                int flags= delta.getFlags();</TD></TR><TR><TD CLASS="l">1051</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">1052</TD><TD>                IResource resource= delta.getResource();</TD></TR><TR><TD CLASS="l">1053</TD><TD>                // filter out changes affecting the output folder</TD></TR><TR CLASS="z"><TD CLASS="l">1054</TD><TD>                if (resource == null)</TD></TR><TR CLASS="z"><TD CLASS="l">1055</TD><TD>                        return false;        </TD></TR><TR><TD CLASS="l">1056</TD><TD>                        </TD></TR><TR><TD CLASS="l">1057</TD><TD>                // this could be optimized by handling all the added children in the parent</TD></TR><TR CLASS="z"><TD CLASS="l">1058</TD><TD>                if ((status &amp; IResourceDelta.REMOVED) != 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1059</TD><TD>                        if (parent instanceof IPackageFragment) {</TD></TR><TR><TD CLASS="l">1060</TD><TD>                                // refresh one level above to deal with empty package filtering properly</TD></TR><TR CLASS="z"><TD CLASS="l">1061</TD><TD>                                postRefresh(internalGetParent(parent), PARENT, parent, runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">1062</TD><TD>                                return true;</TD></TR><TR><TD CLASS="l">1063</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1064</TD><TD>                                postRemove(resource, runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">1065</TD><TD>                                return false;</TD></TR><TR><TD CLASS="l">1066</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1067</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1068</TD><TD>                if ((status &amp; IResourceDelta.ADDED) != 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1069</TD><TD>                        if (parent instanceof IPackageFragment) {</TD></TR><TR><TD CLASS="l">1070</TD><TD>                                // refresh one level above to deal with empty package filtering properly</TD></TR><TR CLASS="z"><TD CLASS="l">1071</TD><TD>                                postRefresh(internalGetParent(parent), PARENT, parent, runnables);        </TD></TR><TR CLASS="z"><TD CLASS="l">1072</TD><TD>                                return true;</TD></TR><TR><TD CLASS="l">1073</TD><TD>                        } else</TD></TR><TR><TD CLASS="l">1074</TD><TD>                        {</TD></TR><TR CLASS="z"><TD CLASS="l">1075</TD><TD>                                postAdd(parent, resource, runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">1076</TD><TD>                                return false;</TD></TR><TR><TD CLASS="l">1077</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1078</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1079</TD><TD>                if ((status &amp; IResourceDelta.CHANGED) != 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1080</TD><TD>                        if ((flags &amp; IResourceDelta.TYPE) != 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1081</TD><TD>                                postRefresh(parent, PARENT, resource, runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">1082</TD><TD>                                return true;</TD></TR><TR><TD CLASS="l">1083</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1084</TD><TD>                }</TD></TR><TR><TD CLASS="l">1085</TD><TD>                // open/close state change of a project</TD></TR><TR CLASS="z"><TD CLASS="l">1086</TD><TD>                if ((flags &amp; IResourceDelta.OPEN) != 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1087</TD><TD>                        postProjectStateChanged(internalGetParent(parent), runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">1088</TD><TD>                        return true;                </TD></TR><TR><TD CLASS="l">1089</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1090</TD><TD>                IResourceDelta[] resourceDeltas= delta.getAffectedChildren();</TD></TR><TR><TD CLASS="l">1091</TD><TD>                 </TD></TR><TR CLASS="z"><TD CLASS="l">1092</TD><TD>                int count= 0;</TD></TR><TR CLASS="z"><TD CLASS="l">1093</TD><TD>                for (int i= 0; i &lt; resourceDeltas.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1094</TD><TD>                        int kind= resourceDeltas[i].getKind();</TD></TR><TR CLASS="z"><TD CLASS="l">1095</TD><TD>                        if (kind == IResourceDelta.ADDED || kind == IResourceDelta.REMOVED) {</TD></TR><TR CLASS="z"><TD CLASS="l">1096</TD><TD>                                count++;</TD></TR><TR CLASS="z"><TD CLASS="l">1097</TD><TD>                                if (count &gt; 1) {</TD></TR><TR CLASS="z"><TD CLASS="l">1098</TD><TD>                                        postRefresh(parent, PARENT, resource, runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">1099</TD><TD>                                        return true;</TD></TR><TR><TD CLASS="l">1100</TD><TD>                                }</TD></TR><TR><TD CLASS="l">1101</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1102</TD><TD>                }        </TD></TR><TR CLASS="z"><TD CLASS="l">1103</TD><TD>                for (int i= 0; i &lt; resourceDeltas.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1104</TD><TD>                        if (processResourceDelta(resourceDeltas[i], resource, runnables)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1105</TD><TD>                                return false; // early return, element got refreshed</TD></TR><TR><TD CLASS="l">1106</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1107</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="2d">1108</A></TD><TD>                return false;</TD></TR><TR><TD CLASS="l">1109</TD><TD>        }</TD></TR><TR><TD CLASS="l">1110</TD><TD>        </TD></TR><TR><TD CLASS="l">1111</TD><TD>        public void setIsFlatLayout(boolean state) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="2e">1112</A></TD><TD>                fIsFlatLayout= state;</TD></TR><TR CLASS="z"><TD CLASS="l">1113</TD><TD>        }</TD></TR><TR><TD CLASS="l">1114</TD><TD>        </TD></TR><TR><TD CLASS="l">1115</TD><TD>        public void setShowLibrariesNode(boolean state) {</TD></TR><TR CLASS="z"><TD CLASS="l">1116</TD><TD>                fShowLibrariesNode= state;</TD></TR><TR CLASS="z"><TD CLASS="l">1117</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="24">1118</A></TD><TD>        </TD></TR><TR><TD CLASS="l">1119</TD><TD>        private void postRefresh(Object root, int relation, Object affectedElement, Collection runnables) {</TD></TR><TR><TD CLASS="l">1120</TD><TD>                // JFace doesn't refresh when object isn't part of the viewer</TD></TR><TR><TD CLASS="l">1121</TD><TD>                // Therefore move the refresh start down to the viewer's input</TD></TR><TR CLASS="z"><TD CLASS="l">1122</TD><TD>                if (isParent(root, fInput)) </TD></TR><TR CLASS="z"><TD CLASS="l">1123</TD><TD>                        root= fInput;</TD></TR><TR CLASS="z"><TD CLASS="l">1124</TD><TD>                List toRefresh= new ArrayList(1);</TD></TR><TR CLASS="z"><TD CLASS="l">1125</TD><TD>                toRefresh.add(root);</TD></TR><TR CLASS="z"><TD CLASS="l">1126</TD><TD>                augmentElementToRefresh(toRefresh, relation, affectedElement);</TD></TR><TR CLASS="z"><TD CLASS="l">1127</TD><TD>                postRefresh(toRefresh, true, runnables);</TD></TR><TR CLASS="z"><TD CLASS="l">1128</TD><TD>        }</TD></TR><TR><TD CLASS="l">1129</TD><TD>        </TD></TR><TR><TD CLASS="l">1130</TD><TD>        /**</TD></TR><TR><TD CLASS="l">1131</TD><TD>         * Can be implemented by subclasses to add additional elements to refresh</TD></TR><TR><TD CLASS="l">1132</TD><TD>         * </TD></TR><TR><TD CLASS="l">1133</TD><TD>         * @param toRefresh the elements to refresh</TD></TR><TR><TD CLASS="l"><A NAME="3">1134</A></TD><TD>         * @param relation the relation to the affected element ({@link #GRANT_PARENT}, {@link #PARENT}, {@link #ORIGINAL}, {@link #PROJECT})</TD></TR><TR><TD CLASS="l">1135</TD><TD>         * @param affectedElement the affected element</TD></TR><TR><TD CLASS="l">1136</TD><TD>         */</TD></TR><TR><TD CLASS="l"><A NAME="1e">1137</A></TD><TD>        protected void augmentElementToRefresh(List toRefresh, int relation, Object affectedElement) {</TD></TR><TR CLASS="z"><TD CLASS="l">1138</TD><TD>        }</TD></TR><TR><TD CLASS="l">1139</TD><TD> </TD></TR><TR><TD CLASS="l">1140</TD><TD>        private boolean isParent(Object root, Object child) {</TD></TR><TR CLASS="z"><TD CLASS="l">1141</TD><TD>                Object parent= getParent(child);</TD></TR><TR CLASS="z"><TD CLASS="l">1142</TD><TD>                if (parent == null)</TD></TR><TR CLASS="z"><TD CLASS="l">1143</TD><TD>                        return false;</TD></TR><TR CLASS="z"><TD CLASS="l">1144</TD><TD>                if (parent.equals(root))</TD></TR><TR CLASS="z"><TD CLASS="l">1145</TD><TD>                        return true;</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="23">1146</A></TD><TD>                return isParent(root, parent);</TD></TR><TR><TD CLASS="l">1147</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="3b">1148</A></TD><TD> </TD></TR><TR><TD CLASS="l">1149</TD><TD>        protected void postRefresh(final List toRefresh, final boolean updateLabels, Collection runnables) {</TD></TR><TR CLASS="z"><TD CLASS="l">1150</TD><TD>                runnables.add(new Runnable() {</TD></TR><TR><TD CLASS="l">1151</TD><TD>                        public void run() {</TD></TR><TR CLASS="z"><TD CLASS="l">1152</TD><TD>                                for (Iterator iter= toRefresh.iterator(); iter.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">1153</TD><TD>                                        fViewer.refresh(iter.next(), updateLabels);</TD></TR><TR><TD CLASS="l">1154</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1155</TD><TD>                        }</TD></TR><TR><TD CLASS="l"><A NAME="20">1156</A></TD><TD>                });</TD></TR><TR CLASS="z"><TD CLASS="l">1157</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="3e">1158</A></TD><TD> </TD></TR><TR><TD CLASS="l">1159</TD><TD>        protected void postAdd(final Object parent, final Object element, Collection runnables) {</TD></TR><TR CLASS="z"><TD CLASS="l">1160</TD><TD>                runnables.add(new Runnable() {</TD></TR><TR><TD CLASS="l">1161</TD><TD>                        public void run() {</TD></TR><TR CLASS="z"><TD CLASS="l">1162</TD><TD>                                Widget[] items= fViewer.testFindItems(element);</TD></TR><TR CLASS="z"><TD CLASS="l">1163</TD><TD>                                for (int i= 0; i &lt; items.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">1164</TD><TD>                                        Widget item= items[i];</TD></TR><TR CLASS="z"><TD CLASS="l">1165</TD><TD>                                        if (item instanceof TreeItem &amp;&amp; !item.isDisposed()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1166</TD><TD>                                                TreeItem parentItem= ((TreeItem) item).getParentItem();</TD></TR><TR CLASS="z"><TD CLASS="l">1167</TD><TD>                                                if (parentItem != null &amp;&amp; !parentItem.isDisposed() &amp;&amp; parent.equals(parentItem.getData())) {</TD></TR><TR CLASS="z"><TD CLASS="l">1168</TD><TD>                                                        return; // no add, element already added (most likely by a refresh)</TD></TR><TR><TD CLASS="l">1169</TD><TD>                                                }</TD></TR><TR><TD CLASS="l">1170</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">1171</TD><TD>                                }</TD></TR><TR CLASS="z"><TD CLASS="l">1172</TD><TD>                                fViewer.add(parent, element);</TD></TR><TR CLASS="z"><TD CLASS="l">1173</TD><TD>                        }</TD></TR><TR><TD CLASS="l"><A NAME="25">1174</A></TD><TD>                });</TD></TR><TR CLASS="z"><TD CLASS="l">1175</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="41">1176</A></TD><TD> </TD></TR><TR><TD CLASS="l">1177</TD><TD>        protected void postRemove(final Object element, Collection runnables) {</TD></TR><TR CLASS="z"><TD CLASS="l">1178</TD><TD>                runnables.add(new Runnable() {</TD></TR><TR><TD CLASS="l">1179</TD><TD>                        public void run() {</TD></TR><TR CLASS="z"><TD CLASS="l">1180</TD><TD>                                fViewer.remove(element);</TD></TR><TR CLASS="z"><TD CLASS="l">1181</TD><TD>                        }</TD></TR><TR><TD CLASS="l"><A NAME="22">1182</A></TD><TD>                });</TD></TR><TR CLASS="z"><TD CLASS="l">1183</TD><TD>        }</TD></TR><TR><TD CLASS="l"><A NAME="44">1184</A></TD><TD> </TD></TR><TR><TD CLASS="l">1185</TD><TD>        protected void postProjectStateChanged(final Object root, Collection runnables) {</TD></TR><TR CLASS="z"><TD CLASS="l">1186</TD><TD>                runnables.add(new Runnable() {</TD></TR><TR><TD CLASS="l">1187</TD><TD>                        public void run() {</TD></TR><TR CLASS="z"><TD CLASS="l">1188</TD><TD>                                fViewer.refresh(root, true);</TD></TR><TR><TD CLASS="l">1189</TD><TD>                                // trigger a synthetic selection change so that action refresh their</TD></TR><TR><TD CLASS="l">1190</TD><TD>                                // enable state.</TD></TR><TR CLASS="z"><TD CLASS="l">1191</TD><TD>                                fViewer.setSelection(fViewer.getSelection());</TD></TR><TR CLASS="z"><TD CLASS="l">1192</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1193</TD><TD>                });</TD></TR><TR CLASS="z"><TD CLASS="l">1194</TD><TD>        }</TD></TR><TR><TD CLASS="l">1195</TD><TD>        </TD></TR><TR><TD CLASS="l">1196</TD><TD>        </TD></TR><TR><TD CLASS="l"><A NAME="2a">1197</A></TD><TD>        /*</TD></TR><TR><TD CLASS="l">1198</TD><TD>         * @see org.eclipse.jface.util.IPropertyChangeListener#propertyChange(org.eclipse.jface.util.PropertyChangeEvent)</TD></TR><TR><TD CLASS="l">1199</TD><TD>         */</TD></TR><TR><TD CLASS="l">1200</TD><TD>        public void propertyChange(PropertyChangeEvent event) {</TD></TR><TR CLASS="z"><TD CLASS="l">1201</TD><TD>                if (arePackagesFoldedInHierarchicalLayout() != fFoldPackages){</TD></TR><TR CLASS="z"><TD CLASS="l">1202</TD><TD>                        fFoldPackages= arePackagesFoldedInHierarchicalLayout();</TD></TR><TR CLASS="z"><TD CLASS="l">1203</TD><TD>                        if (fViewer != null &amp;&amp; !fViewer.getControl().isDisposed()) {</TD></TR><TR CLASS="z"><TD CLASS="l">1204</TD><TD>                                fViewer.getControl().setRedraw(false);</TD></TR><TR CLASS="z"><TD CLASS="l">1205</TD><TD>                                Object[] expandedObjects= fViewer.getExpandedElements();</TD></TR><TR CLASS="z"><TD CLASS="l">1206</TD><TD>                                fViewer.refresh();        </TD></TR><TR CLASS="z"><TD CLASS="l">1207</TD><TD>                                fViewer.setExpandedElements(expandedObjects);</TD></TR><TR CLASS="z"><TD CLASS="l">1208</TD><TD>                                fViewer.getControl().setRedraw(true);</TD></TR><TR><TD CLASS="l">1209</TD><TD>                        }</TD></TR><TR><TD CLASS="l">1210</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1211</TD><TD>        }</TD></TR><TR><TD CLASS="l">1212</TD><TD>}</TD></TR></TABLE><P></P><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TD CLASS="nv">[<A HREF="../xslUnitTestCoverage.html">all classes</A>][<A HREF="167.html">org.eclipse.wst.jsdt.internal.ui.packageview</A>]</TD></TR><TR><TD CLASS="tl"><A HREF="http://www.eclemma.org/support.html">EMMA 2.0.5312 EclEmma Fix 1</A> (C) Vladimir Roubtsov</TD></TR></TABLE></BODY></HTML>