<HTML><HEAD><META CONTENT="text/html; charset=UTF-8" HTTP-EQUIV="Content-Type"/><TITLE>EMMA Coverage Report</TITLE><STYLE TYPE="text/css"> TABLE,TD,TH {border-style:solid; border-color:black;} TD,TH {background:white;margin:0;line-height:100%;padding-left:0.5em;padding-right:0.5em;} TD {border-width:0 1px 0 0;} TH {border-width:1px 1px 1px 0;} TR TD.h {color:red;} TABLE {border-spacing:0; border-collapse:collapse;border-width:0 0 1px 1px;} P,H1,H2,H3,TH {font-family:verdana,arial,sans-serif;font-size:10pt;} TD {font-family:courier,monospace;font-size:10pt;} TABLE.hdft {border-spacing:0;border-collapse:collapse;border-style:none;} TABLE.hdft TH,TABLE.hdft TD {border-style:none;line-height:normal;} TABLE.hdft TH.tl,TABLE.hdft TD.tl {background:#6699CC;color:white;} TABLE.hdft TD.nv {background:#6633DD;color:white;} .nv A:link {color:white;} .nv A:visited {color:white;} .nv A:active {color:yellow;} TABLE.hdft A:link {color:white;} TABLE.hdft A:visited {color:white;} TABLE.hdft A:active {color:yellow;} .in {color:#356085;} TABLE.s TD {padding-left:0.25em;padding-right:0.25em;} TABLE.s TD.l {padding-left:0.25em;padding-right:0.25em;text-align:right;background:#F0F0F0;} TABLE.s TR.z TD {background:#FF9999;} TABLE.s TR.p TD {background:#FFFF88;} TABLE.s TR.c TD {background:#CCFFCC;} A:link {color:#0000EE;text-decoration:none;} A:visited {color:#0000EE;text-decoration:none;} A:hover {color:#0000EE;text-decoration:underline;} TABLE.cn {border-width:0 0 1px 0;} TABLE.s {border-width:1px 0 1px 1px;} TD.h {color:red;border-width:0 1px 0 0;} TD.f {border-width:0 1px 0 1px;} TD.hf {color:red;border-width:0 1px 0 1px;} TH.f {border-width:1px 1px 1px 1px;} TR.cis TD {background:#F0F0F0;} TR.cis TD {border-width:1px 1px 1px 0;} TR.cis TD.h {color:red;border-width:1px 1px 1px 0;} TR.cis TD.f {border-width:1px 1px 1px 1px;} TR.cis TD.hf {color:red;border-width:1px 1px 1px 1px;} TD.b {border-style:none;background:transparent;line-height:50%;}  TD.bt {border-width:1px 0 0 0;background:transparent;line-height:50%;} TR.o TD {background:#F0F0F0;}TABLE.it {border-style:none;}TABLE.it TD,TABLE.it TH {border-style:none;}</STYLE></HEAD><BODY><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="tl"><A HREF="http://www.eclemma.org/">EMMA</A> Coverage Report (generated Tue Jun 09 19:59:05 GMT 2009)</TH></TR><TR><TD CLASS="nv">[<A HREF="../xslUnitTestCoverage.html">all classes</A>][<A HREF="14b.html">org.eclipse.wst.jsdt.internal.corext.refactoring.typeconstraints</A>]</TD></TR></TABLE><H2>COVERAGE SUMMARY FOR SOURCE FILE [<SPAN CLASS="in">FullConstraintCreator.java</SPAN>]</H2><TABLE CELLSPACING="0" WIDTH="100%"><TR><TH>name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD>FullConstraintCreator.java</TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/46)</TD><TD CLASS="h">0%   (0/1806)</TD><TD CLASS="h">0%   (0/370)</TD></TR></TABLE><H3>COVERAGE BREAKDOWN BY CLASS AND METHOD</H3><TABLE CLASS="cn" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="f">name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#0">FullConstraintCreator</A></TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/46)</TD><TD CLASS="h">0%   (0/1806)</TD><TD CLASS="h">0%   (0/370)</TD></TR><TR><TD CLASS="f"><A HREF="#0">FullConstraintCreator (): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2">FullConstraintCreator (IConstraintVariableFactory, ITypeConstraintFactory): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/21)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR><TD CLASS="f"><A HREF="#3">containsASuperType (ITypeBinding, Set): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/23)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#4">create (ArrayInitializer): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/58)</TD><TD CLASS="h">0%   (0/13)</TD></TR><TR><TD CLASS="f"><A HREF="#5">create (Assignment): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/18)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#6">create (CastExpression): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/79)</TD><TD CLASS="h">0%   (0/16)</TD></TR><TR><TD CLASS="f"><A HREF="#7">create (CatchClause): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/56)</TD><TD CLASS="h">0%   (0/13)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#8">create (ClassInstanceCreation): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/52)</TD><TD CLASS="h">0%   (0/9)</TD></TR><TR><TD CLASS="f"><A HREF="#9">create (ConditionalExpression): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/71)</TD><TD CLASS="h">0%   (0/13)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#a">create (ConstructorInvocation): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/27)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR><TD CLASS="f"><A HREF="#b">create (FieldAccess): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/24)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#c">create (FieldDeclaration): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/33)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR><TD CLASS="f"><A HREF="#d">create (FunctionDeclaration): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/119)</TD><TD CLASS="h">0%   (0/25)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#e">create (FunctionInvocation): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/156)</TD><TD CLASS="h">0%   (0/27)</TD></TR><TR><TD CLASS="f"><A HREF="#f">create (InstanceofExpression): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/34)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#10">create (ParenthesizedExpression): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/23)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR><TD CLASS="f"><A HREF="#11">create (QualifiedName): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/27)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#12">create (ReturnStatement): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/23)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR><TD CLASS="f"><A HREF="#13">create (SingleVariableDeclaration): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/76)</TD><TD CLASS="h">0%   (0/18)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#14">create (SuperConstructorInvocation): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/27)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR><TD CLASS="f"><A HREF="#15">create (SuperFieldAccess): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/21)</TD><TD CLASS="h">0%   (0/6)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#16">create (SuperMethodInvocation): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/37)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR><TD CLASS="f"><A HREF="#17">create (ThisExpression): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/19)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#18">create (VariableDeclarationExpression): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#19">create (VariableDeclarationFragment): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/24)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1a">create (VariableDeclarationStatement): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/7)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#1b">createConstraintsForAccessToField (IVariableBinding, Expression, Expression):...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/62)</TD><TD CLASS="h">0%   (0/14)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1c">createOrOrSubtypeConstraint (ConstraintVariable, ConstraintVariable): ITypeCo...</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/44)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR><TD CLASS="f"><A HREF="#1d">findField (IVariableBinding, ITypeBinding): IVariableBinding</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/12)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1e">findMethod (IFunctionBinding, ITypeBinding): IFunctionBinding</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/11)</TD><TD CLASS="h">0%   (0/3)</TD></TR><TR><TD CLASS="f"><A HREF="#1f">getArgumentConstraints (List, IFunctionBinding): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/52)</TD><TD CLASS="h">0%   (0/8)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#20">getConstraintFactory (): ITypeConstraintFactory</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR><TD CLASS="f"><A HREF="#21">getConstraintVariableFactory (): IConstraintVariableFactory</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#22">getConstraintsForFieldDeclaringTypes (FieldDeclaration): Collection</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/44)</TD><TD CLASS="h">0%   (0/9)</TD></TR><TR><TD CLASS="f"><A HREF="#23">getConstraintsForHiding (FieldDeclaration): Collection</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/22)</TD><TD CLASS="h">0%   (0/4)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#24">getConstraintsForHiding (VariableDeclarationFragment): Collection</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/54)</TD><TD CLASS="h">0%   (0/12)</TD></TR><TR><TD CLASS="f"><A HREF="#25">getConstraintsForOverriding (IFunctionBinding): Collection</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/107)</TD><TD CLASS="h">0%   (0/22)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#26">getConstraintsFromFragmentList (List, Type): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/89)</TD><TD CLASS="h">0%   (0/15)</TD></TR><TR><TD CLASS="f"><A HREF="#27">getContext (): IContext</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/3)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#28">getDeclaringSuperTypes (IFunctionBinding): Set</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/46)</TD><TD CLASS="h">0%   (0/11)</TD></TR><TR><TD CLASS="f"><A HREF="#29">getDeclaringSuperTypes (IVariableBinding): Set</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/30)</TD><TD CLASS="h">0%   (0/7)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2a">getReturnTypeConstraint (Expression, IFunctionBinding): ITypeConstraint []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/30)</TD><TD CLASS="h">0%   (0/5)</TD></TR><TR><TD CLASS="f"><A HREF="#2b">getRootDefs (IFunctionBinding): IFunctionBinding []</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/42)</TD><TD CLASS="h">0%   (0/9)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2c">getTypeParent (ArrayInitializer): Type</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/68)</TD><TD CLASS="h">0%   (0/17)</TD></TR><TR><TD CLASS="f"><A HREF="#2d">isClassBinding (ITypeBinding): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/9)</TD><TD CLASS="h">0%   (0/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2e">setContext (IContext): void</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/4)</TD><TD CLASS="h">0%   (0/2)</TD></TR></TABLE><P></P><TABLE CLASS="s" CELLSPACING="0" WIDTH="100%"><TR><TD CLASS="l">1</TD><TD>/*******************************************************************************</TD></TR><TR><TD CLASS="l">2</TD><TD> * Copyright (c) 2000, 2008 IBM Corporation and others.</TD></TR><TR><TD CLASS="l">3</TD><TD> * All rights reserved. This program and the accompanying materials</TD></TR><TR><TD CLASS="l">4</TD><TD> * are made available under the terms of the Eclipse Public License v1.0</TD></TR><TR><TD CLASS="l">5</TD><TD> * which accompanies this distribution, and is available at</TD></TR><TR><TD CLASS="l">6</TD><TD> * http://www.eclipse.org/legal/epl-v10.html</TD></TR><TR><TD CLASS="l">7</TD><TD> *</TD></TR><TR><TD CLASS="l">8</TD><TD> * Contributors:</TD></TR><TR><TD CLASS="l">9</TD><TD> *     IBM Corporation - initial API and implementation</TD></TR><TR><TD CLASS="l">10</TD><TD> *******************************************************************************/</TD></TR><TR><TD CLASS="l">11</TD><TD>package org.eclipse.wst.jsdt.internal.corext.refactoring.typeconstraints;</TD></TR><TR><TD CLASS="l">12</TD><TD> </TD></TR><TR><TD CLASS="l">13</TD><TD>import java.util.ArrayList;</TD></TR><TR><TD CLASS="l">14</TD><TD>import java.util.Arrays;</TD></TR><TR><TD CLASS="l">15</TD><TD>import java.util.Collection;</TD></TR><TR><TD CLASS="l">16</TD><TD>import java.util.HashSet;</TD></TR><TR><TD CLASS="l">17</TD><TD>import java.util.Iterator;</TD></TR><TR><TD CLASS="l">18</TD><TD>import java.util.LinkedHashSet;</TD></TR><TR><TD CLASS="l">19</TD><TD>import java.util.List;</TD></TR><TR><TD CLASS="l">20</TD><TD>import java.util.Set;</TD></TR><TR><TD CLASS="l">21</TD><TD> </TD></TR><TR><TD CLASS="l">22</TD><TD>import org.eclipse.core.runtime.Assert;</TD></TR><TR><TD CLASS="l">23</TD><TD>import org.eclipse.wst.jsdt.core.dom.ArrayCreation;</TD></TR><TR><TD CLASS="l">24</TD><TD>import org.eclipse.wst.jsdt.core.dom.ArrayInitializer;</TD></TR><TR><TD CLASS="l">25</TD><TD>import org.eclipse.wst.jsdt.core.dom.Assignment;</TD></TR><TR><TD CLASS="l">26</TD><TD>import org.eclipse.wst.jsdt.core.dom.CastExpression;</TD></TR><TR><TD CLASS="l">27</TD><TD>import org.eclipse.wst.jsdt.core.dom.CatchClause;</TD></TR><TR><TD CLASS="l">28</TD><TD>import org.eclipse.wst.jsdt.core.dom.ClassInstanceCreation;</TD></TR><TR><TD CLASS="l">29</TD><TD>import org.eclipse.wst.jsdt.core.dom.ConditionalExpression;</TD></TR><TR><TD CLASS="l">30</TD><TD>import org.eclipse.wst.jsdt.core.dom.ConstructorInvocation;</TD></TR><TR><TD CLASS="l">31</TD><TD>import org.eclipse.wst.jsdt.core.dom.Expression;</TD></TR><TR><TD CLASS="l">32</TD><TD>import org.eclipse.wst.jsdt.core.dom.FieldAccess;</TD></TR><TR><TD CLASS="l">33</TD><TD>import org.eclipse.wst.jsdt.core.dom.FieldDeclaration;</TD></TR><TR><TD CLASS="l">34</TD><TD>import org.eclipse.wst.jsdt.core.dom.IBinding;</TD></TR><TR><TD CLASS="l">35</TD><TD>import org.eclipse.wst.jsdt.core.dom.IFunctionBinding;</TD></TR><TR><TD CLASS="l">36</TD><TD>import org.eclipse.wst.jsdt.core.dom.ITypeBinding;</TD></TR><TR><TD CLASS="l">37</TD><TD>import org.eclipse.wst.jsdt.core.dom.IVariableBinding;</TD></TR><TR><TD CLASS="l">38</TD><TD>import org.eclipse.wst.jsdt.core.dom.InstanceofExpression;</TD></TR><TR><TD CLASS="l">39</TD><TD>import org.eclipse.wst.jsdt.core.dom.FunctionDeclaration;</TD></TR><TR><TD CLASS="l">40</TD><TD>import org.eclipse.wst.jsdt.core.dom.FunctionInvocation;</TD></TR><TR><TD CLASS="l">41</TD><TD>import org.eclipse.wst.jsdt.core.dom.Name;</TD></TR><TR><TD CLASS="l">42</TD><TD>import org.eclipse.wst.jsdt.core.dom.ParenthesizedExpression;</TD></TR><TR><TD CLASS="l">43</TD><TD>import org.eclipse.wst.jsdt.core.dom.QualifiedName;</TD></TR><TR><TD CLASS="l">44</TD><TD>import org.eclipse.wst.jsdt.core.dom.ReturnStatement;</TD></TR><TR><TD CLASS="l">45</TD><TD>import org.eclipse.wst.jsdt.core.dom.SimpleName;</TD></TR><TR><TD CLASS="l">46</TD><TD>import org.eclipse.wst.jsdt.core.dom.SingleVariableDeclaration;</TD></TR><TR><TD CLASS="l">47</TD><TD>import org.eclipse.wst.jsdt.core.dom.SuperConstructorInvocation;</TD></TR><TR><TD CLASS="l">48</TD><TD>import org.eclipse.wst.jsdt.core.dom.SuperFieldAccess;</TD></TR><TR><TD CLASS="l">49</TD><TD>import org.eclipse.wst.jsdt.core.dom.SuperMethodInvocation;</TD></TR><TR><TD CLASS="l">50</TD><TD>import org.eclipse.wst.jsdt.core.dom.ThisExpression;</TD></TR><TR><TD CLASS="l">51</TD><TD>import org.eclipse.wst.jsdt.core.dom.Type;</TD></TR><TR><TD CLASS="l">52</TD><TD>import org.eclipse.wst.jsdt.core.dom.VariableDeclaration;</TD></TR><TR><TD CLASS="l">53</TD><TD>import org.eclipse.wst.jsdt.core.dom.VariableDeclarationExpression;</TD></TR><TR><TD CLASS="l">54</TD><TD>import org.eclipse.wst.jsdt.core.dom.VariableDeclarationFragment;</TD></TR><TR><TD CLASS="l">55</TD><TD>import org.eclipse.wst.jsdt.core.dom.VariableDeclarationStatement;</TD></TR><TR><TD CLASS="l">56</TD><TD>import org.eclipse.wst.jsdt.internal.corext.dom.ASTNodes;</TD></TR><TR><TD CLASS="l">57</TD><TD>import org.eclipse.wst.jsdt.internal.corext.dom.Bindings;</TD></TR><TR><TD CLASS="l">58</TD><TD>import org.eclipse.wst.jsdt.internal.corext.refactoring.rename.MethodChecks;</TD></TR><TR><TD CLASS="l">59</TD><TD> </TD></TR><TR><TD CLASS="l">60</TD><TD>/**</TD></TR><TR><TD CLASS="l">61</TD><TD> * Default implementation of the creator. Creates all or nearly all constraints for program constructs.</TD></TR><TR><TD CLASS="l">62</TD><TD> * Subclasses can provide additional checks to avoid creating constraints that are not useful for their purposes.</TD></TR><TR><TD CLASS="l">63</TD><TD> */</TD></TR><TR><TD CLASS="l">64</TD><TD>public class FullConstraintCreator extends ConstraintCreator{</TD></TR><TR><TD CLASS="l">65</TD><TD> </TD></TR><TR><TD CLASS="l">66</TD><TD>        private final IConstraintVariableFactory fConstraintVariableFactory;</TD></TR><TR><TD CLASS="l"><A NAME="0">67</A></TD><TD>        private final ITypeConstraintFactory fTypeConstraintFactory;</TD></TR><TR><TD CLASS="l">68</TD><TD>        private IContext fContext;</TD></TR><TR><TD CLASS="l">69</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="2">70</A></TD><TD>        public FullConstraintCreator(){</TD></TR><TR CLASS="z"><TD CLASS="l">71</TD><TD>                this(new ConstraintVariableFactory(), new TypeConstraintFactory());</TD></TR><TR CLASS="z"><TD CLASS="l">72</TD><TD>        }</TD></TR><TR><TD CLASS="l">73</TD><TD>        </TD></TR><TR CLASS="z"><TD CLASS="l">74</TD><TD>        public FullConstraintCreator(IConstraintVariableFactory cFactory,</TD></TR><TR><TD CLASS="l">75</TD><TD>                                                                 ITypeConstraintFactory tFactory) {</TD></TR><TR CLASS="z"><TD CLASS="l">76</TD><TD>                Assert.isTrue(cFactory != null);</TD></TR><TR CLASS="z"><TD CLASS="l">77</TD><TD>                fConstraintVariableFactory= cFactory;</TD></TR><TR CLASS="z"><TD CLASS="l">78</TD><TD>                fTypeConstraintFactory= tFactory;</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="27">79</A></TD><TD>                fContext= new NullContext();</TD></TR><TR CLASS="z"><TD CLASS="l">80</TD><TD>        }</TD></TR><TR><TD CLASS="l">81</TD><TD> </TD></TR><TR><TD CLASS="l">82</TD><TD>        public IContext getContext() {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="2e">83</A></TD><TD>                return fContext;</TD></TR><TR><TD CLASS="l">84</TD><TD>        }</TD></TR><TR><TD CLASS="l">85</TD><TD>        </TD></TR><TR><TD CLASS="l">86</TD><TD>        public void setContext(IContext context) {</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="20">87</A></TD><TD>                fContext= context;</TD></TR><TR CLASS="z"><TD CLASS="l">88</TD><TD>        }</TD></TR><TR><TD CLASS="l">89</TD><TD>        </TD></TR><TR><TD CLASS="l">90</TD><TD>        public ITypeConstraintFactory getConstraintFactory(){</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="21">91</A></TD><TD>                return fTypeConstraintFactory;</TD></TR><TR><TD CLASS="l">92</TD><TD>        }</TD></TR><TR><TD CLASS="l">93</TD><TD>        </TD></TR><TR><TD CLASS="l">94</TD><TD>        public IConstraintVariableFactory getConstraintVariableFactory(){</TD></TR><TR CLASS="z"><TD CLASS="l">95</TD><TD>                return fConstraintVariableFactory;</TD></TR><TR><TD CLASS="l">96</TD><TD>        }</TD></TR><TR><TD CLASS="l">97</TD><TD>        </TD></TR><TR><TD CLASS="l"><A NAME="4">98</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">99</TD><TD>         * @see org.eclipse.wst.jsdt.core.dom.ASTVisitor#visit(org.eclipse.wst.jsdt.core.dom.ArrayInitializer)</TD></TR><TR><TD CLASS="l">100</TD><TD>         */</TD></TR><TR><TD CLASS="l">101</TD><TD>        public ITypeConstraint[] create(ArrayInitializer arrayInitializer){</TD></TR><TR CLASS="z"><TD CLASS="l">102</TD><TD>                ITypeBinding arrayBinding= arrayInitializer.resolveTypeBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">103</TD><TD>                Assert.isTrue(arrayBinding.isArray());</TD></TR><TR CLASS="z"><TD CLASS="l">104</TD><TD>                List expressions= arrayInitializer.expressions();</TD></TR><TR CLASS="z"><TD CLASS="l">105</TD><TD>                List/*&lt;ITypeConstraint&gt;*/ constraints= new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">106</TD><TD>                Type type= getTypeParent(arrayInitializer);</TD></TR><TR CLASS="z"><TD CLASS="l">107</TD><TD>                ConstraintVariable typeVariable= fConstraintVariableFactory.makeTypeVariable(type);</TD></TR><TR CLASS="z"><TD CLASS="l">108</TD><TD>                for (int i= 0; i &lt; expressions.size(); i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">109</TD><TD>                        Expression each= (Expression) expressions.get(i);</TD></TR><TR CLASS="z"><TD CLASS="l">110</TD><TD>                        ITypeConstraint[] c= fTypeConstraintFactory.createSubtypeConstraint(</TD></TR><TR CLASS="z"><TD CLASS="l">111</TD><TD>                                        fConstraintVariableFactory.makeExpressionOrTypeVariable(each, getContext()),</TD></TR><TR CLASS="z"><TD CLASS="l">112</TD><TD>                                        typeVariable);</TD></TR><TR CLASS="z"><TD CLASS="l">113</TD><TD>                        constraints.addAll(Arrays.asList(c));</TD></TR><TR><TD CLASS="l">114</TD><TD>                }                </TD></TR><TR CLASS="z"><TD CLASS="l">115</TD><TD>                return (ITypeConstraint[])constraints.toArray(new ITypeConstraint[constraints.size()]);</TD></TR><TR><TD CLASS="l">116</TD><TD>        }</TD></TR><TR><TD CLASS="l">117</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="5">118</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">119</TD><TD>         * @see org.eclipse.wst.jsdt.core.dom.ASTVisitor#visit(org.eclipse.wst.jsdt.core.dom.Assignment)</TD></TR><TR><TD CLASS="l">120</TD><TD>         */</TD></TR><TR><TD CLASS="l">121</TD><TD>        public ITypeConstraint[] create(Assignment assignment){</TD></TR><TR CLASS="z"><TD CLASS="l">122</TD><TD>                return fTypeConstraintFactory.createSubtypeConstraint(</TD></TR><TR CLASS="z"><TD CLASS="l">123</TD><TD>                                fConstraintVariableFactory.makeExpressionOrTypeVariable(assignment.getRightHandSide(), getContext()), </TD></TR><TR CLASS="z"><TD CLASS="l">124</TD><TD>                                fConstraintVariableFactory.makeExpressionOrTypeVariable(assignment.getLeftHandSide(), getContext()));</TD></TR><TR><TD CLASS="l">125</TD><TD>        }</TD></TR><TR><TD CLASS="l">126</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="6">127</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">128</TD><TD>         * @see org.eclipse.wst.jsdt.core.dom.ASTVisitor#visit(org.eclipse.wst.jsdt.core.dom.CastExpression)</TD></TR><TR><TD CLASS="l">129</TD><TD>         */</TD></TR><TR><TD CLASS="l">130</TD><TD>        public ITypeConstraint[] create(CastExpression castExpression){</TD></TR><TR CLASS="z"><TD CLASS="l">131</TD><TD>                Expression expression= castExpression.getExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">132</TD><TD>                Type type= castExpression.getType();</TD></TR><TR CLASS="z"><TD CLASS="l">133</TD><TD>                ITypeConstraint[] definesConstraint= fTypeConstraintFactory.createDefinesConstraint(fConstraintVariableFactory.makeExpressionOrTypeVariable(castExpression, getContext()), </TD></TR><TR CLASS="z"><TD CLASS="l">134</TD><TD>                                                                                                        fConstraintVariableFactory.makeTypeVariable(castExpression.getType()));</TD></TR><TR CLASS="z"><TD CLASS="l">135</TD><TD>                if (isClassBinding(expression.resolveTypeBinding()) &amp;&amp; isClassBinding(type.resolveBinding())){</TD></TR><TR CLASS="z"><TD CLASS="l">136</TD><TD>                        ConstraintVariable expressionVariable= fConstraintVariableFactory.makeExpressionOrTypeVariable(expression, getContext());</TD></TR><TR CLASS="z"><TD CLASS="l">137</TD><TD>                        ConstraintVariable castExpressionVariable= fConstraintVariableFactory.makeExpressionOrTypeVariable(castExpression, getContext());</TD></TR><TR CLASS="z"><TD CLASS="l">138</TD><TD>                        ITypeConstraint[] c2 = createOrOrSubtypeConstraint(expressionVariable, castExpressionVariable);</TD></TR><TR CLASS="z"><TD CLASS="l">139</TD><TD>                        if (definesConstraint.length == 0){</TD></TR><TR CLASS="z"><TD CLASS="l">140</TD><TD>                                return c2;</TD></TR><TR><TD CLASS="l">141</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">142</TD><TD>                                ITypeConstraint c1 = definesConstraint[0];</TD></TR><TR CLASS="z"><TD CLASS="l">143</TD><TD>                                Collection/*&lt;ITypeConstraint&gt;*/ constraints= new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">144</TD><TD>                                constraints.add(c1);</TD></TR><TR CLASS="z"><TD CLASS="l">145</TD><TD>                                constraints.addAll(Arrays.asList(c2));</TD></TR><TR CLASS="z"><TD CLASS="l">146</TD><TD>                                return (ITypeConstraint[])constraints.toArray(new ITypeConstraint[constraints.size()]);</TD></TR><TR><TD CLASS="l">147</TD><TD>                        }</TD></TR><TR><TD CLASS="l">148</TD><TD>                } else </TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="7">149</A></TD><TD>                        return definesConstraint;</TD></TR><TR><TD CLASS="l">150</TD><TD>        }</TD></TR><TR><TD CLASS="l">151</TD><TD>        </TD></TR><TR><TD CLASS="l">152</TD><TD>        public ITypeConstraint[] create(CatchClause node) {</TD></TR><TR CLASS="z"><TD CLASS="l">153</TD><TD>                SingleVariableDeclaration exception= node.getException();</TD></TR><TR CLASS="z"><TD CLASS="l">154</TD><TD>                ConstraintVariable nameVariable= fConstraintVariableFactory.makeExpressionOrTypeVariable(exception.getName(), getContext());</TD></TR><TR><TD CLASS="l">155</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">156</TD><TD>                ITypeConstraint[] defines= fTypeConstraintFactory.createDefinesConstraint(</TD></TR><TR CLASS="z"><TD CLASS="l">157</TD><TD>                                nameVariable,</TD></TR><TR CLASS="z"><TD CLASS="l">158</TD><TD>                                fConstraintVariableFactory.makeTypeVariable(exception.getType()));</TD></TR><TR><TD CLASS="l">159</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">160</TD><TD>                ITypeBinding throwable= node.getAST().resolveWellKnownType(&#34;java.lang.Throwable&#34;); //$NON-NLS-1$</TD></TR><TR CLASS="z"><TD CLASS="l">161</TD><TD>                ITypeConstraint[] catchBound= fTypeConstraintFactory.createSubtypeConstraint(</TD></TR><TR CLASS="z"><TD CLASS="l">162</TD><TD>                                nameVariable,</TD></TR><TR CLASS="z"><TD CLASS="l">163</TD><TD>                                fConstraintVariableFactory.makeRawBindingVariable(throwable));</TD></TR><TR><TD CLASS="l">164</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">165</TD><TD>                ArrayList result= new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">166</TD><TD>                result.addAll(Arrays.asList(defines));</TD></TR><TR CLASS="z"><TD CLASS="l">167</TD><TD>                result.addAll(Arrays.asList(catchBound));</TD></TR><TR CLASS="z"><TD CLASS="l">168</TD><TD>                return (ITypeConstraint[]) result.toArray(new ITypeConstraint[result.size()]);                </TD></TR><TR><TD CLASS="l">169</TD><TD>        }</TD></TR><TR><TD CLASS="l">170</TD><TD> </TD></TR><TR><TD CLASS="l">171</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="8">172</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">173</TD><TD>         * @see org.eclipse.wst.jsdt.core.dom.ASTVisitor#visit(org.eclipse.wst.jsdt.core.dom.ClassInstanceCreation)</TD></TR><TR><TD CLASS="l">174</TD><TD>         */</TD></TR><TR><TD CLASS="l">175</TD><TD>        public ITypeConstraint[] create(ClassInstanceCreation instanceCreation){</TD></TR><TR CLASS="z"><TD CLASS="l">176</TD><TD>                List arguments= instanceCreation.arguments();</TD></TR><TR CLASS="z"><TD CLASS="l">177</TD><TD>                List result= new ArrayList(arguments.size());</TD></TR><TR CLASS="z"><TD CLASS="l">178</TD><TD>                IFunctionBinding methodBinding= instanceCreation.resolveConstructorBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">179</TD><TD>                result.addAll(Arrays.asList(getArgumentConstraints(arguments, methodBinding)));</TD></TR><TR CLASS="z"><TD CLASS="l">180</TD><TD>                if (instanceCreation.getAnonymousClassDeclaration() == null){</TD></TR><TR CLASS="z"><TD CLASS="l">181</TD><TD>                        ConstraintVariable constructorVar= fConstraintVariableFactory.makeExpressionOrTypeVariable(instanceCreation, getContext());</TD></TR><TR CLASS="z"><TD CLASS="l">182</TD><TD>                        ConstraintVariable typeVar= fConstraintVariableFactory.makeRawBindingVariable(instanceCreation.resolveTypeBinding());</TD></TR><TR CLASS="z"><TD CLASS="l">183</TD><TD>                        result.addAll(Arrays.asList(fTypeConstraintFactory.createDefinesConstraint(constructorVar, typeVar)));</TD></TR><TR><TD CLASS="l">184</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">185</TD><TD>                return (ITypeConstraint[]) result.toArray(new ITypeConstraint[result.size()]);                </TD></TR><TR><TD CLASS="l">186</TD><TD>        }</TD></TR><TR><TD CLASS="l">187</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="a">188</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">189</TD><TD>         * @see org.eclipse.wst.jsdt.core.dom.ASTVisitor#visit(org.eclipse.wst.jsdt.core.dom.ConstructorInvocation)</TD></TR><TR><TD CLASS="l">190</TD><TD>         */</TD></TR><TR><TD CLASS="l">191</TD><TD>        public ITypeConstraint[] create(ConstructorInvocation invocation){</TD></TR><TR CLASS="z"><TD CLASS="l">192</TD><TD>                List arguments= invocation.arguments();</TD></TR><TR CLASS="z"><TD CLASS="l">193</TD><TD>                List result= new ArrayList(arguments.size());</TD></TR><TR CLASS="z"><TD CLASS="l">194</TD><TD>                IFunctionBinding methodBinding= invocation.resolveConstructorBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">195</TD><TD>                result.addAll(Arrays.asList(getArgumentConstraints(arguments, methodBinding)));</TD></TR><TR CLASS="z"><TD CLASS="l">196</TD><TD>                return (ITypeConstraint[]) result.toArray(new ITypeConstraint[result.size()]);</TD></TR><TR><TD CLASS="l">197</TD><TD>        }</TD></TR><TR><TD CLASS="l">198</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="b">199</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">200</TD><TD>         * @see org.eclipse.wst.jsdt.core.dom.ASTVisitor#visit(org.eclipse.wst.jsdt.core.dom.FieldAccess)</TD></TR><TR><TD CLASS="l">201</TD><TD>         */</TD></TR><TR><TD CLASS="l">202</TD><TD>        public ITypeConstraint[] create(FieldAccess access){</TD></TR><TR CLASS="z"><TD CLASS="l">203</TD><TD>                Expression expression= access.getExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">204</TD><TD>                SimpleName name= access.getName();</TD></TR><TR CLASS="z"><TD CLASS="l">205</TD><TD>                IBinding binding= name.resolveBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">206</TD><TD>                if (! (binding instanceof IVariableBinding))</TD></TR><TR CLASS="z"><TD CLASS="l">207</TD><TD>                        return new ITypeConstraint[0];        </TD></TR><TR CLASS="z"><TD CLASS="l">208</TD><TD>                IVariableBinding vb= (IVariableBinding)binding;</TD></TR><TR CLASS="z"><TD CLASS="l">209</TD><TD>                return createConstraintsForAccessToField(vb, expression, access);</TD></TR><TR><TD CLASS="l">210</TD><TD>        }</TD></TR><TR><TD CLASS="l">211</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="c">212</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">213</TD><TD>         * @see org.eclipse.wst.jsdt.core.dom.ASTVisitor#visit(org.eclipse.wst.jsdt.core.dom.FieldDeclaration)</TD></TR><TR><TD CLASS="l">214</TD><TD>         */</TD></TR><TR><TD CLASS="l">215</TD><TD>        public ITypeConstraint[] create(FieldDeclaration fd){</TD></TR><TR CLASS="z"><TD CLASS="l">216</TD><TD>                List result= new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">217</TD><TD>                result.addAll(Arrays.asList(getConstraintsFromFragmentList(fd.fragments(), fd.getType())));</TD></TR><TR CLASS="z"><TD CLASS="l">218</TD><TD>                result.addAll(getConstraintsForHiding(fd));</TD></TR><TR CLASS="z"><TD CLASS="l">219</TD><TD>                result.addAll(getConstraintsForFieldDeclaringTypes(fd));</TD></TR><TR CLASS="z"><TD CLASS="l">220</TD><TD>                return (ITypeConstraint[]) result.toArray(new ITypeConstraint[result.size()]);</TD></TR><TR><TD CLASS="l">221</TD><TD>        }</TD></TR><TR><TD CLASS="l">222</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="f">223</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">224</TD><TD>         * @see org.eclipse.wst.jsdt.core.dom.ASTVisitor#visit(org.eclipse.wst.jsdt.core.dom.InstanceofExpression)</TD></TR><TR><TD CLASS="l">225</TD><TD>         */</TD></TR><TR><TD CLASS="l">226</TD><TD>        public ITypeConstraint[] create(InstanceofExpression instanceofExpression){</TD></TR><TR CLASS="z"><TD CLASS="l">227</TD><TD>                Expression expression= instanceofExpression.getLeftOperand();</TD></TR><TR CLASS="z"><TD CLASS="l">228</TD><TD>                Type type= instanceofExpression.getRightOperand();</TD></TR><TR CLASS="z"><TD CLASS="l">229</TD><TD>                if (isClassBinding(expression.resolveTypeBinding()) &amp;&amp; isClassBinding(type.resolveBinding())) {</TD></TR><TR CLASS="z"><TD CLASS="l">230</TD><TD>                        ConstraintVariable expressionVar= fConstraintVariableFactory.makeExpressionOrTypeVariable(expression, getContext());</TD></TR><TR CLASS="z"><TD CLASS="l">231</TD><TD>                        ConstraintVariable typeVariable= fConstraintVariableFactory.makeTypeVariable(type);</TD></TR><TR CLASS="z"><TD CLASS="l">232</TD><TD>                        return createOrOrSubtypeConstraint(expressionVar, typeVariable);</TD></TR><TR><TD CLASS="l">233</TD><TD>                } else</TD></TR><TR CLASS="z"><TD CLASS="l">234</TD><TD>                        return new ITypeConstraint[0];</TD></TR><TR><TD CLASS="l">235</TD><TD>        }</TD></TR><TR><TD CLASS="l">236</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="9">237</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">238</TD><TD>         * @see org.eclipse.wst.jsdt.core.dom.ASTVisitor#visit(org.eclipse.wst.jsdt.core.dom.ConditionalExpression)</TD></TR><TR><TD CLASS="l">239</TD><TD>         */</TD></TR><TR><TD CLASS="l">240</TD><TD>        public ITypeConstraint[] create(ConditionalExpression node) {</TD></TR><TR CLASS="z"><TD CLASS="l">241</TD><TD>                List result= new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">242</TD><TD>                Expression thenExpression= node.getThenExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">243</TD><TD>                Expression elseExpression= node.getElseExpression();</TD></TR><TR CLASS="z"><TD CLASS="l">244</TD><TD>                ConstraintVariable whole= fConstraintVariableFactory.makeExpressionOrTypeVariable(node, getContext());</TD></TR><TR CLASS="z"><TD CLASS="l">245</TD><TD>                ConstraintVariable ev1= fConstraintVariableFactory.makeExpressionOrTypeVariable(thenExpression, getContext());</TD></TR><TR CLASS="z"><TD CLASS="l">246</TD><TD>                ConstraintVariable ev2= fConstraintVariableFactory.makeExpressionOrTypeVariable(elseExpression, getContext());</TD></TR><TR CLASS="z"><TD CLASS="l">247</TD><TD>                ITypeConstraint[] constraints1= fTypeConstraintFactory.createEqualsConstraint(ev1, ev2);</TD></TR><TR CLASS="z"><TD CLASS="l">248</TD><TD>                ITypeConstraint[] constraints2= fTypeConstraintFactory.createSubtypeConstraint(ev1, whole);</TD></TR><TR CLASS="z"><TD CLASS="l">249</TD><TD>                ITypeConstraint[] constraints3= fTypeConstraintFactory.createSubtypeConstraint(ev2, whole);</TD></TR><TR CLASS="z"><TD CLASS="l">250</TD><TD>                result.addAll(Arrays.asList(constraints1));</TD></TR><TR CLASS="z"><TD CLASS="l">251</TD><TD>                result.addAll(Arrays.asList(constraints2));</TD></TR><TR CLASS="z"><TD CLASS="l">252</TD><TD>                result.addAll(Arrays.asList(constraints3));</TD></TR><TR CLASS="z"><TD CLASS="l">253</TD><TD>                return (ITypeConstraint[])result.toArray(new ITypeConstraint[result.size()]);</TD></TR><TR><TD CLASS="l">254</TD><TD>        }</TD></TR><TR><TD CLASS="l">255</TD><TD>        </TD></TR><TR><TD CLASS="l"><A NAME="d">256</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">257</TD><TD>         * @see org.eclipse.wst.jsdt.core.dom.ASTVisitor#visit(org.eclipse.wst.jsdt.core.dom.FunctionDeclaration)</TD></TR><TR><TD CLASS="l">258</TD><TD>         */</TD></TR><TR><TD CLASS="l">259</TD><TD>        public ITypeConstraint[] create(FunctionDeclaration declaration){</TD></TR><TR CLASS="z"><TD CLASS="l">260</TD><TD>                List result= new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">261</TD><TD>                IFunctionBinding methodBinding= declaration.resolveBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">262</TD><TD>                if (methodBinding == null)</TD></TR><TR CLASS="z"><TD CLASS="l">263</TD><TD>                        return new ITypeConstraint[0];</TD></TR><TR CLASS="z"><TD CLASS="l">264</TD><TD>                ITypeConstraint[] constraints = fTypeConstraintFactory.createDefinesConstraint(</TD></TR><TR CLASS="z"><TD CLASS="l">265</TD><TD>                                fConstraintVariableFactory.makeDeclaringTypeVariable(methodBinding),</TD></TR><TR CLASS="z"><TD CLASS="l">266</TD><TD>                                fConstraintVariableFactory.makeRawBindingVariable(methodBinding.getDeclaringClass()));</TD></TR><TR CLASS="z"><TD CLASS="l">267</TD><TD>                result.addAll(Arrays.asList(constraints));</TD></TR><TR CLASS="z"><TD CLASS="l">268</TD><TD>                if (! methodBinding.isConstructor() &amp;&amp; ! methodBinding.getReturnType().isPrimitive()){</TD></TR><TR CLASS="z"><TD CLASS="l">269</TD><TD>                        ConstraintVariable returnTypeBindingVariable= fConstraintVariableFactory.makeReturnTypeVariable(methodBinding);</TD></TR><TR CLASS="z"><TD CLASS="l">270</TD><TD>                        ConstraintVariable returnTypeVariable= fConstraintVariableFactory.makeTypeVariable(declaration.getReturnType2());</TD></TR><TR CLASS="z"><TD CLASS="l">271</TD><TD>                        ITypeConstraint[] defines= fTypeConstraintFactory.createDefinesConstraint(</TD></TR><TR CLASS="z"><TD CLASS="l">272</TD><TD>                                        returnTypeBindingVariable, returnTypeVariable);</TD></TR><TR CLASS="z"><TD CLASS="l">273</TD><TD>                        result.addAll(Arrays.asList(defines));</TD></TR><TR><TD CLASS="l">274</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">275</TD><TD>                for (int i= 0, n= declaration.parameters().size(); i &lt; n; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">276</TD><TD>                        SingleVariableDeclaration paramDecl= (SingleVariableDeclaration)declaration.parameters().get(i);</TD></TR><TR CLASS="z"><TD CLASS="l">277</TD><TD>                        ConstraintVariable parameterTypeVariable= fConstraintVariableFactory.makeParameterTypeVariable(methodBinding, i);</TD></TR><TR CLASS="z"><TD CLASS="l">278</TD><TD>                        ConstraintVariable parameterNameVariable= fConstraintVariableFactory.makeExpressionOrTypeVariable(paramDecl.getName(), getContext());</TD></TR><TR CLASS="z"><TD CLASS="l">279</TD><TD>                        ITypeConstraint[] constraint= fTypeConstraintFactory.createDefinesConstraint(</TD></TR><TR CLASS="z"><TD CLASS="l">280</TD><TD>                                        parameterTypeVariable, parameterNameVariable);</TD></TR><TR CLASS="z"><TD CLASS="l">281</TD><TD>                        result.addAll(Arrays.asList(constraint));</TD></TR><TR><TD CLASS="l">282</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">283</TD><TD>                if (MethodChecks.isVirtual(methodBinding)){</TD></TR><TR CLASS="z"><TD CLASS="l">284</TD><TD>                        Collection constraintsForOverriding = getConstraintsForOverriding(methodBinding);</TD></TR><TR CLASS="z"><TD CLASS="l">285</TD><TD>                        result.addAll(constraintsForOverriding);</TD></TR><TR><TD CLASS="l">286</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">287</TD><TD>                return (ITypeConstraint[]) result.toArray(new ITypeConstraint[result.size()]);</TD></TR><TR><TD CLASS="l">288</TD><TD>        }</TD></TR><TR><TD CLASS="l">289</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="10">290</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">291</TD><TD>         * @see org.eclipse.wst.jsdt.internal.corext.refactoring.typeconstraints.ConstraintCreator#create(org.eclipse.wst.jsdt.core.dom.ParenthesizedExpression)</TD></TR><TR><TD CLASS="l">292</TD><TD>         */</TD></TR><TR><TD CLASS="l">293</TD><TD>        public ITypeConstraint[] create(ParenthesizedExpression node) {</TD></TR><TR CLASS="z"><TD CLASS="l">294</TD><TD>                ConstraintVariable v1= fConstraintVariableFactory.makeExpressionOrTypeVariable(node, getContext());</TD></TR><TR CLASS="z"><TD CLASS="l">295</TD><TD>                ConstraintVariable v2= fConstraintVariableFactory.makeExpressionOrTypeVariable(node.getExpression(), getContext());</TD></TR><TR CLASS="z"><TD CLASS="l">296</TD><TD>                ITypeConstraint[] equal= fTypeConstraintFactory.createEqualsConstraint(v1, v2);</TD></TR><TR CLASS="z"><TD CLASS="l">297</TD><TD>                return equal;</TD></TR><TR><TD CLASS="l">298</TD><TD>        }</TD></TR><TR><TD CLASS="l">299</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="e">300</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">301</TD><TD>         * @see org.eclipse.wst.jsdt.core.dom.ASTVisitor#visit(org.eclipse.wst.jsdt.core.dom.FunctionInvocation)</TD></TR><TR><TD CLASS="l">302</TD><TD>         */</TD></TR><TR><TD CLASS="l">303</TD><TD>        public ITypeConstraint[] create(FunctionInvocation invocation){</TD></TR><TR CLASS="z"><TD CLASS="l">304</TD><TD>                List arguments= invocation.arguments();</TD></TR><TR CLASS="z"><TD CLASS="l">305</TD><TD>                List result= new ArrayList(arguments.size());</TD></TR><TR CLASS="z"><TD CLASS="l">306</TD><TD>                IFunctionBinding methodBinding= invocation.resolveMethodBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">307</TD><TD>                if (methodBinding == null)</TD></TR><TR CLASS="z"><TD CLASS="l">308</TD><TD>                        return new ITypeConstraint[0];</TD></TR><TR CLASS="z"><TD CLASS="l">309</TD><TD>                ITypeConstraint[] returnTypeConstraint= getReturnTypeConstraint(invocation, methodBinding);</TD></TR><TR CLASS="z"><TD CLASS="l">310</TD><TD>                result.addAll(Arrays.asList(returnTypeConstraint));</TD></TR><TR CLASS="z"><TD CLASS="l">311</TD><TD>                result.addAll(Arrays.asList(getArgumentConstraints(arguments, methodBinding)));</TD></TR><TR CLASS="z"><TD CLASS="l">312</TD><TD>                if (invocation.getExpression() != null){</TD></TR><TR CLASS="z"><TD CLASS="l">313</TD><TD>                        if(MethodChecks.isVirtual(methodBinding)){</TD></TR><TR CLASS="z"><TD CLASS="l">314</TD><TD>                                IFunctionBinding[] rootDefs= getRootDefs(methodBinding);                </TD></TR><TR CLASS="z"><TD CLASS="l">315</TD><TD>                                Assert.isTrue(rootDefs.length &gt; 0);</TD></TR><TR CLASS="z"><TD CLASS="l">316</TD><TD>                                ConstraintVariable expressionVar= fConstraintVariableFactory.makeExpressionOrTypeVariable(invocation.getExpression(), getContext());</TD></TR><TR CLASS="z"><TD CLASS="l">317</TD><TD>                                if (rootDefs.length == 1){</TD></TR><TR CLASS="z"><TD CLASS="l">318</TD><TD>                                        result.addAll(Arrays.asList(fTypeConstraintFactory.createSubtypeConstraint(expressionVar, fConstraintVariableFactory.makeDeclaringTypeVariable(rootDefs[0]))));</TD></TR><TR><TD CLASS="l">319</TD><TD>                                }else{        </TD></TR><TR CLASS="z"><TD CLASS="l">320</TD><TD>                                        Collection/*&lt;ITypeConstraint&gt;*/ constraints= new ArrayList(); </TD></TR><TR CLASS="z"><TD CLASS="l">321</TD><TD>                                        for (int i= 0; i &lt; rootDefs.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">322</TD><TD>                                                ConstraintVariable rootDefTypeVar= fConstraintVariableFactory.makeDeclaringTypeVariable(rootDefs[i]);</TD></TR><TR CLASS="z"><TD CLASS="l">323</TD><TD>                                                ITypeConstraint[] tc= fTypeConstraintFactory.createSubtypeConstraint(expressionVar, rootDefTypeVar);</TD></TR><TR CLASS="z"><TD CLASS="l">324</TD><TD>                                                constraints.addAll(Arrays.asList(tc));</TD></TR><TR><TD CLASS="l">325</TD><TD>                                        }</TD></TR><TR CLASS="z"><TD CLASS="l">326</TD><TD>                                        ITypeConstraint[] constraintsArray= (ITypeConstraint[])constraints.toArray(new ITypeConstraint[constraints.size()]);</TD></TR><TR CLASS="z"><TD CLASS="l">327</TD><TD>                                        if (constraintsArray.length &gt; 0){</TD></TR><TR CLASS="z"><TD CLASS="l">328</TD><TD>                                                result.add(fTypeConstraintFactory.createCompositeOrTypeConstraint(constraintsArray));</TD></TR><TR><TD CLASS="l">329</TD><TD>                                        }</TD></TR><TR><TD CLASS="l">330</TD><TD>                                }</TD></TR><TR><TD CLASS="l">331</TD><TD>                        } else {</TD></TR><TR CLASS="z"><TD CLASS="l">332</TD><TD>                                ConstraintVariable typeVar= fConstraintVariableFactory.makeDeclaringTypeVariable(methodBinding);</TD></TR><TR CLASS="z"><TD CLASS="l">333</TD><TD>                                ConstraintVariable expressionVar= fConstraintVariableFactory.makeExpressionOrTypeVariable(invocation.getExpression(), getContext());</TD></TR><TR CLASS="z"><TD CLASS="l">334</TD><TD>                                result.addAll(Arrays.asList(fTypeConstraintFactory.createSubtypeConstraint(expressionVar, typeVar)));</TD></TR><TR><TD CLASS="l">335</TD><TD>                        }</TD></TR><TR><TD CLASS="l">336</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">337</TD><TD>                return (ITypeConstraint[]) result.toArray(new ITypeConstraint[result.size()]);</TD></TR><TR><TD CLASS="l">338</TD><TD>        }</TD></TR><TR><TD CLASS="l">339</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="11">340</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">341</TD><TD>         * @see org.eclipse.wst.jsdt.core.dom.ASTVisitor#visit(org.eclipse.wst.jsdt.core.dom.QualifiedName)</TD></TR><TR><TD CLASS="l">342</TD><TD>         */</TD></TR><TR><TD CLASS="l">343</TD><TD>        public ITypeConstraint[] create(QualifiedName qualifiedName){</TD></TR><TR CLASS="z"><TD CLASS="l">344</TD><TD>                SimpleName name= qualifiedName.getName();</TD></TR><TR CLASS="z"><TD CLASS="l">345</TD><TD>                Name qualifier= qualifiedName.getQualifier();</TD></TR><TR CLASS="z"><TD CLASS="l">346</TD><TD>                IBinding nameBinding= name.resolveBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">347</TD><TD>                if (nameBinding instanceof IVariableBinding){</TD></TR><TR CLASS="z"><TD CLASS="l">348</TD><TD>                        IVariableBinding vb= (IVariableBinding)nameBinding;</TD></TR><TR CLASS="z"><TD CLASS="l">349</TD><TD>                        if (vb.isField())</TD></TR><TR CLASS="z"><TD CLASS="l">350</TD><TD>                                return createConstraintsForAccessToField(vb, qualifier, qualifiedName);</TD></TR><TR><TD CLASS="l">351</TD><TD>                } //TODO other bindings </TD></TR><TR CLASS="z"><TD CLASS="l">352</TD><TD>                return new ITypeConstraint[0];                        </TD></TR><TR><TD CLASS="l">353</TD><TD>        }</TD></TR><TR><TD CLASS="l">354</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="12">355</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">356</TD><TD>         * @see org.eclipse.wst.jsdt.core.dom.ASTVisitor#visit(org.eclipse.wst.jsdt.core.dom.ReturnStatement)</TD></TR><TR><TD CLASS="l">357</TD><TD>         */</TD></TR><TR><TD CLASS="l">358</TD><TD>        public ITypeConstraint[] create(ReturnStatement returnStatement){</TD></TR><TR CLASS="z"><TD CLASS="l">359</TD><TD>                if (returnStatement.getExpression() == null)</TD></TR><TR CLASS="z"><TD CLASS="l">360</TD><TD>                        return new ITypeConstraint[0];</TD></TR><TR><TD CLASS="l">361</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">362</TD><TD>                ConstraintVariable returnTypeVariable= fConstraintVariableFactory.makeReturnTypeVariable(returnStatement);</TD></TR><TR CLASS="z"><TD CLASS="l">363</TD><TD>                return fTypeConstraintFactory.createSubtypeConstraint(</TD></TR><TR CLASS="z"><TD CLASS="l">364</TD><TD>                                fConstraintVariableFactory.makeExpressionOrTypeVariable(returnStatement.getExpression(), getContext()),</TD></TR><TR CLASS="z"><TD CLASS="l">365</TD><TD>                                returnTypeVariable);</TD></TR><TR><TD CLASS="l">366</TD><TD>        }</TD></TR><TR><TD CLASS="l">367</TD><TD>        </TD></TR><TR><TD CLASS="l"><A NAME="13">368</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">369</TD><TD>         * @see org.eclipse.wst.jsdt.core.dom.ASTVisitor#visit(org.eclipse.wst.jsdt.core.dom.SingleVariableDeclaration)</TD></TR><TR><TD CLASS="l">370</TD><TD>         */</TD></TR><TR><TD CLASS="l">371</TD><TD>        public ITypeConstraint[] create(SingleVariableDeclaration svd){</TD></TR><TR CLASS="z"><TD CLASS="l">372</TD><TD>                ITypeConstraint[] defines= fTypeConstraintFactory.createDefinesConstraint(</TD></TR><TR CLASS="z"><TD CLASS="l">373</TD><TD>                                fConstraintVariableFactory.makeExpressionOrTypeVariable(svd.getName(), getContext()),</TD></TR><TR CLASS="z"><TD CLASS="l">374</TD><TD>                                fConstraintVariableFactory.makeTypeVariable(svd.getType()));</TD></TR><TR CLASS="z"><TD CLASS="l">375</TD><TD>                if (svd.getInitializer() == null)</TD></TR><TR CLASS="z"><TD CLASS="l">376</TD><TD>                        return defines;        </TD></TR><TR CLASS="z"><TD CLASS="l">377</TD><TD>                ITypeConstraint[] constraints = fTypeConstraintFactory.createSubtypeConstraint(</TD></TR><TR CLASS="z"><TD CLASS="l">378</TD><TD>                                fConstraintVariableFactory.makeExpressionOrTypeVariable(svd.getInitializer(), getContext()),</TD></TR><TR CLASS="z"><TD CLASS="l">379</TD><TD>                                fConstraintVariableFactory.makeExpressionOrTypeVariable(svd.getName(), getContext()));</TD></TR><TR CLASS="z"><TD CLASS="l">380</TD><TD>                if (defines.length == 0 &amp;&amp; constraints.length == 0){</TD></TR><TR CLASS="z"><TD CLASS="l">381</TD><TD>                        return new ITypeConstraint[0];</TD></TR><TR CLASS="z"><TD CLASS="l">382</TD><TD>                } else if (defines.length == 0){</TD></TR><TR CLASS="z"><TD CLASS="l">383</TD><TD>                        return constraints;</TD></TR><TR CLASS="z"><TD CLASS="l">384</TD><TD>                } else if (constraints.length == 0){</TD></TR><TR CLASS="z"><TD CLASS="l">385</TD><TD>                        return defines;</TD></TR><TR><TD CLASS="l">386</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">387</TD><TD>                        List all= new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">388</TD><TD>                        all.addAll(Arrays.asList(defines));</TD></TR><TR CLASS="z"><TD CLASS="l">389</TD><TD>                        all.addAll(Arrays.asList(constraints));</TD></TR><TR CLASS="z"><TD CLASS="l">390</TD><TD>                        return (ITypeConstraint[])all.toArray();</TD></TR><TR><TD CLASS="l">391</TD><TD>                }</TD></TR><TR><TD CLASS="l">392</TD><TD>        }</TD></TR><TR><TD CLASS="l">393</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="14">394</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">395</TD><TD>         * @see org.eclipse.wst.jsdt.core.dom.ASTVisitor#visit(org.eclipse.wst.jsdt.core.dom.SuperConstructorInvocation)</TD></TR><TR><TD CLASS="l">396</TD><TD>         */</TD></TR><TR><TD CLASS="l">397</TD><TD>        public ITypeConstraint[] create(SuperConstructorInvocation invocation){</TD></TR><TR CLASS="z"><TD CLASS="l">398</TD><TD>                List arguments= invocation.arguments();</TD></TR><TR CLASS="z"><TD CLASS="l">399</TD><TD>                List result= new ArrayList(arguments.size());</TD></TR><TR CLASS="z"><TD CLASS="l">400</TD><TD>                IFunctionBinding methodBinding= invocation.resolveConstructorBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">401</TD><TD>                result.addAll(Arrays.asList(getArgumentConstraints(arguments, methodBinding)));</TD></TR><TR CLASS="z"><TD CLASS="l">402</TD><TD>                return (ITypeConstraint[]) result.toArray(new ITypeConstraint[result.size()]);</TD></TR><TR><TD CLASS="l">403</TD><TD>        }</TD></TR><TR><TD CLASS="l">404</TD><TD>        </TD></TR><TR><TD CLASS="l"><A NAME="15">405</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">406</TD><TD>         * @see org.eclipse.wst.jsdt.core.dom.ASTVisitor#visit(org.eclipse.wst.jsdt.core.dom.SuperFieldAccess)</TD></TR><TR><TD CLASS="l">407</TD><TD>         */</TD></TR><TR><TD CLASS="l">408</TD><TD>        public ITypeConstraint[] create(SuperFieldAccess access){</TD></TR><TR CLASS="z"><TD CLASS="l">409</TD><TD>                SimpleName name= access.getName();</TD></TR><TR CLASS="z"><TD CLASS="l">410</TD><TD>                IBinding binding= name.resolveBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">411</TD><TD>                if (! (binding instanceof IVariableBinding))</TD></TR><TR CLASS="z"><TD CLASS="l">412</TD><TD>                        return new ITypeConstraint[0];        </TD></TR><TR CLASS="z"><TD CLASS="l">413</TD><TD>                IVariableBinding vb= (IVariableBinding)binding;</TD></TR><TR CLASS="z"><TD CLASS="l">414</TD><TD>                return createConstraintsForAccessToField(vb, null, access);</TD></TR><TR><TD CLASS="l">415</TD><TD>        }</TD></TR><TR><TD CLASS="l">416</TD><TD>                </TD></TR><TR><TD CLASS="l"><A NAME="16">417</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">418</TD><TD>         * @see org.eclipse.wst.jsdt.core.dom.ASTVisitor#visit(org.eclipse.wst.jsdt.core.dom.SuperMethodInvocation)</TD></TR><TR><TD CLASS="l">419</TD><TD>         */</TD></TR><TR><TD CLASS="l">420</TD><TD>        public ITypeConstraint[] create(SuperMethodInvocation invocation){</TD></TR><TR CLASS="z"><TD CLASS="l">421</TD><TD>                List arguments= invocation.arguments();</TD></TR><TR CLASS="z"><TD CLASS="l">422</TD><TD>                List result= new ArrayList(arguments.size());</TD></TR><TR CLASS="z"><TD CLASS="l">423</TD><TD>                IFunctionBinding methodBinding= invocation.resolveMethodBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">424</TD><TD>                ITypeConstraint[] returnTypeConstraint= getReturnTypeConstraint(invocation, methodBinding);</TD></TR><TR CLASS="z"><TD CLASS="l">425</TD><TD>                result.addAll(Arrays.asList(returnTypeConstraint));</TD></TR><TR CLASS="z"><TD CLASS="l">426</TD><TD>                result.addAll(Arrays.asList(getArgumentConstraints(arguments, methodBinding)));</TD></TR><TR CLASS="z"><TD CLASS="l">427</TD><TD>                return (ITypeConstraint[]) result.toArray(new ITypeConstraint[result.size()]);</TD></TR><TR><TD CLASS="l">428</TD><TD>        }</TD></TR><TR><TD CLASS="l">429</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="17">430</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">431</TD><TD>         * @see org.eclipse.wst.jsdt.core.dom.ASTVisitor#visit(org.eclipse.wst.jsdt.core.dom.ThisExpression)</TD></TR><TR><TD CLASS="l">432</TD><TD>         */</TD></TR><TR><TD CLASS="l">433</TD><TD>        public ITypeConstraint[] create(ThisExpression expression){</TD></TR><TR CLASS="z"><TD CLASS="l">434</TD><TD>                ConstraintVariable thisExpression= fConstraintVariableFactory.makeExpressionOrTypeVariable(expression, getContext());</TD></TR><TR CLASS="z"><TD CLASS="l">435</TD><TD>                ConstraintVariable declaringType= fConstraintVariableFactory.makeRawBindingVariable(expression.resolveTypeBinding());//TODO fix this - can't use Decl(M) because 'this' can live outside of methods</TD></TR><TR CLASS="z"><TD CLASS="l">436</TD><TD>                return fTypeConstraintFactory.createDefinesConstraint(thisExpression, declaringType);</TD></TR><TR><TD CLASS="l">437</TD><TD>        }</TD></TR><TR><TD CLASS="l">438</TD><TD>        </TD></TR><TR><TD CLASS="l"><A NAME="18">439</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">440</TD><TD>         * @see org.eclipse.wst.jsdt.core.dom.ASTVisitor#visit(org.eclipse.wst.jsdt.core.dom.VariableDeclarationExpression)</TD></TR><TR><TD CLASS="l">441</TD><TD>         */</TD></TR><TR><TD CLASS="l">442</TD><TD>        public ITypeConstraint[] create(VariableDeclarationExpression vde){</TD></TR><TR CLASS="z"><TD CLASS="l">443</TD><TD>                return getConstraintsFromFragmentList(vde.fragments(), vde.getType());</TD></TR><TR><TD CLASS="l">444</TD><TD>        }</TD></TR><TR><TD CLASS="l">445</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="19">446</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">447</TD><TD>         * @see org.eclipse.wst.jsdt.core.dom.ASTVisitor#visit(org.eclipse.wst.jsdt.core.dom.VariableDeclarationFragment)</TD></TR><TR><TD CLASS="l">448</TD><TD>         */</TD></TR><TR><TD CLASS="l">449</TD><TD>        public ITypeConstraint[] create(VariableDeclarationFragment vdf){</TD></TR><TR CLASS="z"><TD CLASS="l">450</TD><TD>                if (vdf.getInitializer() == null)</TD></TR><TR CLASS="z"><TD CLASS="l">451</TD><TD>                        return new ITypeConstraint[0];        </TD></TR><TR CLASS="z"><TD CLASS="l">452</TD><TD>                return fTypeConstraintFactory.createSubtypeConstraint(</TD></TR><TR CLASS="z"><TD CLASS="l">453</TD><TD>                                fConstraintVariableFactory.makeExpressionOrTypeVariable(vdf.getInitializer(), getContext()),</TD></TR><TR CLASS="z"><TD CLASS="l">454</TD><TD>                                fConstraintVariableFactory.makeExpressionOrTypeVariable(vdf.getName(), getContext()));</TD></TR><TR><TD CLASS="l">455</TD><TD>        }</TD></TR><TR><TD CLASS="l">456</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="1a">457</A></TD><TD>        /* (non-Javadoc)</TD></TR><TR><TD CLASS="l">458</TD><TD>         * @see org.eclipse.wst.jsdt.core.dom.ASTVisitor#visit(org.eclipse.wst.jsdt.core.dom.VariableDeclarationStatement)</TD></TR><TR><TD CLASS="l">459</TD><TD>         */</TD></TR><TR><TD CLASS="l">460</TD><TD>        public ITypeConstraint[] create(VariableDeclarationStatement vds){</TD></TR><TR CLASS="z"><TD CLASS="l">461</TD><TD>                return getConstraintsFromFragmentList(vds.fragments(), vds.getType());</TD></TR><TR><TD CLASS="l">462</TD><TD>        }</TD></TR><TR><TD CLASS="l">463</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="22">464</A></TD><TD> </TD></TR><TR><TD CLASS="l">465</TD><TD>        //--------- private helpers ----------------//</TD></TR><TR><TD CLASS="l">466</TD><TD>        </TD></TR><TR><TD CLASS="l">467</TD><TD>        private Collection getConstraintsForFieldDeclaringTypes(FieldDeclaration fd) {</TD></TR><TR CLASS="z"><TD CLASS="l">468</TD><TD>                Collection result= new ArrayList(fd.fragments().size());</TD></TR><TR CLASS="z"><TD CLASS="l">469</TD><TD>                for (Iterator iter= fd.fragments().iterator(); iter.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">470</TD><TD>                        VariableDeclarationFragment varDecl= (VariableDeclarationFragment) iter.next();</TD></TR><TR CLASS="z"><TD CLASS="l">471</TD><TD>                        IVariableBinding binding= varDecl.resolveBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">472</TD><TD>                        Assert.isTrue(binding.isField());</TD></TR><TR CLASS="z"><TD CLASS="l">473</TD><TD>                        result.addAll(Arrays.asList(fTypeConstraintFactory.createDefinesConstraint(</TD></TR><TR CLASS="z"><TD CLASS="l">474</TD><TD>                                        fConstraintVariableFactory.makeDeclaringTypeVariable(binding),</TD></TR><TR CLASS="z"><TD CLASS="l">475</TD><TD>                                        fConstraintVariableFactory.makeRawBindingVariable(binding.getDeclaringClass()))));</TD></TR><TR><TD CLASS="l">476</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="23">477</A></TD><TD>                return result;</TD></TR><TR><TD CLASS="l">478</TD><TD>        }</TD></TR><TR><TD CLASS="l">479</TD><TD>        </TD></TR><TR><TD CLASS="l">480</TD><TD>        private Collection getConstraintsForHiding(FieldDeclaration fd) {</TD></TR><TR CLASS="z"><TD CLASS="l">481</TD><TD>                Collection result= new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">482</TD><TD>                for (Iterator iter= fd.fragments().iterator(); iter.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">483</TD><TD>                        result.addAll(getConstraintsForHiding((VariableDeclarationFragment) iter.next()));</TD></TR><TR><TD CLASS="l">484</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="24">485</A></TD><TD>                return result;</TD></TR><TR><TD CLASS="l">486</TD><TD>        }</TD></TR><TR><TD CLASS="l">487</TD><TD>        </TD></TR><TR><TD CLASS="l">488</TD><TD>        private Collection getConstraintsForHiding(VariableDeclarationFragment fragment) {</TD></TR><TR CLASS="z"><TD CLASS="l">489</TD><TD>                Collection result= new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">490</TD><TD>                IVariableBinding fieldBinding= fragment.resolveBinding();</TD></TR><TR CLASS="z"><TD CLASS="l">491</TD><TD>                Assert.isTrue(fieldBinding.isField());</TD></TR><TR CLASS="z"><TD CLASS="l">492</TD><TD>                Set declaringTypes= getDeclaringSuperTypes(fieldBinding);</TD></TR><TR CLASS="z"><TD CLASS="l">493</TD><TD>                ConstraintVariable hiddingFieldVar= fConstraintVariableFactory.makeDeclaringTypeVariable(fieldBinding);</TD></TR><TR CLASS="z"><TD CLASS="l">494</TD><TD>                for (Iterator iter= declaringTypes.iterator(); iter.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">495</TD><TD>                        ITypeBinding declaringSuperType= (ITypeBinding) iter.next();</TD></TR><TR CLASS="z"><TD CLASS="l">496</TD><TD>                        IVariableBinding hiddenField= findField(fieldBinding, declaringSuperType);</TD></TR><TR CLASS="z"><TD CLASS="l">497</TD><TD>                        Assert.isTrue(hiddenField.isField());</TD></TR><TR CLASS="z"><TD CLASS="l">498</TD><TD>                        ConstraintVariable hiddenFieldVar= fConstraintVariableFactory.makeDeclaringTypeVariable(hiddenField);</TD></TR><TR CLASS="z"><TD CLASS="l">499</TD><TD>                        result.addAll(Arrays.asList(fTypeConstraintFactory.createStrictSubtypeConstraint(hiddingFieldVar, hiddenFieldVar)));</TD></TR><TR><TD CLASS="l">500</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="26">501</A></TD><TD>                return result;</TD></TR><TR><TD CLASS="l">502</TD><TD>        }</TD></TR><TR><TD CLASS="l">503</TD><TD>        </TD></TR><TR><TD CLASS="l">504</TD><TD>        private ITypeConstraint[] getConstraintsFromFragmentList(List fragments, Type type) {</TD></TR><TR CLASS="z"><TD CLASS="l">505</TD><TD>                int size= fragments.size();</TD></TR><TR CLASS="z"><TD CLASS="l">506</TD><TD>                ConstraintVariable typeVariable= fConstraintVariableFactory.makeTypeVariable(type);</TD></TR><TR CLASS="z"><TD CLASS="l">507</TD><TD>                List result= new ArrayList((size * (size - 1))/2);</TD></TR><TR CLASS="z"><TD CLASS="l">508</TD><TD>                for (int i= 0; i &lt; size; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">509</TD><TD>                        VariableDeclarationFragment fragment1= (VariableDeclarationFragment) fragments.get(i);</TD></TR><TR CLASS="z"><TD CLASS="l">510</TD><TD>                        SimpleName fragment1Name= fragment1.getName();</TD></TR><TR CLASS="z"><TD CLASS="l">511</TD><TD>                        result.addAll(Arrays.asList(fTypeConstraintFactory.createDefinesConstraint(</TD></TR><TR CLASS="z"><TD CLASS="l">512</TD><TD>                                        fConstraintVariableFactory.makeExpressionOrTypeVariable(fragment1Name, getContext()),</TD></TR><TR CLASS="z"><TD CLASS="l">513</TD><TD>                                        typeVariable)));</TD></TR><TR CLASS="z"><TD CLASS="l">514</TD><TD>                        for (int j= i + 1; j &lt; size; j++) {</TD></TR><TR CLASS="z"><TD CLASS="l">515</TD><TD>                                VariableDeclarationFragment fragment2= (VariableDeclarationFragment) fragments.get(j);</TD></TR><TR CLASS="z"><TD CLASS="l">516</TD><TD>                                result.addAll(Arrays.asList(fTypeConstraintFactory.createEqualsConstraint(</TD></TR><TR CLASS="z"><TD CLASS="l">517</TD><TD>                                                fConstraintVariableFactory.makeExpressionOrTypeVariable(fragment1Name, getContext()),</TD></TR><TR CLASS="z"><TD CLASS="l">518</TD><TD>                                                fConstraintVariableFactory.makeExpressionOrTypeVariable(fragment2.getName(), getContext()))));</TD></TR><TR><TD CLASS="l">519</TD><TD>                        }</TD></TR><TR><TD CLASS="l">520</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="25">521</A></TD><TD>                return (ITypeConstraint[]) result.toArray(new ITypeConstraint[result.size()]);</TD></TR><TR><TD CLASS="l">522</TD><TD>        }</TD></TR><TR><TD CLASS="l">523</TD><TD>        </TD></TR><TR><TD CLASS="l">524</TD><TD>        private Collection getConstraintsForOverriding(IFunctionBinding overriddingMethod) {</TD></TR><TR CLASS="z"><TD CLASS="l">525</TD><TD>                Collection result= new ArrayList();</TD></TR><TR CLASS="z"><TD CLASS="l">526</TD><TD>                Set declaringSupertypes= getDeclaringSuperTypes(overriddingMethod);</TD></TR><TR CLASS="z"><TD CLASS="l">527</TD><TD>                for (Iterator iter= declaringSupertypes.iterator(); iter.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">528</TD><TD>                        ITypeBinding superType= (ITypeBinding) iter.next();</TD></TR><TR CLASS="z"><TD CLASS="l">529</TD><TD>                        IFunctionBinding overriddenMethod= findMethod(overriddingMethod, superType);</TD></TR><TR CLASS="z"><TD CLASS="l">530</TD><TD>                        Assert.isNotNull(overriddenMethod);//because we asked for declaring types</TD></TR><TR CLASS="z"><TD CLASS="l">531</TD><TD>                        if (Bindings.equals(overriddingMethod, overriddenMethod)) continue;</TD></TR><TR CLASS="z"><TD CLASS="l">532</TD><TD>                        ITypeConstraint[] returnTypeConstraint= fTypeConstraintFactory.createEqualsConstraint(</TD></TR><TR CLASS="z"><TD CLASS="l">533</TD><TD>                                        fConstraintVariableFactory.makeReturnTypeVariable(overriddenMethod),</TD></TR><TR CLASS="z"><TD CLASS="l">534</TD><TD>                                        fConstraintVariableFactory.makeReturnTypeVariable(overriddingMethod));</TD></TR><TR CLASS="z"><TD CLASS="l">535</TD><TD>                        result.addAll(Arrays.asList(returnTypeConstraint));</TD></TR><TR CLASS="z"><TD CLASS="l">536</TD><TD>                        Assert.isTrue(overriddenMethod.getParameterTypes().length == overriddingMethod.getParameterTypes().length);</TD></TR><TR CLASS="z"><TD CLASS="l">537</TD><TD>                        for (int i= 0, n= overriddenMethod.getParameterTypes().length; i &lt; n; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">538</TD><TD>                                ITypeConstraint[] parameterTypeConstraint= fTypeConstraintFactory.createEqualsConstraint(</TD></TR><TR CLASS="z"><TD CLASS="l">539</TD><TD>                                                fConstraintVariableFactory.makeParameterTypeVariable(overriddenMethod, i),</TD></TR><TR CLASS="z"><TD CLASS="l">540</TD><TD>                                                fConstraintVariableFactory.makeParameterTypeVariable(overriddingMethod, i));</TD></TR><TR CLASS="z"><TD CLASS="l">541</TD><TD>                                result.addAll(Arrays.asList(parameterTypeConstraint));</TD></TR><TR><TD CLASS="l">542</TD><TD>                        }</TD></TR><TR CLASS="z"><TD CLASS="l">543</TD><TD>                        ITypeConstraint[] declaringTypeConstraint= fTypeConstraintFactory.createStrictSubtypeConstraint(</TD></TR><TR CLASS="z"><TD CLASS="l">544</TD><TD>                                        fConstraintVariableFactory.makeDeclaringTypeVariable(overriddingMethod),</TD></TR><TR CLASS="z"><TD CLASS="l">545</TD><TD>                                        fConstraintVariableFactory.makeDeclaringTypeVariable(overriddenMethod));</TD></TR><TR CLASS="z"><TD CLASS="l">546</TD><TD>                        result.addAll(Arrays.asList(declaringTypeConstraint));</TD></TR><TR><TD CLASS="l">547</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="2a">548</A></TD><TD>                return result;</TD></TR><TR><TD CLASS="l">549</TD><TD>        }</TD></TR><TR><TD CLASS="l">550</TD><TD>        </TD></TR><TR><TD CLASS="l">551</TD><TD>        private ITypeConstraint[] getReturnTypeConstraint(Expression invocation, IFunctionBinding methodBinding){</TD></TR><TR CLASS="z"><TD CLASS="l">552</TD><TD>                if (methodBinding == null || methodBinding.isConstructor() || methodBinding.getReturnType().isPrimitive())</TD></TR><TR CLASS="z"><TD CLASS="l">553</TD><TD>                        return new ITypeConstraint[0];</TD></TR><TR CLASS="z"><TD CLASS="l">554</TD><TD>                ConstraintVariable returnTypeVariable= fConstraintVariableFactory.makeReturnTypeVariable(methodBinding);</TD></TR><TR CLASS="z"><TD CLASS="l">555</TD><TD>                ConstraintVariable invocationVariable= fConstraintVariableFactory.makeExpressionOrTypeVariable(invocation, getContext());</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1f">556</A></TD><TD>                return fTypeConstraintFactory.createDefinesConstraint(invocationVariable, returnTypeVariable);</TD></TR><TR><TD CLASS="l">557</TD><TD>        }</TD></TR><TR><TD CLASS="l">558</TD><TD>        </TD></TR><TR><TD CLASS="l">559</TD><TD>        private ITypeConstraint[] getArgumentConstraints(List arguments, IFunctionBinding methodBinding){</TD></TR><TR CLASS="z"><TD CLASS="l">560</TD><TD>                List result= new ArrayList(arguments.size());</TD></TR><TR CLASS="z"><TD CLASS="l">561</TD><TD>                for (int i= 0, n= arguments.size(); i &lt; n; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">562</TD><TD>                        Expression argument= (Expression) arguments.get(i);</TD></TR><TR CLASS="z"><TD CLASS="l">563</TD><TD>                        ConstraintVariable expressionVariable= fConstraintVariableFactory.makeExpressionOrTypeVariable(argument, getContext());</TD></TR><TR CLASS="z"><TD CLASS="l">564</TD><TD>                        ConstraintVariable parameterTypeVariable= fConstraintVariableFactory.makeParameterTypeVariable(methodBinding, i);</TD></TR><TR CLASS="z"><TD CLASS="l">565</TD><TD>                        ITypeConstraint[] argConstraint= fTypeConstraintFactory.createSubtypeConstraint(expressionVariable, parameterTypeVariable);</TD></TR><TR CLASS="z"><TD CLASS="l">566</TD><TD>                        result.addAll(Arrays.asList(argConstraint));</TD></TR><TR><TD CLASS="l">567</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="2c">568</A></TD><TD>                return (ITypeConstraint[]) result.toArray(new ITypeConstraint[result.size()]);                </TD></TR><TR><TD CLASS="l">569</TD><TD>        }</TD></TR><TR><TD CLASS="l">570</TD><TD>        </TD></TR><TR><TD CLASS="l">571</TD><TD>        private static Type getTypeParent(ArrayInitializer arrayInitializer) {</TD></TR><TR CLASS="z"><TD CLASS="l">572</TD><TD>                if (arrayInitializer.getParent() instanceof ArrayCreation){</TD></TR><TR CLASS="z"><TD CLASS="l">573</TD><TD>                        return ((ArrayCreation)arrayInitializer.getParent()).getType().getElementType();</TD></TR><TR CLASS="z"><TD CLASS="l">574</TD><TD>                } else if (arrayInitializer.getParent() instanceof ArrayInitializer){</TD></TR><TR CLASS="z"><TD CLASS="l">575</TD><TD>                        return getTypeParent((ArrayInitializer) arrayInitializer.getParent());</TD></TR><TR CLASS="z"><TD CLASS="l">576</TD><TD>                } else if (arrayInitializer.getParent() instanceof VariableDeclaration){</TD></TR><TR CLASS="z"><TD CLASS="l">577</TD><TD>                        VariableDeclaration parent= (VariableDeclaration)arrayInitializer.getParent();</TD></TR><TR><TD CLASS="l">578</TD><TD>                        </TD></TR><TR CLASS="z"><TD CLASS="l">579</TD><TD>                        if (parent.getParent() instanceof VariableDeclarationStatement){</TD></TR><TR CLASS="z"><TD CLASS="l">580</TD><TD>                                Type type= ((VariableDeclarationStatement)parent.getParent()).getType();</TD></TR><TR CLASS="z"><TD CLASS="l">581</TD><TD>                                return ASTNodes.getElementType(type);</TD></TR><TR CLASS="z"><TD CLASS="l">582</TD><TD>                        } else if (parent.getParent() instanceof VariableDeclarationExpression){</TD></TR><TR CLASS="z"><TD CLASS="l">583</TD><TD>                                Type type= ((VariableDeclarationExpression)parent.getParent()).getType();</TD></TR><TR CLASS="z"><TD CLASS="l">584</TD><TD>                                return ASTNodes.getElementType(type);</TD></TR><TR CLASS="z"><TD CLASS="l">585</TD><TD>                        } else if (parent.getParent() instanceof FieldDeclaration){</TD></TR><TR CLASS="z"><TD CLASS="l">586</TD><TD>                                Type type= ((FieldDeclaration)parent.getParent()).getType();</TD></TR><TR CLASS="z"><TD CLASS="l">587</TD><TD>                                return ASTNodes.getElementType(type);</TD></TR><TR><TD CLASS="l">588</TD><TD>                        }</TD></TR><TR><TD CLASS="l">589</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">590</TD><TD>                Assert.isTrue(false);//array initializers are allowed in only 2 places</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1c">591</A></TD><TD>                return null;</TD></TR><TR><TD CLASS="l">592</TD><TD>        }</TD></TR><TR><TD CLASS="l">593</TD><TD>        </TD></TR><TR><TD CLASS="l">594</TD><TD>        private ITypeConstraint[] createOrOrSubtypeConstraint(ConstraintVariable var1, ConstraintVariable var2){</TD></TR><TR CLASS="z"><TD CLASS="l">595</TD><TD>                ITypeConstraint[] c1= fTypeConstraintFactory.createSubtypeConstraint(var1, var2);</TD></TR><TR CLASS="z"><TD CLASS="l">596</TD><TD>                ITypeConstraint[] c2= fTypeConstraintFactory.createSubtypeConstraint(var2, var1);</TD></TR><TR CLASS="z"><TD CLASS="l">597</TD><TD>                if (c1.length == 0 &amp;&amp; c2.length == 0){</TD></TR><TR CLASS="z"><TD CLASS="l">598</TD><TD>                        return new ITypeConstraint[0];</TD></TR><TR><TD CLASS="l">599</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1b">600</A></TD><TD>                return new ITypeConstraint[]{ fTypeConstraintFactory.createCompositeOrTypeConstraint(new ITypeConstraint[]{c1[0], c2[0]}) };</TD></TR><TR><TD CLASS="l">601</TD><TD>        }</TD></TR><TR><TD CLASS="l">602</TD><TD>        </TD></TR><TR><TD CLASS="l">603</TD><TD>        private ITypeConstraint[] createConstraintsForAccessToField(IVariableBinding fieldBinding, Expression qualifier, Expression accessExpression){</TD></TR><TR CLASS="z"><TD CLASS="l">604</TD><TD>                Assert.isTrue(fieldBinding.isField());</TD></TR><TR CLASS="z"><TD CLASS="l">605</TD><TD>                ITypeConstraint[] defines= fTypeConstraintFactory.createDefinesConstraint(</TD></TR><TR CLASS="z"><TD CLASS="l">606</TD><TD>                                fConstraintVariableFactory.makeExpressionOrTypeVariable(accessExpression, getContext()),</TD></TR><TR CLASS="z"><TD CLASS="l">607</TD><TD>                                fConstraintVariableFactory.makeRawBindingVariable(fieldBinding.getType()));</TD></TR><TR CLASS="z"><TD CLASS="l">608</TD><TD>                if (qualifier == null)</TD></TR><TR CLASS="z"><TD CLASS="l">609</TD><TD>                        return defines;</TD></TR><TR CLASS="z"><TD CLASS="l">610</TD><TD>                ITypeConstraint[] subType= fTypeConstraintFactory.createSubtypeConstraint(</TD></TR><TR CLASS="z"><TD CLASS="l">611</TD><TD>                                fConstraintVariableFactory.makeExpressionOrTypeVariable(qualifier, getContext()),</TD></TR><TR CLASS="z"><TD CLASS="l">612</TD><TD>                                fConstraintVariableFactory.makeDeclaringTypeVariable(fieldBinding));</TD></TR><TR><TD CLASS="l">613</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">614</TD><TD>                if (defines.length == 0){</TD></TR><TR CLASS="z"><TD CLASS="l">615</TD><TD>                        return subType;</TD></TR><TR CLASS="z"><TD CLASS="l">616</TD><TD>                } else if (subType.length == 0){</TD></TR><TR CLASS="z"><TD CLASS="l">617</TD><TD>                        return defines;</TD></TR><TR><TD CLASS="l">618</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">619</TD><TD>                        return new ITypeConstraint[]{defines[0], subType[0]};</TD></TR><TR><TD CLASS="l"><A NAME="1d">620</A></TD><TD>                }</TD></TR><TR><TD CLASS="l">621</TD><TD>        }</TD></TR><TR><TD CLASS="l">622</TD><TD>        </TD></TR><TR><TD CLASS="l">623</TD><TD>        private static IVariableBinding findField(IVariableBinding fieldBinding, ITypeBinding type) {</TD></TR><TR CLASS="z"><TD CLASS="l">624</TD><TD>                if (fieldBinding.getDeclaringClass().equals(type))</TD></TR><TR CLASS="z"><TD CLASS="l">625</TD><TD>                        return fieldBinding;</TD></TR><TR CLASS="z"><TD CLASS="l">626</TD><TD>                return Bindings.findFieldInType(type, fieldBinding.getName());</TD></TR><TR><TD CLASS="l">627</TD><TD>        }</TD></TR><TR><TD CLASS="l">628</TD><TD>        </TD></TR><TR><TD CLASS="l"><A NAME="29">629</A></TD><TD>        /* </TD></TR><TR><TD CLASS="l">630</TD><TD>         * return Set of ITypeBindings</TD></TR><TR><TD CLASS="l">631</TD><TD>         */</TD></TR><TR><TD CLASS="l">632</TD><TD>        private static Set getDeclaringSuperTypes(IVariableBinding fieldBinding) {</TD></TR><TR CLASS="z"><TD CLASS="l">633</TD><TD>                ITypeBinding[] allSuperTypes= Bindings.getAllSuperTypes(fieldBinding.getDeclaringClass());</TD></TR><TR CLASS="z"><TD CLASS="l">634</TD><TD>                Set result= new HashSet();</TD></TR><TR CLASS="z"><TD CLASS="l">635</TD><TD>                for (int i= 0; i &lt; allSuperTypes.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">636</TD><TD>                        ITypeBinding type= allSuperTypes[i];</TD></TR><TR CLASS="z"><TD CLASS="l">637</TD><TD>                        if (findField(fieldBinding, type) != null)</TD></TR><TR CLASS="z"><TD CLASS="l">638</TD><TD>                                result.add(type);</TD></TR><TR><TD CLASS="l">639</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">640</TD><TD>                return result;</TD></TR><TR><TD CLASS="l"><A NAME="2b">641</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">642</TD><TD>        </TD></TR><TR><TD CLASS="l">643</TD><TD>        //--- RootDef ----//</TD></TR><TR><TD CLASS="l">644</TD><TD>        protected static IFunctionBinding[] getRootDefs(IFunctionBinding methodBinding) {</TD></TR><TR CLASS="z"><TD CLASS="l">645</TD><TD>                Set/*&lt;ITypeBinding&gt;*/ declaringSuperTypes= getDeclaringSuperTypes(methodBinding);</TD></TR><TR CLASS="z"><TD CLASS="l">646</TD><TD>                Set/*&lt;IFunctionBinding&gt;*/ result= new LinkedHashSet();</TD></TR><TR CLASS="z"><TD CLASS="l">647</TD><TD>                for (Iterator iter= declaringSuperTypes.iterator(); iter.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">648</TD><TD>                        ITypeBinding type= (ITypeBinding) iter.next();</TD></TR><TR CLASS="z"><TD CLASS="l">649</TD><TD>                        if (! containsASuperType(type, declaringSuperTypes))</TD></TR><TR CLASS="z"><TD CLASS="l">650</TD><TD>                                result.add(findMethod(methodBinding, type));</TD></TR><TR><TD CLASS="l">651</TD><TD>                }</TD></TR><TR><TD CLASS="l">652</TD><TD>                </TD></TR><TR CLASS="z"><TD CLASS="l">653</TD><TD>                if (result.size() == 0){</TD></TR><TR CLASS="z"><TD CLASS="l">654</TD><TD>                        result.add(methodBinding);</TD></TR><TR><TD CLASS="l">655</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">656</TD><TD>                return (IFunctionBinding[]) result.toArray(new IFunctionBinding[result.size()]);</TD></TR><TR><TD CLASS="l">657</TD><TD>        }</TD></TR><TR><TD CLASS="l">658</TD><TD>        </TD></TR><TR><TD CLASS="l">659</TD><TD>        /* </TD></TR><TR><TD CLASS="l">660</TD><TD>         * @param declaringSuperTypes Set of ITypeBindings</TD></TR><TR><TD CLASS="l"><A NAME="3">661</A></TD><TD>         * @return &lt;code&gt;true&lt;/code&gt; iff &lt;code&gt;declaringSuperTypes&lt;/code&gt; contains a type</TD></TR><TR><TD CLASS="l">662</TD><TD>         *                 which is a strict supertype of &lt;code&gt;type&lt;/code&gt;</TD></TR><TR><TD CLASS="l">663</TD><TD>         */</TD></TR><TR><TD CLASS="l">664</TD><TD>        private static boolean containsASuperType(ITypeBinding type, Set declaringSuperTypes) {</TD></TR><TR CLASS="z"><TD CLASS="l">665</TD><TD>                for (Iterator iter= declaringSuperTypes.iterator(); iter.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">666</TD><TD>                        ITypeBinding maybeSuperType= (ITypeBinding) iter.next();</TD></TR><TR CLASS="z"><TD CLASS="l">667</TD><TD>                        if (! Bindings.equals(maybeSuperType, type) &amp;&amp; Bindings.isSuperType(maybeSuperType, type))</TD></TR><TR CLASS="z"><TD CLASS="l">668</TD><TD>                                return true;</TD></TR><TR><TD CLASS="l">669</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">670</TD><TD>                return false;</TD></TR><TR><TD CLASS="l">671</TD><TD>        }</TD></TR><TR><TD CLASS="l">672</TD><TD>        </TD></TR><TR><TD CLASS="l"><A NAME="28">673</A></TD><TD>        /* </TD></TR><TR><TD CLASS="l">674</TD><TD>         * return Set of ITypeBindings</TD></TR><TR><TD CLASS="l">675</TD><TD>         */</TD></TR><TR><TD CLASS="l">676</TD><TD>        protected static Set getDeclaringSuperTypes(IFunctionBinding methodBinding) {</TD></TR><TR CLASS="z"><TD CLASS="l">677</TD><TD>                ITypeBinding superClass = methodBinding.getDeclaringClass();</TD></TR><TR CLASS="z"><TD CLASS="l">678</TD><TD>                Set allSuperTypes= new LinkedHashSet();</TD></TR><TR CLASS="z"><TD CLASS="l">679</TD><TD>                allSuperTypes.addAll(Arrays.asList(Bindings.getAllSuperTypes(superClass)));</TD></TR><TR CLASS="z"><TD CLASS="l">680</TD><TD>                if (allSuperTypes.isEmpty())</TD></TR><TR CLASS="z"><TD CLASS="l">681</TD><TD>                        allSuperTypes.add(methodBinding.getDeclaringClass()); //TODO: Why only iff empty? The declaring class is not a supertype ...</TD></TR><TR CLASS="z"><TD CLASS="l">682</TD><TD>                Set result= new HashSet();</TD></TR><TR CLASS="z"><TD CLASS="l">683</TD><TD>                for (Iterator iter= allSuperTypes.iterator(); iter.hasNext();) {</TD></TR><TR CLASS="z"><TD CLASS="l">684</TD><TD>                        ITypeBinding type= (ITypeBinding) iter.next();</TD></TR><TR CLASS="z"><TD CLASS="l">685</TD><TD>                        if (findMethod(methodBinding, type) != null)</TD></TR><TR CLASS="z"><TD CLASS="l">686</TD><TD>                                result.add(type);</TD></TR><TR><TD CLASS="l">687</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="1e">688</A></TD><TD>                return result;</TD></TR><TR><TD CLASS="l">689</TD><TD>        }</TD></TR><TR><TD CLASS="l">690</TD><TD>        </TD></TR><TR><TD CLASS="l">691</TD><TD>        protected static IFunctionBinding findMethod(IFunctionBinding methodBinding, ITypeBinding type) {</TD></TR><TR CLASS="z"><TD CLASS="l">692</TD><TD>                if (methodBinding.getDeclaringClass().equals(type))</TD></TR><TR CLASS="z"><TD CLASS="l">693</TD><TD>                        return methodBinding;</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="2d">694</A></TD><TD>                return Bindings.findOverriddenMethodInType(type, methodBinding);</TD></TR><TR><TD CLASS="l">695</TD><TD>        }</TD></TR><TR><TD CLASS="l">696</TD><TD> </TD></TR><TR><TD CLASS="l">697</TD><TD>        private static boolean isClassBinding(ITypeBinding typeBinding){</TD></TR><TR CLASS="z"><TD CLASS="l">698</TD><TD>                return typeBinding != null &amp;&amp; typeBinding.isClass();</TD></TR><TR><TD CLASS="l">699</TD><TD>        }</TD></TR><TR><TD CLASS="l">700</TD><TD>        </TD></TR><TR><TD CLASS="l">701</TD><TD>}</TD></TR></TABLE><P></P><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TD CLASS="nv">[<A HREF="../xslUnitTestCoverage.html">all classes</A>][<A HREF="14b.html">org.eclipse.wst.jsdt.internal.corext.refactoring.typeconstraints</A>]</TD></TR><TR><TD CLASS="tl"><A HREF="http://www.eclemma.org/support.html">EMMA 2.0.5312 EclEmma Fix 1</A> (C) Vladimir Roubtsov</TD></TR></TABLE></BODY></HTML>